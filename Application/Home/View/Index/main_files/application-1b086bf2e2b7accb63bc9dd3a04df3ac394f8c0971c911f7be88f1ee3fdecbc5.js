var Yourls=function(e,t){"use strict";function i(e){return e?e.join?e.join("."):e.toString():null}return e.Cache={set:function(e,t,n){lscache.set(i(e),t,n)},get:function(t,n,r){t=i(t);var a=lscache.get(t);if(null!=a)return a;switch(typeof n){case"undefined":return null;case"function":return a=n(),e.Cache.set(t,a,r),a;default:return n}},fetch:function(t,n,r,a){t=i(t);var o=lscache.get(t);if(null!=o)return n(o);switch(typeof r){case"undefined":return n(null);case"function":return r(function(i){i&&e.Cache.set(t,i,a),n(i)});default:return n(r)}},flush:function(){lscache.flush()}},e}(Yourls||{},jQuery),Yourls=function(e,t,i){"use strict";return e.Util={hashCode:function(e){var t,i=0,n=e.length;if(0==n)return i;for(var r=0;n>r;r++)t=e.charCodeAt(r),i=(i<<5)-i+t,i&=2147483647;return i},toBase26:function(e){for(var t,i=Math.round(e).toString(26),n="",r=i.length,e=0;r>e;e++)t=i.charCodeAt(e),t+=97>t?49:10,n+=String.fromCharCode(t);return n},toMoment:function(e){"string"==typeof e&&(e=new Date(e));var t=moment(e||new Date);return t.locale(I18n.currentLocale()),t._lang||t.locale(I18n.currentLocale().toLowerCase()),t._lang||t.locale(I18n.currentLocale().replace(/-.*$/,"")),t._lang||t.locale(I18n.defaultLocale),t},now:Date.now||function(){return(new Date).getTime()},debounce:function(t,i,n){var r,a,o,s,d,l=function(){var c=e.Util.now()-s;i>c&&c>=0?r=setTimeout(l,i-c):(r=null,n||(d=t.apply(o,a),r||(o=a=null)))};return function(){o=this,a=arguments,s=e.Util.now();var c=n&&!r;return r||(r=setTimeout(l,i)),c&&(d=t.apply(o,a),o=a=null),d}},throttle:function(e,t){var i,n=!1;return function(){i?n=!0:(e.call(),i=setInterval(function(){e.call(),n?n=!1:i=clearInterval(i)&&void 0},t))}},shortenNumberToString:function(e,t){var i,n=["k","M","G","T","P","E","Z","Y"];if(1e3>e)return e.toFixed(t);for(var r=n.length-1;r>=0;r--)if(i=Math.pow(1e3,r+1),-i>=e||e>=i)return+(e/i).toFixed(t)+n[r];return e}},String.prototype.hashCode=function(){return e.Util.hashCode(this)},String.prototype.toMoment=Date.prototype.toMoment=function(){return e.Util.toMoment(this)},String.prototype.isNumber=function(){return/^\d+$/.test(this)},String.prototype.inferType=function(){return this.isNumber()?parseInt(this):this},String.prototype.repeat=function(e){for(var t="";e-->0;)t+=this;return t},Number.prototype.toBase26=function(){return e.Util.toBase26(this)},i.SECOND=1,i.MINUTE=60*i.SECOND,i.HOUR=60*i.MINUTE,i.DAY=24*i.HOUR,i.WEEK=7*i.DAY,moment.fn.compare=function(t){return moment.isMoment(t)||(t=e.Util.toMoment(t)),this.isSame(t)?0:t>this?-1:1},e}(Yourls||{},jQuery,this),Yourls=function(Yourls,$){"use strict";return Yourls.initialized=!1,Yourls.root={},Yourls.selectors={root:"body",main:"main",header:"#header",submenu:"main > nav.submenu",pages:"#pages",searchBar:"#searchbar",urllists:".widget-urllist ul.urllist",todolists:".widget-todo ul.task-list",sections:"section.section",sectionColumns:"section.columns",columns:"section.column",widget:"article.widget",addWidget:".add-widget-placeholder",footerAd:"#footer-ad",footer:"#footer"},Yourls.dom={},Yourls.pages=null,Yourls.activePage=null,Yourls.activePageId=0,Yourls.noRenderPage=-1,Yourls.tags=null,Yourls.embedded=!1,Yourls.searchProviders=null,Yourls.search=null,Yourls.user=null,Yourls.faviconProvider=function(){return window.favicon_provider?window.favicon_provider:"http://%{hostname[0]}.getfavicon.appspot.com/http://%{domain}?defaulticon=none"},Yourls.init=function(e){function t(){this.initPagesMenu(),this.initMeMenu(),this.initSubmenu(),this.hasSearch()&&(this.search=new Yourls.Search(Yourls.dom.searchBar),Yourls.postpone(function(){Yourls.search.initialize()})),this.initEmbeddedPageLinks(),this.initFooter(),this.initHeader(),this.initChallengeResponse(),this.initExtensionIntegration(),Yourls.initialized=!0,$(Yourls).trigger("initialized"),this.processHashCommands(),$(window).on("hashchange",$.proxy(this.processHashCommands,this)),this.reportExtension(),this.ping(),measureEnd("postrender"),i.resolve()}var i=$.Deferred();return measure("prerender"),this.initErrorHandler(),this.initAjax(),this.initEmbedding(),this.cacheDomReferences(),this.pages=new Yourls.Pages,this.tags=new Yourls.Tags,(this.hasSearch()||this.isDisplayingPage())&&(this.searchProviders=new Yourls.Search.Providers,this.monitorSearchProviders(),this.searchProviders.initialize()),window.CurrentUser&&window.CurrentUser.id&&(this.user=new Yourls.User(window.CurrentUser),this.imports=new Yourls.Import,this.exports=new Yourls.Export),$(Yourls.Model).on("loginStatus",$.proxy(this.loginChange,this)),measureEnd("prerender"),measure("build"),$.isFunction(e)&&(e=e()),this.setActivePage(),this.buildPage(e).fail(function(){e&&e.pages&&this.updatePagesData(e.pages)}.bind(this)).always(function(){measureEnd("build"),measureEnd("loading"),$(document.body).removeClass("rendering"),measure("postrender"),setTimeout(t.bind(this),10)}.bind(this)),i.promise()},Yourls.postpone=function(e,t){function i(){Yourls.initialized?setTimeout(n,10):$(Yourls).on("initialized",i)}function n(){for(;r.length;)setTimeout($.proxy(function(){measure("postponed"),this(),measureEnd("postponed")},r.shift()),0)}var r=Yourls.postponedTasks=Yourls.postponedTasks||[];r.length||i(),r.push($.proxy(e,t||Yourls))},Yourls.isDebug=function(){return $(document.body).hasClass("development")?!0:$(document.body).hasClass("staging")?!0:/[&?]debug=1/.test(location.search)?!0:!1},Yourls.hasSearch=function(){return this.dom.searchBar.length},Yourls.monitorSearchProviders=function(){var e=this;$(Yourls.searchProviders).on("loaded",function(){e.search&&e.search.selectDefaultProvider()})},Yourls.isDisplayingPage=function(){return 0!=this.dom.pages.length},Yourls.isPrimarySite=function(){return window.primaryDomain==location.hostname},Yourls.getActivePage=function(){return this.activePage},Yourls.getActivePageId=function(){return Yourls.activePageId||null},Yourls.setActivePage=function(e){if(Yourls.activePageId=Yourls.noRenderPage,!e){var t=$("#pages");if(!t.length)return;var e=parseInt(t.data("active-page-id"));if(isNaN(e))return}Yourls.activePageId=e},Yourls.userOwnsActivePage=function(){var e=this.getActivePage();return e&&this.activePage.isOwned()},Yourls.userCanEditActivePage=function(){var e=this.getActivePage();return e&&e.isEditable()},Yourls.buildPage=function(e){var t=$.Deferred();return this.isDisplayingPage()?(Yourls.Model.build({buildSuccess:function(){this.render.apply(this,arguments),t.resolve()}.bind(this),buildError:$.proxy(this.offline,this),buildMenuSuccess:$.proxy(this.updatePagesData,this),data:e}),t.promise()):t.reject().promise()},Yourls.initErrorHandler=function(){var e=[];window.Bugsnag.beforeNotify=function(t,i){try{var n=Math.floor(36e4*Math.random()),r=Math.floor(36e4*Math.random()),a="#"+n.toString(36).toUpperCase()+"-"+r.toString(36).toUpperCase();window.Bugsnag.user.name=a,i.history=i.history||{},i.history.ajax=e;var o=[];$("script").each(function(){var e=$(this);o.push({src:e.attr("src"),type:e.attr("type"),summary:$.trim(e.text()).slice(0,200)})}),i.resources=i.resources||{},i.resources.scripts=o;var s=t.file&&/assets\.start\.me|\/assets\//.test(t.file);Yourls.isDebug()&&(s=!0),i.ajax&&(s=!0),s&&"error"==t.severity&&window.setTimeout(function(){Yourls.Logger.error(t,i),Yourls.fatalError(t.name+": "+t.message,a,t,i)},100)}catch(d){i.errorHandlerError=d}return!0},$(document).on("ajaxSend",function(t,i,n){e.splice(0,0,{timestamp:(new Date).toString(),url:n.url,type:n.type,dataType:n.dataType,data:n.data,async:n.async,global:n.global,isLocal:n.isLocal,cache:n.cache,crossDomain:n.crossDomain}).splice(20)})},Yourls.initPagesMenu=function(){var e=$("#pages-menu").disableSelection();e.click(function(){var e=Yourls.getPagesMenu();e.isVisible()?e.hide():Yourls.showPagesMenu()}),this.isEmbedded()||($(document).on("keydown",function(e){e.altKey&&e.shiftKey&&(e.charCode||$(e.target).is(":input:not(#search)")||Yourls.showPagesMenu())}),Yourls.addMenuDroppable())},Yourls.getPagesMenu=function(){return Yourls.pagesMenu||(Yourls.pagesMenu=new Yourls.PagesMenu({user:Yourls.user})),Yourls.pagesMenu},Yourls.showPagesMenu=function(e){function t(){window.setTimeout(function(){var e=Yourls.getActivePage();e&&e.adjustColumns()},100)}var i=Yourls.getPagesMenu();if(i.isVisible())return void i.focusSearch();$("#pages-menu").addClass("expanded");var n=$.Deferred();return Yourls.getPagesMenu().show($.extend(e,{closed:function(){$("#pages-menu").removeClass("expanded"),n.resolve()},stackUpdated:t})),Yourls.gtmEvent("Navigation",{item:"PagesMenu"}),n.promise()},Yourls.getImport=function(){return Yourls["import"]||(Yourls["import"]=new Yourls.Import),Yourls["import"]},Yourls.getExport=function(){return Yourls["export"]||(Yourls["export"]=new Yourls.Export),Yourls["export"]},Yourls.initNotifications=function(){return location.hash?!1:this.isDisplayingPage()?this.isEmbedded()||window!=window.top?!1:Yourls.user?Yourls.showTour()?!0:Yourls.showAnonymousNotification()?!0:Yourls.getImport().showNotification()?!0:Yourls.showExtensionNotification()?!0:Yourls.showStartpageNotification()?!0:Yourls.showUnreadNotification():Yourls.showSignupPopup()?!0:void 0:!1},Yourls.showUnreadNotification=function(){var e=this.getUnreadNotification();return e?(this.showNotification(e.message,{actionText:e.link_title,actionUrl:e.url,action:function(e){e()},closed:function(){Yourls.user.setLastReadNotificationTimeStamp(e.timestamp)}}),!0):!1},Yourls.isBrowser=function(e){for(var t in arguments)if(arguments.hasOwnProperty(t)&&$("html").hasClass("is-"+arguments[t].toString().replace(/[\s_]+/,"-").toLowerCase()))return!0},Yourls.isMobileBrowser=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(navigator.userAgent)},Yourls.getBrowser=function(){var e;return $.each(["firefox","safari","chrome","internet-explorer","opera","palemoon","edge","iron"],function(){return Yourls.isBrowser(this)?e=this:void 0}),e},Yourls.getAvailableBrowserExtensions=function(){return["chrome","firefox","palemoon","opera"]},Yourls.isBrowserExtensionAvailable=function(e){return $.inArray(e,Yourls.getAvailableBrowserExtensions())>=0},Yourls.hasBrowserExtension=function(e){function t(e){r=r||i.hasClass("has-"+e+"-extension")}var i=$("html"),n=e?$.makeArray(e):Yourls.getAvailableBrowserExtensions(),r=!1;return $.each(n,function(){if(Yourls.isBrowser(this))switch(this){case"palemoon":t("firefox");break;default:t(this)}}),r},Yourls.reportExtension=function(){function e(){var e={path:"/",expires:7};if(Yourls.hasBrowserExtension()){var t=Yourls.getBrowser(),i=$("html").data(t+"-extension")||"";$.cookie("has-extension",t+i,e)}else $.removeCookie("has-extension",e)}setTimeout(e,1e3)},Yourls.installBrowserExtension=function(e){switch(e||Yourls.getBrowser()){case"chrome":return Yourls.installChromeExtension();case"firefox":case"palemoon":return Yourls.installFirefoxExtension();case"opera":return Yourls.installOperaExtension();default:return $.Deferred().reject("No extension for browser available").promise()}},Yourls.installChromeExtension=function(){var e=$.Deferred();if(!Yourls.isBrowser("chrome")||!window.chrome||!window.chrome.app)return e.reject("Not Chrome browser").promise();Yourls.hasBrowserExtension("chrome")&&e.reject("Extension already installed").promise();var t=$('link[rel="chrome-webstore-item"]').attr("href");if(!t)return e.reject("Extension not available").promise();try{window.chrome.webstore.install(t,function(){e.resolve()},function(t){e.reject(t)})}catch(i){e.reject(i)}return e.promise()},Yourls.installFirefoxExtension=function(){var e=$.Deferred();if(!Yourls.isBrowser("firefox","palemoon")||!window.InstallTrigger||!window.InstallTrigger.enabled())return e.reject("Not Firefox browser").promise();Yourls.hasBrowserExtension()&&e.reject("Extension already installed").promise();var t=$('link[rel="firefox-extension-xpi"]'),i=t.attr("href"),n=t.data("hash");return InstallTrigger.install({"start.me":{URL:i,Hash:n,toString:function(){return i}}}),window.setTimeout(e.resolve,3e3),e.promise()},Yourls.installOperaExtension=function(){var e=$.Deferred();if(!(Yourls.isBrowser("opera")&&window.opr&&window.opr.addons&&window.opr.addons.installExtension))return e.reject("Not opera browser").promise();Yourls.hasBrowserExtension("opera")&&e.reject("Extension already installed").promise();var t=$('meta[property="aoc:app_id"]'),i=t.attr("content");return window.opr.addons.installExtension(i,e.resolve,e.reject),e.promise()},Yourls.showTour=function(){return Yourls.user&&Yourls.user.getSignInCount()<=2&&!Yourls.user.tourNotificationShown()?(setTimeout($.proxy(Yourls.startTour,Yourls),1e3),!0):void 0},Yourls.showExtensionNotification=function(){if(location.hostname!=window.primaryDomain&&!Yourls.isDebug())return!1;if(Yourls.isMobileBrowser())return!1;var e=!1;return $.each(["chrome","firefox","opera"],function(t,i){return!Yourls.isBrowser(i)||Yourls.hasBrowserExtension(i)||Yourls.user.extensionNotificationShown(i)?void 0:(Yourls.embedPage("/users/wizard/"+i,{closed:function(){Yourls.user.setExtensionNotificationShown(i)}}),e=!0,!1)}),e},Yourls.showStartpageNotification=function(){if(!Yourls.isEditable())return!1;if(Yourls.hasBrowserExtension())return!1;if(Yourls.isBrowser("palemoon"))return!1;if(Yourls.user.startPageNotificationShown())return!1;var e=Yourls.getBrowser()||"generic";return Yourls.embedPage("/users/wizard/startpage/"+e,{closed:function(){Yourls.user.setStartPageNotificationShown()},noFallback:!0})!==!1?!0:void 0},Yourls.showAnonymousNotification=function(){return Yourls.user&&Yourls.user.shouldSeeAnonymousNotification()&&Yourls.embedPage("/users/sign_up/anonymous",{hideUntilLoaded:!0,noFallback:!0,once:!0})!==!1?(Yourls.user.setAnonymousNotificationShown(),!0):void 0},Yourls.showSignupPopup=function(){if(!Yourls.user&&Yourls.isPrimarySite()&&Yourls.root.hasClass("default-page")){var e="last-signup-popup",t=$.cookie(e,Number)||0,i=Math.round((new Date).valueOf()/1e3);if(!(i-t<30*DAY))return setTimeout(function(){Yourls.hasEmbeddedPages()||Yourls.embedPage("/welcome",{hideUntilLoaded:!0,noFallback:!0,closed:function(){$.cookie(e,i,{path:"/",expires:30})}})},5e3),!0}},Yourls.showNotification=function(e,t){function i(){$(document.body).removeClass("show-notification-bar"),$.isFunction(t.closed)&&t.closed()}t=$.extend({actionText:null,actionUrl:null,actionTarget:"_blank",action:null,icon:null,canClose:!0,autoClose:null,type:"info",closed:function(){}},t);var n=$("#notification-bar").empty().removeClass("info alert error").addClass(t.type);if(!n.length)return!1;var r=$(Yourls.markdown(e,{paragraphTag:"<div>"})).addClass("message").appendTo(n);if((t.actionUrl||t.action)&&$("<a/>").addClass("read-more").appendTo(r.last()).attr("href",t.actionUrl).attr("target",t.actionTarget).text(t.actionText||I18n.t("read_more")).click(function(){$.isFunction(t.action)&&t.action(i)}),t.icon&&$("<i>").addClass("fa fa-fw icon").addClass(t.icon).prependTo(r.first()),t.canClose){var a=$("<i/>").addClass("close fa fa-fw fa-times").prependTo(n).attr("title",I18n.t("close"));a.click(i)}$(document.body).addClass("show-notification-bar"),t.autoClose&&window.setTimeout(i,t.autoClose)},Yourls.showConfirmation=function(e){Yourls.showNotification(e,{autoClose:3e3,icon:"fa-check"})},Yourls.getUnreadNotification=function(){var e=Yourls.user.lastReadNotificationTimeStamp(),t=!1;return $.each(Yourls.Model.getNotifications(),function(){return(null==this.has_extension||this.has_extension==Yourls.hasBrowserExtension())&&this.timestamp>e?(t=this,!1):void 0}),t},Yourls.isSecure=function(){return"https:"==location.protocol.toLowerCase()},Yourls.isEmbedded=function(){return $(document.documentElement).hasClass("embedded")},Yourls.initEmbeddedPageLinks=function(){$("a[data-embed]").click(function(e){var t=$(this),i="once"==t.data("embed"),n=t.data("embed-url")||t.attr("href"),r=!!t.data("embed-force"),a=parseInt(t.data("embed-width"))||!1,o=parseInt(t.data("embed-height"))||!1;e.preventDefault(),Yourls.embedPage(n,{once:i,checkDomain:!r,maxWidth:a,maxHeight:o})})},Yourls.embedPage=function(e,t){function i(){o.empty(),setTimeout(function(){o.removeClass("show"),setTimeout(function(){o.remove()},200)},200),$(window).off("message",l),$(document.documentElement).removeClass("show-embedded-page"),t.closed()}if(window.topYourls!=Yourls)return window.topYourls.embedPage(e,t);Yourls.closeEmbeddedPages(),t=$.extend({checkDomain:!0,noFallback:!1,hideUntilLoaded:!1,maxWidth:!1,maxHeight:!1,once:!1,closed:function(){}},t);var n=$("<a>").attr("href",e)[0];if(t.checkDomain&&n.hostname&&n.hostname!=window.primaryDomain&&n.hostname!=window.location.hostname||this.isEmbedded()||window.innerWidth<750)return t.noFallback?!1:void Yourls.UrlHelper.openUrl(n.href);var r=t.once?"embed_once":"embed";if(!/\bembed(_once)?=1\b/.test(n.search)){var a=n.search;a&&(a+="&"),n.search=a+r+"=1"}$(document.documentElement).addClass("show-embedded-page");var o=$("<aside>").addClass("embedded-page").toggleClass("hide",t.hideUntilLoaded),s=$("<iframe>").attr({seamless:"seamless",scrolling:"auto",allowTransparency:!0,allowFullScreen:!0}).appendTo(o),d=($("<i>").addClass("loader fa fa-spin fa-circle-o-notch").appendTo(o),$("<i>").addClass("closer").text("\xd7").appendTo(o));t.maxWidth&&s.css("max-width",t.maxWidth),t.maxHeight&&s.css("max-height",t.maxHeight),s.on("load",function(){o.removeClass("hide").addClass("loaded")});var l;$(window).on("message",l=function(e){if(e.originalEvent&&e.originalEvent.data)switch(e.originalEvent.data){case"iframe_change":o.removeClass("loaded");break;case"iframe_loading":o.addClass("loaded"),$(s.prop("contentDocument").body).click(function(e){"BODY"==e.target.tagName&&i()})}}),s.attr({src:n.href}),o.click(i),d.click(i),o.on("close",i),o.appendTo(document.body),setTimeout($.proxy(o.addClass,o,"show"),100)},Yourls.hasEmbeddedPages=function(){return $("aside.embedded-page").length>0},Yourls.closeEmbeddedPages=function(){$("aside.embedded-page").trigger("close")},Yourls.hideEmbeddedPageOverlay=function(){$("aside.embedded-page").removeClass("show")},Yourls.updatePagesData=function(e){Yourls.pages.setData(e),Yourls.pages.setActivePage(Yourls.getActivePageId())},Yourls.getEditablePages=function(e){return Yourls.pages.filter(function(t){return(t.is_owner||t.is_editor)&&!(t.is_active&&e)})},Yourls.isEditable=function(){return this.isDisplayingPage()&&this.userCanEditActivePage()&&!this.isEmbedded()},Yourls.isEditing=function(){return Yourls.root.hasClass("editing")},Yourls.hasTouchScreen=function(){return Featurizr.touch},Yourls.canDragWithoutEditing=function(){return!Yourls.hasTouchScreen()},Yourls.isAutoFocusEnabled=function(){return!Yourls.hasTouchScreen()},Yourls.shouldOpenLinksInNewWindow=function(){return!Yourls.root.hasClass("open-links-here")&&Yourls.Model.openLinksInNewWindow()},Yourls.shouldMonetizeUrls=function(){return!Yourls.user||Yourls.user.isAdmin()||!Yourls.user.isPremium()},Yourls.setPageOrder=function(e){Yourls.pages.sort(function(t,i){return e.indexOf(t.id)-e.indexOf(i.id)});var t=[];Yourls.pages.each(function(e,i){t.push({id:i.id,owner:i.is_owner})}),Yourls.ajaxSave({url:"/pages/menu",type:"patch",data:JSON.stringify({menu:t}),dataType:"json",contentType:"application/json"})},Yourls.deletePage=function(e,t){$.ajax({url:"/page/"+e+".json",method:"DELETE",blocking:e==Yourls.getActivePageId()}).done(t)},Yourls.createPage=function(e,t){e=$.extend({title:I18n.t("new_page_title"),column_count:3,organization_id:null},e);var i={title:e.title,column_count:e.column_count,organization_id:e.organization_id,is_public:!1};for(var n in i)i.hasOwnProperty(n)&&(null==i[n]||"undefined"==typeof i[n])&&delete i[n];$.ajax({url:"/pages.json",type:"POST",contentType:"application/json",data:JSON.stringify(i),dataType:"json",blocking:!0}).done(function(e){"url"in e&&(window.location.href=e.url),$.isFunction(t)&&t()})},Yourls.updatePage=function(e,t,i){$.isPlainObject(t)||(t={});var n=$.extend({},Yourls.pages.get(e)),r={id:e},a="title description is_public is_listed is_organization_only organization_id editor_ids column_count background widget_transparency".split(" ");for(var o in a){var s=a[o];if(!(!s in t)){var d=t[s];null!=d&&(r[s]=d)}}Yourls.ajaxSave({url:"/pages/"+e+".json",type:"put",contentType:"application/json",data:JSON.stringify(r),dataType:"json",success:function(e){var t=Yourls.pages.get(e.page.id);$.extend(t,e.page);var r=Yourls.getActivePageId()==e.page.id;Featurizr.history&&r&&window.history.replaceState(null,null,e.page.url),r&&$.extend(Yourls.getActivePage().data,t);var a="organization_id is_public".split(" "),o=!1;for(var s in a){var d=a[s],l=n[d]||null,c=e.page[d]||null;o=o||l!=c}var u=!1;u=$.isFunction(i)?!i(o)&&o:o,Yourls.pages.triggerChanged(),u&&window.location.reload()}})},Yourls.initLoggedIn=function(){var e=Yourls.Model.loggedIn();1==e?Yourls.root.addClass("logged-in").removeClass("not-logged-in"):Yourls.root.removeClass("logged-in").addClass("not-logged-in")},Yourls.loginChange=function(e,t){this.initLoggedIn(),t.loggedIn||t.timeout&&(Yourls.Model.clearUserCache(),Yourls.Model.clearMenuCache(),Yourls.Model.clearSearchProviderCache(),window.location.href="/"),Yourls.initNotifications()},Yourls.startTour=function(){function e(){Yourls.user.setTourNotificationShown()}var t=Yourls.getEditablePages().shift();t&&(t=t.url+"#tour"),Yourls.Tour.start().done(function(){e()}).fail(function(i,n){var r=Yourls.user.isAnonymous()?I18n.t("tour.take_time"):I18n.t("tour.thanks_for_signing_up").replace("\n"," ");switch(n){case 1:break;case 3:if(t){Yourls.showNotification(r,{actionText:I18n.t("continue"),actionUrl:t,actionTarget:"_top",closed:e});break}default:Yourls.showNotification(r,{closed:e})}})},Yourls.initMeMenu=function(){var e=$("#me");e.click(function(t){t.preventDefault(),e.addClass("expanded"),Yourls.showMeMenu({closed:function(){e.removeClass("expanded")}}),Yourls.gtmEvent("Navigation",{item:"MeMenu"})})},Yourls.showMeMenu=function(e){function t(){var e=Yourls.user&&Yourls.user.isAnonymous(),t=[];e?t.push({caption:I18n.t("devise.create_profile"),icon:"fa-user-plus",action:function(){Yourls.embedPage("/users/sign_up/anonymous",{once:!0})}}):t.push($.extend({caption:I18n.t("devise.account"),icon:"fa-user",url:"/users/edit"},Yourls.user.isPremium()?{rightIcon:"fa-heart always-show red",rightIconTitle:I18n.t("premium")}:{})),!Yourls.user.isPremium()&&t.push({caption:I18n.t("upgrade_to_premium"),icon:"fa-heart",url:"/premium",action:$.proxy(Yourls.embedPage,Yourls,"/premium"),rightIcon:"fa-thumbs-up always-show blue"}),t.push({caption:I18n.t("preferences"),icon:"fa-sliders",url:"/users/settings"});var i=Yourls.getActivePage();i&&Yourls.isEditable()&&t.push({caption:I18n.t("background"),icon:"fa-picture-o",action:$.proxy(Yourls.editPageDialog,Yourls,i.id,{activeTab:"layout"})}),t.push({caption:I18n.t("import_and_export"),icon:"fa-exchange",action:function(){Yourls.getImport().showSidebar(Yourls.getActivePageId())}}),Yourls.user&&Yourls.user.isAdmin()&&t.push({caption:"Admin menu",icon:"fa-gears",url:"https://admin.start.me"}),t=t.concat(["-",{caption:I18n.t("about_us"),icon:"fa-info-circle",url:window.primaryBaseUrl+"/about"},{caption:I18n.t("feedback"),icon:"fa-comments-o",action:$.proxy(Yourls.showFeedbackDialog,Yourls)},{caption:I18n.t("channels.title"),icon:"fa-rss",url:window.primaryBaseUrl+"/channels"},{caption:I18n.t("blog"),icon:"fa-bullhorn",url:"http://blog.start.me"},{caption:I18n.t("help"),icon:"fa-question",url:window.primaryBaseUrl+"/support",target:"_top","class":"help"}]),Yourls.Tour.isSupported()&&t.push({caption:I18n.t("tour.take_a_tour"),icon:"fa-road",action:$.proxy(Yourls.startTour,Yourls),"class":"editable-only"});var n=Yourls.getBrowser();return Yourls.hasBrowserExtension(n)||t.push({caption:I18n.t("setup.make_startpage"),action:function(){Yourls.embedPage("/users/wizard/startpage/"+n)},icon:"fa-home"}),t=t.concat(["-",{caption:I18n.t("for_education"),icon:"fa-graduation-cap",url:window.primaryBaseUrl+"/education"},{caption:I18n.t("for_teams"),icon:"fa-users",url:window.primaryBaseUrl+"/business"},"-",{caption:I18n.t("Logout"),icon:"fa-sign-out",action:function(){Yourls.user.signOut()}}]),Yourls.user.isImpersonated()&&t.push({caption:I18n.t("depersonate"),icon:"fa-level-up",url:"/impersonate/revert",method:"delete"}),Yourls.isBrowserExtensionAvailable(n)&&!Yourls.hasBrowserExtension(n)&&(t.push("-"),t.push({caption:I18n.t(["wizard",n,"install"]),action:function(){Yourls.embedPage("/users/wizard/"+n)},"class":"browser-logo "+n})),t}Yourls.user&&Yourls.sidebar(null,$.extend({side:"right",buttons:t(),hasClose:!1},e))},Yourls.initSubmenu=function(){function e(e){var t=e.first(),i=t.innerWidth()-1,n=0,r=e.children("li");r.each(function(){var e=$(this);e.hasClass("more")||(n+=$(this).outerWidth(!0))});var a=n>i;t.toggleClass("has-overflow",a),a&&(r.filter(".active, .more, .has-subitems").each(function(){i-=$(this).outerWidth(!0)}),r.each(function(){var e=$(this);e.is(".active, .more, .has-subitems")?e.removeClass("overflown"):(i-=e.outerWidth(!0),e.toggleClass("overflown",0>i))}))}function t(e){var t=[];return e.children("li.overflown").each(function(){var e=$(this);t.push({caption:$.trim(e.text()),url:e.find("a").attr("href")})}),t}function i(e){var t=[];return e.children("a.subitem").each(function(){var e=$(this);t.push({caption:$.trim(e.text()),url:e.attr("href"),icon:e.data("icon"),active:!!e.data("active")})}),t}var n=Yourls.dom.main.find("> nav.submenu, > header > nav.submenu, > nav.menu .wrapper");n.length&&n.each(function(){var n=$(this),r=n.children("ul"),a=r.first(),o=$("<li>").addClass("more").text(I18n.t("more"));$("<i>").addClass("fa fa-angle-down").appendTo(o),o.appendTo(a),o.dropdown({items:$.proxy(t,null,a),appendTo:Yourls.dom.main,position:{within:Yourls.dom.main}});var s=r.find(".subitem");s.parent().each(function(){var e=$(this);e.addClass("has-subitems"),e.dropdown({items:$.proxy(i,null,e),position:{within:Yourls.dom.main}})});var d=$.proxy(e,null,r);$(window).resize(Yourls.Util.debounce(d,250)),d()})},Yourls.cacheDomReferences=function(){Yourls.root=$(Yourls.selectors.root),$.each(this.selectors,function(e,t){Yourls.dom[e]=$(t,Yourls.root)})},Yourls.initFooter=function(){$("#copyright").click(function(){$("#footer").toggleClass("collapsed"),this.scrollIntoView()})},Yourls.sidebar=function(e,t){t=t||{};var i=t.values||{};e||(e="general/empty"),$.isFunction(e)||(e=JST[e]);var n=e(i),r=$("<aside/>").append(n);$(document.body).append(r),t=t||{};var a=t.shown,o=t.closed,s=t.rendered;return t.shown=function(){$("body").addClass("has-sidebar"),a&&a.apply(this)},t.closed=function(){o&&o.apply(this),$("body").removeClass("has-sidebar"),window.setTimeout($.proxy(r.remove,r),500)},t.rendered=function(){$(this).find(":radio.toggle").parent().buttonset(),s&&s.call(this,this)},r.sidebar(t),setTimeout($.proxy(r.sidebar,r,"show"),1),r},Yourls.closeAllSidebars=function(){$("aside.sidebar").each(function(){$(this).sidebar("close")})},Yourls.contextmenu=function(e,t,i){return e=$(e),e.off("contextmenu"),Yourls.user&&!Yourls.user.showContextMenus()?!1:void e.on("contextmenu",function(e){if(!(e.shiftKey||e.ctrlKey||e.metaKey)){var n=$(e.delegateTarget),r=$.isFunction(t)?t(n,$(e.target)):t;if(r){n.dropdown("instance")&&n.dropdown("destroy");var a=!0;n.dropdown($.extend({items:r,position:{my:"center top",of:$(e)},hidden:function(){n.dropdown("instance")&&n.dropdown("destroy")},notshown:function(){a=!1}},i)).dropdown("show"),a&&(e.preventDefault(),e.stopPropagation())}}})},Yourls.gtmEvent=function(e,t){dataLayer&&dataLayer.push($.extend({event:e},t))},Yourls.confirm=function(e,t,i){t=t||I18n.t("are_you_sure"),this.sidebar("general/confirm",{title:t,icon:"fa-info-circle",alert:{message:I18n.t("please_confirm"),type:"question"},values:{description:i?{text:i}:!1},buttons:[{caption:I18n.t("ok"),icon:"fa-check","default":!0,action:function(){e()}},{caption:I18n.t("cancel"),icon:"fa-times"}]})},Yourls.alert=function(e,t){t=t||{};var i=t.title||I18n.t("home_name"),n=t.icon||"fa-info-circle",r=t.type||"info",a=$.makeArray(t.alert||[]);switch(r){case"warning":a.push({message:I18n.t("warning"),type:"warning"});break;case"error":a.push({message:I18n.t("oops"),type:"error"})}Yourls.sidebar("general/alert",{title:i,icon:n,alert:a,values:{message:e},buttons:[{caption:I18n.t("ok"),"default":!0,action:function(){}}]})},Yourls.error=function(e){Yourls.showNotification(e,{icon:"fa-warning",type:"error"})},Yourls.fatalError=function(e,t,i,n){function r(){var e="Error report: "+i.name;t&&(e+=" ["+t+"]");var r=JST["general/error_report"]({error:i,navigator:navigator,metaData:n}).replace(/\\n/g,"\n");Yourls.showFeedbackDialog({subject:e,attachment:r})}function a(){Yourls.sidebar("general/error_debug",{title:"Debug error",icon:"fa-bug",values:i,buttons:[{caption:"Send to Bugsnag",icon:"fa-mail-forward",action:function(){Bugsnag.notify("Forwarded error",i.message,{error:i})}}]})}var o=[];Yourls.gtmEvent("Error",{message:e}),i&&o.push({caption:I18n.t("report_error"),icon:"fa-phone",autoclose:!1,action:r}),o=o.concat([{caption:I18n.t("reload_page"),icon:"fa-refresh","default":!0,action:function(){return window.setTimeout(function(){window.location.reload()},100),{message:I18n.t("reloading_page"),type:"info"}}},{caption:I18n.t("ignore"),icon:"fa-step-forward"}]),Yourls.isDebug()&&i&&o.push({caption:"Debug",icon:"fa-bug",autoclose:!1,action:a}),Yourls.showNotification("**"+I18n.t("oops")+" "+I18n.t("something_went_wrong")+".** "+I18n.t("error_reload_page"),{icon:"fa-warning",type:"error",action:function(i){i(),Yourls.sidebar("general/error",{title:I18n.t("something_went_wrong"),icon:"fa-bug",values:{caseId:t||"",message:e||""},buttons:o})}})},Yourls.checkEditability=function(){this.isEditable()?$(document.body).addClass("editable").removeClass("non-editable"):$(document.body).removeClass("editable").addClass("non-editable")},Yourls.ping=function(e){function t(){Yourls.versionWarningShown||(Yourls.versionWarningShown=!0,Yourls.showNotification(I18n.t("page_changed_warning"),{type:"alert",icon:"fa-refresh",action:function(){location.reload()},actionText:I18n.t("refresh"),canClose:!1}))}var i=Yourls.getActivePage();if(i){var n=i.getPingUrl();if(n)try{clearTimeout(this.pingTimeout),$.getJSON(n).then(function(n){e?i.setVersion(n.version):i.getVersion()!=n.version&&t();var r=n.editors.length,a=$("#page-editors");a.find(".count").text(n.editors.length),a.toggleClass("show",r>1),a.data("editors",n.editors)})}finally{this.pingTimeout=setTimeout($.proxy(Yourls.ping,Yourls),15e3)}}},Yourls.addWidget=function(e,t,i){return this.activePage.addWidget(e,t,i)},Yourls.addMenuDroppable=function(){function e(e,t){window.setTimeout(function(){t.helper.stop().animate({opacity:.5})},10)}function t(e,t){t.helper.stop().animate({opacity:1})}Yourls.root.find("#pages-menu").droppable({accept:"article.widget",tolerance:"pointer",hoverClass:"droptarget",over:e,out:t,drop:function(e,t){var i=t.draggable.data("widget_id"),n=Yourls.getActivePage().getWidgetById(i);n.showMoveDialog()},deactivate:t})},Yourls.render=function(e){this.initLoggedIn(),measure("render"),this.renderPage(e),measureEnd("render")},Yourls.addPageDialog=function(){function e(e){var i=$.trim(e.title);if(!i.length)return I18n.t("please_specify_title");var n=t.length?parseInt(e.organization)||null:null,r=Math.max(0,Math.min(5,parseInt($.trim(e.column_count))));Yourls.createPage({title:i,column_count:r,organization_id:n},function(){Yourls.pages.triggerChanged()})}var t=Yourls.user.getOrganizations();Yourls.sidebar("page/add",{title:I18n.t("new_page_title"),icon:"fa-file",formdata:{column_count:3},values:{has_organizations:t.length>0,organizations:t},canClose:!0,buttons:[{caption:I18n.t("add"),icon:"fa-plus","default":!0,action:e},{caption:I18n.t("pages_browser.title"),icon:"fa-search",rightIcon:"fa-chevron-right",action:$.proxy(Yourls.browsePages,Yourls),autoclose:!1}]})},Yourls.editPageDialog=function(e,t){e=e||Yourls.getActivePageId();var i=new Yourls.EditPage(e,t||{});i.show(),Yourls.gtmEvent("Navigation",{item:"EditPage"})},Yourls.browsePages=function(){var e=new Yourls.PagesBrowser;e.show()},Yourls.showAddBookmarksDialog=function(e){var t=e.extraButtons||[];e.showBrowseWidgets&&t.push({caption:I18n.t("browse_widgets"),icon:"fa-folder-open",rightIcon:"fa-chevron-right",action:$.proxy(Yourls.showAddWidgetsDialog,Yourls,{})}),e=$.extend({extraButtons:t},e),Yourls.gtmEvent("Navigation",{item:"AddBookmarks"}),new Yourls.BookmarksAdder(e).show()},Yourls.showAddWidgetsDialog=function(e){this.activePage.showAddWidgetsDialog(e)},Yourls.deletePageDialog=function(e){var t=Yourls.getActivePageId();e=e||t;var i=e==t;Yourls.confirm(function(){Yourls.closeAllSidebars(),Yourls.deletePage(e,function(){Yourls.pages.triggerChanged(),i?location.href="/":location.reload()})},I18n.t("delete_page"),I18n.t("delete_page_confirm"));
},Yourls.showBookmarkUrlDialog=function(e,t){function i(){var e=$(this),t=e.find("select[name=widget_id]");r(function(e){$.each(e,function(e,i){if(0!=i.widgets.length){var n=$("<optgroup>").attr("label",i.title);$.each(i.widgets,function(e,t){$("<option>").text(t.title).attr("value",t.id).appendTo(n)}),n.appendTo(t)}});var i=Yourls.Cache.get("showBookmarkUrlDialog.lastWidgetId",null);i&&t.val(i)})}function n(e){Yourls.Cache.set("showBookmarkUrlDialog.lastWidgetId",e.widget_id);var t=e.widget_id,i=$.trim(e.title),n=$.trim(e.url);if(0==i.length)return I18n.t("please_specify_title");if(!Yourls.UrlHelper.isValid(n)){if(!Yourls.UrlHelper.isValidButWithoutProtocol(n))return I18n.t("invalid_url");n="http://"+n}$.ajax({url:"/widget/"+t+"/item",type:"POST",contentType:"application/json",data:JSON.stringify({url:n,title:i}),dataType:"json"}).success(function(){Yourls.showConfirmation(I18n.t("urllist.bookmark_x_added",{title:i}))})}function r(e){Yourls.Cache.fetch("showBookmarkUrlDialog.widgetTree",e,function(e){function t(t){$.each(t,function(e,t){var i=[];$.each(t.widgets,function(e,t){"urllist"==t.widget_type&&i.push(t)}),i.sort(function(e,t){return e.title.localeCompare(t.title)}),t.widgets=i}),t.sort(function(e,t){return e.title.localeCompare(t.title)}),e(t)}$.ajax({url:"/pages/tree",type:"get",dataType:"json",success:t})},1)}t=$.trim(t).replace(/\s+[-|:,]\s.*$/g,""),Yourls.sidebar("general/sidebar_bookmark_url",{title:I18n.t("new_link"),icon:"fa-bookmark",formdata:{title:t,url:e},buttons:[{caption:I18n.t("urllist.add_bookmark"),icon:"fa-plus","default":!0,action:n},{caption:I18n.t("cancel"),icon:"fa-times"}],rendered:i})},Yourls.renderPage=function(e){if(!this.activePage||this.activePageVersion!=e.version){var t=new Yourls.Page(e);this.activePage=t,this.activePageVersion=e.version,this.dom.pages.empty(),this.dom.pages.append(t.render())}this.checkEditability(),this.isEditable()&&this.activePage.enableEditing()},Yourls.setColumnCount=function(e){var t=Yourls.getActivePage();t&&(t.setColumnCount(e),Yourls.updatePage(Yourls.getActivePageId(),{column_count:t.getColumnCount()}))},Yourls.offline=function(e){},Yourls.initHeader=function(){function e(){var e=Yourls.getActivePage(),t=[];return e.isEditable()?(t.push({caption:I18n.t("edit_page"),icon:"fa-pencil",classes:"edit",action:$.proxy(Yourls.editPageDialog,Yourls,e.id)},{caption:I18n.t("change_background"),icon:"fa-picture-o",classes:"background",action:$.proxy(Yourls.editPageDialog,Yourls,e.id,{activeTab:"layout"})}),e.isOwned()&&t.push({caption:I18n.t("share_page"),icon:"fa-share-alt",classes:"share",action:$.proxy(Yourls.editPageDialog,Yourls,e.id,{activeTab:"share"})})):e.isPersisted()&&(e.isPinned()?t.push({caption:I18n.t("unfavorite"),icon:"fa-star-o",action:$.proxy(e.unsubscribe,e)}):t.push({caption:I18n.t("make_favorite"),icon:"fa-star",action:$.proxy(e.subscribe,e)})),e.isPersisted()&&t.push({caption:I18n.t("copy_page"),icon:"fa-clone",action:$.proxy(e.clone,e)}),e.isEditable()&&t.push("-",{caption:I18n.t("add_bookmarks"),icon:"fa-bookmark",action:$.proxy(Yourls.showAddBookmarksDialog,Yourls)},{caption:I18n.t("add_news_feed_rss"),icon:"fa-rss",action:$.proxy(Yourls.addWidget,Yourls,"rsslist")},{caption:I18n.t("add_notes"),icon:"fa-pencil-square-o",action:$.proxy(Yourls.addWidget,Yourls,"notes")},"-",{caption:I18n.t("organize_widgets"),icon:"fa-arrows",action:function(){Yourls.getActivePage().enableSortMode()}},{caption:I18n.t("add_widget"),icon:"fa-plus",action:$.proxy(Yourls.showAddWidgetsDialog,Yourls,{})}),e.isPersisted()&&(Yourls.user.isAdmin()||Yourls.user.isImpersonated())&&t.push("-",{caption:"Open in admin",icon:"fa-gears",url:"/admin/pages/"+e.getId()}),"-"==t[0]&&t.shift(),"-"==t[t.length-1]&&t.pop(),t}var t=Yourls.dom.header;if(t.length){var i=Yourls.getActivePage();if(i){t.find("#add-content").click($.proxy(Yourls.showAddBookmarksDialog,Yourls,{showBrowseWidgets:!0,side:"right"}));var n=t.find("#breadcrumbs .page");Yourls.user&&(n.dropdown({items:e,height:10,appendTo:t}),Yourls.contextmenu(Yourls.dom.pages,function(t,i){return i.parents("article.widget").length?void 0:e()},{height:10})),Yourls.pages.on("changed",function(){n.find("span").text(i.getTitle())});var r=$("#page-pinned"),a=$("#pin-page");r.click($.proxy(i.unsubscribe,i)),a.click($.proxy(i.subscribe,i)),$("#edit-page, #customize-page").click(function(){$(this).is("[data-embed]")||Yourls.setLoading(!0,!0)})}var o=$("#page-editors");o.tooltip({track:!0,content:function(){return JST["general/editors_tooltip"]({editors:$(this).data("editors")})}})}},Yourls.showLoader=function(e,t){var i=Yourls.root.find("#loading");e=e||I18n.t("loading"),i.attr("title",e),i.children("i").attr("title",e),clearTimeout(Yourls.loaderTimeout),i.hasClass("blocking")==!t?(i.removeClass("show"),Yourls.loaderTimeout=setTimeout(function(){i.toggleClass("blocking",!!t),i.addClass("show")},500)):(i.addClass("show"),i.toggleClass("blocking",!!t))},Yourls.hideLoader=function(){var e=Yourls.root.find("#loading");clearTimeout(Yourls.loaderTimeout),e.removeClass("show",500)},Yourls.setLoading=function(e,t){var i=I18n.t("working");switch(typeof e){case"undefined":e=!0;break;case"string":i=e,e=!0;break;default:e=!!e}e?Yourls.pushLoading(i,t):Yourls.popLoading()},Yourls.pushLoading=function(e,t){var i=Yourls.loadingStack||(Yourls.loadingStack=[]);i.push([e,t]),Yourls.showLoader(e,t||Yourls.hasBlockingLoaders())},Yourls.hasBlockingLoaders=function(){for(var e in Yourls.loadingStack)if(Yourls.loadingStack[e][1])return!0},Yourls.popLoading=function(){if(Yourls.loadingStack){var e=Yourls.loadingStack.pop(),t=Yourls.loadingStack.slice(-1).pop()||!1;return t?Yourls.showLoader(t[0],Yourls.hasBlockingLoaders()):Yourls.hideLoader(),e}},Yourls.initAjax=function(){$.ajaxSetup({cache:!0}),$(document).ajaxSend(function(e,t,i){var n=I18n.t("saving");switch((i.origType||i.type||"get").toLowerCase()){case"post":n=I18n.t("adding");break;case"get":n=I18n.t("loading");break;case"patch":n=I18n.t("updating");break;case"delete":n=I18n.t("deleting")}n=i.loader||n;var r=i.blocking||!1;Yourls.pushLoading(n,r)}),$(document).ajaxComplete(function(e,t,i){Yourls.popLoading(),i&&i.type&&"GET"!=i.type.toUpperCase()&&Yourls.ping(!0)}),$.ajaxPrefilter(function(e,t,i){e.customError=e.error,e.error=null}),$(document).ajaxError(function(e,t,i,n){if(!($.isFunction(i.customError)&&i.customError(t,t.status,n)||t&&4!=t.readyState||i.noBugsnag)){var r=i.url.replace(/\/\d+/g,"/:id:"),a=(i.origType||i.type).toUpperCase()+" "+r;t.status&&(a+=" -> "+t.status),n&&(a+=" ("+n+")");var o="error";switch(t.status){case 401:case 404:case 415:case 503:o="warning";break;case 200:o="info"}var s=t.getResponseHeader("X-Rails-Error");s&&(s=JSON.parse(s)),Bugsnag.notify(a,i.url,{ajax:{url:i.url,type:i.type,origType:i.origType,data:i.data,dataType:i.dataType,contentType:i.contentType,status:t.status,statusText:t.statusText,responseText:t.responseText},railsError:s},o)}})},Yourls.ajaxSave=function(e){e.origType=(""+e.type).toLowerCase(),"get"!=e.origType&&"post"!=e.origType&&(e.headers=$.extend({"X-HTTP-Method-Override":e.origType},e.headers),e.type="post");var t=$.ajax(e);return t},Yourls.initEmbedding=function(){for(window.topWithYourls=window;window.topWithYourls!=window.parent;)try{if(window.parent.document.domain!=document.domain)break;window.topWithYourls=window.parent}catch(e){break}window.topYourls=window.topWithYourls.Yourls},Yourls.processHashCommands=function(){var e=window.location&&window.location.hash&&window.location.hash.substring(1);if(!e||!document.getElementById(e)){var t=e.split();$.each(t,function(e,t){t=$.trim(t).split("/");var i=t.slice(1);t=t[0];var n;switch(t){case"addWidget":n=$.proxy(Yourls.addWidget,Yourls);break;case"import":n=$.proxy(Yourls.getImport().pollImport,Yourls.getImport());break;case"tour":n=$.proxy(Yourls.startTour,Yourls);break;case"addPage":n=$.proxy(Yourls.addPageDialog,Yourls);break;case"editPage":n=$.proxy(Yourls.editPageDialog,Yourls);break;case"flushCache":n=$.proxy(Yourls.Cache.flush,Yourls.Cache)}$.isFunction(n)&&n.apply(Yourls,i)}),Featurizr.history?window.history.replaceState(null,null,window.location.href.replace(/#.*$/,"")):window.location.hash=""}},Yourls.showFeedbackDialog=function(e){e=$.extend({name:"",email:"",subject:"Feedback",message:"",url:location.toString(),attachment:""},e);var t=window.primaryBaseUrl+"/contact?"+$.param($.prefix(e,"message[","]"));Yourls.embedPage(t)},Yourls.initChallengeResponse=function(){$("#challenge_question").each(function(){var question=$(this).val();if(/\d+\s*[-+*]\s*\d+/.test(question)){var answer=eval(question),form=$(this).parents("form:first");$(document).one("click",function(){form.submit(function(){form.find("input#challenge_answer").val(answer)})})}})},Yourls.initExtensionIntegration=function(){$(window).on("message",function(e){var t=e.data||e.originalEvent.data;switch(t.action){case"showStartmeSidebar":Yourls.showPagesMenu()}})},Yourls.shareOnSocialMedia=function(e,t){t=$.extend({url:Yourls.pages.get(Yourls.getActivePageId()).share_url,title:document.title,source:"start.me"},t||{});var i={facebook:{url:"https://www.facebook.com/sharer/sharer.php?u=%{url}",width:626,height:436},twitter:{url:"http://twitter.com/share?url=%{url}&text=%{title}&source=%{source}",width:626,height:470},linkedin:{url:"http://www.linkedin.com/shareArticle?mini=true&url=%{url}&title=%{title}&source=%{source}",width:520,height:570},googleplus:{url:"https://plus.google.com/share?url=%{url}",width:626,height:445},pinterest:{url:"http://pinterest.com/pin/create/button/?url=%{url}&description=%{title}",width:626,height:436}};if(!i[e])return!1;e=i[e];var n=e.url.replace(/%\{(\w+)\}/g,function(e,i){return encodeURIComponent(t[i])});window.open(n,"sharer","width="+e.width+",height="+e.height)},Yourls.markdown=function(e,t){var i=new marked.Renderer;return i.html=function(e){var t=$("<div>").text(e);return t.html()},i.paragraph=function(e){var i=$(t.paragraphTag).append(e);return i.find("script,style").remove(),i.find("*").each(function(){var e=$(this);$.each(this.attributes,function(){/^on\w+/i.test(this.name)&&e.attr(this.name,null)})}),$("<div>").append(i).html()},t=$.extend({renderer:i,sanitize:!1,smartypants:!0,breaks:!0,paragraphTag:"<p>"},t||{}),marked(e,t)},Yourls.escape=function(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},Yourls.unescape=function(e){return e.replace(/&([#\w]+);/g,function(e,t){return t=t.toLowerCase(),"colon"===t?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})},Yourls.getCountryCode=function(){return window.countryCode},Yourls}(Yourls||{},jQuery),Yourls=function(e,t){"use strict";return e.UrlHelper={openUrl:function(t,i,n){i=i||window.event;try{i&&i.preventDefault()}catch(r){i=null}"boolean"!=typeof n&&(n=e.shouldOpenLinksInNewWindow()),i&&(i.shiftKey||i.ctrlKey||i.metaKey||1==i.button)&&(n=!0),n?window.open(t):window.top.location.href=t},monetizeUrl:function(i,n){if(!e.shouldMonetizeUrls())return i;switch(n=parseInt(n)||n){case 1:return this.monetizeSkimlinks(i);case 2:return this.monetizeViglink(i);case 3:return this.monetizeBolcom(i);case 4:return this.monetizeLinkPizza(i);case 6:return this.monetizeDigidip(i);case 7:return this.monetizeAmazon(i);case 5:default:return this.isValid(n)?n:(t.each([this.monetizeAmazon,this.monetizeBolcom],function(e,t){var n=t(i);return n!=i?(i=n,!1):void 0}),i)}},monetizeSkimlinks:function(e){return"http://redirect.start.me?"+t.map({id:window.skimlinks_site_id,url:e,sref:location.href,xcust:window.referal},function(e,t){return t+"="+encodeURIComponent(e)}).join("&")},monetizeViglink:function(e){return"http://redirect2.start.me?"+t.map({key:window.viglink_api_key,u:e,loc:location.href,cuid:window.referal},function(e,t){return t+"="+encodeURIComponent(e)}).join("&")},monetizeLinkPizza:function(e){return"http://pzz.to/click?"+t.map({uid:2261,target_url:e},function(e,t){return t+"="+encodeURIComponent(e)}).join("&")},monetizeDigidip:function(e){return"http://start.digidip.net/visit?"+t.map({url:e,ref:window.referal,ppref:location.href},function(e,t){return t+"="+encodeURIComponent(e)}).join("&")},monetizeAmazon:function(e){function i(e){switch(e){case"co.uk":return"startme03-21";case"de":return"startme04-21";case"ca":return"startme05-20";case"es":return"startme07-21";case"fr":return"startme08-21";case"it":return"startme09-21"}}var n=/^https?:\/\/(?:www\.)?amazon\./i.exec(e);if(!n)return e;var r=t("<a>").attr("href",e)[0],a=r.hostname,n=/^(www\.)?amazon\.((co\.)?[a-z]{2,3})$/.exec(a);if(!n)return e;var o=n[2].toLowerCase();if(/[?&]tag=[^&]+/.test(r.search))return e;var s=i(o);if(!s)return e;var d=r.search;return""==d||"?"==d?d="?":d+="&",r.search=d+"tag="+encodeURIComponent(s),r.href},monetizeBolcom:function(e){var i=/https?:\/\/(?:www\.)?bol\.com/i.exec(e);return i&&(e="http://partnerprogramma.bol.com/click/click?"+t.map({p:1,t:"url",s:34222,subid:window.referal||"",url:e,name:"bolstandaard",f:"TXL"},function(e,t){return t+"="+encodeURIComponent(e)}).join("&")),e},isValid:function(e){return/^([a-z]{3,}:)?\/\/\S+$/.test(e)?e.length>=2048?!1:!0:!1},isValidButWithoutProtocol:function(e){return/^[a-z]{3,}:\/\//.test(e)?!1:/^[^\/\s]{2,}\.\S{2,}$/.test(e)},stripProtocol:function(e){return e.toString().replace(/^https?:\/\//i,"")},isAssetUrl:function(e){return/^https?:\/\/(res.*?\.cloudinary\.com|(static|assets|beta)\.start\.me|localhost:\d+)\/.+/.test(e)},newLink:function(e){return e=this.normalizeUrl(e),{url:e,title:this.guessTitleFromUrl(e)}},normalizeUrl:function(e){try{e=decodeURI(e)}catch(i){}e=t.trim(e);var n=/^((?:https?|ftp):(?:\/\/)|)(.+@|)([^/]+)(\/.*|)$/i.exec(e);return n&&(e=n[1].toLowerCase()+n[2]+n[3].toLocaleLowerCase()+n[4]),e=encodeURI(e)},isSecure:function(e){var i=t("<a>").attr("href",e)[0];return"https:"==i.protocol.toLowerCase()},isData:function(e){var i=t("<a>").attr("href",e)[0];return"data:"==i.protocol.toLowerCase()},makeProtocolRelative:function(e){return e?e.toString().replace(/^https?:\/\//i,"//"):void 0},guessTitleFromUrl:function(e){e=t.trim(e),e=decodeURI(e),e=e.replace(/^https?:\/\//i,""),e=e.replace(/^www\./i,""),e=e.replace(/\?.*$/,"");var i=e.split("/");i[0]=i[0].toLowerCase();var n=i.join("/");return n=n.slice(0,1).toUpperCase()+n.slice(1)},domainAutocomplete:function(e,i){var n=/^(https?:\/\/)?(www\.)?(.*)$/,r=e.term.match(n);return r&&r[3]?void t.ajax({url:"/tools/domains/find?limit=10&query="+encodeURIComponent(r[3]),type:"get",contentType:"application/json",dataType:"json"}).done(function(e){if(e&&t.isArray(e.domains)){var n=t.map(e.domains.slice(0,9),function(e){return{label:e,value:(r[1]||"http://")+(r[2]||"")+e}});i(n)}}):i([])},getSite:function(i){try{i=e.UrlHelper.normalizeUrl(i);var n=t("<a>").attr("href",i)[0],r=n.hostname.toLowerCase().replace(/^www\./,"");return r}catch(a){return null}},faviconLink:function(i){if(i=t.trim(i),!i.length)return"";try{var n=t("<a>",{href:encodeURI(i)})[0],r=n.hostname.replace(/^www\./,"").toLowerCase(),a=n.pathname,o=a.replace(/^\/([a-z0-9_-]*).*/,"$1"),s=r.replace(/^www\./,""),d=r.hashCode(),l=d%4;if(r)return this.isPathRelevantForFavicon(r)||(o=""),e.faviconProvider().replace("%{domain}",encodeURIComponent(r)).replace("%{path}",encodeURIComponent(a)).replace("%{path_root}",encodeURIComponent(o)).replace("%{hostname[0]}",encodeURIComponent(s[0])).replace("%{hash4}",l)}catch(c){}return""},isPathRelevantForFavicon:function(e){switch(e){case"google.com":return!0;default:return!1}},renderIcon:function(t,i,n){e.UrlHelper.isValid(i)?e.UrlHelper.isAssetUrl(i)?e.UrlHelper.renderFavicon(t,null,i):e.UrlHelper.renderFavicon(t,i,n):e.UrlHelper.renderFavicon(t,null,i)},renderFavicon:function(i,n,r){if(i=t(i),i.length){i.addClass("favicon show").removeClass("fa"),i.each(function(){this.className=this.className.replace(/\bfa-\S+\b/,"")}),n=t.trim(n);var a=n?t.proxy(e.UrlHelper.faviconLink,e.UrlHelper,n):!1,o=r||i.data("placeholder")||"fa-globe";if(this.isValid(o))a?i.css("background-image","url('"+o+"')"):a=o,o=null;else{var s=o.split("#");o=s[0],i.addClass("fa").addClass(o);var d=s[1];d&&i.css("color","#"+d)}if(t.isFunction(a)&&(a=a()),a){a=e.UrlHelper.makeProtocolRelative(a);var l=i.children("img");0==l.length&&(l=t.tag("img").appendTo(i),o||i.addClass("placeholder"));var c=l[0];c.onload=function(){i.removeClass(o).removeClass("fa placeholder").addClass("ready");var e=Math.ceil(Math.log(Math.max(c.width,c.height))/Math.log(2));l.parent().attr({"data-icon-size":"x".repeat(e)})},c.onerror=function(){l.remove(),i.addClass("placeholder").addClass("error ready")},l.attr("src",a)}else i.empty()}},imageExists:function(i){var n=e.UrlHelper.checkedUrls||{};if(e.UrlHelper.checkedUrls=n,i in n)return n[i];var r=t.Deferred(),a=n[i]=r.promise(),o="image"+e.Util.hashCode(i);if(e.Cache.get(o,!1))return r.resolve(),a;var s=new Image;return s.onload=r.resolve,s.onerror=r.reject,s.src=i,r.then(function(){e.Cache.set(o,1)}),s.remove&&r.done(s.remove.bind(s)),a},proxyUrl:function(t){return e.UrlHelper.isValid(t)&&/^https?:\/\//.test(t)?"https://"+window.proxyDomain+"/?"+decodeURI(t):!1},getTitle:function(i){function n(){function e(e){t.isPlainObject(e)&&"title"in e&&e.title?a(e.title):(o("Invalid title retrieval response"),r())}t.ajax({url:"/tools/title",type:"get",contentType:"application/json",data:{url:i},dataType:"json",error:function(){return!0}}).then(e).fail(function(e){o(e.statusText||"Not found"),r()})}function r(){function e(e){var i=(/\<head.*?\>([\s\S]+?)\<\/\s*head.*?\>/i.exec(e)||[]).shift();if(!i)return o("Failed to find head");var n=(/<title.*?\>([\s\S]+?)\<\/\s*title.*?\>/i.exec(i)||[]).shift();return n?(n=t.trim(t(n).text()),void a(n)):o("Failed to find title")}t.ajax({url:u,type:"get",error:function(){return!0}}).then(e).fail(o)}function a(e){d||s.resolve(e)}function o(e){c--,e&&l.push(e.toString()),0==c&&s.reject(l.join("\n"))}var s=t.Deferred(),d=!1,l=[],c=2,u=e.UrlHelper.proxyUrl(i);return u?(n(),s.promise()):s.reject("Invalid URL").promise()}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.GAPI=new function(){function e(e){if(window.gapi&&window.gapi.client)e(window.gapi.client);else{var i="YourlsGAPILoaded";window[i]=function(){e(window.gapi.client)},t.getScript("https://apis.google.com/js/client:platform.js?onload="+i)}}function i(t,i,n){e(function(e){e.load(t,i,function(){n(e[t])})})}var n={},r=[],a=[];this.use=function(e,a,o){function s(){i(e,a,function(i){var o=n[e][a];o.api=i,t.each(o.onloaded,function(e,t){t(i)}),o.onloaded=[],r.shift(),d()})}function d(){var e=r.slice(0,1).shift();t.isFunction(e)&&e()}if(n[e]&&n[e][a]){var l=n[e][a];l.api?o(l.api):l.onloaded.push(o)}else n[e]||(n[e]={}),n[e][a]={api:null,onloaded:[o]},r.push(s),1==r.length&&d()},this.useWithAuth=function(e,i,n,r){this.use(e,i,function(e){function i(){function t(){clearTimeout(s),window.gapi.auth.setToken(i),a.shift(),o()}var i=window.gapi.auth.getToken();window.gapi.auth.setToken({access_token:r});var s=setTimeout(t,5e3);n(e,t)}function o(){var e=a.slice(0,1).shift();t.isFunction(e)&&e()}a.push(i),1==a.length&&o()})}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.CIO=new function(){this.fetch=function(i,n){function r(i){var n=[];for(var r in i){if(i.hasOwnProperty(r)){var a={id:"",author:"",title:"",date:"",summary:"",unread:!1,starred:!1},o=i[r];a.id=o.message_id,a.author="",o.addresses.from[0].name&&(a.author+=o.addresses.from[0].name),o.addresses.from[0].email&&(a.author+=" <"+o.addresses.from[0].email+">"),a.title=o.subject,a.date="undefined"!=typeof o.sent_at&&null!=o.sent_at?e.Util.toMoment(moment.unix(o.sent_at)):null,a.unread=!o.flags.seen,a.starred=o.flags.flagged,a.summary="",t.isArray(o.bodies)&&o.bodies.length>0&&(a.summary=o.bodies[0].content,a.summary=a.summary.replace(/\s+/g," "),a.summary.length>40&&(a.summary=a.summary.substring(0,40)+"\u2026")),a.summary=a.summary||I18n.t("widgets.email.no_snippet")}n.push(a)}return n}function a(e){return e.sort(function(e,t){return e.date==t.date?0:e.date<t.date?1:-1})}function o(e,i){var n=[];if("undefined"!=typeof e.filter&&t.isFunction(e.filter))for(var r in i)i.hasOwnProperty(r)&&e.filter(i[r])&&n.push(i[r]);else n=i;return n}var s=t.Deferred(),d="undefined"!=typeof n.fetch?n.fetch:n.id,l="email-"+i.config.authorization.email+"-"+d,c=e.Cache.get(l,!1);c&&(c=r(c),c=a(c),c=o(n,c),s.notify(i,c));var u="/widget/"+i.widget.id+"/email/"+i.id;return this.callViaProxy(u,"get",{folder:d}).then(function(t){e.Cache.set(l,t,0),t=r(t),t=a(t),t=o(n,t),s.resolve(i,t)}).fail(function(e,t){s.reject(i,t)}),s.promise()},this.callViaProxy=function(i,n,r){function a(i){t.isPlainObject(i)&&e.UrlHelper.isValid(i.url)||o.reject(i),i.url=e.UrlHelper.proxyUrl(i.url),t.ajax(i).then(function(){o.resolve.apply(o,arguments)}).fail(function(e){o.reject(e)})}var o=t.Deferred();return t.ajax({url:i,type:n||"get",data:r||null,dataType:"json"}).then(a).fail(function(e,t){o.reject(e)}),o.promise()},this.listEmailLabels=function(){return[{id:"Inbox",title:I18n.t("widgets.email.labels.inbox")},{id:"Unread",title:I18n.t("widgets.email.labels.unread"),fetch:"Inbox",filter:function(e){return e.unread}},{id:"Starred",title:I18n.t("widgets.email.labels.starred"),fetch:"Inbox",filter:function(e){return e.starred}},{id:"Sent",title:I18n.t("widgets.email.labels.sent")}]}},e}(Yourls,jQuery);!function(e){"use strict";function t(t){var n=i[t],r=n.length-1;e.each(n,function(t,i){e.each(i.element,function(){this.className=this.className.replace(/\bposition-\d+\b/,"")}),i.element.addClass("position-"+Math.min(t,4)),i.element.toggleClass("on-top",t==r)}),e(document.body).children(".sidebar-document-overlay").each(function(t,i){e(i).toggleClass("first",0==t)}),e.each(n,function(e,t){t._trigger("stackUpdated")})}var i={left:[],right:[],fill:[]},n=0;e.widget("yourls.sidebar",{options:{side:"left",title:"",icon:"",canClose:!0,hasClose:!0,formdata:{},autofocus:!0,alert:!1,extraClasses:"",activeTab:"",buttons:[]},show:function(){i[this.options.side].push(this),window.setTimeout(e.proxy(function(){this.element.removeClass("closed"),this._bindEvents(),this._showOverlay(),this.options.autofocus&&Yourls.isAutoFocusEnabled()&&this.element.find(":input:first").focus(),t(this.options.side),this._trigger("shown")},this),10)},close:function(){if(!this.element.hasClass("closed")&&this._trigger("closing")){this._hideOverlay(),this.element.addClass("closed");var n=i[this.options.side];return n.splice(e.inArray(this,n),1),window.setTimeout(e.proxy(function(){t(this.options.side)},this),100),this._unbindEvents(),this._trigger("closed"),!0}},selectTab:function(e){},alert:function(e){this.options.alert=e,this._renderAlerts()},doDefaultAction:function(){this._defaultAction()},markChanged:function(){this._trigger("changed",null,this._getFormData())},_create:function(){this.id=++n,this.element.addClass("sidebar closed ui-front"),this.element.addClass(this.options.side),this._renderBody(),this._renderHeader(),this._renderTabs(),this._renderAlerts(),this._renderButtons(),this._renderFormData(),this._renderForm(),this._renderSidebarOverlay(),this._trigger("rendered"),this._updateTabs()},_tryClose:function(){return this.options.canClose?this.close():void 0},_renderBody:function(){var t=e("<section/>").addClass("main body").addClass(this.options.extraClasses||""),i=this.element.children();if(i.length){t.append(i).appendTo(this.element);var n=t.children("header");if(n.length>0){var r=e("<section>").addClass("body header").addClass(this.options.extraClasses||"").addClass(n.prop("className"));r.append(n.children()).insertBefore(t),n.remove()}var a=t.children("footer");if(a.length>0){var o=e("<section>").addClass("body footer").addClass(this.options.extraClasses||"").addClass(a.prop("className"));o.append(a.children()).insertAfter(t),a.remove()}}},_renderHeader:function(){if(this.options.title||this.options.canClose&&this.options.hasClose){var t=e("<header/>").prependTo(this.element).addClass("title").disableSelection();if(e.tag("span").text(this.options.title).appendTo(t),this.options.title&&this.options.icon&&(t.addClass("has-icon"),e("<i/>").prependTo(t).addClass("icon fa fa-fw").addClass(this.options.icon)),this.options.title||t.addClass("no-title"),this.options.canClose&&this.options.hasClose){var i=e("<i/>").appendTo(t).addClass("close fa fa-fw fa-times").attr("title",I18n.t("close"));i.click(e.proxy(this.close,this))}}},_renderTabs:function(){function t(e){s.find("li").removeClass("active"),a.removeClass("active"),d.options.activeTab=e.data("name"),e.addClass("active");var t=e.data("panel").addClass("active");d.options.autofocus&&Yourls.isAutoFocusEnabled()&&t.find(":input:visible:first").focus()}function i(t){var i={},n=e();return e.each(t,function(t,r){r=e(r);var a=r.data("name");i[a]?(i[a].append(r.children()),r.remove()):n=n.add(i[a]=r)}),n}var n=e("section.body:first",this.element),r=e("section.body:not(.header):first",this.element),a=r.find("section.tab");if(a.length){a=i(a);var o=e("<nav>").addClass("tabs"),s=e("<ul>").attr("role","tablist").appendTo(o),d=this,l={};a.each(function(i,n){var r=e(n);r.attr("role","tabpanel");var a=Math.round(Math.random()*Math.pow(2,31)),o=r.data("title"),c=r.data("name")||a,u=e("<li>").text(o).appendTo(s).attr("data-name",c).data("panel",r),h="tab-"+a,f="tabpanel-"+a;u.attr("id",h).attr("aria-controls",f),r.attr("id",f).attr("aria-labelledby",h),(r.hasClass("active")||c==d.options.activeTab)&&t(u),u.toggleClass("always-show",r.hasClass("always-show")),u.click(function(e){t(u),d._trigger("tabselected",e,u.data("name"))}),l[c]=u}),0==s.find("li.active").length&&t(s.find("li:first")),n.before(o),this._updateTabs(),this.activateTab=function(e){e in l&&(t(l[e]),d._trigger("tabselected",null,e))}}},_updateTabs:function(){var t=this.element.find("nav.tabs ul li");t.each(function(){var t=e(this),i=t.data("panel"),n=t.is(".active"),r=t.hasClass("always-show");n=n||r||i.innerHeight()>0,t.toggleClass("empty",!n)})},_renderAlerts:function(){if(this.element.find("header.alert").remove(),this.options.alert){var t=e.makeArray(this.options.alert),i=this;e.each(t,function(){var t="",n="info";switch(typeof this){case"object":t=this.message||"",n=this.type||"info";break;case"string":t=this;break;default:return}var r,a=e("<header/>").insertBefore(i.element.find("section.body, section.buttons").first()).addClass("alert").text(t).disableSelection();switch(n){case"info":r="";break;case"warning":r="fa-warning";break;case"error":r="fa-times-circle";break;case"question":r="fa-question-circle";break;case"locked":r="fa-lock";break;default:n=""}n&&a.addClass(n),r&&e("<i/>").prependTo(a).addClass("fa fa-fw").addClass(r)})}},_renderButtons:function(){if(this.options.buttons.length){var t,i=[];e.each(this.options.buttons,function(){this.hasOwnProperty("section")?(i.push(this),t=null):(t||i.push(t={section:"",buttons:[]}),t.buttons.push(this))});var n=this;e.each(i,function(){var t=e("<section/>").appendTo(n.element).addClass("buttons").disableSelection();if(this.section.length){var i=e("<header/>");e("<span>").text(this.section).appendTo(i),i.appendTo(t)}e.each(this.buttons,function(i,r){if(e.isPlainObject(r)||(r={caption:r.toString()}),"-"!=r.caption){var a=e("<a/>").addClass("button");e("<span>").text(r.caption||"").appendTo(a),a.appendTo(t),r.icon&&e("<i/>").prependTo(a).addClass("fa fa-fw").addClass(r.icon),r.rightIcon&&e("<i/>").appendTo(a).addClass("fa fa-fw icon-right").addClass(r.rightIcon).attr("title",r.rightIconTitle),r["default"]&&a.addClass("default"),r["class"]&&a.addClass(r["class"]),r.url&&a.attr("href",r.url),r.method&&a.attr("data-method",r.method),r.button=a,a.click(function(e){e.preventDefault(),n._doAction(r)}),e.isArray(r.tabs)&&r.tabs.length>0&&(a.toggle(e.inArray(n.options.activeTab,r.tabs)>=0),n.element.on("sidebartabselected",function(t,i){a.toggle(e.inArray(i,r.tabs)>=0)}))}else{e("<div/>").addClass("separator").appendTo(t)}})})}},_showOverlay:function(){this.docOverlay=e("<div/>").appendTo(document.body).addClass("sidebar-document-overlay"),this.options.canClose&&this.docOverlay.click(e.proxy(this.close,this))},_hideOverlay:function(){this.docOverlay&&(this.docOverlay.remove(),this.docOverlay=!1)},_bindEvents:function(){var t=this;e(document).on("keydown.sidebar"+this.id,function(e){t._keyHandler(e)}),this.element.find("form").submit(function(e){e.stopPropagation(),e.preventDefault()})},_unbindEvents:function(){e(document).off("keydown.sidebar"+this.id)},_isOnTop:function(){return i[this.options.side].slice(-1).pop()==this},_aboveMe:function(){var t=i[this.options.side],n=e.inArray(this,t);return 0>n?[]:t.slice(n+1)},_keyHandler:function(t){if(this._isOnTop())switch(t.keyCode){case 13:var i=e(t.target);i.is("input,select")&&i.parents(this.element).length?this._defaultAction():this._hasFormElements()||this._defaultAction();break;case 27:this._tryClose()}},_hasFormElements:function(){return this.element.has(":input").length>0},_doAction:function(t){var i=this._getFormData();if(e.isFunction(t.action)){var n=t.action(i,this.element);if(t.autoclose===!1||n===!1)return;if("string"==typeof n&&(n={message:n,type:"error"}),n)return void this.alert(n)}else if(t.url){var r=t.url,a=e.param(i);a&&(r+="?"+a),t.method&&"get"!=t.method&&t.button?e.rails.handleMethod(t.button):window.top.location.href=r}this.close()},_defaultAction:function(){var t=this;e.each(this.options.buttons,function(i,n){if(n["default"]){if(e.isArray(n.tabs)&&n.tabs.length>0&&e.inArray(t.options.activeTab,n.tabs)<0)return;return t._doAction(n),!1}})},_getFormData:function(){var t=this.element.find(":input").serializeArray(),i={};return e.each(t,function(){i[this.name]=this.value}),i},_renderFormData:function(){var t=this.element.find(":input");e.each(this.options.formdata,function(e,i){var n=t.filter('[name="'+e+'"]');n.is(":radio, :checkbox")?(n.prop("checked",!1),n.filter('[value="'+i+'"]').prop("checked",!0)):n.val(i)})},_renderForm:function(){var e=this;this.element.find(":input").change(function(){e.markChanged(),e._updateTabs()})},_renderSidebarOverlay:function(){function t(e){var i=e.pop();i&&i._tryClose()&&window.setTimeout(function(){t(e)},100)}var i=e("<div>").addClass("overlay").appendTo(this.element),n=this;i.click(function(){var e=n._aboveMe();t(e)})}})}(jQuery),function(e,t){"use strict";t.widget("yourls.checkbox",{options:{checkOnly:!0},_create:function(){var e=this;this.element.addClass("checkbox").hide(),this.checkbox=t("<span>").addClass("fancy-checkbox fa fa-fw").insertAfter(this.element),this.checkbox.toggleClass("check-only",this.options.checkOnly),this.checkbox.toggleClass("disabled",this.element.is(":disabled")),this.checkbox.click(function(t){e._toggle()}),this._syncState(),this.element.on("change",function(t){e._syncState()})},_toggle:function(e){"undefined"==typeof e&&(e=!this.element.is(":checked")),this.checkbox.prop("checked",e),this._syncState},_syncState:function(){var e=this.element.prop("checked");this.checkbox.toggleClass("checked fa-check",e),this.checkbox.toggleClass("fa-times",!e)}})}(Yourls,jQuery),function(e){"use strict";function t(e){var t=0,i=0;for(var n in e){var r=parseFloat(e[n]);isNaN(r)||(t+=r,i++)}return i>0?t:NaN}function i(e){var t=0,i=0;for(var n in e){var r=parseFloat(e[n]);isNaN(r)||(t+=r,i++)}return i>0?t/i:NaN}function n(e){var t=[],i=NaN;for(var n in e){var r=parseFloat(e[n]);isNaN(r)||(isNaN(i)||t.push(r-i),i=r)}return t}function r(e){return i(n(e))}function a(e){if("string"!=typeof e)return e;switch($.trim(e).toLowerCase()){case"":return void 0;case"true":return!0;case"false":return!1;case"0":return 0;case"1":return 1;case"null":return null;case"nan":return NaN;default:return o.test(e)?parseFloat(e):s.test(e)?parseInt(e,16):e}}e.ChartSeries=function(e,t,i){this.name=e?e.toString():void 0,this.data=Array.prototype.slice.call(t||[],0),i="object"==typeof i?i:{},this.total=parseFloat(i.total)||void 0,this.average=parseFloat(i.average)||void 0,this.trend=parseFloat(i.trend)||void 0,this.metadata=i.metadata||void 0},e.ChartSeries.prototype={getName:function(){return this.name},getData:function(){return this.data},getSize:function(){return this.data.length},getTotal:function(){return void 0!=this.total?this.total:t(this.data)},getAverage:function(){return void 0!=this.average?this.average:i(this.data)},getTrend:function(){return void 0!=this.trend?this.trend:r(this.data)},getMetaData:function(){return this.metadata}},e.ChartData=function(t){if(arguments.length>1&&(t=arguments),"object"!=typeof t&&(t=new Array(parseInt(t))),t=Array.prototype.slice.call(t||[],0),t.length<2)throw"Too few series specified";for(var i=0;i<t.length;i++)switch(typeof t[i]){case"undefined":t[i]=new e.ChartSeries;break;case"string":t[i]=new e.ChartSeries(t[i]);
break;case"object":t[i]instanceof Array?t[i]=new e.ChartSeries("",t[i]):t[i]||(t[i]=new e.ChartSeries(t[i]||void 0));break;default:throw"Invalid series specified"}this.series=t;for(var n=this.series[0].getSize(),r=0;r<this.series.length;r++)if(t[r].getSize()!=n)throw"Not all series contain the same number of items"},e.ChartData.prototype={getLabelsSeries:function(){return this.series[0]},getDataSeriesCount:function(){return this.series.length-1},getDataSeries:function(e){return this.series[e+1]},getRowCount:function(){return this.series[0].getSize()},clear:function(){for(var e in this.series)this.series[e].data=[]},addRow:function(e){if((arguments.length>1||!(e instanceof Array))&&(e=arguments),e||(e=new Array(this.series.length)),this.series.length!=e.length)throw"Invalid number of values in row. Expected "+this.series.length;for(var t in this.series)this.series[t].data.push(a(e[t]))},eachRow:function(e){var t;e||(t=[],e=function(e){t.push(e)});for(var i in this.series[0].data){var n=[];for(var r in this.series)n.push(this.series[r].data[i]);e(n)}return t},toArray:function(){for(var e=[],t=[],i=0;i<this.series.length;i++)t.push(this.series[i].name);return e.push(t),this.eachRow(function(t){e.push(t)}),e},toChartkick:function(){for(var e=[],t=this.series[0].data,i=1;i<this.series.length;i++){for(var n=this.series[i],r=n.data,a=n.getAverage(),o=n.getTotal(),s=n.getTrend(),d=n.getMetaData()||{},l={},c=0;c<r.length;c++)l[t[c]]=r[c];e.push({name:n.name,legend:{name:n.name,delta:a?s/a:NaN,total:o,average:a?a:NaN},metadata:d,data:l})}return e}};var o=/^[\d,.]+$/,s=/^0x[\da-f]+/i;e.ChartData.fromArray=function(t){if(!(t instanceof Array))throw"Array expected";if(t.length<1)throw"Empty array can not be converted to ChartData";for(var i=new e.ChartData(t[0]),n=t.length,r=1;n>r;r++)i.addRow(t[r]);return i},e.ChartData.fromCSV=function(t,i){function n(){p.length<h&&p.push(g),g=""}function r(){if(0==m)if(c){for(var t=[],i=0;i<p.length;i++)t.push(new e.ChartSeries(p[i]));y=new e.ChartData(t)}else y=new e.ChartData(p.length),y.addRow(p);else y.addRow(p);p=[],m++}i&&"object"==typeof i||(i={});var a=(i.quote||"").toString().charAt(0)||'"',o=(i.separator||"").toString().charAt(0)||",",s=" ",d="	",l="\n",c="header"in i?!!i.header:!0,u=parseInt(i.maxRows)||250,h=parseInt(i.maxCols)||100;t=t.replace(/\r\n|\r/g,l),t+=l,t=t.replace(/\n([ \t]*\n)+/,l);for(var f=0,g="",p=[],m=0,v=t.length,y=null,w=0;v>w;w++){var b=t.charAt(w);switch(f){case 0:switch(b){case o:n();break;case a:f=1;break;case l:n(),r();break;case s:case d:break;default:f=2,g+=b}break;case 1:switch(b){case a:t.charAt(w+1)==a||(n(),f=3);break;default:g+=b}break;case 2:switch(b){case o:n(),f=0;break;case l:n(),r(),f=0;break;default:g+=b}break;case 3:switch(b){case o:f=0;break;case l:r(),f=0}}if(m>=u)break}return y}}(Yourls);var Yourls=function(e,t){"use strict";return e.ChartRenderer={CHART_TYPES:{area:"AreaChart",line:"LineChart",bar:"BarChart",column:"ColumnChart",pie:"PieChart",geo:"GeoChart"},SIMPLE_CHART_TYPES:["PieChart","GeoChart"],CURRENCIES:{EUR:"fa-eur",USD:"fa-usd",GBP:"fa-gbp",YEN:"fa-yen"},render:function(i,n,r,a){var o=this;return"object"!=typeof a&&(a={}),e.LibLoader.load(e.LibLoader.GJSAPI).then(function(){i.empty();var e=n.toChartkick(),s=e[0].data,d=t.inArray(r,o.SIMPLE_CHART_TYPES)>=0,l=o.chartLibraryOptions(r,a);new Chartkick[r](i[0],d?s:e,{library:l}),a.legendContainer&&!d&&o.renderChartLegend(a.legendContainer,e)})},renderChartLegend:function(i,n,r){var a=this;i.empty();var r=r||this.chartLibraryOptions();n.forEach(function(n,o){function s(){var t="";return f?(t+=String(Number(n.legend.average).toFixed(2)),g||(t+="%")):t+=g?Number(n.legend.total).toLocaleString(I18n.locale):e.Util.shortenNumberToString(Number(n.legend.total),2),t}function d(e){var t="";return g&&p&&(t+=n.legend.currency+" "),t+=e}var l=NaN,c="";isNaN(n.legend.delta)?c="nan":(c+=Number(n.legend.delta)<0?"negative":"positive",l=String(Math.abs(100*Number(n.legend.delta)).toFixed(1)));var u="",h="",f=n.metadata.hasOwnProperty("type")&&"average"===n.metadata.type,g=n.metadata.hasOwnProperty("format")&&"currency"===n.metadata.format,p=n.metadata.hasOwnProperty("currency");g&&p&&(u=n.metadata.currency,a.CURRENCIES.hasOwnProperty(n.metadata.currency)&&(h=a.CURRENCIES[n.metadata.currency]));var m=s(),v=d(m);t(JST["widgets/chart/chart_legend_item"]({title:n.metadata.short_name||n.legend.name,title_tooltip:n.legend.name,color:r.colors[o],total:m,total_tooltip:v,delta:l,delta_class:c,currency_icon_class:h,currency:u})).appendTo(i)})},chartLibraryOptions:function(e,t){"object"!=typeof t&&(t={});var i=parseInt(t.height)||180,n=t.hasOwnProperty("vAxis")?t.vAxis.textPosition:"in",r=t.hasOwnProperty("hAxis")?t.hAxis.textPosition:"out",a=t.hasOwnProperty("pointsVisible")?t.pointsVisible:!1,t={height:i,fontName:"Gudea",legend:{position:"none"},chartArea:{top:0,left:"0",width:"100%",height:"out"==r?i-20:i},isStacked:!!t.stacked,interpolateNulls:!0,hAxis:{maxAlternation:"in"==r?2:1,maxTextLines:"in"==r?2:1,textPosition:r,slantedText:"in"==r},vAxis:{format:"short",textPosition:n,textStyle:{textShadow:"0 0 3px black"}},animation:{duration:750,easing:"out",startup:"animate"in t?!!t.animate:!0},backgroundColor:{fill:"transparent"},colors:["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"],tooltip:{showColorCode:!0},series:t.series||{},pointsVisible:a};switch(e){case this.CHART_TYPES.bar:"out"==r&&(t.chartArea.left="15%",t.chartArea.width="85%",t.vAxis.textPosition="out");break;case this.CHART_TYPES.pie:t.pieSliceText="label";break;case this.CHART_TYPES.geo:t.keepAspectRatio=!1}return t}},e}(Yourls,jQuery);!function(e){"use strict";e.widget("yourls.dropdown",{options:{items:[],showFavicons:!1,height:8,position:{},classes:{},appendTo:null},show:function(){var t=this;return e(document).trigger("show.dropdown",this),this.menu=t._renderMenu(),this.menu?(this.element.addClass("expanded"),this._replaceIcon(this.element,"fa-chevron-down","fa-chevron-up"),this._replaceIcon(this.element,"fa-angle-down","fa-angle-up"),e(document.body).hasClass("kiosk")||(e(document).on("click",this,this._handleDocumentClickBlur),e(window).on("blur",this,this._handleDocumentClickBlur)),e(document).on("show.dropdown",this,this._handleDropdownShow),void this._trigger("shown")):void this._trigger("notshown")},hide:function(){this.menu&&(this.menu.remove(),delete this.menu,this.element.removeClass("expanded"),this._replaceIcon(this.element,"fa-chevron-up","fa-chevron-down"),this._replaceIcon(this.element,"fa-angle-up","fa-angle-down"),e(document).off("click",this._handleDocumentClickBlur),e(window).off("blur",this._handleDocumentClickBlur),e(document).off("show.dropdown",this._handleDropdownShow),this._trigger("hidden"))},_create:function(){this.element.addClass("trigger").addClass(this.options.classes),this._bindEvents()},_destroy:function(){this._unbindEvents(),this.menu&&this.menu.menu("destroy")},_bindEvents:function(){var e=this;this.element.on("click",function(t){t.stopPropagation(),t.preventDefault(),e.menu?e.hide():e.show()})},_unbindEvents:function(){this.element.off("click")},_replaceIcon:function(e,t,i){e.find(".fa").addBack(".fa").filter("."+t).removeClass(t).addClass(i)},_renderMenu:function(){var t=this._getItems()||[];if(e.isArray(t)&&0!=t.length){var i=this,n=e("<ul/>").addClass("dropdown").addClass(this.options.classes).appendTo(this.options.appendTo||document.body);return n.css("max-height",parseInt(this.options.height||8)+"em"),e.each(t,function(t,r){e.isPlainObject(r)||(r={caption:r});var a=e("<li/>").addClass(r.classes).appendTo(n);if("-"==r.caption)return void a.text("-");a.data("item",r);var o=e("<a/>").appendTo(a).text(r.caption).attr("href",r.url||"#").attr("target",r.target||"");if(r.active&&o.addClass("active"),i.options.showFavicons&&r.url){var s=e("<i/>").addClass("favicon").prependTo(o);Yourls.UrlHelper.renderIcon(s,r.icon||r.url,r.icon)}else r.icon&&e("<i/>").addClass("icon fa fa-fw").addClass(r.icon).prependTo(o)}),n.menu({select:function(e,t){e.stopPropagation(),e.preventDefault();var n=t.item.data("item");i.hide(),i._trigger("select",e,n),i._doAction(n,t.item)}}),n.position(e.extend({my:"left top",at:"left bottom",of:this.element,collision:"fit"},this.options.position||{})),n.children("li:visible").length?(this._trigger("rendered",null,{menu:n}),n):void n.remove()}},_getItems:function(){var t=this.options.items||[];return e.isFunction(t)&&(t=t()),e.makeArray(t)},_handleDocumentClickBlur:function(e){e.data.hide()},_handleDropdownShow:function(e,t){e.data!=t&&e.data.hide()},_doAction:function(t,i){var n=!0;if(e.isFunction(t.action)&&(n=n&&t.action(t)===!0),n&&t.url){var r=t.method||"get";if("get"==r)switch(t.target){case"_top":window.top.location=t.url;break;case"_blank":window.open(t.url);break;default:window.location=t.url}else{var a=i.find("a");a.data("method",r),e.rails.handleMethod(a)}}}})}(jQuery);var Yourls=function(e,t){"use strict";return e.Browser=function(i){function n(e,t){function n(e,n){var r=i.compareItems(e,n,t);return 0==r&&e.name&&n.name?e.name.localeCompare(n.name):r}e.sort(n)}function r(e,n){e=t.extend({query:null},e),t.each(i.filters,function(t){t in e||(e[t]=null)});var r={};e.query&&(r.query=t.isArray(e.query)?e.query.join(" "):e.query),t.each(i.filters,function(i){r[i]=t.isArray(e[i])?e[i].join(","):e[i]}),t.each(r,function(e,t){null==t&&delete r[e]}),t.ajax({url:i.url,type:i.method,data:r,dataType:"json",success:function(e){var t=i.transformQueryResult(e);n(t)}})}function a(e,r,o,s){function d(t){a(e,r,o,t)}e.empty();var l=t("<li>").addClass("loader").appendTo(e);t("<i>").addClass("fa fa-fw fa-spinner fa-spin").appendTo(l),l.append(" "+I18n.t("loading")),s=t.extend({query:null},s||{}),i.beforeFilter(s),c(r,s,d),o(function(t){n(t,s),u(t,e)},s),p=t.proxy(a,this,e,r,o,s)}function o(e){if(g.tags||(g.tags={}),!g.tags[e]){var n=i.filters[e].tags;t.isFunction(n)&&(n=n()),g.tags[e]=t.isArray(n)?n:[]}return g.tags[e]}function s(e,i,n){var r=i.any||I18n.t(e+".any");return t.each(o(e),function(){return this.tag==n?(r=this.name,!1):void 0}),r}function d(e){var n=[];return t.each(i.filters,function(i,r){var a=l(e,i,!0);t.each(a,function(e,t){n.push(s(i,r,t))})}),n}function l(e,n,r){var a=i.filterValueForItem(e,n);return r&&(a=a||[],t.isArray(a)||(a=[a])),a}function c(e,n,r){function a(e,i){var n=[],r=o(e);return i.any!==!1&&n.push({name:i.any||I18n.t(e+".any"),tag:null}),r.length&&(n.length&&n.push("-"),n=n.concat(r)),t.map(n,function(i){return{caption:i.name,action:t.proxy(d,null,e,i)}})}function d(e,t){n[e]=t.tag,l[e].find("span").text(t.name),r(n)}var l={};e.empty();var c=0;t.each(i.filters,function(i,r){var o=l[i]=t("<div>").addClass("filter").addClass(i+"-tags").appendTo(e),d=r.icon||"fa-filter";t("<i>").addClass("icon fa").addClass(d).appendTo(o),t("<span>").text(s(i,r,t.makeArray(n[i])[0])).appendTo(o),t("<i>").addClass("dropdown fa fa-angle-down").appendTo(o),o.dropdown({items:t.proxy(a,null,i,r),position:{my:"right top",at:"right bottom+1"}}),c++}),0!=c&&t("<div>").addClass("label").text(I18n.t("filter")).prependTo(e)}function u(n,r){r.empty(),r.toggleClass("show-thumbnails",i.showThumbnails&&!i.showThumbnailsAsTiles),r.toggleClass("show-tiles",i.showThumbnails&&i.showThumbnailsAsTiles),r.toggleClass("show-small-thumbnails",i.showThumbnails&&i.showSmallThumbnails),i.beforeItemsRender(n),n=n.slice(0,i.maxItems),0==n.length&&t("<li>").addClass("no-results").text(I18n.t("no_results_found")).appendTo(r);r.parents(".sidebar:first");t.each(n,function(n,a){i.beforeItemRender(a);var o=a.name;o.length>35&&(o=o.slice(0,34)+"\u2026");var s=t("<li>").addClass("item"),l=t("<a>").appendTo(s);if(t("<div>").addClass("caption").text(o).attr("title",o).appendTo(l),i.showSummaries){var c=a.summary;c||(c=d(a).join(" / ")||a.url),t("<div>").addClass("summary").text(c).appendTo(l)}var u=null;if(a.url&&i.showFavicons?(l.attr("href",a.url),u=t("<i>").prependTo(l),e.UrlHelper.renderIcon(u,a.url,a.icon||i.icon)):a.icon&&(u=t("<i>").addClass("favicon").prependTo(l),e.UrlHelper.renderIcon(u,a.icon)),u&&i.showThumbnails&&u.addClass("thumbnail"),a.thumbnail&&i.showThumbnails){var h=t("<div>").addClass("thumbnail").prependTo(l);h.css("background-image",'url("'+a.thumbnail+'")'),u&&u.remove()}var f=i.filterItem(this)===!1;s.toggleClass("added",f),i.showSelectedFirst&&f?s.prependTo(r):s.appendTo(r),i.itemRendered(a,s);var p=function(){function e(){g.sidebar.sidebar("close")}return close===!0?g.sidebar.sidebar("close"):(!1===i.add(a,e)&&e(),i.selectMultiple||r.children(".added").removeClass("added"),void s.addClass("added"))},m=function(){s.hasClass("added")||p()},v=i.getItemAction(a,p)||{};v=t.extend({caption:I18n.t("add"),icon:"fa-plus",action:m},v);var y=t("<i>").addClass("action fa fa-fw");y.addClass(v.icon).attr("title",v.caption),i.showThumbnailsAsTiles?(y.toggleClass("icon-right",i.showThumbnailsAsTiles),y.toggleClass("always-show",s.hasClass("added")),y.appendTo(l)):y.prependTo(l),l.click(function(e){e.preventDefault(),v.action(a)})})}var h,f=i=t.extend({title:I18n.t("search"),icon:"fa-folder",side:"left",url:null,method:"get",transformQueryResult:function(e){return e.results},extraButtons:[],extraClasses:"",searchHint:I18n.t("search"),maxItems:500,filters:{},tabs:[{name:"default",active:!0,title:null,template:null,options:{}}],footer:null,values:{},formdata:{},cachePopular:!0,cachePopularVersion:1,selectMultiple:!0,showSelectedFirst:!1,scrollToFirstSelected:!1,showFavicons:void 0,showSummaries:!0,showThumbnails:!1,showSmallThumbnails:!1,showThumbnailsAsTiles:!1,initializer:function(e){e()},rendered:function(){},closed:function(){},tabSelected:function(e){},add:function(e,t){},beforeItemsRender:function(e){},beforePopularItemsRender:function(e,t){},beforeSuggestionsRender:function(e,t){},beforeItemRender:function(e){},itemRendered:function(e,t){},filterItem:function(e){},beforeFilter:function(e){},filterValueForItem:function(e,t){return e[t]},getItemAction:function(e,t){},compareItems:function(e,t,i){return 0}},i),g=this,p=null;this.show=function(){function n(){h=t(this),v=h.find(".browsing-only"),w=h.find("ul.suggestions"),b=h.find("input.search"),b.autocomplete({autoFocus:!0,delay:300,minLength:3,html:!0,source:function(e,i){var n=t.trim(e.term)||null;n?l(n):c()}}),b.on("input",function(){b.val()||c()}),y=h.find("nav.filter");var e=f.tabs[0];t.each(f.tabs,function(){this.active&&(e=this)}),d(e.name),f.rendered.apply(this,arguments)}function o(){if(i.scrollToFirstSelected){var e=h.find(".items .item.added:first");e.length&&e[0].scrollIntoView(!1)}}function s(e,t){d(t)}function d(n){b.val("");var r=f.tabs[0];t.each(f.tabs,function(){this.name==n&&(r=this)}),i=t.extend({},f,r.options),v.toggle(!r.template),r.template||e.postpone(c),f.tabSelected(n)}function l(e){var n={query:t.trim(e)};a(w,y,function(t,n){r(n,function(n){n=i.beforeSuggestionsRender(e,n)||n,t(n)})},n)}function c(){var n={query:null};t.each(i.filters,function(e,i){var r=i.popular;t.isFunction(r)&&(r=r()),n[e]=r});var o=t.param(n);a(w,y,function(n,a){function s(e){i.beforePopularItemsRender(e,o==d),n(e)}var d=t.param(a);if(i.cachePopular&&o==d){var l="popular.v"+i.cachePopularVersion+"."+i.url+"."+d+"."+I18n.locale;e.Cache.fetch(l,s,function(e){r(a,e)},30)}else r(a,function(e){s(e)})},n)}var u=[];if(i.extraButtons){var m=i.extraButtons;t.isFunction(m)&&(m=m()),u=u.concat(m)}i.showThumbnails?(i.showSummaries=!1,i.showFavicons!==!0&&(i.showFavicons=!1)):i.showFavicons!==!1&&(i.showFavicons=!0),i.initializer(function(){g.sidebar=e.sidebar("general/browser/sidebar",{title:i.title,icon:i.icon,side:i.side,extraClasses:"browser "+i.extraClasses,values:t.extend(i.values,{searchHint:i.searchHint,tabs:t.map(i.tabs||[],function(e){return e.template&&(e.render=function(){return JST[e.template](i.values)}),e}),hasMultipleTabs:i.tabs.length>1,hasFooter:!!i.footer,footer:function(){return i.footer?JST[i.footer](i.values):""}}),formdata:i.formdata,buttons:u,rendered:n,shown:o,tabselected:s,closed:function(){h=null,p=null,i.closed.apply(this,arguments)}})});var v,y,w,b},this.isVisible=function(){return!!h},this.close=function(){this.isVisible()&&h.sidebar("close")},this.refresh=function(){p&&p()}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.BackgroundBrowser=function(i){function n(){var e=[];return e.push({caption:I18n.t("upload_background"),icon:"fa-upload",autoclose:!1,action:r}),e}function r(){var t=new e.ImageUploader({title:I18n.t("upload_background"),uploadPreset:"background",uploaded:function(e){return h=e,s(e),u.refresh(),!1}});t.show()}function a(e){return e.public_id!=i.selection}function o(e,t){return{caption:I18n.t("select_background"),icon:"fa-check",action:function(){return s(e.public_id),t()}}}function s(e){i.selection=e,i.selected(e)===!1&&u.close()}function d(e){h&&e.unshift({title:"",public_id:h})}function l(e){e.name=e.title}function c(i,n){function r(i){var n=0,r=t.makeArray(i.area),a=t.makeArray(i.subject);return t.inArray(e.user.getCountryCode(),r)>=0?n+=20:t.inArray("int",r)>=0&&(n+=10),t.inArray("popular",a)>=0&&(n+=5),n}return r(n)-r(i)}i=t.extend({selection:null,selected:function(e){},title:I18n.t("select_background"),icon:"fa-picture-o",searchHint:I18n.t("search"),extraButtons:n,cachePopularVersion:2,tabs:[{name:"default",title:I18n.t("background_type.default"),options:{url:"/background/find",filters:{subject:{icon:"fa-tag",popular:null,tags:function(){return e.tags.getBackgroundSubjectTags()}}}}},{name:"used",title:I18n.t("background_type.used"),options:{url:"/background/custom/find",cachePopular:!1,filters:{}}}],selectMultiple:!1,showSelectedFirst:!0,showThumbnails:!0,filterItem:a,compareItems:c,getItemAction:o,beforeItemsRender:d,beforeItemRender:l},i);var u=new e.Browser(i),h=null;return u},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";var i=null;return e.BookmarksAdder=function(n){function r(){function i(e,t){t.preventDefault(),D=e,n.attr("data-mode",e),n.find(":input:visible:first").focus()}k=t(this);var n=k.find(".modes");k.find("#bookmarkGotoSingle").click(i.bind(void 0,"single")),k.find("#bookmarkGotoMultiple").click(i.bind(void 0,"multiple")),I=k.find(':input[name="url"]'),u(I.val()),I.on("input",e.Util.debounce(function(){u(I.val())},500,!1)),c(I),S=k.find(':input[name="title"]'),S.on("input",function(){t(this).addClass("custom")}),T=k.find("form .bookmarks"),x=T.find('textarea[name="urls"]'),l(x),h(x),T.on("click",function(){x.focus()}),T.sortable({items:"a",cursor:"move",distance:15,opacity:.7}),p(x,!0),_=k.find('form select[name="widget_id"]'),E=k.find("form .widget-title"),_.on("change",f),f()}function a(e){A=e}function o(){k=null}function s(t){return e.UrlHelper.isValid(t)||(e.UrlHelper.isValidButWithoutProtocol(t)?t="http://"+t:/^[a-z]+$/.test(t)&&(t="http://"+t+".com")),t}function d(e){P.push(e)}function l(e){e.on("input",function(t){p(e)}),e.on("blur",function(t){p(e,!0)}),e.on("keydown",function(t){8==t.keyCode&&0==e.prop("selectionStart")&&0==e.prop("selectionEnd")&&v()}),e.enter(function(){0==t.trim(e.val()).length&&k.sidebar("doDefaultAction")})}function c(t){t.autocomplete({source:e.UrlHelper.domainAutocomplete,minLength:2,autoFocus:!1,delay:500}),t.on("autocompleteselect",function(){setTimeout(function(){u(t.val())},100)})}function u(i){function n(e){if(!S.hasClass("custom")||S.is(":focus"))S.val(e);else{var i=k.find('label[for="'+S.prop("id")+'"]');i.find("a.suggestion").remove();var n=t("<a>").addClass("suggestion").text(I18n.t("bookmarks_adder.suggested_title",{title:e})).appendTo(i);n.click(function(){n.remove(),S.val(e)})}}var r=i;i=e.UrlHelper.normalizeUrl(i),i&&(i=s(i),e.UrlHelper.isValid(i)&&e.UrlHelper.getTitle(i).then(function(e){I.val()==r&&n(e)}))}function h(t){t.autocomplete({source:e.UrlHelper.domainAutocomplete,minLength:2,autoFocus:!1,delay:500,position:{my:"left top",at:"left bottom+5"}}),t.on("autocompleteselect",function(){setTimeout(function(){p(t,!0)},100)})}function f(){var e=parseInt(_.val());E.toggle(!e)}function g(r){function a(){var i=s(e.UrlHelper.normalizeUrl(r.url)),n=t.trim(r.title),a=t.trim(r.description);return i?[{url:i,title:n,description:a}]:[]}function o(){var i=[];return p(x,!0),T.find("a:not(.invalid)").each(function(n,r){r=t(r);var a=s(r.attr("href")),o=r.find(".title").text();return e.UrlHelper.isValid(a)?(i.push({url:a,title:o}),void r.remove()):void r.addClass("invalid")}),i}function d(){return P}function l(e,r){i=e.getId();var a=0;t.each(r,function(t,i){e.submitLink(i.url,i.title,i.description)||a++}),C.scrollWidgetIntoView(e.getId()),a>0||"add"==A&&"multiple"==D&&T.find("a.invalid").length>0?k&&k.sidebar("alert",{message:I18n.t("urllist.urls_not_added"),type:"error"}):k&&k.sidebar("close"),n.added(r,e)}var c=[];switch(A){case"add":switch(D){case"single":c=a();break;case"multiple":c=o()}break;case"suggestions":c=d()}var u=r.widget_id,h=C.getWidgetById(u);if(h)h.startEditing(),l(h,c);else{var f=t.trim(r.widget_title);C.addWidget("urllist",{title:f||I18n.t("new_bookmark_list"),column:n.column,trigger_added:!1},function(e){l(e,c)})}}function p(e,i){var n=e.val();i&&(n+=" ");for(var r=n.split(/\s+/),a=r.pop();""==r[0];)r.shift();var o=!1;t.each(r,function(e,t){o=!0,m(t)}),o&&e.val(a)}function m(i){i=s(e.UrlHelper.normalizeUrl(i));var n=e.UrlHelper.isValid(i),r=t("<a>").attr({href:i,target:"_blank"}).toggleClass("invalid",!n),a=t("<span>").addClass("title").appendTo(r),o=e.UrlHelper.guessTitleFromUrl(i);n&&y(i,function(e){a.text(e)}),a.text(o),n||r.attr("title",I18n.t("invalid_url"));var d=t("<i>").addClass("favicon").prependTo(r);e.UrlHelper.renderFavicon(d,i,n?"fa-bookmark":"fa-warning");t("<i>").addClass("remove fa fa-fw fa-times").attr("title",I18n.t("remove")).appendTo(r).click(function(e){e.stopPropagation(),e.preventDefault(),r.remove()});T.sortable("refresh"),r.insertBefore(x)}function v(){T.find("a:last").remove()}function y(t,i){e.UrlHelper.getTitle(t).then(i).fail(function(t){e.Logger.error(t)})}function w(i,n,r){function a(e){var i=0;e.rank&&(i=10-Math.log(e.rank));var n=t.makeArray(e.area),r=t.makeArray(e.subject);return t.inArray(o,n)>=0?i+=20:t.inArray("int",n)>=0&&(i+=10),t.inArray("popular",r)>=0&&(i+=5),i}var o=r.area||e.user.getCountryCode();return a(n)-a(i)}function b(e){e.summary=e.url}n=t.extend({widgetId:"auto",url:"",title:"",extraButtons:[],side:"left",column:null,added:function(e,t){}},n);var C,k,I,S,T,x,_,E,P=[],D="single",A="add";this.show=function(){function s(){var e=t.map(C.getWidgetsByType("urllist"),function(e){return{id:e.getId(),title:e.getTitle()}});return e.sort(function(e,t){try{return e.title.localeCompare(t.title)}catch(i){return 0}}),e}if(this.isVisible())return!1;if(C=e.getActivePage(),!C)return!1;i&&!C.getWidgetById(i)&&(i=null);var l=[];l.push({caption:I18n.t("add"),icon:"fa-plus","default":!0,autoclose:!1,action:g}),n.extraButtons&&t.each(n.extraButtons,function(){l.push(t.extend({tabs:["add"]},this))});var c=n.urls||[];t.isArray(c)||(c=c.split(/\s+/));var u=new e.Browser({title:I18n.t("add_bookmarks"),icon:"fa-bookmark",side:n.side,extraClasses:"bookmarks-adder",extraButtons:l,tabs:[{name:"add",title:I18n.t("add"),active:!0,template:"links/sidebar/add"},{name:"suggestions",title:I18n.t("bookmarks_adder.suggestions"),options:{url:"/site/find",filters:{subject:{icon:"fa-tag",popular:"popular",any:!1,tags:function(){return e.tags.getCategorySubjects()}},area:{icon:"fa-globe",popular:e.user.getCountryCode()||"int",any:!1,tags:function(){return e.tags.getAreaTags()}}}}}],footer:"links/sidebar/footer",values:{custom_title:!!n.title,widgets:s(),forceNewWidget:"new"==n.widgetId,title_example:I18n.t("for_example_x",{example:I18n.t("home_name")}),url_example:I18n.t("for_example_x",{example:window.primaryBaseUrl})},formdata:{url:c[0],title:n.title,urls:c,widget_id:"auto"==n.widgetId?i:"new"==n.widgetId?"":n.widgetId},selectMultiple:!0,compareItems:w,beforeItemRender:b,showFavicons:!0,maxItems:50,rendered:r,closed:o,tabSelected:a,add:d});return u.show()},this.isVisible=function(){return!!k}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.EditPage=function(i,n){function r(e){var t=e.find("input[name='share_mode']");t.parent().removeClass("selected"),t.filter(":checked").parent().addClass("selected")}function a(e){var i=e.find("#page_organization"),n=parseInt(i.val())||0,a=i.find("option[value="+n+"]").text(),o=e.find("li.with-organization");o.toggle(!!n),o.each(function(){var e=t(this),i=e.attr("phrase");e.find("label").text(I18n.t(i,{organization:a}))}),n||e.find('input[name="share_mode"]:checked').parent().hasClass("with-organization")&&(e.find('input[name="share_mode"]:first')[0].checked=!0,r(e)),e.find(".organization_section").toggle(!!n)}function o(t){if(h){var i=t.find('input[name="widget_transparency"]'),n=e.Util.debounce(function(e){h.setWidgetTransparency(n.value)},null,!1);i.on("input",function(){n.value=i.val(),n()})}}function s(i){function n(e){var i=e?t.cloudinary.url(e,{width:432,height:243,crop:"fill",fetch_format:"auto",quality:90}):null;s.val(e),o.find("img").attr("src",i),o.toggleClass("has-image",!!i)}function r(e){n(e),h&&h.setBackground(e),c.sidebar("markChanged")}function a(){var t=new e.BackgroundBrowser({selection:s.val(),selected:r});t.show()}var o=i.find(".background.image-selector"),s=o.find("input");n(u.background),o.click(function(){a()}),o.find(".clear").click(function(e){e.stopPropagation(),r(null)})}function d(t){var n=t.find("#page_organization"),r=t.find("#page_editor_count"),a=t.find("#page_editors"),o=t.find("#page_sharemode_only_me");r.click(function(){var t=parseInt(n.val())||0;if(t){var s=new e.EditPageEditors(i,t,{selection:JSON.parse(a.val()),selected:function(e){r.toggleClass("with-editors",e.length>0),r.find(".caption").text(I18n.t("share_mode.only_me_n",{count:e.length})),o.text(I18n.t(e.length?"share_mode.only_we":"share_mode.only_me")),a.val(JSON.stringify(e))}});s.show()}})}function l(n){var r=t.trim(n.title),a=t.trim(n.description);if(!r.length)return I18n.t("please_specify_title");var o=f.length?parseInt(n.organization)||!1:null,s=n.share_mode+"000",d="1"==s[0],l=d&&"1"==s[1],c=d&&"1"==s[2],m=n.editors?JSON.parse(n.editors):null,v=Math.max(0,Math.min(5,parseInt(t.trim(n.column_count))||v)),y=u.background=n.background||!1,w=u.widget_transparency=Math.max(0,Math.min(255,parseInt(n.widget_transparency)))||!1;if(h){var b=h.getColumnCount();h.setColumnCount(v),v!=b&&h.saveWidgetsOrder()}g=!0,e.updatePage(i,{title:r,description:a,column_count:v,organization_id:o,is_public:d,is_listed:c,is_organization_only:l,editor_ids:m,background:y,widget_transparency:w},function(e){return p=p||e,!0})}n=t.extend({activeTab:"general",reloadOnSave:!1},n);var c,u=e.pages.get(i);if(!u)throw"Page not found";var h=e.getActivePage();h&&h.getId()!=i&&(h=null);var f=e.user.getOrganizations(),g=!1,p=n.reloadOnSave;this.show=function(){function h(){c=t(this);var e=c.find("form");e.find(".public_section").toggle(!!b);var i=e.find("input[name='share_mode']").click(function(){e.find(".public_section").toggle("000"!=t(this).val()),r(e)});i.filter('[value="'+_+'"]').parent().addClass("selected"),a(e);var n=e.find("#page_organization"),l=e.find(".share_with_section");l.toggle(!!S),n.change(function(){a(e)}),o(e),s(e),d(e)}function m(){p&&g&&window.location.reload()}var v=u.title,y=u.description,w=u.column_count;i==e.getActivePageId()&&(w=e.getActivePage().getColumnCount());var b=u.is_public?1:0,C=u.is_listed?1:0,k=u.is_owner,I=u.is_editor,S=u.organization?parseInt(u.organization.id)||null:null,T=u.is_organization_only&&S?1:0,x=u.editor_count,_=""+b+T+C,E=u.share_url,P=u.widget_transparency||0,D=[];D.push({caption:I18n.t("done"),icon:"fa-check","default":!0,action:l}),k&&D.push({caption:I18n.t("delete_page"),icon:"fa-trash",rightIcon:"fa-chevron-right",autoclose:!1,action:t.proxy(e.deletePageDialog,e,i)}),e.sidebar("page/edit",{title:I18n.t("edit_page"),icon:"fa-file",extraClasses:"page-edit",formdata:{title:v,description:y,column_count:w,organization:S,share_mode:_,share_url:E,widget_transparency:P},values:{is_owner:k,is_editor:I,owner:u.owner,has_organizations:f.length>0,editor_count:x,organizations:f},rendered:h,closed:m,changed:function(e,t){l(t)},activeTab:n.activeTab,buttons:D})}},e}(Yourls,jQuery);!function(e,t){"use strict";e.EditPageEditors=function(i,n,r){if(this.options=t.extend({selection:null,selected:function(e){}},r),this.page=e.pages.get(i),!this.page)throw"Page not found";if(this.organization=e.user.getOrganizationById(n),!this.organization)throw"Organization not found";this.getEditors(),this.getMembers()},e.EditPageEditors.prototype={show:function(){function i(i){this.sidebar=t(i),t.when(this.options.selection||this.getEditors(),this.getMembers()).then(n).fail(t.proxy(e.fatalError,e))}function n(i,n){a.sidebar.find("section.loader").remove();var r={};t.each(i,function(e,i){r[t.isPlainObject(i)?i.id:parseInt(i)]=!0}),t.each(n,function(e,t){t.editor=!!r[t.id]}),n.sort(function(e,t){return e.editor!=t.editor?t.editor-e.editor:e.name.toString().localeCompare(t.name.toString())});var o=a.sidebar.find("section.editors").empty(),s=e.user.getId();t.each(n,function(e,i){if(i.id!=s){var n=t.tag("a").addClass("editor button").toggleClass("selected",i.editor);t.tag("i").addClass("fa fa-fw fa-user").appendTo(n);var r=t.tag("span").addClass("caption").text(i.name).appendTo(n);t.tag("span").addClass("email").text(i.email).appendTo(r),t.tag("i").addClass("check fa fa-fw fa-check icon-right").toggleClass("green always-show",i.editor).appendTo(n),n.data("user",i.id),n.appendTo(o)}}),o.find(".editor").click(function(){var e=t(this),i=(e.data("user"),e.hasClass("selected"));e.toggleClass("selected",!i),e.find("i.check").toggleClass("green always-show",!i),a.reportSelected()}),a.initialized=!0}function r(){a.initialized&&a.reportSelected()}var a=this;e.sidebar("page/edit_members",{title:I18n.t("who_can_edit_page"),icon:"fa-users",extraClasses:"page-edit-editors sectioned",rendered:t.proxy(i,this),closed:t.proxy(r,this),buttons:[{caption:I18n.t("done"),"default":!0,icon:"fa-check"}]})},getSelectedIds:function(){var e=[],i=this.sidebar.find("section.editors");return i.find(".selected.editor").each(function(){e.push(t(this).data("user"))}),e},reportSelected:function(){this.options.selected(this.getSelectedIds())},getEditors:function(){if(this.editors)return t.when(this.editors);var e=t.Deferred(),i=this;return this.getEditorsPromise?this.getEditorsPromise:(this.getEditorsPromise=e.promise(),t.getJSON("/page/"+this.page.id+"/editors").then(function(t){i.editors=t,e.resolve(t)}).fail(t.proxy(e.reject,e)).always(function(){delete i.getEditorsPromise}),this.getEditorsPromise)},getMembers:function(){if(this.members)return t.when(this.members);var e=t.Deferred(),i=this;return this.getMembersPromise?this.getMembersPromise:(this.getMembersPromise=e.promise(),t.getJSON("/organization/"+this.organization.public_id+"/members").then(function(t){i.members=t,e.resolve(t)}).fail(t.proxy(e.reject,e)).always(function(){delete i.getMembersPromise}),this.getMembersPromise)}}}(Yourls,jQuery);var Yourls=function(e,t){"use strict";return e.Export=function(){function i(e,i){t.isFunction(i)||(i=new Function);var n=t("<a>").attr({href:e,target:"_self","data-method":"get"}).css({display:"none",width:1,height:1});t.rails.handleMethod(n),setTimeout(i,12e3)}var n=this;this.showSidebar=function(t){function i(t){e.setLoading(!0,!0);var i=function(){e.setLoading(!1)},r=("1"==t.export_all_pages?1:0,t.type);"links"==r?n.generateLinkExport(0,i):"feeds"==r?n.generateFeedExport(0,i):i()}e.user&&e.sidebar("general/sidebar_export",{title:I18n.t("export"),icon:"fa-download",formdata:{export_all_pages:0,type:"links"},buttons:[{caption:I18n.t("export"),icon:"fa-download","default":!0,action:i}]})},this.generateLinkExport=function(e,t){var n="/export";"undefined"!=typeof e&&e>0&&(n+="/"+e),i(n,t)},this.generateFeedExport=function(e,t){var n="/export/feed";"undefined"!=typeof e&&e>0&&(n+="/"+e),i(n,t)}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.ColorPicker=function(i){function n(){return["000000","993300","333300","000080","333399","333333","800000","FF6600","808000","008000","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","999999","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFFF","99CCFF","FFFFFF"]}i=t.extend({selectedColor:null,colors:null,allowDefault:!1,selected:function(e){}},i);this.show=function(){function r(){var e=t(this),r=e.find(".body ul.icons"),a=(i.selectedColor||"").toString(16).toUpperCase();
a&&(a=("000000"+a).slice(-6)),r.empty(),t.each(i.colors||n(),function(n,o){o=o.toString(16).toUpperCase();var s=t(JST["general/sidebar/tile"]({icon:"fa-square shadow",color:"#"+o})).appendTo(r);o==a&&(s.addClass("selected"),s[0].scrollIntoView()),s.click(function(t){t.preventDefault(),r.find(".tile.selected").removeClass("selected"),s.addClass("selected"),i.selected(o)===!1&&e.sidebar("close")})})}var a=[{caption:I18n.t("done"),icon:"fa-check","default":!0}];i.allowDefault&&a.push({caption:I18n.t("use_default_color"),icon:"fa-eraser",action:function(){i.selected(null)}}),e.sidebar("general/sidebar_colorpicker",{title:I18n.t("select_color"),icon:"fa-paint-brush",extraClasses:"light",rendered:r,closed:i.closed,buttons:a})}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.IconPicker=function(i){function n(){var e=[];return e.push({caption:I18n.t("done"),icon:"fa-check","default":!0}),i.allowColor&&e.push({caption:I18n.t("select_color"),icon:"fa-paint-brush",autoclose:!1,action:l}),i.allowUpload&&e.push({caption:I18n.t("upload"),icon:"fa-upload",autoclose:!1,action:c}),i.allowDefault&&e.push({caption:I18n.t("use_default_icon"),icon:"fa-eraser",action:function(){i.selected(null,null)}}),e}function r(e){if(t.isArray(e))return e;var i=new Array;return t.map(e,function(e,t){i.push({name:e,icon:t})}),i}function a(e,i){var n=new RegExp(e,"gi");return t.grep(i,function(e,t){return!!e.name.match(n)})}function o(e){return e.icon==i.selectedIcon?!1:void 0}function s(e,t){t.find("i.favicon.fa").css("color","#"+i.selectedColor)}function d(e,t){return{caption:I18n.t("select_icon"),icon:"fa-check",action:function(){return i.selected(i.selectedIcon=e.icon,i.selectedColor),t()}}}function l(){new e.ColorPicker({selectedColor:i.selectedColor,allowDefault:!0,selected:function(e){i.selected(i.selectedIcon,i.selectedColor=e),h.refresh()}}).show()}function c(){new e.ImageUploader({uploadPreset:"custom-icon",uploaded:function(e,t){i.selected(t.secure_url)}}).show()}function u(e,t){return e.name<t.name?-1:e.name>t.name?1:0}i=t.extend({selectedIcon:null,selectedColor:null,allowDefault:!1,allowColor:!1,allowUpload:!1,selected:function(e,t){},title:I18n.t("select_icon"),icon:"fa-cubes",searchHint:I18n.t("search"),url:"/tools/icons",extraButtons:n,selectMultiple:!1,scrollToFirstSelected:!0,transformQueryResult:r,beforeSuggestionsRender:a,filterItem:o,itemRendered:s,getItemAction:d,showThumbnails:!0,showSmallThumbnails:!0,compareItems:u,maxItems:1e3},i),i.allowUpload&&(i.tabs=[{name:"fontawesome",title:I18n.t("general"),options:{url:"/tools/icons"}},{name:"user",title:I18n.t("your_icons"),options:{cachePopular:!1,url:"/tools/icons/user"}}]);var h=new e.Browser(i);return h},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.ImageUploader=function(i){i=t.extend({title:I18n.t("upload"),uploadPreset:"background",cloudName:t.cloudinary.config().cloud_name,fileTypes:["jpeg","gif","png","bmp","ico","pdf","svg","tiff"],maxFileSize:20,uploaded:function(e,t){}},i);var n,r=this;this.show=function(){function a(){function e(e,t){l(),h.text("Uploading...")}function a(e,t){h.text(Math.round(t.loaded/t.total*100)+"%")}function o(e,i){var r=null;t.each(i.files,function(e,t){t.error&&(r=t.error)}),n.sidebar("alert",{message:r||I18n.t("uploader.error.upload_failed"),type:"error"})}function d(e,n){c.addClass("uploaded");var a=t.cloudinary.url(n.result.public_id,{crop:"fit",width:280,height:190,fetch_format:"auto"});u.css("background-image","url("+a+")"),i.uploaded(n.result.public_id,n.result)===!1&&r.close()}function l(){c.removeClass("uploaded"),u.css("background-image","none"),n.sidebar("alert",[])}n=t(this);var c=n.find(".work-area"),u=c.find(".dropzone"),h=u.find(".status");s=n.find(".button.select-file input").unsigned_cloudinary_upload(i.uploadPreset,{cloud_name:i.cloudName},{dropZone:u,pasteZone:t(document.body),acceptFileTypes:new RegExp("(\\.|\\/)("+i.fileTypes.join("|")+")","i"),maxFileSize:i.maxFileSize*Math.pow(2,20),messages:{uploadedBytes:I18n.t("uploader.error.upload_failed"),maxNumberOfFiles:I18n.t("uploader.error.upload_failed"),acceptFileTypes:I18n.t("uploader.error.invalid_file_type"),maxFileSize:I18n.t("uploader.error.file_too_large"),minFileSize:I18n.t("uploader.error.upload_failed")},start:e,progress:a,done:d,fail:o,processfail:o})}var o=t.map(i.fileTypes,function(e){return e.toUpperCase()}).join(", ");e.sidebar("general/sidebar_image_uploader",{title:i.title,icon:"fa-upload",extraClasses:"image-uploader sectioned",values:{fileTypes:o,maxFileSize:i.maxFileSize},rendered:a,closed:function(){n=null}});var s},this.close=function(){n&&n.sidebar("close")}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.Import=function(){function i(i,n,r,a,o){function s(){if(o>c){setTimeout(d,h);var e=u+h;u=h,h=e}else l()}function d(){o>c?(c+=1,t.ajax({url:"/import/poll/"+i,type:"get",contentType:"application/json",dataType:"json",loader:I18n.t("importing"),success:function(e){"work"!=e.status?(l(),n(e)):s()},error:function(){r(),l()}})):l()}function l(){e.popLoading(!1)}var c=0,u=0,h=a;e.pushLoading(I18n.t("importing"),!0),s()}function n(e,t,i){e.ajaxSubmit({url:"/import",type:"post",dataType:"json",success:t,error:i,blocking:!0})}var r=this;this.showSidebar=function(i){function a(t,i){var a=t.page_id,o=t.title,s=i.find("form"),d=s.find("#import_file").val();d.length>0&&(a.length>0||o.length>0)&&(o.length>0&&s.find("input#page-select").val(""),e.setLoading(I18n.t("importing")),n(s,function(t){t.success===!0?(e.setLoading(!1),window.location.href=t.location+"?import="+t.id):"work"==t.status&&r.pollImport(t.id)},function(){e.setLoading(!1)}))}function o(t){e.setLoading(!0,!0),t(0,function(){e.setLoading(!1)})}e.user&&e.sidebar("general/sidebar_import",{title:I18n.t("import_and_export"),icon:"fa-exchange",formdata:{page_id:i,title:"",import_file:""},buttons:[{caption:I18n.t("import"),icon:"fa-upload","default":!0,action:a},{caption:I18n.t("export_links"),icon:"fa-bookmark",action:function(){o(e.getExport().generateLinkExport)}},{caption:I18n.t("export_feeds"),icon:"fa-rss",action:function(){o(e.getExport().generateFeedExport)}}],rendered:function(){var e=t(this);e.find(".alert").hide(),e.find("#import_file").bind("change",function(){this.files[0].size>1048576?e.find(".alert").show():e.find(".alert").hide()})}})},this.pollImport=function(t){e.setLoading(I18n.t("importing"),!0),e.alert(I18n.t("import_wait"),{title:I18n.t("importing"),icon:"fa-exchange"}),i(t,function(t){t.success===!0&&(e.setLoading(!1),window.location.href=t.location+"?import="+t.id)},function(t){e.error(I18n.t("import_failed"))},1e3,12)},this.showNotification=function(){var t=/[?&]import=([0-9]+)$/.exec(window.location.search);if(!t)return!1;var i=parseInt(t[1]);return e.showNotification(I18n.t("import_confirmation"),{actionText:I18n.t("undo"),action:function(){r.deleteImport(i,e.getActivePageId(),function(e){e.success===!0&&(window.location.href=e.location)})},closed:function(){window.location.href=location.pathname}}),!0},this.deleteImport=function(e,i,n){t.ajax({url:"/import/"+e,type:"delete",contentType:"application/json",dataType:"json",data:JSON.stringify({page:i}),blocking:!0,success:n})}},e}(Yourls,jQuery);!function(e,t){"use strict";function i(){function i(){var e=t(window).scrollTop(),i=t(window).innerHeight(),a=e+i,o=a-.1*i,s=a+.1*i;r.toggleClass("scrolled",e>0),n.each(function(){var e=t(this),i=e.offset().top;if(e.hasClass("seen")){var n=i>s;e.toggleClass("seen",!n).toggleClass("unseen",n),n&&e.trigger("unseen")}else{var r=o>=i;e.toggleClass("seen",r).toggleClass("unseen",!r),r&&e.trigger("seen")}})}var n=t(".seeme"),r=t("#header");i(),t(window).on("resize scroll",e.Util.throttle(i,250))}function n(){function e(e,o,s,d){function l(s,d){function c(){var e=p.text(),t=m.text(),i=t.slice(0,1);e+=i,t=t.slice(1),p.text(e),m.text(t),t?setTimeout(c," "==i?0:v):setTimeout(u,r)}function u(){var e=p.text(),t=m.text();t=e.slice(-1)+t,e=e.slice(0,-1),p.text(e),m.text(t),e?setTimeout(u,v*n):setTimeout(l,a)}var h=o.filter(".active").index();o.removeClass("active"),"undefined"==typeof s&&(s=h>=0?(h+1)%o.length:0);var f=t(o[s]),g=t.trim(f.text());f.empty();var p=t("<span>").addClass("typed").appendTo(f),m=t("<span>").addClass("untyped").appendTo(f);f.addClass("active");var v=i/g.length;d?(p.text(g),c(e,o,p,m,v)):(m.text(g),c(e,o,p,m,v))}e.css("width",e.width()),l(s,d)}var i=750,n=1/3,r=1e3,a=240,o=t("kbd");o.each(function(){var i=t(this),n=i.children(".word");n.length>0&&e(i,n,0,!0)})}function r(){function e(e){i(e),r(e,0),e.data("interval",window.setInterval(r.bind(void 0,e,1),4e3))}function i(e){window.clearInterval(e.data("interval")),e.data("interval",!1)}function n(e){var t=e.find("ul.photos"),i=t.children();i.removeClass("active")}function r(e,r,a){a&&i(e),n(e);var o=e.find("ul.photos"),s=o.children(),d=parseInt(o.data("current-slide"))||0,l=o.find("li").length,c=((d+r)%l+l)%l;o.css("transform","translateX("+-100*c+"%)").data("current-slide",c),t(s.get(c)).addClass("active")}t("section.slide.box").each(function(){var a=t(this),o=a.find("nav");r(a,0),e(a),a.on("seen",e.bind(void 0,a)),a.on("unseen",function(){n(a),i(a)});var s=r.bind(void 0,a,1,!0),d=r.bind(void 0,a,-1,!0);o.find(".prev").click(d),o.find(".next").click(s),a.on("click",i.bind(void 0,a)),a.on("swipeleft",d),a.on("swiperight",d)})}t("main").hasClass("landing-page")&&(r(),n(),i())}(Yourls,jQuery);var Yourls=function(e,t){"use strict";return e.Storage={localStorage:{},init:function(){this.localStorage=localStorage},getItem:function(e){return this.localStorage[e]},setItem:function(e,t){this.localStorage[e]=t},removeItem:function(e){try{delete this.localStorage[e]}catch(t){}},clear:function(){this.localStorage.clear()}},e.Storage.init(),e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.Model={loggedIn:function(){var t=e.Storage.getItem("loggedIn");return"undefined"==typeof t?!1:"true"==t},openLinksInNewWindow:function(){var t=e.Storage.getItem("openLinksInNewWindow");return"undefined"==typeof t?!1:"true"==t||1==t},showFavicons:function(){var t=e.Storage.getItem("showFavicons");return"undefined"==typeof t?!0:"true"==t||1==t},startWithLastTab:function(){var t=e.Storage.getItem("startWithLastTab");return"undefined"==typeof t?!1:"true"==t||1==t},options:{buildSuccess:function(){},buildError:function(){},saveSuccess:function(){},buildMenuSuccess:function(){},buildSearchProviderSuccess:function(){},data:null},build:function(i){if(t.extend(this.options,i),i.data=i.data||{},!i.data.page&&e.user){var n=[e.user.getId(),location.pathname].join(":"),r=e.Cache.get(n,null);try{r&&t("#pages").data("active-page-version")-r.page.version>.005&&(e.Cache.set(n,null),r=null)}catch(a){Bugsnag.notifyException(a,"Invalid cached page data")}r&&(i.data=t.extend(r,i.data))}i.data.page?this.handleSuccess(i.data):this.retrieve({blocking:!0})},retrieve:function(i){i||(i={});var n=parseInt(e.getActivePageId());if(!n||n==e.noRenderPage)return this.handleError(null,null,"Cannot load non-persisted page");var r=location.pathname+".json";t.ajax({url:r,success:t.proxy(this.handleSuccess,this),dataType:"json",accept:"application/json",error:t.proxy(this.handleError,this),blocking:!!i.blocking}).always(function(){e.popLoading()})},save:function(e){t.ajax({url:"/home/update",type:"PUT",contentType:"application/json",data:JSON.stringify(e),dataType:"json"}).done(this.options.saveSuccess)},setOpenLinksInNewWindow:function(t){e.Storage.setItem("openLinksInNewWindow",t)},setShowFavicons:function(t){e.Storage.setItem("showFavicons",t)},setStartWithLastTab:function(t){e.Storage.setItem("startWithLastTab",!!t)},setNotifications:function(t){e.Storage.setItem("notifications",JSON.stringify(t))},getNotifications:function(){var t=e.Storage.getItem("notifications");try{return"undefined"==typeof t?[]:JSON.parse(t)}catch(i){return Bugsnag.notifyException(i,"Error parsing notifications",{notifications:t}),[]}},handleSuccess:function(i){var n=!1;if(this.loggedIn()&&!i.user&&(n=!0),i.user){var r=[i.user.id,location.pathname].join(":");e.Cache.set(r,i,43200)}e.Storage.setItem("loggedIn",!!i.user),this.setOpenLinksInNewWindow(i.settings.open_links_in_new_window),this.setShowFavicons(i.settings.show_favicons),this.setStartWithLastTab(i.settings.start_with_last_tab),this.setNotifications(i.notifications),i.user?t(this).trigger("loginStatus",t.extend({loggedIn:!0,timeout:n},i.user)):t(this).trigger("loginStatus",{loggedIn:!1,timeout:n}),this.options.buildMenuSuccess(i.pages),this.options.buildSearchProviderSuccess(i.search_providers),this.options.buildSuccess(i.page)},handleError:function(e,t,i){this.options.buildError(i)},isMenuCached:function(){var t=e.Storage.getItem("menu");return"undefined"!=typeof t&&""!=t&&null!=t},isSearchProviderCached:function(){var t=e.Storage.getItem("searchProvider");return"undefined"!=typeof t&&""!=t&&null!=t},clearMenuCache:function(){this.isMenuCached()&&e.Storage.removeItem("menu")},clearSearchProviderCache:function(){this.isSearchProviderCached()&&e.Storage.removeItem("searchProvider")},clearUserCache:function(){e.Storage.removeItem("loggedIn"),e.Storage.removeItem("openLinksInNewWindow"),e.Storage.removeItem("showFavicons"),e.Storage.removeItem("showSearch")}},e}(Yourls,jQuery);!function(e,t){"use strict";e.Page=function(e){this.data=e,this.id=null!=this.data&&"undefined"!=typeof this.data.id?e.id:0,this.domElement=null},e.Page.prototype={MIN_COLUMNS:1,MAX_COLUMNS:5,MIN_COLUMN_WIDTH:225,MAX_COLUMN_WIDTH:600,OPTIMAL_COLUMN_WIDTH:350,COLUMN_GUTTER_WIDTH:20,MINIMAL_MARGIN:10,widgets:[],newUserWidgetCounter:0,getId:function(){return this.data.id},getVersion:function(){return this.data.version},setVersion:function(e){this.data.version=e},getType:function(){return this.data.type||"urllist"},getTitle:function(){return this.data.title},isPublic:function(){return 1==this.data.is_public},isListed:function(){return 1==this.data.is_listed},isOwned:function(){return!!this.data.is_owner},isEditable:function(){return this.isOwned()||!!this.data.is_editor},isPinned:function(){return!!this.data.pinned},isPersisted:function(){return!!this.getId()},getEditorCount:function(){return this.data.editor_count||0},getPingUrl:function(){return this.data.ping_url},render:function(){var i=JST["links/page"]({id:this.data.id,index:this.data.index,title:this.data.title,active:this.data.active,column_count:this.data.column_count,columns:t.map(this.data.columns||[],function(e,i){return t.extend(e,{index:i})})});return this.domElement=t(i),"undefined"!=typeof this.data.background&&null!=this.data.background&&this.data.background.length>0&&e.isDisplayingPage()?this.setBackground(this.data.background):this.setBackground(null),this.setWidgetTransparency(this.data.widget_transparency),e.postpone(this.renderWidgets.bind(this)),this.domElement},renderWidgets:function(){measure("render");var i=this.data.sections||[];if(this.isPersisted()&&i.length>1)throw"Sections are not supported for persisted pages";var n=t(),r=this;t.each(i,function(i,a){var o=r.renderNewSection(i,a);n=n.add(o);var s=t();t.each(a.columns||[],function(e,i){var n=r.renderNewColumn(e);s=s.add(n),t.each(i.widgets,function(e,t){measure("render_"+t.widget_type),r.pushWidget(t.widget_type,n,t),measureEnd("render_"+t.widget_type)})}),s.appendTo(o.find(e.selectors.sectionColumns))}),n.appendTo(this.domElement),this.adjustColumns(),t(window).resize(e.Util.debounce(t.proxy(this.adjustColumns,this),250)),measureEnd("render")},renderNewSection:function(e,i){var n=t.tag("section").addClass("section").data("id",i.id);t.tag("section").addClass("columns").appendTo(n);if(i.title){var r=t.tag("header").prependTo(n),a=t.tag("a").addClass("title").appendTo(r),o=t.tag("h2").text(i.title).appendTo(a);if(i.icon&&t.tag("i").addClass("fa").addClass(i.icon).prependTo(o),i.description){t.tag("i").addClass("fa fa-question-circle").appendTo(o);o.attr("title",i.description).tooltip({track:!0})}i.url&&(a.attr("href",i.url).attr("target","_self"),i.moreLabel&&t.tag("span").addClass("more").text(i.moreLabel).appendTo(o))}return n},renderNewColumn:function(e){var i=t.tag("section").addClass("column column-"+e).data("index",e),n=this,r=t(JST["links/add_widget_placeholder"]({})).appendTo(i);return r.find(".button").click(function(){n.showAddWidgetsDialog({column:e})}),i},show:function(){this.domElement.addClass("active"),this.domElement.show()},hide:function(){this.domElement.hide()},setBackground:function(i){this.data.background=i;var n=t("html");if(n.data("background")!=i){n.data("background",i),i?n.removeClass("default-background").css("background-image","url('"+t.cloudinary.url(i,{fetch_format:"auto",quality:"auto"})+"')"):n.addClass("default-background").css("background-image",""),e.dom.submenu.removeClass("js-background").children(".background").remove();var r=e.UrlHelper.isValid(i);if(i&&!r){e.dom.submenu.addClass("js-background");var a=t.tag("div").addClass("background").appendTo(e.dom.submenu),o=e.dom.header.add(a),s=t.cloudinary.url(i,{width:1,height:1,crop:"scale",fetch_format:"png",effect:["brightness",-60]});o.css("background-image","url('"+s+"')")}else e.dom.header.css("background-image","none")}},getWidgetTransparency:function(){return parseInt(this.data.widget_transparency)||0},setWidgetTransparency:function(e){this.data.widget_transparency=e=Math.max(0,Math.min(255,e||0)),t(this).trigger("changed.widgetBackground")},getColumnCount:function(){return parseInt(this.domElement.data("columns"))||0},isAutoColumnCount:function(){return 0==this.getColumnCount()},getActualColumnCount:function(){return this.domElement.children(e.selectors.sections).first().children(e.selectors.sectionColumns).children(e.selectors.columns).length},setColumnCount:function(i){var n=this.isAutoColumnCount(),r=this.getActualColumnCount();i=parseInt(i)||0;var a=i;(1>a||a>this.MAX_COLUMNS)&&(a=this.optimalColumnCount());var o=this.domElement;o.data("columns",i);for(var s=0;s<=this.MAX_COLUMNS;s++)o.toggleClass("columns-"+s,s==a);var d=this;o.children(e.selectors.sections).each(function(){for(var i=t(this),n=r;a>n;n++)d.renderNewColumn(n).appendTo(i.find(e.selectors.sectionColumns))}),this.reflowWidgets(a,n);for(var s=a;r>s;s++)o.find("section.column-"+s).remove();this.initDragDrop(),t(this).trigger("adjusted.columns")},pageWidth:function(){return this.domElement.width()||e.dom.pages.innerWidth()},optimalColumnWidth:function(){var e=this.OPTIMAL_COLUMN_WIDTH;return this.pageWidth()>1100&&(e*=1.2),e},maxWidgetCountPerSection:function(){var i=0;return this.domElement.children(e.selectors.sections).each(function(){i=Math.max(i,t(this).find(e.selectors.widget).length)}),i},optimalColumnCount:function(){var e=this.calcColumnCount(this.optimalColumnWidth(),!0),t=this.maxWidgetCountPerSection(),i=Math.max(2,Math.ceil(t/e)),n=e*i;return 3>=t?Math.max(this.MIN_COLUMNS,t):n-t>=i?Math.max(this.MIN_COLUMNS,Math.min(e,Math.ceil(t/i))):e},calcColumnCount:function(e,t){var i=this.pageWidth();i-=2*this.MINIMAL_MARGIN,i-=e;var n=i/(e+this.COLUMN_GUTTER_WIDTH)+1;return n=t?Math.round(n):Math.floor(n),Math.max(1,Math.min(this.MAX_COLUMNS,n))},adjustColumns:function(){this.setColumnCount(this.getColumnCount())},getWidgetsInFlowOrder:function(i){var n=[],r=i||this.domElement,a=r.find(e.selectors.columns);return a.each(function(i,r){t(r).find(e.selectors.widget).each(function(e,t){n[e*a.length+i]=t})}),n=t.map(n,function(e){return e})},reflowWidgets:function(i,n){var r=this.domElement,a=this,o=this.isAutoColumnCount();r.children(e.selectors.sections).each(function(){for(var r,s=t(this),d=[],l=0;i>l;l++)d[l]=[];if(o||n){r=a.getWidgetsInFlowOrder(s);for(var c=0;c<r.length;c++)d[c%i].push(r[c])}else s.find(e.selectors.widget).each(function(){d[Math.max(0,Math.min(d.length-1,t(this).data("column")))].push(this)});var u=s.data("flowSignature"),h=t.map(d,function(e){return t.map(e,function(e){return t(e).data("uid")}).join(",")}).join(";").hashCode();s.data("flowSignature",h),u!=h&&(s.find(e.selectors.columns).each(function(e,i){var n=t(i).children(".add-widget-placeholder");d[e]&&t.each(d[e],function(){var i=t(this);o||i.data("column",e),i.insertBefore(n),t(i).trigger("moved.widget")})}),a.updateColumnStatistics(s))})},updateColumnStatistics:function(i){var n=i||this.domElement,r=!0;n.find("section.column").each(function(){var i=t(this),n=i.children(e.selectors.widget).length;i.toggleClass("empty",0==n),r=r&&0==n}),n.toggleClass("empty",r)},getWidgetById:function(e){for(var t in this.widgets){var i=this.widgets[t];if(i.getId()==e)return i}},getWidgetsByType:function(e){var t=[];for(var i in this.widgets){var n=this.widgets[i];n.getWidgetType()==e&&t.push(n)}return t},getWidgetCount:function(){return this.widgets.length},subscribe:function(){e.gtmEvent("Navigation",{item:"SubscribePage"}),e.Page.API.subscribe(this.data.id).done(function(){window.location.reload()})},unsubscribe:function(){e.gtmEvent("Navigation",{item:"UnsubscribePage"}),e.Page.API.unsubscribe(this.data.id).done(function(){window.location.reload()})},clone:function(){e.gtmEvent("Navigation",{item:"ClonePage"}),e.Page.API.clone(this.getId()).done(function(e){window.top.location=e.url+"#editPage"})},scheduleSaveWidgetOrder:function(e){var t=this;window.setTimeout(function(){t.saveWidgetsOrder(e)},1e3)},saveWidgetsOrder:function(i){if(this.savingWidgetsOrder)return void this.scheduleSaveWidgetOrder(i);this.savingWidgetsOrder=!0;for(var n=[],r=this.getColumnCount();n.length<(r||1);)n.push({widgets:[]});if(this.isAutoColumnCount())t.each(this.getWidgetsInFlowOrder(),function(){n[0].widgets.push({id:t(this).data("widget_id")})});else{var a=this.domElement.find(e.selectors.columns);a.each(function(i,a){t(a).find(e.selectors.widget).each(function(e,i){var a=Math.max(0,Math.min(r-1,t(i).data("column")));n[a].widgets.push({id:t(i).data("widget_id")})})})}var o=this;this.patchWidgets({columns:n},function(){delete o.savingWidgetsOrder,t.isFunction(i)&&i()})},patchWidgets:function(t,i){e.ajaxSave({url:"/page/"+this.id+"/widgets",type:"patch",contentType:"application/json",data:JSON.stringify(t),dataType:"json",success:i})},getData:function(){return this.data},addWidget:function(i,n,r){var a=t.Deferred(),o=[];n&&"column"in n&&(o=this.domElement.find(e.selectors.columns).eq(n.column),delete n.column),0==o.length&&(o=this.getLeastHighColumn()),n=t.extend({page:this.id,column:o.index(),trigger_added:!0},n);var s=n.trigger_added;delete n.trigger_added,a.done(r);var d=this;return this.postWidget(i,n).success(function(e){if(n.page!=d.id)return void a.resolve();var r=d.pushWidget(i,o,e);if(!r)return void Bugsnag.notify("PushWidgetError","Failed to create widget",{widget:{type:i,column:o,data:e}});switch(d.adjustColumns(),s=s&&!n.source_id,i){case"rsslist":n.feed&&(r.addFeed(n.feed),s=!1)}d.scrollWidgetIntoView(r.getId(),function(){r.domElement.show("drop",{direction:"up"},function(){s&&t(r).trigger("added.widget"),a.resolve(r)})}),r.domElement.hide(),d.enableEditing()}).fail(t.proxy(a.reject,a)),a.promise()},scrollWidgetIntoView:function(e,i){var n=this.getWidgetById(e);if(!n)return!1;var r=t(document.body),a=r.scrollTop(),o=n.domElement.offset().top+a;o-=200,r.animate({scrollTop:o},400,i)},postWidget:function(i,n,r){n=t.extend({page:this.id,column:0,title:I18n.t("new_urllist"),icon:null,source_id:null,settings:null,items:null},n);var a={title:n.title,widget_type:i,icon:n.icon,column:n.column,source_id:n.source_id,settings:n.settings,items:n.items};return e.ajaxSave({url:"/page/"+n.page+"/widget",type:"post",contentType:"application/json",data:JSON.stringify(a),dataType:"json"}).success(r)},pushWidget:function(i,n,r){var a,o;try{if(a=e.Widget.typeExists(i)?e.Widget.create(i,r):e.Widget.create("error",t.extend(r,{error:"Unsupported type",message:I18n.t("widget_type_does_not_exist")})),"undefined"==typeof r.id&&(r.id=++this.newUserWidgetCounter),o=a.render(this),!o)throw"Failed to render widget"}catch(s){e.Logger.error(s);try{a=e.Widget.create("error",t.extend(r,{error:s})),o=a.render(this)}catch(s){return e.Logger.error(s),!1}}n.children(".add-widget-placeholder").before(o),this.widgets.push(a);var d=this;t(a).on("save",function(){t(d).trigger("save")}),t(a).on("delete",function(){var e=t.inArray(this,d.widgets);e>=0&&d.widgets.splice(e,1),setTimeout(function(){d.updateColumnStatistics(),d.adjustColumns()},1)});var l="number"==typeof r.column?r.column:n.data("index");a.domElement.data("column",l);var c=n.parent(e.selectors.sections),u="number"==typeof r.section?r.section:c.data("id");return a.domElement.data("section",u),a},enableEditing:function(){this.initDragDrop()},getLeastHighColumn:function(){var i=this.domElement.find(e.selectors.columns).filter(":visible"),n=null,r=-1;return i.each(function(i,a){var o=parseInt(t(a).height());return 0==t(a).find(e.selectors.widget).length?(n=a,!1):void((null==n||r>o)&&(r=o,n=a))}),t(n)},enableSortMode:function(){if(!this.domElement.hasClass("sorting")){this.enableDragDrop(),this.domElement.find("article.widget").each(function(){t(this).height(t(this).height())}),this.domElement.addClass("sorting"),t(document.body).animate({scrollTop:0},500);var i=this.domElement.find(e.selectors.columns);setTimeout(function(){i.sortable("refreshPositions")},600),e.showNotification(I18n.t("you_can_now_organize_widgets"),{icon:"fa-arrows",actionText:I18n.t("done"),action:function(e){e()},canClose:!0,autoClose:!1,closed:this.disableSortMode.bind(this)})}},disableSortMode:function(){if(this.domElement.hasClass("sorting")){e.canDragWithoutEditing()||this.disableDragDrop(),this.domElement.removeClass("sorting");var i=this;setTimeout(function(){i.domElement.find("article.widget").each(function(){t(this).height("")})},200)}},initDragDrop:function(){e.isEditable()&&e.canDragWithoutEditing()&&e.postpone(this.enableDragDrop,this)},enableDragDrop:function(){function i(t){t.sortable({items:">"+e.selectors.widget,connectWith:e.selectors.columns,distance:15,handle:"header",placeholder:"widget-placeholder",helper:"original",forcePlaceholderSize:!1,cursor:"move",tolerance:"pointer",update:n,change:r,start:a,stop:o})}function n(i,n){var r=n.item,a=t(i.target),o=a.parent(e.selectors.sections);r.data("column",a.data("index")),r.data("section",o.data("id")),t(r).trigger("moved.widget"),s.domElement.addClass(d)}function r(e,i){t(this).sortable("refreshPositions")}function a(){s.enableSortMode()}function o(e,i){s.domElement.hasClass(d)&&(s.domElement.removeClass(d),s.saveWidgetsOrder()),s.domElement.children(".add-widget-placeholder").each(function(){var e=t(this),i=e.parent();e.appendTo(i)}),s.adjustColumns(),s.updateColumnStatistics(),t(this).hasClass("dropped")&&(t(this).sortable("cancel"),t(this).removeClass("dropped"),t(this).find(".removed").remove())}var s=this;this.domElement.find(e.selectors.columns).each(function(e,n){n=t(n),n.sortable("instance")||i(n)});var d="widgets-order-changed"},disableDragDrop:function(){this.domElement.find(e.selectors.columns).each(function(e,i){i=t(i),i.sortable("instance")&&i.sortable("destroy")})},showAddWidgetsDialog:function(i){e.gtmEvent("Navigation",{item:i&&"column"in i?"AddWidgetsFromGrid":"AddWidgets"});var n=this;new e.WidgetsBrowser(t.extend({add:function(r,a){var o=t.inArray("premium",r.subject)>=0;return!o||e.user&&e.user.isPremium()?"urllist"!=r.type||r.source_id?(i=t.extend({title:r.title,icon:r.icon,source_id:r.source_id,feed:r.feed,column:i.column},i),n.addWidget(r.type,i),!1):(e.showAddBookmarksDialog({widgetId:"new",column:i.column,added:function(){a()}}),!0):(e.embedPage("/premium"),!0)}},i)).show()}},e.Page.Factory=function(t){return new e.Page(t)},e.Page.closeInlineEdits=function(){var t=e.root.find(".inline-editing");t.trigger("closeInlineEdit")},e.Page.API=function(){return{subscribe:function(e){return t.when(t.ajax({url:"/page/"+e+"/subscription",type:"post",contentType:"application/json",dataType:"json",loader:I18n.t("updating")}))},unsubscribe:function(e){return t.when(t.ajax({url:"/page/"+e+"/subscription",type:"delete",contentType:"application/json",dataType:"json",loader:I18n.t("updating")}))},clone:function(e){return t.when(t.ajax({url:"/pages/"+e,type:"post",contentType:"application/json",dataType:"json",loader:I18n.t("saving"),blocking:!0}))},moveWidget:function(e,i){var n={tab_id:i};return t.when(t.ajax({url:"/widget/"+e,type:"put",contentType:"application/json",data:JSON.stringify(n),dataType:"json"}))}}}()}(Yourls,jQuery),function(e,t){"use strict";e.Pages=function(e){e&&this.setData(e)},e.Pages.prototype={setData:function(e){if(!t.isArray(e))throw"Invalid pages data: Array expected";var i=this.pages=[];t.each(e,function(e,n){if(!t.isPlainObject(n))throw"Invalid page data: Object expected";i.push(n)}),this.triggerChanged()},get:function(e){e=parseInt(e);var t=!1;return this.each(function(i,n){return n.id==e?(t=n,!1):void 0}),t},count:function(){return this.pages.length},each:function(e){t.each(this.pages,e)},filter:function(e){var i=[];return t.isFunction(e)||(e=function(){}),this.each(function(t,n){e(n)!==!1&&i.push(n)}),i},sort:function(e){if(!t.isFunction(e))throw"Function expected";this.pages.sort(e),this.triggerChanged()},section:function(i){function n(t,i){r[t]||(r[t]=new e.Pages.Section(i.organization||t)),r[t].add(i)}if(i)return new e.Pages(i).section();var r={};return t.each(this.pages,function(t,i){i.organization?n(i.organization.id,i):i.pinned?n(e.Pages.Section.PINNED,i):i.is_owner?n(e.Pages.Section.PERSONAL,i):n(e.Pages.Section.PUBLIC,i)}),t.each(r,function(e,t){t.sort()}),r},getActivePage:function(){var e=!1;return this.each(function(t,i){return i.is_active?(e=i,!1):void 0}),e},setActivePage:function(e){e=parseInt(e),this.each(function(t,i){i.is_active=i.id==e})},triggerChanged:function(){t(this).trigger("changed")},on:function(e,i){t(this).on(e,i)},off:function(e,i){t(this).off(e,i)}},e.Pages.Section=function(i){switch(this.id=parseInt(i),this.pages=[],this.alwaysShow=!1,i){case e.Pages.Section.PERSONAL:this.title=I18n.t("personal_pages"),this.icon="fa-user",this.url=e.user&&e.user.getUrl();break;case e.Pages.Section.PINNED:this.title=I18n.t("favorite_pages"),this.icon="fa-star";break;case e.Pages.Section.PUBLIC:this.title=I18n.t("public_pages"),this.icon="fa-files-o";break;default:if(t.isPlainObject(i)){var n=i;this.id=n.id,this.title=n.title,this.icon="fa-group",this.logo=n.avatar,this.url=n.url,this.publicId=n.public_id,this.owner=n.owner}else this.title=I18n.t("organization")}},t.extend(e.Pages.Section,{PERSONAL:-100,PUBLIC:-75,PINNED:-50}),e.Pages.Section.prototype={isPersonal:function(){return this.id==e.Pages.Section.PERSONAL},add:function(e){this.pages.push(e)},sort:function(){function e(e,t){return e.title.localeCompare(t.title)}function t(e,t){return e.index-t.index}this.pages.sort(this.isPersonal()?t:e)},compare:function(e){return this.id<0||e.id<0?this.id-e.id:this.title.localeCompare(e.title)}}}(Yourls,jQuery);var Yourls=function(e,t){"use strict";return e.PagesBrowser=function(i){function n(){return[{caption:I18n.t("discover.browse"),icon:"fa-star",rightIcon:"fa-chevron-right",url:window.primaryBaseUrl+"/discover"}]}function r(e){return!e.followed}function a(){var i=t.map(e.user.getOrganizations(),function(e){return{tag:e.id,name:e.title}});return i.sort(function(e,t){return e.name.localeCompare(t.name)}),i}function o(i,n){function r(i){var n=0,r=t.makeArray(i.area),a=t.makeArray(i.subject);return t.inArray(e.user.getCountryCode(),r)>=0&&(n+=10),t.inArray("popular",a)>=0&&(n+=5),n}return r(n)-r(i)}function s(t){return{caption:I18n.t("view_page"),icon:"fa-chevron-right",action:function(){e.UrlHelper.openUrl(t.url,null,!1)}}}i=t.extend({title:I18n.t("pages_browser.title"),icon:"fa-search",extraButtons:n,cachePopular:!0,cachePopularVersion:1,selectMultiple:!0,showThumbnails:!0,showThumbnailsAsTiles:!0,filterItem:r,compareItems:o,getItemAction:s,tabs:[{name:"public",title:I18n.t("public_pages"),active:!0,options:{url:"/pages/public/find",filters:{subject:{icon:"fa-tag",popular:"",tags:e.tags.getSubjectTags},area:{icon:"fa-globe",popular:e.user.getCountryCode,tags:e.tags.getAreaTags}}}},{name:"team",title:I18n.t("team_pages"),options:{url:"/pages/organizations/find",filters:{organization:{icon:"fa-users",any:I18n.t("organizations.any"),tags:a}}}}]},i);var d=new e.Browser(i);return d},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.PagesMenu=function(i){function n(e){var i=t.trim(e).toLowerCase().split(/[\s,]+/);return i=t.map(i,function(e){return e.length?e:null}),function(e){e=e.toLowerCase();var t=Number.POSITIVE_INFINITY;for(var n in i){var r=e.indexOf(i[n]);if(0>r)return!1;t=Math.min(t,r)}return t+1}}function r(t){return t?(t=n(t),e.pages.filter(function(e){var i=[e.title,e.description];e.organization&&i.push(e.organization.title),e.owner&&i.push(e.owner.name);var n=i.join(" ");return t(n)})):e.pages.filter()}function a(i,r){function a(e){
i=n(i),e=t.map(e,function(e){return e.score=i([e.title,e.url].join(" ")),e.score?e:null}),e=e.sort(function(e,t){var i=e.score-t.score;return i?i:(i=e.url.length-t.url.length,i?i:e.title.localeCompare(t.title))}),r(e)}function o(i){t.ajax({url:e.user.getUrl()+"/bookmarks.json",type:"get",contentType:"application/json",dataType:"json",success:i})}var s=["user",e.user.getId(),"bookmarks"].join(".");e.Cache.fetch(s,a,o,10)}function o(){h.val(""),h.trigger("input")}function s(){function i(e,i){return t("<i>").addClass("fa fa-fw").addClass(e).addClass(i)}function n(e){var n=t("<a>").addClass("button");return n.attr({href:e.url,target:"_top",title:e.title}),e.icon&&i(e.icon).appendTo(n),t("<span>").addClass("title").text(e.title).appendTo(n),n}function o(e,t){"undefined"==typeof t&&(t=!c(e));var i=e.data("button");e.toggleClass("collapsed",!t),i.toggleClass("collapsed",!t)}function s(){var e={};try{e=JSON.parse(t.cookie("pages-menu-section-states")),t.isPlainObject(e)||(e={})}catch(i){e={}}return e}function d(){var e={};u.find("section.pages").each(function(){var i=t(this),n=i.data("id");"undefined"!=typeof n&&(e[n]=c(i))}),t.cookie("pages-menu-section-states",JSON.stringify(e),{path:"/",expires:365})}function c(e){return!e.hasClass("collapsed")}function f(i){var n=0,r=[];i.find(".page").each(function(i,a){var o=e.pages.get(t(a).data("id"));o&&o.is_owner&&(o.index=n++,r.push({id:o.id,owner:o.is_owner}))}),e.ajaxSave({url:"/pages/menu",method:"patch",data:JSON.stringify({menu:r}),dataType:"json",contentType:"application/json"})}var g=t.trim(h.val()).toLowerCase();g.length||(g=!1);var p=r(g);u.empty();var m=e.getActivePageId(),v=l(p),y=s();if(t.each(v,function(r,a){if(a.pages||(a.pages=[]),a.pages.length||!g&&a.alwaysShow){var s=n(a);if(s.addClass("section"),s.appendTo(u),a.logo){var l=t("<div>").addClass("logo").prependTo(s);l.css("background-image","url('"+e.UrlHelper.makeProtocolRelative(a.logo)+"')")}var c=t("<section>").addClass("pages");if(c.data({id:a.id,button:s}),a.owner){var h=i("fa-cog","icon-right always-show").attr("title",I18n.t("settings")).appendTo(s);h.click(function(t){t.stopPropagation(),e.UrlHelper.openUrl("/organization/"+a.publicId+"/edit",t,!1)})}if(!g&&a.pages.length>0){var p=i("fa-minus","icon-right expander").appendTo(s);p.click(function(e){e.preventDefault(),o(c),d()}),y[a.id]===!1&&o(c,!1)}t.each(a.pages,function(r,a){var o=n(a).appendTo(c);o.addClass("page"),o.data("id",a.id);var s=t("<div>").addClass("thumbnail").prependTo(o);if(a.background){var d=t.cloudinary.url(a.background,{width:64,height:64,crop:"fill",fetch_format:"auto",quality:80});s.css("background-image",'url("'+d+'")')}a.id==m&&o.addClass("active"),a.is_owner&&a.is_public&&t("<mark>").addClass("label").attr("title",I18n.t("shared")).appendTo(o.find(".title"));var l=null;if(a.is_owner||a.is_editor){var u=function(t){t.preventDefault(),t.stopPropagation(),e.editPageDialog(a.id)};l=i("fa-pencil").attr("title",I18n.t("edit_page")).click(u),a.id==m&&o.click(u).attr("title",I18n.t("edit_page"))}a.id!=m&&o.click(function(){e.gtmEvent("Navigation",{action:"PageButton"})}),l&&l.addClass("icon-right").prependTo(o)}),a.isPersonal()&&c.sortable({items:".page",cursor:"move",handle:e.canDragWithoutEditing()?null:".thumbnail",distance:15,opacity:.7,update:function(){f(c)}}),c.appendTo(u)}}),g&&e.user){var w=n({title:I18n.t("bookmarks"),icon:"fa-bookmark"}).appendTo(u).hide(),b=t("<section>").addClass("pages links").appendTo(u).hide();a(g,function(i){i.length&&(i=i.slice(0,10),t.each(i,function(i,r){var a=n({url:r.url,title:r.title}).addClass("page link").appendTo(b),o=t("<i>").prependTo(a);e.UrlHelper.renderFavicon(o,r.icon?null:r.url,r.icon||"fa-bookmark"),a.click(function(t){t.preventDefault();var i=r.url;i=e.UrlHelper.monetizeUrl(i,r.monetizer),e.UrlHelper.openUrl(i,t)})}),w.show(),b.show())});var C=(new e.Search.Providers).createDefaultProvider();n({title:I18n.t("search_placeholder",{provider:"Google"}),icon:"fa-search"}).appendTo(u);var k=t("<section>").addClass("pages google").appendTo(u),I=n({url:C.getUrlForQuery(g),title:'"'+g+'"'}).addClass("page link google").appendTo(k);I.click(function(e){e.preventDefault(),C.search(g)})}}function d(i){function n(){return u.find("a[href].button:not(.section):visible")}function r(){var e=n(),t=e.filter(".selected:first");return t.length||(t=e.filter(":first")),t.length?t:!1}function a(){var t=r();t&&(t.hasClass("link")?t.click():e.UrlHelper.openUrl(t.attr("href"),null,!1))}function s(e){var i=r();if(i){if(i.hasClass("selected")){i.removeClass("selected");var a=n(),o=(t.inArray(i[0],a)+e+a.length)%a.length;i=t(a[o])}i.addClass("selected"),i[0].scrollIntoView(!1)}}switch(i.which){case 13:return i.stopPropagation(),h.select(),void a();case 27:return void o();case 38:return void s(-1);case 40:return void s(1)}}function l(i){var n={},n=e.pages.section(i),r=e.user&&e.user.getOrganizations()||[];return t.each(r,function(t,i){if(!n[i.id]){var r=n[i.id]=new e.Pages.Section(i);r.alwaysShow=!0}}),n=t.map(n,function(e){return e}),n.sort(function(e,t){return e.compare(t)}),n}i=t.extend({user:null},i);var c,u,h;this.show=function(n){function r(){c=t(this),c.addClass("pages-menu"),u=c.find("section.main.body").addClass("sectioned list");var i=c.find("section.buttons");u.css("bottom",i.outerHeight()),setTimeout(function(){u.css("bottom",i.outerHeight())},500),h=c.find("section.search input"),h.on("input",function(){s()}),h.on("keydown",d),s(),e.pages.on("changed",s)}if(!this.isVisible()){n=t.extend({autofocus:!0,canClose:!0,side:"left",closing:function(){},closed:function(){},stackUpdated:function(){}},n||{});var a=!!i.user,o=[];a&&o.push({caption:I18n.t("new_page"),icon:"fa-plus",rightIcon:"fa-chevron-right",autoclose:!1,"default":!0,"class":"add-page",action:t.proxy(e.addPageDialog,e)}),o.push({caption:I18n.t("pages_browser.title"),icon:"fa-search",rightIcon:"fa-chevron-right",action:t.proxy(e.browsePages,e),autoclose:!1},"-",{caption:I18n.t("channels.browse"),icon:"fa-rss",rightIcon:"fa-chevron-right",url:window.primaryBaseUrl+"/channels"}),e.sidebar("general/sidebar_pages_menu",{hasClose:!1,extraClasses:"",values:{loggedIn:a},buttons:o,rendered:r,autofocus:n.autofocus,side:n.side,stackUpdated:n.stackUpdated,canClose:n.canClose,closing:n.closing,closed:function(){c=null,n.closed(),e.pages.off("changed",s)}})}},this.isVisible=function(){return!!c},this.hide=function(){this.isVisible()&&c.sidebar("close")},this.focusSearch=function(){this.isVisible()&&h.focus()}},e}(Yourls,jQuery);!function(Yourls,$){"use strict";Yourls.Provider=function(){this.id=void 0,this.type=void 0,this.widget=0},Yourls.Provider.prototype={initialize:function(e){"undefined"!=typeof e.id&&(this.id=e.id,delete e.id),"undefined"!=typeof e.type&&(this.type=e.type,delete e.type),"undefined"!=typeof e.widget&&(this.widget=e.widget,delete e.widget),this.setCustomConfig(e)},setCustomConfig:function(e){},getCustomConfig:function(){return{}},getType:function(){return this.type},getNiceName:function(){Bugsnag.notify("Provider.getNiceName is not supported by this provider",this.type,{})},getIcon:function(){Bugsnag.notify("Provider.getIcon is not supported by this provider",this.type,{})},getPlaceholderEmailAddress:function(){return"example@domain.com"},getAuthNamespace:function(){return!1},getAuthUrl:function(){var e=this.getAuthNamespace();return e?"/widget/"+this.widget.id+"/auth/"+e+"/"+this.id:(Bugsnag.notify("Provider does not support authentication","Yourls.Widget",{}),!1)},getIdentifier:function(){Bugsnag.notify("Provider.getIdentifier is not supported by this provider",this.type,{})},clearAuthorization:function(){this.config.authorization={}},hasToken:function(){return"undefined"!=typeof this.config.authorization&&!$.isEmptyObject(this.config.authorization)},setAuthorizationToken:function(e,t){var i=this.config.authorization;if(!$.isPlainObject(i))throw"No authorization data for provider";return i.access_token=e.toString(),i.expires_at=(t||new Date).toString().toMoment().toDate(),i},refreshToken:function(e){var t=this,i=$.Deferred();return $.ajax({url:"/widget/"+this.widget.id+"/token/"+this.getAuthNamespace()+"/"+this.id,type:"get",contentType:"application/json",dataType:"json",success:function(n){if("auth"==n.status)return t.clearAuthorization(),i.reject();var r=t.setAuthorizationToken(n.token,n.expires_at);$.isFunction(e)&&e(),i.resolve(r)}}).fail(i.reject.bind(i)),i.promise()},checkToken:function(e){function t(){var e=i.refreshTokenRetriers;delete i.refreshTokenRetriers,$.each(e,function(){this()})}var i=this;if($.isEmptyObject(this.config.authorization)||this.config.authorization.expires_at<new Date){if(this.refreshTokenRetriers=this.refreshTokenRetriers||[],this.refreshTokenRetriers.push(e),this.refreshTokenTimeout)return;return this.refreshTokenInterval=2*this.refreshTokenInterval||500,this.refreshTokenTimeout=window.setTimeout(function(){i.refreshToken().always(function(){delete i.refreshTokenTimeout}).then(t)}),!1}return!0}};var providerNamespaces={},providerTypes={};Yourls.Provider.registerNamespace=function(namespace,members){var extension=null,name=namespace[0].toUpperCase()+namespace.slice(1).toLowerCase();name=name.replace(/[^a-z0-9]+(\w)/gi,function(e){return e.slice(-1).toUpperCase()}),eval("extension = function "+name+"Provider() { Yourls.Provider.call(this) }"),extension.prototype=new Yourls.Provider,extension.prototype.constructor=extension;for(var member in members)members.hasOwnProperty(member)&&(extension.prototype[member]=members[member]);return providerNamespaces[namespace]=extension,extension},Yourls.Provider.registerType=function(namespace,type,members){var extension=null,name=namespace[0].toUpperCase()+namespace.slice(1).toLowerCase()+type[0].toUpperCase()+type.slice(1).toLowerCase();name=name.replace(/[^a-z0-9]+(\w)/gi,function(e){return e.slice(-1).toUpperCase()}),eval("extension = function "+name+"Provider() { Yourls.Provider.call(this) }"),extension.prototype=new providerNamespaces[namespace],extension.prototype.constructor=extension;for(var member in members)members.hasOwnProperty(member)&&(extension.prototype[member]=members[member]);return providerTypes[namespace+"."+type]=extension,extension},Yourls.Provider.create=function(e,t,i){var n=providerTypes[e+"."+t];if(n){var r=new n;return i.type=t,r.initialize(i),r}return Yourls.Logger.error("Unknown provider "+t),!1}}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Calendar=e.Provider.registerNamespace("calendar",{getCalendar:function(e,t,i){Bugsnag.notify("Provider.getCalendar should be overridden",this.type,{})},listCalendars:function(){Bugsnag.notify("Provider.listCalendars should be overridden",this.type,{})},call:function(e,i,n,r,a){a="undefined"==typeof a?{}:a,r="undefined"==typeof r?"GET":r;var o=this,s=t.proxy(this.call,this,e,i,n,r,a),d={url:this.config.baseUrl+e,type:r,data:a,success:function(e){i(e)},error:function(e,t,i){if(401==e.status)o.checkToken(s);else{var n={status:t,error:i};i(n)}}};"GET"==r?a.access_token=this.config.authorization.access_token:d.beforeSend=function(e){e.setRequestHeader("Authorization","Bearer "+o.config.authorization.access_token)},t.ajax(d)},between:function(t,i,n){i=moment.isMoment(i)?i:e.Util.toMoment().startOf("day"),n=moment.isMoment(n)?n:e.Util.toMoment().endOf("day");var r=[];for(var a in t){var o=e.Util.toMoment(t[a].start);(o.isSame(i)||o.isAfter(i)&&o.isBefore(n))&&r.push(t[a])}return r},expand:function(i,n,r){var a=[];for(var o in i)if(i.hasOwnProperty(o)){var s=i[o];if("undefined"!=typeof s.rrule&&s.rrule.length>0){var d=RRule.parseString(s.rrule);d.dtstart=s.start.toDate();var l=new RRule(d),c=[];"undefined"==typeof r&&(r=moment.max(e.Util.toMoment().add("1","month").add("1","day"),e.Util.toMoment(n).add("1","month").add("1","day"))),c=l.between(e.Util.toMoment(n).subtract("1","seconds").toDate(),r.toDate());var u=s.end.diff(s.start);for(var h in c)if(c.hasOwnProperty(h)){var f=c[h],g=t.extend({},s);g.start=e.Util.toMoment(f),g.end=e.Util.toMoment(g.start).add("milliseconds",u),a.push(g)}}else a.push(s)}return a}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Email=e.Provider.registerNamespace("email",{listEmail:function(e){Bugsnag.notify("Provider.getCalendar should be overridden",this.type,{})},listEmailLabels:function(){Bugsnag.notify("Provider.listEmailLabels should be overridden",this.type,{})},getUrlForMessage:function(e,t){Bugsnag.notify("Provider.getUrlForMessage is not supported by this provider",this.type,{})},config:{authorization:{}},setCustomConfig:function(e){this.config=t.extend({},this.config,e)},getCustomConfig:function(){return this.config},getIdentifier:function(){return this.config.authorization.email}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Analytics=e.Provider.registerNamespace("analytics",{config:{authorization:{}},setCustomConfig:function(e){this.config=t.extend({},this.config,e)},getCustomConfig:function(){return this.config},getIdentifier:function(){return this.config.authorization.email},listAccounts:function(){Bugsnag.notify("Provider.Analytics.listAccounts should be overridden",this.type,{})},listWebProperties:function(){Bugsnag.notify("Provider.Analytics.listProperties should be overridden",this.type,{})},listViews:function(){Bugsnag.notify("Provider.Analytics.listViews should be overridden",this.type,{})},listColumns:function(){Bugsnag.notify("Provider.Analytics.listColumns should be overridden",this.type,{})},getAnalyticsReportingData:function(){Bugsnag.notify("Provider.Analytics.getAnalyticsReportingData should be overridden",this.type,{})}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Adsense=e.Provider.registerNamespace("adsense",{config:{authorization:{}},setCustomConfig:function(e){this.config=t.extend({},this.config,e)},getCustomConfig:function(){return this.config},getIdentifier:function(){return this.config.authorization.email}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Tasks=e.Provider.registerNamespace("tasks",{config:{authorization:{}},setCustomConfig:function(e){this.config=t.extend({},this.config,e)},getCustomConfig:function(){return this.config},getIdentifier:function(){return this.config.authorization.email}})}(Yourls,jQuery),function(e){e.rails.allowAction=function(e){var t=e.data("confirm");if(!t)return!0;var i=t.match(/^\s*t\((.+?)\)\s*$/);return i&&(t=I18n.t(i[1])),e.data("confirmed")?(e.data("confirmed",!1),e.trigger("confirmed"),!0):(Yourls.confirm(function(){e.data("confirmed",!0),e.trigger("click")},null,t),!1)}}($);var Yourls=function(e,t){"use strict";return e.Search=function(i){var n=this;this.dom={bar:i,box:i.find("#search"),favicon:i.find("i.favicon"),wrapper:i.find(".wrapper"),menu:i.find(".menu"),button:i.find(".button")},this.provider=null,this.initialize=function(){this.selectDefaultProvider(),this.initSearch(),this.initAutoComplete(),this.initProvidersMenu(),e.hasBrowserExtension()||this.focus()},this.focus=function(){return this.isProviderSelected()?void(e.hasTouchScreen()||this.focus()):!1},this.focus=function(){this.dom.box.focus(),this.dom.box.trigger("focus")},this.executeSearch=function(){this.dom.box.autocomplete("close"),this.dom.box.blur();var e=t.trim(this.dom.box.val());this.provider.search(e),t(this).trigger("searched",e)},this.isProviderSelected=function(){return!!this.provider},this.selectDefaultProvider=function(){var t=this.getForcedProvider()||this.getAnonymousDefaultProvider()||e.searchProviders.getDefaultProvider();this.selectProvider(t)},this.selectProvider=function(t){if(this.provider=t,!this.provider)return!1;this.setAnonymousDefaultProvider(t),e.UrlHelper.renderIcon(this.dom.favicon,t.getIcon()||t.getUrl());var i=I18n.t("search_placeholder",{provider:t.data.name});this.dom.box.attr("placeholder",i),this.dom.button.attr("title",i)},this.getSelectedProvider=function(){return this.provider},this.initSearch=function(){function e(e){e.preventDefault(),n.executeSearch()}function i(){r.toggleClass("empty",!t.trim(r.val()).length),a.toggleClass("has-focus",r.is(":focus"))}var r=this.dom.box.enter(e),a=this.dom.bar;r.on("click input focus blur",i),i(),this.dom.favicon.click(e),this.dom.button.click(e)},this.initAutoComplete=function(){var e=this.dom.wrapper;this.dom.box.autocomplete({autoFocus:!1,minLength:3,html:!0,source:function(e,t){n.provider.suggest(e.term,function(e){t(e)})},select:function(e,t){e.stopPropagation(),n.provider.search(t.item.value),n.dom.box.trigger("input")},position:{of:e,using:function(i,n){t(n.element.element).css(i).outerWidth(e.outerWidth())}},appendTo:this.dom.bar.parents("header,main")})},this.initProvidersMenu=function(){function i(){var i=[];i.push({caption:I18n.t("search_settings"),icon:"fa-cog",classes:"logged-in",action:function(){n.showSettings()}});var r=e.searchProviders.getSortedVisibleProviders();return r.length>0&&i.push({caption:"-",classes:"logged-in"}),t.each(r,function(e,t){i.push({caption:t.getName(),url:t.getUrl(),icon:t.getIcon()||t.getUrl(),action:function(){n.selectProvider(t),n.focus()}})}),i}this.dom.menu.dropdown({position:{my:"right top",at:"right bottom",of:this.dom.wrapper},items:i,height:12,showFavicons:!0,appendTo:this.dom.bar.parents("header,main")})},this.showSettings=function(){function i(t){var i=t.default_provider;if(i!=e.searchProviders.getDefaultProvider().getId()){var r=o[i];r&&r.patchSubscription({"default":!0},function(){e.searchProviders.getDefaultProvider().setUserDefault(!1),r.setUserDefault(!0),e.Model.clearSearchProviderCache(),n.selectProvider(r)})}}var n=this,r={default_provider:e.searchProviders.getDefaultProvider().getId()},a=[],o=e.searchProviders.getVisibleProviders();t.each(e.searchProviders.getSortedVisibleProviders(),function(e,t){a.push({id:t.getId(),name:t.getName()})}),e.sidebar("search/settings",{side:"right",title:I18n.t("search_settings"),icon:"fa-cog",formdata:r,values:{providers:a},buttons:[{caption:I18n.t("save"),icon:"fa-save","default":!0,action:i},{caption:I18n.t("manage_search_providers"),icon:"fa-search-plus",autoclose:!1,action:function(){e.searchProviders.showEditProvidersDialog({side:"right"})}}]})},this.getForcedProvider=function(){var t=this.dom.box.data("provider");if(t){var i=e.searchProviders.getVisibleProviders();return i[t]}},this.getAnonymousDefaultProvider=function(){if(!e.user){var i=t.cookie(this.getAnonymousDefaultProviderCookieName(),Number)||0;if(i){var n=e.searchProviders.getVisibleProviders();return n[i]}}},this.setAnonymousDefaultProvider=function(i){e.user||(i==e.searchProviders.getDefaultProvider()&&(i=null),i?t.cookie(this.getAnonymousDefaultProviderCookieName(),i.getId(),{path:"/",expires:365}):t.removeCookie(this.getAnonymousDefaultProviderCookieName(),{path:"/"}))},this.getAnonymousDefaultProviderCookieName=function(){var t=e.getActivePageId()||0;return["page",t,"search-provider"].join("-")}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.Search.Provider=function(i,n){var r=this;this.data=i,this.suggest=function(e,i){function n(n,r){t.ajax({url:"https://clients1.google.com/complete/search",dataType:"jsonp",data:{q:e,nolabels:"t",client:n||"psy",ds:r||"",hl:I18n.locale},error:function(){return!0},success:function(e){i(t.map(e[1],function(e){var i=e[0],n=t("<span/>").html(i).text();return{value:n,label:i}}))}})}var r=this.data.url;if(this.isGoogleSearch()){var a="psy",o="";return-1!==r.indexOf("tbm=isch")&&(a="img",o="i"),n(a,o)}return this.isYoutubeSearch()?n("youtube","yt"):n()},this.search=function(t){var i=!1,n=!1;if(e.UrlHelper.isValid(t)?i=t:e.UrlHelper.isValidButWithoutProtocol(t)?i="http://"+t:(n=this.getUrlForQuery(t),e.gtmEvent("Search",{provider:this.getName(),query:t})),i)e.UrlHelper.openUrl(e.UrlHelper.monetizeUrl(i,1));else if(this.isCustomSearch()&&this.isCustomSearchPage()){e.pushLoading(I18n.t("searching"),!0);var r=google.search.cse.element.getElement("google_search");r&&r.execute(t)}else n&&e.UrlHelper.openUrl(n,null,this.isCustomSearchPage()?!1:null)},this.getUrlForQuery=function(e){return this.getSearchUrl().replace("%s",encodeURIComponent(e))},this.getId=function(){return this.data.id},this.getName=function(){return this.data.name},this.getSearchUrl=function(){return this.data.url},this.isDefault=function(){return this.data["default"]},this.isUserDefault=function(){return this.data.user_default},this.getIndex=function(){return"number"==typeof this.data.index?this.data.index:Number.POSITIVE_INFINITY},this.setUserDefault=function(e){this.data.user_default=e},this.isShown=function(){return this.data.show},this.show=function(){this.data.show=!0},this.hide=function(){this.data.show=!1,this.isUserDefault()&&this.setUserDefault(!1)},this.getUrl=function(){return r.data.url},this.getIcon=function(){return r.data.icon},this.getFaviconUrl=function(){return e.UrlHelper.faviconLink(this.getIcon()||r.getSearchUrl())},this.isGoogleSearch=function(){var t=e.UrlHelper.getSite(this.getSearchUrl());return/google(\.[a-z]+){1,2}$/i.test(t)},this.isYoutubeSearch=function(){var t=e.UrlHelper.getSite(this.getSearchUrl());return/youtube.com$/i.test(t)},this.isCustomSearch=function(){return/\/search\/google\?q=/.test(this.getSearchUrl())},this.isCustomSearchPage=function(){if(!(window.google&&google.search&&google.search.cse&&google.search.cse.element))return!1;var t=e.getActivePage();return t&&"search"==t.getType()},this.patch=function(t,i){e.ajaxSave({url:"/search_provider/"+r.data.id,type:"patch",dataType:"json",data:JSON.stringify(t),contentType:"application/json",accept:"application/json",success:i})},this.patchSubscription=function(t,i){e.ajaxSave({url:"/search_provider/"+r.data.id+"/subscription",type:"patch",dataType:"json",data:JSON.stringify(t),contentType:"application/json",accept:"application/json",success:i})},this.deleteProvider=function(t){e.ajaxSave({url:"/search_provider/"+r.data.id,type:"delete",dataType:"json",contentType:"application/json",accept:"application/json",success:t})}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.Search.Providers=function(){function i(i,r){function a(e){var a=n(e);return t.isPlainObject(a)?void i.patch(a,function(){i.data.name=a.name,i.data.url=a.url,t.isFunction(r)&&r()}):a}e.sidebar("search/custom_provider",{title:I18n.t("edit_custom_search_provider"),icon:"fa-search",formdata:i.data,buttons:[{caption:I18n.t("save"),icon:"fa-check",action:a,"default":!0},{caption:I18n.t("cancel"),icon:"fa-times"}]})}function n(i){var n=t.trim(i.name),r=t.trim(i.url);if(!n.length)return I18n.t("please_specify_name");if(!e.UrlHelper.isValid(r)){if(!e.UrlHelper.isValidButWithoutProtocol(r))return I18n.t("invalid_url");r="http://"+r}return/%s/.test(r)?{name:n,url:r}:I18n.t("please_specify_query_part")}function r(){var i=e.Model.options.buildSearchProviderSuccess;e.Model.options.buildSearchProviderSuccess=function(e){u={},a(e),t.isFunction(i)&&i(e),t(c).trigger("loaded")}}function a(e){t.each(e,function(){o(this)})}function o(t){u[t.id]=new e.Search.Provider(t)}function s(e){e&&e.data&&e.data.id&&delete u[e.data.id]}function d(e,i,n){var r={name:e,url:i,show:!0,"default":!1};l(r,function(e){o(e),t.isFunction(n)&&n()})}function l(t,i){e.ajaxSave({url:"/search_provider",type:"post",dataType:"json",contentType:"application/json",accept:"application/json",data:JSON.stringify(t),success:i})}var c=this,u={};this.initialize=function(){r()},this.getDefaultProvider=function(){var e=null;return t.each(this.getSortedVisibleProviders(),function(){(!e||this.isUserDefault())&&(e=this)}),e||this.createDefaultProvider()},this.createDefaultProvider=function(){return new e.Search.Provider({name:"Google Custom Search",url:"/search/google?q=%s&p=1",show:!0})},this.getVisibleProviders=function(){var e={};return t.each(u,function(t,i){i.isShown()&&(e[t]=i)}),e},this.getSortedVisibleProviders=function(){var e=[];return t.each(u,function(t,i){i.isShown()&&e.push(i)}),e.sort(function(e,t){return e.getIndex()-t.getIndex()}),e},this.showEditProvidersDialog=function(n){function r(i){return t.extend({favicon:e.UrlHelper.faviconLink(i.data.url),urlShort:e.UrlHelper.getSite(i.data.url)},i.data)}function a(e){e.find(".provider").each(function(){var e=t(this),i=u[e.data("id")];i&&(i.isDefault()||e.click(t.proxy(l,e,i)),e.find(".doshow").click(t.proxy(o,e,i)),e.find(".noshow").click(t.proxy(o,e,i)),e.find(".delete").click(t.proxy(h,e,i)))})}function o(e){var i=t(this);if(!i.hasClass("updating")&&e&&e.isDefault()){var n={show:!e.isShown()};i.addClass("updating"),e.patchSubscription(n,function(){i.removeClass("updating"),n.show?(e.show(),i.removeClass("hidden").addClass("shown")):(e.hide(),i.removeClass("shown").addClass("hidden"))})}}function d(){c.showAddCustomProviderDialog(function(){c.showEditProvidersDialog()})}function l(e){e&&!e.isDefault()&&(f.sidebar("close"),i(e,function(){c.showEditProvidersDialog()}))}function h(t,i){t&&!t.isDefault()&&(i.stopPropagation(),f.sidebar("close"),e.confirm(function(){t.deleteProvider(function(){s(t),c.showEditProvidersDialog()})},I18n.t("remove_provider"),I18n.t("confirm_delete_custom_search_provider")))}var f=e.sidebar("search/providers_sidebar",t.extend({title:I18n.t("manage_search_providers"),icon:"fa-search-plus",values:{providers:t.map(u,r)},buttons:[{caption:I18n.t("add_custom_search_provider"),icon:"fa-plus",action:d}],rendered:function(){a(t(this).find(".providers"))}},n))},this.showAddCustomProviderDialog=function(i){function r(e){var r=n(e);return t.isPlainObject(r)?void d(r.name,r.url,i):r}e.sidebar("search/custom_provider",{title:I18n.t("add_custom_search_provider"),icon:"fa-search-plus",formdata:{url:"http://"},buttons:[{caption:I18n.t("add"),icon:"fa-plus",action:r,"default":!0},{caption:I18n.t("cancel"),icon:"fa-times"}]})}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.User=function(i){var n=this,r=t.extend({id:null,email:null,name:null,role:"user",is_impersonated:!1,is_anonymous:!1,country:null,url:null,sign_in_count:0,organizations:[],no_context_menus:!1,notifications:{}},i||{});this.getId=function(){return r.id},this.getLocale=function(){return I18n.currentLocale()},this.getCountryCode=function(){return r.country},this.getName=function(){return r.name},this.isAdmin=function(){return"admin"==r.role},this.isImpersonated=function(){return!!r.is_impersonated},this.isAnonymous=function(){return!!r.is_anonymous},this.isPremium=function(){return!!r.is_premium},this.getUrl=function(){return r.url},this.getSignInCount=function(){return r.sign_in_count},this.getOrganizations=function(){return r.organizations},this.getOrganizationById=function(e){var i=null;return t.each(this.getOrganizations(),function(t,n){n.id==e&&(i=n)}),i},this.ownsOrganization=function(){var e=!1;return t.each(this.getOrganizations(),function(t,i){i.owner&&(e=!0)}),e},this.showContextMenus=function(){return!r.no_context_menus},this.signOut=function(){e.Model.clearUserCache(),e.Model.clearMenuCache(),e.Model.clearSearchProviderCache(),window.setTimeout(function(){var e=t("<a/>").attr("href","/users/sign_out").data("method","delete");t.rails.handleMethod(e)},200)},this.showAvatarUploader=function(i){function r(r,a){function o(e){t.isFunction(i)&&i(a.url)}t(n).trigger("avatar:change",a.secure_url);var s={user:{avatar_url:a.secure_url}};return e.ajaxSave({url:"/users.json",method:"put",dataType:"json",data:JSON.stringify(s),contentType:"application/json",success:o}),!1}var a=new e.ImageUploader({uploadPreset:"avatar",uploaded:r});a.show()},this.tourNotificationShown=function(){var t=this.notificationShown("tour")||!!e.Storage.getItem("tourShown");return e.Storage.getItem("tourShown")&&!this.notificationShown("tour")&&this.setTourNotificationShown(),t},this.setTourNotificationShown=function(){this.setNotificationShown("tour")},this.extensionNotificationShown=function(e){var i=this.formatBrowserNotificationKeyName(e),n=t.cookie(i,Number)||0,r=this.notificationShown(i)||n;return n&&!this.notificationShown(i)&&this.setExtensionNotificationShown(e),r},this.setExtensionNotificationShown=function(e){var t=this.formatBrowserNotificationKeyName(e);this.setNotificationShown(t)},this.formatBrowserNotificationKeyName=function(e){return e+"-notification-shown"},this.anonymousNotificationKeyName="next-anonymous-notification",this.shouldSeeAnonymousNotification=function(){if(!this.isAnonymous())return!1;var t=moment().utc();if(this.notificationShown(this.anonymousNotificationKeyName))var i=moment(r[this.anonymousNotificationKeyName]);else{var i=e.Storage.getItem(this.anonymousNotificationKeyName);i=isNaN(parseInt(i))?moment().add(1,"hour"):moment.unix(i),this.setAnonymousNotificationShown(this.anonymousNotificationKeyName,i)}return i.isBefore(t)},this.setAnonymousNotificationShown=function(e){e&&moment.isMoment(e)||(e=moment().add(7,"days")),this.setNotificationShown(this.anonymousNotificationKeyName,e.toDate())},this.startPageNotificationKeyName="startpage-notification-shown",this.startPageNotificationShown=function(){return this.notificationShown(this.startPageNotificationKeyName)||e.Cache.get(this.startPageNotificationKeyName)||t.cookie(this.startPageNotificationKeyName,Number)?(this.notificationShown(this.startPageNotificationKeyName)||this.setNotificationShown(this.startPageNotificationKeyName),!0):!1},this.setStartPageNotificationShown=function(){this.setNotificationShown(this.startPageNotificationKeyName)},this.lastReadNotificationKeyName="last-read-notification",this.lastReadNotificationTimeStamp=function(){if(this.notificationShown(this.lastReadNotificationKeyName))return moment(r[this.lastReadNotificationKeyName]).unix();var e=t.cookie(this.lastReadNotificationKeyName,Number)||0;return e&&this.setLastReadNotificationTimeStamp(e),e},this.setLastReadNotificationTimeStamp=function(e){this.setNotificationShown(this.lastReadNotificationKeyName,moment.unix(e).toDate())},this.notificationShown=function(e){return r.notifications&&r.notifications.hasOwnProperty(e)},this.setNotificationShown=function(t,i){var n={notification:t};return i instanceof Date&&(n.date=i),e.ajaxSave({url:"/users/notification",method:"put",dataType:"json",data:JSON.stringify(n),contentType:"application/json"}).then(function(e){return e.notifications&&(r.notifications=e.notifications),e})}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";return e.Tags=function(){function e(e,i){return t.isArray(i)||(i=i.toString().split(" ")),i=t.map(i,function(t){return{tag:t,name:I18n.t(t,{scope:e})}}),i.sort(function(e,t){return e.name.localeCompare(t.name)}),i}this.getAreaTags=function(){return e("area","int ar au be br ca ch cn cz de dk ee es fi fr gb gr hu il in it jp kr nl no pl pt ro ru se tr ua us za")},this.getSubjectTags=function(t){return e("subject","apps business comics culture entertainment education finance games health kids lifestyle news news_regional politics popular premium science search shopping social sports tech tools traffic travel weather")},this.getFeedSubjectTags=function(){return e("subject","business culture entertainment finance health lifestyle news news_regional politics popular science sports tech traffic weather")},this.getBackgroundSubjectTags=function(){return e("subject","animals art beach cars city colors landscape music nature people sports textures other")},this.getCategorySubjects=function(){return e("subject","apps business education entertainment kids lifestyle news personal popular shopping sports tech travel")}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";function i(){return n()&&r()&&a()}function n(){var e=t(window),i=e.width(),n=e.height(),r=i/Math.max(1,n);return i>750&&r>1&&2.5>r}function r(){return null!=e.user}function a(){return e.isEditable()}function o(){var i=t.Deferred();return M?i.resolve("Tour already active",1).promise():n()?r()?a()?(e.gtmEvent("Tour",{action:"start"}),M=!0,s().then(l).then(d).done(i.resolve),i.promise()):i.reject("Cannot edit current page",3).promise():i.reject("For users only",3).promise():i.reject("Browser area too small / not suitable",2).promise()}function s(){var e=t.Deferred();return t(document.body).add("html").addClass("kiosk"),P=t("<section>").addClass("tour overlay").appendTo(document.body),D=t("<div>").addClass("spotlight").appendTo(P),setTimeout(function(){D.addClass("show")},100),A=t("<div>").addClass("progress").appendTo(P),Y=t("<div>").addClass("thumb").appendTo(A),setTimeout(e.resolve,1100),e.promise()}function d(){var e=t.Deferred();return M&&P?(M=!1,c(!1),t(document.body).add("html").removeClass("kiosk"),g({delay:10}).then(t.proxy(p,null,document.body)).then(function(){P.remove(),P=D=null,e.resolve()}),e.promise()):e.reject().promise()}function l(){var i,n=t.Deferred(),r=b(),a=0,o=r.length,s=i=t.Deferred();return c(0),t.each(r,function(e,t){s=s.then(function(){return a++,c(a/o),u(t)})}),s.done(function(){c(1),e.gtmEvent("Tour",{action:"done"})}).done(n.resolve),s.fail(function(){e.gtmEvent("Tour",{
action:"cancelled",slides:a}),u(k).always(n.resolve)}),i.resolve(),n.promise()}function c(e){e===!1?A.hide():(Y.css("width",Math.round(100*e)+"%"),A.show())}function u(e){return t.isPlainObject(e)?"click"in e?m(e.click,e):"toggleClass"in e?v(e.target,e.toggleClass,e):"type"in e?y(e.target,e.type,e):"highlight"in e?p(e.highlight,e):w(null,null,e):t.isFunction(e)?e():w(e.toString(),"center")}function h(e,i,n,r){r=t.extend({delay:1e3,showPointer:!1},r);var a=t.Deferred(),o=n/2;return D.css({left:e-o,top:i-o,width:n,height:n}).data({x:e,y:i}),setTimeout(a.resolve,r.delay),a.promise()}function f(){if(!D)return"left";var e=D.data("x");return e<t(window).innerWidth()/2?"right":"left"}function g(e){var i=t(window),n=i.width(),r=i.height();return h(n/2,r/2,0,e)}function p(e,i){if(i=t.extend({element:e,offsetX:0,offsetY:0,minDiameter:0,maxDiameter:1e4,diameterRatio:1.1,scrollIntoView:!0},i),e=t(i.element),0==e.length)return g();var n=e.offset(),r=e.outerWidth(),a=e.outerHeight();if(i.scrollIntoView){var o=t(window).scrollTop(),s=t(window).scrollTop()+t(window).innerHeight();if(n.top<o||n.top>s){var d=n.top>s?!0:!1;e[0].scrollIntoView(d),n=e.offset()}}var l=t(document);n.left-=l.scrollLeft(),n.top-=l.scrollTop();var c=n.left+r/2+i.offsetX,u=n.top+a/2+i.offsetY,f=Math.min(i.maxDiameter,Math.max(i.minDiameter,Math.sqrt(Math.pow(r,2)+Math.pow(a,2))));return h(c,u,f*i.diameterRatio,i)}function m(e,i){i=t.extend({element:e,times:1,interval:100,delay:500,startDelay:0},i);for(var n=t.Deferred(),e=t(i.element),r=t.proxy(e.click,e),a=0;a<i.times;a++)setTimeout(r,a*i.interval+i.startDelay);return setTimeout(n.resolve,i.delay),n.promise()}function v(e,i,n){n=t.extend({element:e,className:i,mode:null,delay:500,times:1,interval:100,startDelay:0},n);for(var r=t.Deferred(),e=t(n.element),a=t.proxy(e.toggleClass,e,n.className,n.mode),o=0;o<n.times;o++)setTimeout(a,o*n.interval+n.startDelay);return setTimeout(r.resolve,n.delay),r.promise()}function y(e,i,n){n=t.extend({target:e,text:i,interval:100,delay:500},n);var r=t.Deferred(),e=t(n.target);e.focus(),e.val("");for(var a=0;a<n.text.length;a++)setTimeout(t.proxy(function(t){e.val(n.text.slice(0,t+1)),e.trigger("input")},null,a),a*n.interval);return setTimeout(function(){e.trigger("change"),r.resolve()},n.delay),r.promise()}function w(e,i,n){function r(e){t(document).off("keydown.tour"),o.removeClass("show"),setTimeout(function(){o.remove(),e()},500)}var a=t.Deferred();n=t.extend({text:e,position:i||"center",last:!1},n),n.position=n.position.replace("opposite",f());var o=t(JST["tour/dialog"](n)).appendTo(P);return setTimeout(t.proxy(o.addClass,o,"show"),100),o.find(".buttons button.next").click(t.proxy(r,null,a.resolve)).focus(),o.find(".buttons button.end").click(t.proxy(r,null,a.reject)),t(document).on("keydown.tour",function(e){var t=!0;switch(e.which){case 13:case 32:case 39:r(a.resolve);break;case 27:r(n.last?a.resolve:a.reject);break;default:t=!1}t&&e.preventDefault()}),a.promise()}function b(){var t="main article.widget:first",i=e.selectors.addWidget+":first",n="aside.sidebar:last",r=n+" .body",a=n+" section.buttons .button.default",o=n+" ul.suggestions",s="#add-content",d=e.selectors.widget+".new-widget-for-tour",l=d+" header .buttons .dropdown",c=".ui-menu.dropdown:visible",u="#breadcrumbs li.page",h="#pages-menu",f=n+" .body .background.image-selector",p=n+" .buttons .button.add-page";return[S,I,C,{toggleClass:"highlight",target:t,delay:0,startDelay:1e3,mode:!0},{highlight:t},{text:I18n.t("tour.widgets.about"),position:"bottom opposite"},{toggleClass:"highlight",target:t,delay:0,startDelay:500,mode:!1},{highlight:i},{toggleClass:"show",target:i,delay:250,startDelay:250,mode:!0},{text:I18n.t("tour.widgets.add_button")},{click:i+" .button",delay:250},{toggleClass:"show",target:i,delay:0,startDelay:0,mode:!1},{highlight:n,offsetX:-100,offsetY:-100,delay:0},{text:I18n.t("tour.widgets.choice"),position:"bottom right"},{highlight:o+" .item:nth-child(1)",delay:1e3},{highlight:o+" .item:nth-child(10)",delay:1e3},{highlight:o+" .item:nth-child(16)",delay:1e3},{highlight:o+" .item:nth-child(21)",delay:1e3},{text:I18n.t("tour.widgets.examples"),position:"bottom right"},g,S,{text:I18n.t("tour.widgets.adding_is_easy"),position:"top right"},{highlight:s,diameterRatio:2},{toggleClass:"hover",target:s,delay:250,startDelay:250,times:2,interval:1e3},{click:s},{highlight:n,offsetX:100,offsetY:-100,delay:2e3},{type:"http://www.google.com",target:"#bookmarkUrl",delay:2e3},{type:"Google",target:"#bookmarkTitle",delay:2e3},{type:I18n.t("bookmark_widget_title"),target:"#bookmarks_adder_title",delay:2e3},{highlight:a,delay:2e3},T,{click:a},_,{highlight:d,offsetY:50,delay:1e3},{text:I18n.t("tour.widgets.that_easy"),position:"top opposite"},{highlight:l,delay:2e3},{click:l,delay:500},{highlight:c,delay:0},{toggleClass:"ui-state-focus",target:c+" li.edit",delay:0,startDelay:2e3,times:2,interval:1e3},{toggleClass:"ui-state-focus",target:c+" li.delete",delay:0,startDelay:3500,times:2,interval:1e3},{text:I18n.t("tour.widgets.dropdown_menu"),position:"top opposite"},I,g,E,{text:I18n.t("tour.page.change_style"),position:"center"},{highlight:u,diameterRatio:2,delay:1e3},{text:I18n.t("tour.page.edit"),position:"top right"},{click:u,delay:600,startDelay:500},{highlight:c,delay:1e3},{toggleClass:"ui-state-focus",target:c+" li.background",delay:1e3,mode:!0},{click:c+" li.background",delay:500},{highlight:n,offsetX:-100,offsetY:-100},{text:I18n.t("tour.page.change_background"),position:"bottom opposite"},{highlight:f,delay:1e3,diameterRatio:1.5},{click:f,delay:500},{highlight:n,diameterRatio:.8,delay:4e3},g,S,{text:I18n.t("tour.page.share"),position:"top right"},{highlight:u,diameterRatio:2,delay:1e3},{click:u,delay:600,startDelay:500},{highlight:c,delay:1e3},{toggleClass:"ui-state-focus",target:c+" li.share",delay:1e3,mode:!0},{click:c+" li.share",delay:500},{highlight:r,delay:1e3},{text:I18n.t("tour.page.publish"),position:"top right"},S,{highlight:h,diameterRatio:2,delay:1e3},{click:h,delay:500},{highlight:p,diameterRatio:1.5,offsetY:100},{toggleClass:"hover",target:p,mode:!0,delay:0,startDelay:500},{text:I18n.t("tour.page.create"),position:"top opposite"},S,{highlight:"#me"},{click:"#me",delay:500},{highlight:n,offsetX:100,offsetY:100},{toggleClass:"hover",target:n+" .button.help",mode:!0,delay:0,startDelay:500},{text:I18n.t("tour.help"),position:"bottom opposite"},S,g,{text:I18n.t("tour.enjoy"),last:!0}]}function C(){var t=[];return e.user.getSignInCount()<=2&&!e.user.isAnonymous()&&t.push(I18n.t("tour.thanks_for_signing_up")),t.push(I18n.t("tour.take_time")),u({text:t.join("\n"),position:"center"})}function k(){return g(),S(),I(),E(),w(I18n.t("tour.need_help"),"center",{last:!0})}function I(){return t(document).trigger("show.dropdown"),t.Deferred().resolve().promise}function S(){return e.closeAllSidebars(),t.Deferred().resolve().promise}function T(){return t(e.selectors.widget).addClass("not-added-in-tour"),t.Deferred().resolve().promise()}function x(i){var n=t(e.selectors.widget).filter(i?":not(.not-added-in-tour):first":".new-widget-for-tour:first");return e.getActivePage().getWidgetById(n.data("widget_id"))}function _(){function e(){var t=x(!0);t?(t.domElement.addClass("new-widget-for-tour"),setTimeout(i.resolve,500)):setTimeout(e,100)}var i=t.Deferred();return e(),i.promise()}function E(){var e=x();return e&&e.queueDelete(),t.Deferred().resolve().promise()}e.Tour={start:o,isSupported:i,setSpotlight:h,hideSpotlight:g,highlightElement:p};var P,D,A,Y,M=!1;return e}(Yourls||{},jQuery);!function(Yourls,$){"use strict";var lastWidgetUid=0,DROPDOWN_MENU_HEIGHT=11,GENERIC_SETTINGS_PREFIX="_",DEFAULT_BACKGROUND_COLOR=16777215,WIDGET_BACKGROUND_COLORS=[16777096,16764548,16754085,11843071,10867455,8716279,11141033,13421789,15658734,16119260,16444375,15652279,8388564,10210715,13485683,14741230,15655141,11584734,16777181,14548957,14544639],DEFAULT_WIDGET_TRANSPARENCY=0;Yourls.Widget=function(){this.data={},this.domElement=null,this.previewMode=!1},Yourls.Widget.prototype={initialize:function(e){this.id=0,this.uid=++lastWidgetUid,this.previewMode=!!e.previewMode,this.setData(e)},setData:function(e){this.data=e||{},"id"in this.data&&(this.id=e.id),this.setSettings($.extend(this.getSettingsDefaults(),this.data.settings))},setSettings:function(e){var t=$.unprefix(e,GENERIC_SETTINGS_PREFIX),i=$.excludePrefix(e,GENERIC_SETTINGS_PREFIX);this.setGenericSettings(t),this.setCustomSettings(i)},getSettings:function(){return $.extend($.prefix(this.getGenericSettings(),GENERIC_SETTINGS_PREFIX),this.getCustomSettings())},getSettingsDefaults:function(){return $.extend($.prefix(this.getGenericSettingsDefaults(),GENERIC_SETTINGS_PREFIX),this.getCustomSettingsDefaults())},getGenericSettings:function(){return{title:this.getTitle(),icon:this.getIcon(),b:this.getBackgroundColor(),i:this.getInheritBackgroundTransparency(),t:this.getBackgroundTransparency(),h:this.getHeaderless()?1:0}},getGenericSettingsDefaults:function(){var e=Yourls.getActivePage(),t=e?e.getWidgetTransparency():DEFAULT_WIDGET_TRANSPARENCY;return{title:this.getTitle(),icon:this.getIcon(),b:this.getDefaultBackgroundColor(),i:!0,t:t,h:!1}},setGenericSettings:function(e){this.setTitle(e.title),this.setInheritBackgroundTransparency(e.i),this.setBackgroundTransparency(e.t),this.setBackgroundColor(e.b),this.setHeaderless(e.h)},setCustomSettings:function(e){},getCustomSettings:function(){return{}},getCustomSettingsDefaults:function(){return{}},isPreview:function(){return!!this.previewMode},render:function(){Bugsnag.notify("Widget.render should be implemented","Abstract",{})},renderWidget:function(e,t,i){measure("render_widget"),t=t||{},this.options=$.extend({anchor:"widget-"+(this.data.id||Math.random().toString(36).substring(2)),icon:"fa-folder",url:this.data.url,hasDropdownMenu:!0,canBeCopied:!0,headerButtons:[],subnav:null,added:$.proxy(this.startEditing,this),moved:function(){}},i),this.options.subnav=$.isPlainObject(this.options.subnav)?$.extend({items:[],autohide:!1,viewOnly:!0,showFavicons:!1,faviconPlaceholder:"fa-globe"},this.options.subnav):null,this.data.icon&&(this.options.icon=this.data.icon);var n={title:this.data.title,subtitle:this.getSubtitle(),subtitleIcon:this.getSubtitleIcon(),widget_anchor:this.options.anchor,widget_id:this.getId(),widget_uid:this.getUid(),widget_type:e,widget_icon:this.options.icon,widget_url:this.options.url,widget_default:this.data["default"]&&Yourls.user&&Yourls.user.isAdmin(),options:this.options},r=JST["widgets/generic/frame"]($.extend(n));this.domElement=$(r);var a=JST["widgets/"+e+"/widget"]($.extend(n,t));return this.domElement.append(a),this.domElement.toggleClass("headerless",this.getHeaderless()),this.renderBackground(),Yourls.getActivePage()&&$(Yourls.getActivePage()).on("changed.widgetBackground",$.proxy(this.renderBackground,this)),this.options.subnav&&this.renderSubnav(),Yourls.postpone(function(){var e=window.location.hash;/^[-a-z0-9_]+$/i.test(e)&&this.domElement.is(e)&&this.domElement.addClass("highlight"),this.changeIcon(this.options.icon),this.options.url&&this.domElement.find("> header").click($.proxy(function(e){this.isEditable()||Yourls.UrlHelper.openUrl(this.options.url,e,!1)},this)),this.renderHeaderButtons(),this.initContextMenu(),this.isEditable()&&(this.initEditability(),$(this).on("added.widget",$.proxy(this.options.added,this))),$(this.domElement).on("moved.widget",$.proxy(this.options.moved,this))},this),measureEnd("render_widget"),this.domElement},renderBackground:function(){var e=this.getBackgroundColor(),t=this.getBackgroundTransparency(),i=e>>16&255,n=e>>8&255,r=255&e,a=1-t/255,o=[i,n,r,a];this.domElement.css("background-color","rgba("+o.join(",")+")"),this.domElement.toggleClass("fully-transparent",t>250)},renderHeaderButtons:function(){var e=this.domElement.find("> header .buttons").empty(),t=this.getHeaderButtons();$.each(t,function(){var t=$.extend({icon:"fa-bars",caption:"",classes:"",action:null,rendered:null},this),i=$("<li>").prependTo(e).addClass(t.icon?"fa fa-fw "+t.icon:"").addClass(t.classes).attr("title",t.caption);$.isFunction(t.action)&&i.click(function(e){e.stopPropagation(),t.action.call(i,t)}),$.isFunction(t.rendered)&&t.rendered(i)})},getHeaderButtons:function(){var e=[],t=this;return this.options.hasDropdownMenu&&e.push({icon:"fa-chevron-down",classes:"dropdown view-only logged-in",rendered:function(e){e.dropdown({position:{my:"right top",at:"right bottom"},height:DROPDOWN_MENU_HEIGHT,items:$.proxy(t.getDropdownItems,t)})}}),e.push({icon:"fa-trash",classes:"remove sorting-only",caption:I18n.t("remove"),action:$.proxy(this.askDeleteWidget,this)}),e.push({icon:"fa-check",classes:"done edit-only",caption:I18n.t("save"),action:$.proxy(this.finishEditing,this)}),e=e.concat(this.getCustomHeaderButtons()),e.push({icon:"fa-cog",classes:"edit-only",caption:I18n.t("settings"),action:$.proxy(this.showSettings,this)}),e},getCustomHeaderButtons:function(){return[]},initContextMenu:function(){var e=this;Yourls.contextmenu(this.domElement,function(t,i){return i.parents("ul.itemlist").length?void 0:e.getDropdownItems()},{height:DROPDOWN_MENU_HEIGHT})},getDropdownItems:function(){var e=[],t=this,i=this.getCustomDropdownItems(),n=0;$.each(i,function(t,i){i.pinned&&(e.push(i),n++)}),n&&e.push({caption:"-",classes:"editable-only"}),this.isEditable()&&(this.isEditing()?e.push({caption:I18n.t("save"),icon:"fa-check",classes:"editable-only edit-only done",action:$.proxy(this.finishEditing,this)}):e.push({caption:I18n.t("edit"),icon:"fa-pencil",classes:"editable-only view-only edit",action:$.proxy(this.startEditing,this)})),this.canBeCopied()&&e.push({caption:Yourls.isEditable()?I18n.t("copy"):I18n.t("add_to_my_page"),icon:"fa-clone",classes:"logged-in",action:$.proxy(this.showCopyDialog,this)}),this.canBeMoved()&&e.push({caption:I18n.t("move"),icon:"fa-arrows",classes:"logged-in",action:$.proxy(this.showMoveDialog,this)});var r=0;return $.each(i,function(t,i){i.pinned||(e.push(i),r++)}),(this.isEditable()||r)&&e.push({caption:"-",classes:"editable-only"}),this.isEditable()&&(e.push({caption:I18n.t("settings"),icon:"fa-cog",classes:"editable-only",action:$.proxy(this.showSettings,this)}),e.push({caption:I18n.t("delete"),icon:"fa-trash",classes:"editable-only delete",action:$.proxy(this.askDeleteWidget,this)})),this.options.help&&(this.isPersisted()&&e.push("-"),e.push({caption:I18n.t("help"),icon:"fa-question",action:function(){Yourls.UrlHelper.openUrl(t.getHelpUrl())}})),this.isPersisted()&&Yourls.user&&Yourls.user.isAdmin()&&(e.push("-"),e.push({caption:I18n.t("manage"),icon:"fa-cogs",url:"/admin/widgets/"+t.getId()+"/edit",target:"_blank"})),e},getCustomDropdownItems:function(){return[]},getHelpUrl:function(){return this.options.help?window.primaryBaseUrl+"/support/"+this.options.help:void 0},isEditable:function(){return this.isPersisted()&&Yourls.isEditable()},initEditability:function(){var e=this.domElement.find("header"),t=e.find(".title span");e.dblclick($.proxy(this.toggleEditing,this)),t.dblclick($.proxy(this.showSettings,this)),t.click(function(){this.isEditing()&&this.showSettings()}.bind(this))},renderSubnav:function(){if(this.domElement.children("nav.subnav").remove(),this.domElement.removeClass("has-subnav"),$(window).off("resize",$.proxy(this.checkSubnavOverflow,this)),$.isPlainObject(this.options.subnav)){var e=$.tag("nav").addClass("subnav").toggleClass("view-only",this.options.subnav.viewOnly).insertAfter(this.domElement.find("> header"));this.domElement.addClass("has-subnav");var t=this.options.subnav.items;return $.isFunction(t)&&(t=t()),t=$.makeArray(t),this.options.subnav.autohide&&t.length<=1?(e.remove(),void this.domElement.removeClass("has-subnav")):void this.postpone(function(){var i=$("<ul/>").appendTo(e),n=this;$.each(t,function(e,t){var r=$("<li/>").appendTo(i),a=$("<a/>").appendTo(r).text(t.caption);t.active&&a.addClass("active");var o=null;t.url&&(a.attr("href",t.url),n.options.subnav.showFavicons&&(o=$("<i/>").addClass("favicon").prependTo(a),Yourls.UrlHelper.renderFavicon(o,t.url,t.icon||n.options.subnav.faviconPlaceholder))),t.icon&&!o&&$("<i/>").addClass("icon fa fa-fw").addClass(t.icon).prependTo(a),t.action&&a.click(function(e){e.preventDefault(),t.action()}),r.data("item",t)});var r=$("<i/>").addClass("overflow fa fa-fw "+this.getSubnavOverflowIcon()).prependTo(e);$(window).on("resize",$.proxy(this.checkSubnavOverflow,this)),window.setTimeout($.proxy(this.checkSubnavOverflow,this),1),r.dropdown({items:$.proxy(this.getSubnavOverflowItems,this),showFavicons:this.options.subnav.showFavicons,position:{my:"right top",at:"right bottom",of:e}})})}},getSubnavOverflowIcon:function(){return"fa-angle-double-right"},checkSubnavOverflow:function(){var e=this.getSubnavOverflowItems(),t=this.domElement.find("nav.subnav");t.find(".last-non-overflown").removeClass("last-non-overflown"),e.length?(t.addClass("has-overflow"),t.find(".overflown:first").prev().addClass("last-non-overflown")):t.removeClass("has-overflow")},getSubnavOverflowItems:function(){var e=[],t=this.domElement.find("nav.subnav"),i=t.find("li:first");if(!i.length)return e;var n=i.position().top;return t.find("li").each(function(){var t=$(this).removeClass("overflown");t.position().top!=n&&(t.addClass("overflown"),e.push(t.data("item")))}),e},getId:function(){return this.id},getUid:function(){return this.uid},isPersisted:function(){return!!this.id&&this.id>0},getWidgetType:function(){return this.data.widget_type},getTitle:function(){return this.data.title},setTitle:function(e){this.data.title=$.trim(e),this.domElement&&this.domElement.find("header .title").attr("title",this.data.title).find("span").text(this.data.title)},getIcon:function(){return this.data.icon},setIcon:function(e){this.data.icon=e},getSubtitle:function(){return this.data.subtitle||""},setSubtitle:function(e){this.data.subtitle=$.trim(e),this.domElement.find("header .subtitle .subtitle-text").text(this.data.subtitle).attr("subtitle",this.data.subtitle)},getSubtitleIcon:function(){var e=this.data.subtitleIcon||!1;return e?'<i class="fa fa-fw '+e+'"></i>':""},setSubtitleIcon:function(e){this.data.subtitleIcon=$.trim(e),this.domElement.find("header .subtitle .subtitle-icon").html(this.getSubtitleIcon())},getDefaultBackgroundColor:function(){return DEFAULT_BACKGROUND_COLOR},getBackgroundColor:function(){return"number"!=typeof this.backgroundColor?this.getDefaultBackgroundColor():this.backgroundColor},setBackgroundColor:function(e){switch($.type(e)){case"undefined":e=this.getDefaultBackgroundColor();case"number":break;default:e=parseInt(e.toString(),16)}this.backgroundColor=Math.max(0,Math.min(16777215,e))},getInheritBackgroundTransparency:function(){return"boolean"!=typeof this.inheritBackgroundTransparency?!0:!!this.inheritBackgroundTransparency},setInheritBackgroundTransparency:function(e){"undefined"==typeof e&&(e=!0),this.inheritBackgroundTransparency=!!e},getBackgroundTransparency:function(){if(this.getInheritBackgroundTransparency()){var e=Yourls.getActivePage();return e?e.getWidgetTransparency():DEFAULT_WIDGET_TRANSPARENCY}return"number"!=typeof this.backgroundTransparency?DEFAULT_WIDGET_TRANSPARENCY:this.backgroundTransparency},setBackgroundTransparency:function(e){"undefined"==typeof e&&(e=this.getBackgroundTransparency()),this.backgroundTransparency=Math.max(0,Math.min(255,parseInt(e)||0))},getHeaderless:function(){return!!this.headerless},setHeaderless:function(e){this.headerless=!!e},isEditing:function(){return this.domElement.hasClass("editing")},startEditing:function(){this.isEditing()||this.isEditable()&&(this.domElement.addClass("editing").removeClass("non-editing"),Yourls.canDragWithoutEditing()||Yourls.getActivePage().enableDragDrop(),$(this).trigger("startEditing.widget"))},finishEditing:function(){this.isEditing()&&(Yourls.Page.closeInlineEdits(),this.domElement.removeClass("editing").addClass("non-editing"),Yourls.canDragWithoutEditing()||0!=$(".widget.editing").length||Yourls.getActivePage().disableDragDrop(),$(this).trigger("finishEditing.widget"))},toggleEditing:function(){this.isEditing()?this.finishEditing():this.startEditing()},queueUpdate:function(e){function t(){n.queuedUpdates&&window.setTimeout(i,1)}function i(){if(!n.queuedUpdates.length)return void delete n.queuedUpdates;var e=n.queuedUpdates.shift();try{e(t)}catch(i){throw t(),i}}var n=this;this.queuedUpdates?this.queuedUpdates.push(e):(this.queuedUpdates=[e],t())},askDeleteWidget:function(){Yourls.confirm($.proxy(this.queueDelete,this),I18n.t("delete_widget"),I18n.t("delete_widget_confirm"))},queueDelete:function(){this.removeFromDOM(),$(this).trigger("delete");var e=this.getId();this.queueUpdate(function(t){Yourls.ajaxSave({url:"/widget/"+e,type:"delete",contentType:"application/json",dataType:"json",error:function(e){return 404==e.status?!0:void 0}}).success(t)})},renderFavicons:function(e){e=e||this.domElement.children(".body");var t=this;e.find("li").each(function(e,i){t.renderFavicon($(i))})},renderFavicon:function(e,t){e=$(e);var i=e.find(".favicon"),n=e.hasClass("link")?e:e.find(".link"),r=n.attr("href"),a=n.data("icon");Yourls.UrlHelper.renderIcon(i,a||r,t)},showSettings:function(e){function t(e){function t(e){return $.each(e,function(t,i){e[t]=i.inferType()}),e}var i=t($.unprefix(e,"widget_"));this.setGenericSettings($.extend(this.getGenericSettings(),i));var n=t($.unprefix(e,"setting_"));this.setCustomSettings($.extend(this.getCustomSettings(),n)),this.saveSettings()}function i(e){e.find("#widget_title:focus").select(),r(e),o(e),s(e)}function n(e){a(e)}function r(e){a(e);var t=e.find(".icon-selector");t.click(function(){new Yourls.IconPicker({selectedIcon:h.options.icon,selected:function(t){h.changeIcon(t),a(e),h.putWidget({icon:t})}}).show()})}function a(e){var t=e.find(".icon-selector i"),i=h.options.icon,n="",r=(i.match(/^favicon:(.+)/)||[]).pop();r&&(n=r,i=null),Yourls.UrlHelper.renderIcon(t,n||i)}function o(e){function t(e){null==e&&(e=h.getDefaultBackgroundColor()),h.setBackgroundColor(e),h.renderBackground(),i(),h.saveSettings()}function i(){var e=h.getBackgroundColor().toString(16);n.css("background-color","#"+e)}var n=e.find("#widget_background_swatch span");i(),n.click(function(){var e=h.getBackgroundColor(),i=new Yourls.ColorPicker({selectedColor:e,colors:WIDGET_BACKGROUND_COLORS,allowDefault:!0,selected:t});i.show()})}function s(e){var t=e.find("input#widget_transparency"),i=e.find("button#widget_transparency_reset");t.on("input",function(){var e=t.val();h.setInheritBackgroundTransparency(e==f.getWidgetTransparency()),h.setBackgroundTransparency(e),h.renderBackground()}),i.click(function(){var e=f.getWidgetTransparency();t.val(e),h.setInheritBackgroundTransparency(!0),h.setBackgroundTransparency(e),h.renderBackground()})}if(this.showingSettings)return!1;this.showingSettings=!0;var d=$.extend({template:"widgets/"+this.getWidgetType()+"/settings",templateValues:{},rendered:function(e){},changed:function(e){}},this.getSettingsConfig()),l="";if(JST[d.template]){var c=d.templateValues;$.isFunction(c)&&(c=c()),l=JST[d.template](c)}var u=$.extend($.prefix(this.getGenericSettings(),"widget_"),$.prefix(this.getCustomSettings(),"setting_")),h=this,f=Yourls.getActivePage();this.settingsSidebar("generic",{formdata:u,values:{custom_form:l},extraClasses:"widget-"+this.getWidgetType()+"-settings",activeTab:e||"general",save:$.proxy(t,h),rendered:function(){i.call(h,$(this)),d.rendered.call(h,$(this))},changed:function(e,t){n.call(h,$(this)),d.changed.call(h,$(this))},closed:function(){delete h.showingSettings}})},getSettingsConfig:function(){return{}},saveSettings:function(e){var t=this.getSettings(),i=$.unprefix(t,"_"),n=$.excludePrefix(t,"_");i.title&&this.setTitle(i.title),delete i.title,i=$.compact(i,this.getGenericSettingsDefaults()),n=$.extend(n,$.prefix(i,"_"));var r={title:this.getTitle(),settings:n};this.putWidget(r,e)},putWidget:function(e,t){"string"==typeof e&&(e={title:e});var i=this;this.queueUpdate(function(n){Yourls.ajaxSave({url:"/widget/"+i.getId(),type:"put",contentType:"application/json",data:JSON.stringify(e),dataType:"json",success:function(){i.setData($.extend(i.data,e)),$.isFunction(t)&&t()},error:function(e){return 404==e.status?!0:void 0}}).done(n)})},inlineEdit:function(e,t){function i(e){function i(){Yourls.Page.closeInlineEdits()}function n(){d.addClass("error"),c=!1}if(e&&(e.preventDefault(),e.stopPropagation()),c)return!1;c=!0;var r=$.trim(d.val());return r==u?i():$.isFunction(t.callback)&&t.callback(r)===!1?n():(t.useSource&&o.text(r),i())}function n(e){d.removeClass("error"),13==e.keyCode&&i(e)}function r(t){t&&$(t.target).parents(".ui-menu").length||(e.removeClass("inline-editing"),c=!1,d.removeClass("error"),$(document).unbind("click",r),d.unbind("blur",i),l.unbind("click",i),d.unbind("keydown",n),s.unbind("submit",i),e.unbind("closeInlineEdit",a))}function a(e){t.submitOnClose&&!c?i():r(e)}if(!e.hasClass("inline-editing")){t=$.extend({defaultValue:"",callback:null,submitOnBlur:!1,submitOnClose:!0,useSource:!0},t),Yourls.Page.closeInlineEdits(),e.addClass("inline-editing"),e.bind("closeInlineEdit",a);var o=e.find(".inline-edit"),s=(e.find(".icon"),e.find(".buttons"),e.find("form")),d=s.find("input"),l=s.find("button"),c=!1;d.removeClass("error");var u=(t.useSource?$.trim(o.text()):"")||t.defaultValue;d.val(u),d.select(),s.bind("submit",i),l.bind("click",i),d.bind("keydown",n),t.submitOnBlur?d.bind("blur",i):window.setTimeout(function(){$(document).bind("click",r)},500)}},settingsSidebar:function(e,t){t=$.extend({title:I18n.t("widget_settings"),icon:"fa-cog",template:"settings",buttons:[{caption:I18n.t("done"),icon:"fa-check","default":!0,action:t.save}],activeTab:t.activeTab,changed:function(){},save:function(){}},t);var i=t.changed;t.changed=function(e,n){t.save(n),i.apply(this,arguments)},Yourls.sidebar("widgets/"+e+"/"+t.template,t)},initInlineAdding:function(e){function t(){i.inlineEdit(n,e)}var i=this,n=this.domElement.find(".add");e=$.extend({defaultValue:n.data("default")||"",useSource:!1,editOnly:!0},e||{}),n.toggleClass("edit-only",e.editOnly);var r=e.callback;e.callback=function(e){return $.isFunction(r)&&r(e)===!1?!1:void window.setTimeout(t,100)},n.click(function(n){n.preventDefault(),n.stopPropagation(),(!e.editOnly||i.isEditing())&&t()}),Yourls.hasTouchScreen()||$(this).on("startEditing.widget",function(){t()})},changeIcon:function(e){var t=this.domElement.find("> header .icon.fa");t[0].className=t[0].className.replace(/fa-[a-z0-9-]+/,""),t.removeClass("favicon").css({backgroundImage:null,color:null});var i=(e.match(/^favicon:(.+)/)||[]).pop();i?Yourls.UrlHelper.renderFavicon(t,i,e!=this.options.icon?this.options.icon:"fa-bookmark"):t.addClass(e),this.options.icon=e},setLoading:function(e){e="undefined"==typeof e?!0:1==e;var t=this.domElement.find("header .icon");this.domElement.toggleClass("loading",e).toggleClass("not-loading",!e),t.toggleClass("fa-spin",e)},canBeCopied:function(){return!!this.options.canBeCopied&&!this.isPreview()},canBeMoved:function(){var e=Yourls.getEditablePages(!0);return this.isEditable()&&e.length>0},getRelatedItemIds:function(){return[]},showCopyDialog:function(){function e(e){var i=e.target,n=Yourls.pages.get(i),r={page:i,column:n.is_active?Yourls.getActivePage().getLeastHighColumn().index():n.column_count-1,title:n.is_active?I18n.t("copy_of",{source:t.getTitle()}):t.getTitle(),icon:t.options.icon};t.isPersisted()?r.source_id=t.getId():(r.settings=t.getSettings(),r.items=t.getRelatedItemIds()),Yourls.getActivePage().addWidget(t.getWidgetType(),r).done(function(){n.is_active||Yourls.alert(I18n.t("widget_copied_successfully"))}).fail(function(){Yourls.error(I18n.t("widget_copy_failed"))})}var t=this,i=Yourls.getEditablePages(),n=new Yourls.Pages(i).section();n=$.values(n).sort(function(e,t){return e.compare(t)}),Yourls.sidebar("widgets/generic/copy",{title:I18n.t("copy_widget"),icon:"fa-clone",values:{sections:n},formdata:{target:Yourls.getActivePageId()},buttons:[{caption:I18n.t("copy"),icon:"fa-clone","default":!0,action:e},{caption:I18n.t("cancel"),icon:"fa-times"}]})},showMoveDialog:function(){function e(e){var i=e.move_target;if(Yourls.getActivePageId()!=i){var n=t.getId();Yourls.Page.API.moveWidget(n,i).then(function(){t.removeFromDOM(),Yourls.alert(I18n.t("widget_moved_successfully"))})}}var t=this,i=Yourls.getEditablePages(!0);if(0!=i.length){var n=new Yourls.Pages(i).section();n=$.values(n).sort(function(e,t){return e.compare(t)}),Yourls.sidebar("widgets/generic/move",{title:I18n.t("move_widget"),icon:"fa-arrows",values:{sections:n},buttons:[{caption:I18n.t("move"),icon:"fa-arrows","default":!0,action:e},{caption:I18n.t("cancel"),icon:"fa-times"}]})}},getCache:function(e){return Yourls.Cache.get(this.getCacheKey(e))},tryCache:function(e,t,i){var n=this.getCache(e),r=$.Deferred();return null!=n?($.isFunction(t)&&t.call(this,n),r.resolve(n)):($.isFunction(i)&&i.call(this),r.reject()),r.promise()},setCache:function(e,t,i){i=i||10080,Yourls.Cache.set(this.getCacheKey(e),t,i)},getCacheKey:function(e){return"widget-"+this.getId()+"-"+e},postpone:function(e){Yourls.postpone(e,this)},removeFromDOM:function(){this.domElement.remove()}};var widgetTypes={};Yourls.Widget.registerType=function(type,mixins){var extension=null,name=type[0].toUpperCase()+type.slice(1).toLowerCase();name=name.replace(/[^a-z0-9]+(\w)/gi,function(e){return e.slice(-1).toUpperCase()}),eval("extension = function "+name+"Widget() { Yourls.Widget.call(this) }"),extension.prototype=new Yourls.Widget,extension.prototype.constructor=extension;for(var i=1;i<arguments.length;i++){var mixin=arguments[i];for(var member in mixin)mixin.hasOwnProperty(member)&&(extension.prototype[member]=mixin[member])}return widgetTypes[type]=extension,extension},Yourls.Widget.typeExists=function(e){return!!widgetTypes[e]},Yourls.Widget.create=function(e,t){var i=widgetTypes[e];if(i){var n=new i;return n.initialize(t),n}throw Bugsnag.notify("Unknown widget",e,{}),"Unknown widget "+e}}(Yourls,jQuery);var Yourls=function(e,t){"use strict";return e.WidgetsBrowser=function(i){function n(){var i=[];return i.push({caption:I18n.t("import_bookmarks_feeds"),icon:"fa-upload",action:t.proxy(e.getImport().showSidebar,e.getImport(),e.getActivePageId())}),i}function r(e,t){return e.priority!=t.priority?e.priority-t.priority:Math.round(Math.log(t.usage_count))-Math.round(Math.log(e.usage_count))}function a(e,i){function n(e){e=t.trim(e);var i=t.map(e.split(/\s/),t.trim).join(" "),n="https://news.google.com/news?output=rss&q="+encodeURIComponent(i),r=I18n.t("news_about",{keywords:i});return{name:r,title:r,type:"rsslist",url:n,preview:!1,feed:{url:n}}}var r=n(e);r&&i.push(r)}function o(i,n){function r(){var t=new e.FeedBrowser;t.showFeedBar(i.feed,{add:n,feedIsWidget:!0})}function a(){function r(){var e=t(this),n=e.find(".body"),r=e.find(".widget-preview").detach();n.replaceWith(r),o(i,function(e){c=e,r.append(e.render())})}function a(){c&&(t(c).trigger("delete"),c=null)}function o(i,n){if(i.source_id)t.ajax({url:"/widget/"+i.source_id,dataType:"json",success:function(t){delete t["default"];var r=e.Widget.create(i.type,t);n(r)}});else{var r={title:i.title,previewMode:!0};t.isPlainObject(i.preview)&&(r.settings=i.preview);var a=e.Widget.create(i.type,r);n(a)}}var s=t.inArray("premium",i.subject)>=0,d=s&&!l;e.sidebar("general/browser/sidebar_widget_preview",{title:I18n.t("preview"),icon:"fa-search",extraClasses:"sectioned",rendered:r,closed:a,alert:d?{message:I18n.t("premium_widget"),type:"locked"}:null,buttons:[d?{caption:I18n.t("upgrade_to_premium"),icon:"fa-heart","default":!0,url:window.primaryBaseUrl+"/premium"}:{caption:I18n.t("add_widget"),icon:"fa-plus","default":!0,action:n}]});var c}if(i.preview!==!1){switch(i.type){case"rsslist":if(!i.feed)break;return{caption:I18n.t("preview"),icon:"fa-search",action:r}}return{caption:I18n.t("preview"),icon:"fa-search",action:a}}}function s(e,i){t.inArray("premium",e.subject)>=0&&i.append(t.crel("i","badge","fa",l?"fa-heart":"fa-lock",{title:I18n.t("premium_widget")}))}i=t.extend({title:I18n.t("browse_widgets"),icon:"fa-folder-open",searchHint:I18n.t("widgets.search_hint"),extraButtons:n,url:"/widgets/find",tabs:[{name:"all",title:I18n.t("widgets.all"),active:!0,options:{url:"/widgets/find",filters:{subject:{icon:"fa-tag",popular:"popular",tags:function(){return e.tags.getSubjectTags()}},area:{icon:"fa-globe",popular:[e.user.getCountryCode(),"int"],tags:function(){return e.tags.getAreaTags()}}}}},{name:"premium",title:I18n.t("premium"),options:{url:"/widgets/find?subject=premium"}}],cachePopular:!0,cachePopularVersion:5,showThumbnails:!0,showFavicons:!0,beforeSuggestionsRender:a,getItemAction:o,itemRendered:s,compareItems:r},i);var d=new e.Browser(i),l=e.user&&e.user.isPremium();return d},e}(Yourls,jQuery);!function(e){"use strict";function t(e){return"[object Array]"===Object.prototype.toString.call(e);
}function i(e){return e instanceof Function}function n(e){return!i(e)&&e instanceof Object}function r(e,i){var a;for(a in i)n(i[a])||t(i[a])?(n(i[a])&&!n(e[a])&&(e[a]={}),t(i[a])&&!t(e[a])&&(e[a]=[]),r(e[a],i[a])):void 0!==i[a]&&(e[a]=i[a])}function a(e,t){var i={};return r(i,e),r(i,t),i}function o(e){var t,i,n,r,a,o,s,d,l,c,u;return c=Object.prototype.toString.call(e),"[object Date]"===c?e:"[object String]"===c?(n=e.match(B),n?(u=parseInt(n[1],10),o=parseInt(n[3],10)-1,t=parseInt(n[5],10),i=parseInt(n[7],10),a=n[9]?parseInt(n[9],10):0,l=n[11]?parseInt(n[11],10):0,r=n[12]?1e3*parseFloat(H+n[12].slice(1)):0,d=Date.UTC(u,o,t,i,a,l,r),n[13]&&n[14]&&(s=60*n[15],n[17]&&(s+=parseInt(n[17],10)),s*="-"===n[14]?-1:1,d-=60*s*1e3),new Date(d)):void 0):void 0}function s(e){var t,i,n;for(t=0;t<e.length;t++)for(n=e[t].data,i=0;i<n.length;i++)if(n[i][1]<0)return!0;return!1}function d(e,t,i,n,r,o,d){return function(l,c,u){var h=a({},e);return h=a(h,u||{}),c.hideLegend&&t(h),"min"in c?i(h,c.min):s(l)||i(h,0),c.max&&n(h,c.max),"stacked"in c&&r(h,c.stacked),c.colors&&(h.colors=c.colors),c.xtitle&&o(h,c.xtitle),c.ytitle&&d(h,c.ytitle),h=a(h,c.library||{})}}function l(e,t){document.body.innerText?e.innerText=t:e.textContent=t}function c(e,t){l(e,"Error Loading Chart: "+t),e.style.color="#ff0000"}function u(t,i,n){var r=e.jQuery||e.Zepto||e.$;r.ajax({dataType:"json",url:i,success:n,error:function(e,i,n){var r="string"==typeof n?n:n.message;c(t,r)}})}function h(e,t){try{t(e)}catch(i){throw c(e.element,i.message),i}}function f(e,t){"string"==typeof e.dataSource?u(e.element,e.dataSource,function(i,n,r){e.data=i,h(e,t)}):(e.data=e.dataSource,h(e,t))}function g(e){return""+e}function p(e){return parseFloat(e)}function m(e){var t,i,n,r;if("object"!=typeof e)if("number"==typeof e)e=new Date(1e3*e);else{if(t=e.match(K))return i=parseInt(t[1],10),n=parseInt(t[3],10)-1,r=parseInt(t[5],10),new Date(i,n,r);var a=e.replace(/ /,"T").replace(" ","").replace("UTC","Z");e=o(a)||new Date(e)}return e}function v(e){if(!t(e)){var i,n=[];for(i in e)e.hasOwnProperty(i)&&n.push([i,e[i]]);e=n}return e}function y(e,t){return e[0].getTime()-t[0].getTime()}function w(e,t){return e-t}function b(){!V&&"Highcharts"in e&&(V=new function(){var t=e.Highcharts;this.name="highcharts";var i={chart:{},xAxis:{title:{text:null},labels:{style:{fontSize:"12px"}}},yAxis:{title:{text:null},labels:{style:{fontSize:"12px"}}},title:{text:null},credits:{enabled:!1},legend:{borderWidth:0},tooltip:{style:{fontSize:"12px"}},plotOptions:{areaspline:{},series:{marker:{}}}},n=function(e){e.legend.enabled=!1},r=function(e,t){e.yAxis.min=t},o=function(e,t){e.yAxis.max=t},s=function(e,t){e.plotOptions.series.stacking=t?"normal":null},l=function(e,t){e.xAxis.title.text=t},c=function(e,t){e.yAxis.title.text=t},u=d(i,n,r,o,s,l,c);this.renderLineChart=function(e,i){i=i||"spline";var n={};"areaspline"===i&&(n={plotOptions:{areaspline:{stacking:"normal"},series:{marker:{enabled:!1}}}});var r,a,o,s=u(e.data,e.options,n);s.xAxis.type=e.options.discrete?"category":"datetime",s.chart.type=i,s.chart.renderTo=e.element.id;var d=e.data;for(a=0;a<d.length;a++){if(r=d[a].data,!e.options.discrete)for(o=0;o<r.length;o++)r[o][0]=r[o][0].getTime();d[a].marker={symbol:"circle"}}s.series=d,new t.Chart(s)},this.renderScatterChart=function(e){var i={},n=u(e.data,e.options,i);n.chart.type="scatter",n.chart.renderTo=e.element.id,n.series=e.data,new t.Chart(n)},this.renderPieChart=function(e){var n={};e.options.colors&&(n.colors=e.options.colors);var r=a(a(i,n),e.options.library||{});r.chart.renderTo=e.element.id,r.series=[{type:"pie",name:e.options.label||"Value",data:e.data}],new t.Chart(r)},this.renderColumnChart=function(e,i){i=i||"column";var n,r,a,o,s=e.data,d=u(s,e.options),l=[];for(d.chart.type=i,d.chart.renderTo=e.element.id,n=0;n<s.length;n++)for(a=s[n],r=0;r<a.data.length;r++)o=a.data[r],l[o[0]]||(l[o[0]]=new Array(s.length)),l[o[0]][n]=o[1];var c=[];for(n in l)l.hasOwnProperty(n)&&c.push(n);d.xAxis.categories=c;var h=[];for(n=0;n<s.length;n++){for(o=[],r=0;r<c.length;r++)o.push(l[c[r]][n]||0);h.push({name:s[n].name,data:o})}d.series=h,new t.Chart(d)};var h=this;this.renderBarChart=function(e){h.renderColumnChart(e,"bar")},this.renderAreaChart=function(e){h.renderLineChart(e,"areaspline")}},q.push(V)),!G&&e.google&&e.google.setOnLoadCallback&&(G=new function(){var t=e.google;this.name="google";var i={},n=[],r=function(){for(var e,i,r=0;r<n.length;r++)e=n[r],i=t.visualization&&("corechart"===e.pack&&t.visualization.LineChart||"timeline"===e.pack&&t.visualization.Timeline),i&&(e.callback(),n.splice(r,1),r--)},o=function(e,a){if(a||(a=e,e="corechart"),n.push({pack:e,callback:a}),i[e])r();else{i[e]=!0;var o={packages:[e],callback:r};Q.language&&(o.language=Q.language),t.load("visualization","1",o)}},s={chartArea:{},fontName:"'Lucida Grande', 'Lucida Sans Unicode', Verdana, Arial, Helvetica, sans-serif",pointSize:6,legend:{textStyle:{fontSize:12,color:"#444"},alignment:"center",position:"right"},curveType:"function",hAxis:{textStyle:{color:"#666",fontSize:12},titleTextStyle:{},gridlines:{color:"transparent"},baselineColor:"#ccc",viewWindow:{}},vAxis:{textStyle:{color:"#666",fontSize:12},titleTextStyle:{},baselineColor:"#ccc",viewWindow:{}},tooltip:{textStyle:{color:"#666",fontSize:12}}},l=function(e){e.legend.position="none"},c=function(e,t){e.vAxis.viewWindow.min=t},u=function(e,t){e.vAxis.viewWindow.max=t},h=function(e,t){e.hAxis.viewWindow.min=t},f=function(e,t){e.hAxis.viewWindow.max=t},g=function(e,t){e.isStacked=!!t},m=function(e,t){e.hAxis.title=t,e.hAxis.titleTextStyle.italic=!1},v=function(e,t){e.vAxis.title=t,e.vAxis.titleTextStyle.italic=!1},w=d(s,l,c,u,g,m,v),b=function(e,i){var n,r,a,o,s,d=[];for(n=0;n<e.length;n++)for(a=e[n],r=0;r<a.data.length;r++)o=a.data[r],s="datetime"===i?o[0].getTime():o[0],d[s]||(d[s]=new Array(e.length)),d[s][n]=p(o[1]);var l,c=[],u=!0;for(n in d)d.hasOwnProperty(n)&&("datetime"===i?(l=new Date(p(n)),u=u&&S(l)):l="number"===i?p(n):n,c.push([l].concat(d[n])));"datetime"===i&&c.sort(y);var h=new t.visualization.DataTable;for(i="datetime"===i&&u?"date":i,h.addColumn(i,""),n=0;n<e.length;n++)h.addColumn("number",e[n].name);return h.addRows(c),h},C=function(t){e.attachEvent?e.attachEvent("onresize",t):e.addEventListener&&e.addEventListener("resize",t,!0),t()};this.renderLineChart=function(e){o(function(){var i=w(e.data,e.options),n=b(e.data,e.options.discrete?"string":"datetime");e.chart=new t.visualization.LineChart(e.element),C(function(){e.chart.draw(n,i)})})},this.renderPieChart=function(e){o(function(){var i={chartArea:{top:"10%",height:"80%"}};e.options.colors&&(i.colors=e.options.colors);var n=a(a(s,i),e.options.library||{}),r=new t.visualization.DataTable;r.addColumn("string",""),r.addColumn("number","Value"),r.addRows(e.data),e.chart=new t.visualization.PieChart(e.element),C(function(){e.chart.draw(r,n)})})},this.renderColumnChart=function(e){o(function(){var i=w(e.data,e.options),n=b(e.data,"string");e.chart=new t.visualization.ColumnChart(e.element),C(function(){e.chart.draw(n,i)})})},this.renderBarChart=function(e){o(function(){var i={hAxis:{gridlines:{color:"#ccc"}}},n=d(s,l,h,f,g,m,v)(e.data,e.options,i),r=b(e.data,"string");e.chart=new t.visualization.BarChart(e.element),C(function(){e.chart.draw(r,n)})})},this.renderAreaChart=function(e){o(function(){var i={isStacked:!0,pointSize:0,areaOpacity:.5},n=w(e.data,e.options,i),r=b(e.data,e.options.discrete?"string":"datetime");e.chart=new t.visualization.AreaChart(e.element),C(function(){e.chart.draw(r,n)})})},this.renderGeoChart=function(e){o(function(){var i={legend:"none",colorAxis:{colors:e.options.colors||["#f6c7b6","#ce502d"]}},n=a(a(s,i),e.options.library||{}),r=new t.visualization.DataTable;r.addColumn("string",""),r.addColumn("number",e.options.label||"Value"),r.addRows(e.data),e.chart=new t.visualization.GeoChart(e.element),C(function(){e.chart.draw(r,n)})})},this.renderScatterChart=function(e){o(function(){var i={},n=w(e.data,e.options,i),r=b(e.data,"number");e.chart=new t.visualization.ScatterChart(e.element),C(function(){e.chart.draw(r,n)})})},this.renderTimeline=function(e){o("timeline",function(){var i={legend:"none"};e.options.colors&&(i.colors=e.options.colors);var n=a(a(s,i),e.options.library||{}),r=new t.visualization.DataTable;r.addColumn({type:"string",id:"Name"}),r.addColumn({type:"date",id:"Start"}),r.addColumn({type:"date",id:"End"}),r.addRows(e.data),e.element.style.lineHeight="normal",e.chart=new t.visualization.Timeline(e.element),C(function(){e.chart.draw(r,n)})})}},q.push(G)),!J&&"Chart"in e&&(J=new function(){var t=e.Chart;this.name="chartjs";var i={maintainAspectRatio:!1,animation:!1},n={scales:{yAxes:[{ticks:{maxTicksLimit:4},scaleLabel:{fontSize:16,fontColor:"#333"}}],xAxes:[{gridLines:{drawOnChartArea:!1},scaleLabel:{fontSize:16,fontColor:"#333"},time:{},ticks:{}}]},legend:{}},r=["#3366CC","#DC3912","#FF9900","#109618","#990099","#3B3EAC","#0099C6","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707","#329262","#5574A6","#3B3EAC"],o=function(e){e.legend.display=!1},s=function(e,t){null!==t&&(e.scales.yAxes[0].ticks.min=t)},l=function(e,t){e.scales.yAxes[0].ticks.max=t},c=function(e,t){null!==t&&(e.scales.xAxes[0].ticks.min=t)},u=function(e,t){e.scales.xAxes[0].ticks.max=t},h=function(e,t){e.scales.xAxes[0].stacked=!!t,e.scales.yAxes[0].stacked=!!t},f=function(e,t){e.scales.xAxes[0].scaleLabel.display=!0,e.scales.xAxes[0].scaleLabel.labelString=t},m=function(e,t){e.scales.yAxes[0].scaleLabel.display=!0,e.scales.yAxes[0].scaleLabel.labelString=t},v=function(e,i,n,r){e.element.innerHTML="<canvas></canvas>";var a=e.element.getElementsByTagName("CANVAS")[0];e.chart=new t(a,{type:i,data:n,options:r})},y=function(e,t){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?"rgba("+parseInt(i[1],16)+", "+parseInt(i[2],16)+", "+parseInt(i[3],16)+", "+t+")":e},b=function(e,t,i){var n=Math.ceil(e.element.offsetWidth/4/t.labels.length);n>25&&(n=25),i.scales.xAxes[0].ticks.callback=function(e){return e=g(e),e.length>n?e.substring(0,n-2)+"...":e}},C=d(a(i,n),o,s,l,h,f,m),E=function(e,t,i){var n,o,s,d,l,c,u=[],h=[],f=e.options.colors||r,g=!0,m=!0,v=!0,b=!0,C=!0,E=!0,P=("line"===i||"area"===i)&&!e.options.discrete,D=e.data,A=[],Y=[];for(o=0;o<D.length;o++)for(d=D[o],s=0;s<d.data.length;s++)l=d.data[s],c=P?l[0].getTime():l[0],Y[c]||(Y[c]=new Array(D.length)),Y[c][o]=p(l[1]),-1===A.indexOf(c)&&A.push(c);P&&A.sort(w);var M=[];for(s=0;s<D.length;s++)M.push([]);var L,N;for(N=0;N<A.length;N++)for(o=A[N],P?(L=new Date(p(o)),g=g&&S(L),n||(n=L.getDay()),m=m&&T(L,n),v=v&&x(L),b=b&&_(L),C=C&&I(L),E=E&&k(L)):L=o,h.push(L),s=0;s<D.length;s++)M[s].push(Y[o][s]);for(o=0;o<D.length;o++){d=D[o];var j="line"!==i?y(f[o],.5):f[o],F={label:d.name,data:M[o],fill:"area"===i,borderColor:f[o],backgroundColor:j,pointBackgroundColor:f[o],borderWidth:2};u.push(a(F,d.library||{}))}if(P&&h.length>0){var U=h[0].getTime(),O=h[0].getTime();for(o=1;o<h.length;o++)L=h[o].getTime(),U>L&&(U=L),L>O&&(O=L);var z=(O-U)/864e5;if(!t.scales.xAxes[0].time.unit){var $;if(b||z>3650?(t.scales.xAxes[0].time.unit="year",$=365):v||z>300?(t.scales.xAxes[0].time.unit="month",$=30):g||z>10?(t.scales.xAxes[0].time.unit="day",$=1):C?(t.scales.xAxes[0].time.unit="hour",$=1/24):E&&(t.scales.xAxes[0].time.displayFormats={minute:"h:mm a"},t.scales.xAxes[0].time.unit="minute",$=1/24/60),$&&z>0){var R=Math.ceil(z/$/(e.element.offsetWidth/100));m&&1===$&&(R=7*Math.ceil(R/7)),t.scales.xAxes[0].time.unitStepSize=R}}t.scales.xAxes[0].time.tooltipFormat||(g?t.scales.xAxes[0].time.tooltipFormat="ll":C?t.scales.xAxes[0].time.tooltipFormat="MMM D, h a":E&&(t.scales.xAxes[0].time.tooltipFormat="h:mm a"))}var W={labels:h,datasets:u};return W};this.renderLineChart=function(e,t){var i={};!e.options.max&&P(e.data)&&(e.options.max=1);var n=C(e.data,a(i,e.options)),r=E(e,n,t||"line");n.scales.xAxes[0].type=e.options.discrete?"category":"time",v(e,"line",r,n)},this.renderPieChart=function(e){for(var t=a(i,e.options.library||{}),n=[],o=[],s=0;s<e.data.length;s++){var d=e.data[s];n.push(d[0]),o.push(d[1])}var l={labels:n,datasets:[{data:o,backgroundColor:e.options.colors||r}]};v(e,"pie",l,t)},this.renderColumnChart=function(e,t){var r;r="bar"===t?d(a(i,n),o,c,u,h,f,m)(e.data,e.options):C(e.data,e.options);var s=E(e,r,"column");b(e,s,r),v(e,"bar"===t?"horizontalBar":"bar",s,r)};var D=this;this.renderAreaChart=function(e){D.renderLineChart(e,"area")},this.renderBarChart=function(e){D.renderColumnChart(e,"bar")},this.renderScatterChart=function(e){for(var t=C(e.data,e.options),i=e.options.colors||r,n=[],a=e.data,o=0;o<a.length;o++){for(var s=a[o],d=[],l=0;l<s.data.length;l++)d.push({x:p(s.data[l][0]),y:p(s.data[l][1])});n.push({label:s.name,showLine:!1,data:d,borderColor:i[o],backgroundColor:i[o],pointBackgroundColor:i[o]})}var c={datasets:n};t.scales.xAxes[0].type="linear",t.scales.xAxes[0].position="bottom",v(e,"line",c,t)}},q.unshift(J))}function C(e,t){var n,r,a,o;for(a="render"+e,o=t.options.adapter,b(),n=0;n<q.length;n++)if(r=q[n],(!o||o===r.name)&&i(r[a]))return r[a](t);throw new Error("No adapter found")}function k(e){return 0===e.getMilliseconds()&&0===e.getSeconds()}function I(e){return k(e)&&0===e.getMinutes()}function S(e){return I(e)&&0===e.getHours()}function T(e,t){return S(e)&&e.getDay()===t}function x(e){return S(e)&&1===e.getDate()}function _(e){return x(e)&&0===e.getMonth()}function E(e){return!isNaN(m(e))&&g(e).length>=6}function P(e){var t,i,n;for(t=0;t<e.length;t++)for(n=e[t].data,i=0;i<n.length;i++)if(0!=n[i][1])return!1;return!0}function D(e){var t,i,n;for(t=0;t<e.length;t++)for(n=v(e[t].data),i=0;i<n.length;i++)if(!E(n[i][0]))return!0;return!1}function A(e,i,n){var r;for(!t(e)||"object"!=typeof e[0]||t(e[0])?(e=[{name:i.label||"Value",data:e}],i.hideLegend=!0):i.hideLegend=!1,(null===i.discrete||void 0===i.discrete)&&(i.discrete=D(e)),i.discrete&&(n="string"),r=0;r<e.length;r++)e[r].data=X(v(e[r].data),n);return e}function Y(e){var t,i=v(e);for(t=0;t<i.length;t++)i[t]=[g(i[t][0]),p(i[t][1])];return i}function M(e){var t;for(t=0;t<e.length;t++)e[t][1]=m(e[t][1]),e[t][2]=m(e[t][2]);return e}function L(e){e.data=A(e.data,e.options,"datetime"),C("LineChart",e)}function N(e){e.data=A(e.data,e.options,"string"),C("ColumnChart",e)}function j(e){e.data=Y(e.data),C("PieChart",e)}function F(e){e.data=A(e.data,e.options,"string"),C("BarChart",e)}function U(e){e.data=A(e.data,e.options,"datetime"),C("AreaChart",e)}function O(e){e.data=Y(e.data),C("GeoChart",e)}function z(e){e.data=A(e.data,e.options,"number"),C("ScatterChart",e)}function $(e){e.data=M(e.data),C("Timeline",e)}function R(e,t,i,n,r){var a;if("string"==typeof t&&(a=t,t=document.getElementById(t),!t))throw new Error("No element with id "+a);e.element=t,e.options=n||{},e.dataSource=i,e.getElement=function(){return t},e.getData=function(){return e.data},e.getOptions=function(){return n||{}},e.getChartObject=function(){return e.chart},W.charts[t.id]=e,f(e,r)}var W,B,H,G,V,J,Q=e.Chartkick||{},q=[],K=/^(\d\d\d\d)(\-)?(\d\d)(\-)?(\d\d)$/i;B=/(\d\d\d\d)(\-)?(\d\d)(\-)?(\d\d)(T)?(\d\d)(:)?(\d\d)?(:)?(\d\d)?([\.,]\d+)?($|Z|([\+\-])(\d\d)(:)?(\d\d)?)/i,H=String(1.5).charAt(1);var Z=function(e,t){return e="number"===t?p(e):"datetime"===t?m(e):g(e)},X=function(e,t){var i,n,r=[];for(n=0;n<e.length;n++)i=Z(e[n][0],t),r.push([i,p(e[n][1])]);return"datetime"===t&&r.sort(y),r};W={LineChart:function(e,t,i){R(this,e,t,i,L)},PieChart:function(e,t,i){R(this,e,t,i,j)},ColumnChart:function(e,t,i){R(this,e,t,i,N)},BarChart:function(e,t,i){R(this,e,t,i,F)},AreaChart:function(e,t,i){R(this,e,t,i,U)},GeoChart:function(e,t,i){R(this,e,t,i,O)},ScatterChart:function(e,t,i){R(this,e,t,i,z)},Timeline:function(e,t,i){R(this,e,t,i,$)},charts:{}},"object"==typeof module&&"object"==typeof module.exports?module.exports=W:e.Chartkick=W}(window),function(e,t){"use strict";return e.ProviderMixin={getNewProviderId:function(){return(new Date).getTime()},addProvider:function(e){this.providers[e.id]=e},getProvider:function(e){return this.providers[e]?this.providers[e]:!1},removeProvider:function(e,i){if(this.getProvider(e)){var n=this.getCurrentProvider();e==n.id&&this.setCurrentProvider(void 0),delete this.providers[e],this.setLoading(!0),this.saveSettings(i);var r=this;n.getAuthNamespace()&&t.ajax({url:"/widget/"+this.id+"/auth/"+e,type:"delete",success:function(){r.setLoading(!1)},error:function(){}})}},getCurrentProvider:function(){if("undefined"!=typeof this.currentProvider)return this.currentProvider;var e=this.listProviders(),t=!1;for(var i in e)e.hasOwnProperty(i)&&(t||(t=e[i]));return t},setCurrentProvider:function(e){var t=this.listProviders();this.currentProvider="undefined"!=typeof t[e]?t[e]:void 0},listProviders:function(){return this.providers},listProvidersByType:function(e){var t=[],i=this.listProviders();for(var n in i)i.hasOwnProperty(n)&&i[n].type==e&&t.push(i[n]);return t},providersToJson:function(){var e=[],t=this.listProviders();for(var i in t)t.hasOwnProperty(i)&&e.push({type:t[i].type,id:t[i].id});return e},jsonToProviders:function(i,n,r){var a={};for(var o in i)if(i.hasOwnProperty(o)){var s=this.getAuthorization(i[o].id);if(t.inArray(i[o].type,r)>-1||s){var d=e.Provider.create(n,i[o].type,{id:i[o].id,widget:this,authorization:s});a[d.id]=d}}return a},getAuthorization:function(e){if(!t.isArray(this.data.authorization))return!1;var i=void 0;if("undefined"!=typeof e){for(var n in this.data.authorization)if(this.data.authorization.hasOwnProperty(n)){var r=this.data.authorization[n];r.provider_id==e&&(i=r)}}else i=this.data.authorization.slice(-1).pop();return"undefined"!=typeof i&&"object"!=typeof i.expires_at&&(i.expires_at=i.expires_at.toMoment().toDate()),i},getConfigForProvider:function(e){return"undefined"==typeof this.providerConfig&&(this.providerConfig={}),this.providerConfig.hasOwnProperty(e.id)?this.providerConfig[e.id]:{}},setConfigForProvider:function(e,t){"undefined"==typeof this.providerConfig&&(this.providerConfig={}),this.providerConfig[t.id]=e},setValueForProvider:function(e,t,i){var n=this.getConfigForProvider(i);n[e]=t,this.setConfigForProvider(n,i)},getValueForProvider:function(e,t,i){var n=this.getConfigForProvider(t);return n.hasOwnProperty(e)?n[e]:i}},e}(Yourls,jQuery);var Yourls=function(e,t){"use strict";var i={};return e.LibLoader=new function(){this.FBSDK={name:"fb_sdk",url:"//connect.facebook.net/en_US/sdk.js",version:2.5},this.GJSAPI={name:"google_jsapi",url:"https://www.google.com/jsapi"},this.load=function(e){var n=function(e,t,i){return i="undefined"!=typeof i?String(i):"",e+"_"+i+t},r=n(e.name,e.url,e.version);return i.hasOwnProperty(r)||(i[r]=t.getScript(e.url)),i[r]}},e}(Yourls,jQuery),Yourls=function(e,t){"use strict";function i(e){return window.console&&window.console[e]}function n(t,n,o){t=t||(n instanceof Error?"error":"log");var s=Array.prototype.slice.call(arguments,1);i(t)&&e.isDebug()&&window.console[t].apply(window.console,s),("error"==t||"warn"==t)&&r(n,o,a(t))}function r(e,t,i){"object"==typeof window.Bugsnag&&(e instanceof Error?Bugsnag.notifyException(e,void 0,t,i):Bugsnag.notify("Yourls.Logger.error",e,t,i))}function a(e){var t;switch(e){case"log":case"info":t="info";break;case"warn":t="warning";break;case"error":default:t="error"}return t}return e.Logger=function(){},e.Logger.prototype={log:n.bind(void 0,"log"),info:n.bind(void 0,"info"),debug:n.bind(void 0,"debug"),warn:n.bind(void 0,"warn"),error:n.bind(void 0,"error")},e.Logger=new e.Logger,e}(Yourls,jQuery);!function(e,t){"use strict";e.Widget.AnalogClock=e.Widget.registerType("analog-clock",{getShowSeconds:function(){return"boolean"==typeof this.showSeconds?this.showSeconds:!0},setShowSeconds:function(e){this.showSeconds="undefined"==typeof e?!0:!!e},getFaceType:function(){return"number"==typeof this.faceType?this.faceType:1},setFaceType:function(e){this.faceType=parseInt(e)||0},render:function(){return this.data=t.extend({title:I18n.t("new_analog_clock_widget_title")},this.data),this.renderWidget("analog-clock",{},{icon:"fa-clock-o",settings:this.settingsDialog,added:function(){}}),this.postpone(function(){this.updateSecondsDisplay(),this.refreshMinutes(),this.updateFaceType(),this.domElement.find(".clock").show()}),t(this).on("delete",t.proxy(function(){this.refreshTimeoutSeconds&&clearInterval(this.refreshTimeoutSeconds),this.refreshTimeoutMinutes&&clearTimeout(this.refreshTimeoutMinutes)},this)),this.domElement},getCustomSettingsDefaults:function(){return{s:!0,f:2}},setCustomSettings:function(e){this.setShowSeconds(e.s),this.setFaceType(e.f)},getCustomSettings:function(){return{s:this.getShowSeconds()?1:0,f:this.getFaceType()}},getSettingsConfig:function(){function e(){i.updateSecondsDisplay(),i.refreshSeconds(),i.refreshMinutes(),i.updateFaceType()}function t(){return[{value:0,label:I18n.t("clock.faces.none")},{value:1,label:I18n.t("clock.faces.simple")},{value:2,label:I18n.t("clock.faces.modern")},{value:3,label:I18n.t("clock.faces.classic")},{value:4,label:I18n.t("clock.faces.informal")}]}var i=this;return{templateValues:{faces:t,s:this.getShowSeconds()?1:0,f:this.getFaceType()},changed:e}},updateSecondsDisplay:function(){this.refreshTimeoutSeconds&&clearInterval(this.refreshTimeoutSeconds),this.getShowSeconds()?(this.refreshSeconds(),this.domElement.find(".sec").show(),this.refreshTimeoutSeconds=setInterval(t.proxy(this.refreshSeconds,this),1e3)):this.domElement.find(".sec").hide()},refreshSeconds:function(){var e=(new Date).getSeconds(),t=6*e,i="rotate("+t+"deg)";this.domElement.find(".sec").css("transform",i)},refreshMinutes:function(){this.refreshTimeoutMinutes&&clearTimeout(this.refreshTimeoutMinutes);var e=(new Date).getMinutes(),i=6*e,n="rotate("+i+"deg)";this.domElement.find(".min").css("transform",n);var r=(new Date).getHours(),a=30*r+e/2,o="rotate("+a+"deg)";this.domElement.find(".hour").css("transform",o),this.refreshTimeoutMinutes=setTimeout(t.proxy(this.refreshMinutes,this),1e3*(60-(new Date).getSeconds()))},updateFaceType:function(){var e=this.domElement.data("face-type");"undefined"!=typeof e&&this.domElement.removeClass("face-"+e);var t=this.getFaceType();this.domElement.data("face-type",t).addClass("face-"+t)}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Article=e.Widget.registerType("article",{article:{},render:function(){return this.renderWidget("article",t.extend(this.article,this.getRenderData()),{icon:"fa-newspaper-o",anchor:"article-"+this.article.id,url:this.article.url,added:function(){},hasDropdownMenu:!1,canBeCopied:!1}),this.renderStyle(),this.domElement},getRenderData:function(){var e=(this.article.date||"").toString().toMoment();return{isoDate:e.toISOString(),timeAgo:t.timeago(e.toDate())}},renderStyle:function(){function e(e,n,r){var a,o=[];n>=300&&n>=r&&o.push("large"),n>=100&&r>=150&&(o.push("left"),o.push("right")),o.push("no"),o.push("blank"),i.article.style?(t.each(t.makeArray(i.article.style),function(){return t.inArray(this,o)>=0?(a=this,!1):void 0}),a||(a="no")):(o.pop(),a=o[Math.floor(Math.random()*o.length)]);var s=t("<a>").attr("href",i.article.url).addClass("image");switch(e&&s.css("backgroundImage","url("+e+")"),s.addClass(a),i.domElement.addClass("has-"+a+"-image"),a){case"large":s.css("height",r);var d=i.domElement.find(".body .article");break;case"blank":s.css("backgroundImage","");case"right":case"left":d=i.domElement.find("header")}s.insertBefore(d)}var i=this;if(this.article.image_url){var n,r=600,n=t.cloudinary.url(this.article.image_url,{type:"fetch",fetch_format:"auto",crop:"limit",width:r,height:r,format:"auto",effect:"improve",quality:70,page:1}),a=new Image;a.onload=a.onerror=function(){a.width>=50&&a.height>=50?e(n,a.width,a.height):e(null,0,0)},a.src=n}else e(null,0,0)},getCustomSettingsDefaults:function(){return{id:null,url:null,title:null,summary:null,date:null,image_url:null,style:null}},setCustomSettings:function(e){this.article=e}})}(Yourls,jQuery),function(e,i){"use strict";e.Widget.Bio=e.Widget.registerType("bio",{getDescription:function(){return"string"==typeof this.description?this.description:null},setDescription:function(e){this.description=e?i.trim(""+e):null},getImageId:function(){return"string"==typeof this.imageId?this.imageId:null},setImageId:function(e){this.imageId="string"==typeof e?i.trim(e):null},getFacts:function(){return i.isArray(this.facts)?this.facts:[]},getFactsData:function(){return i.map(this.getFacts(),function(e){var t={};return t[e.type]=e.value,t})},setFacts:function(e){this.facts=i.isArray(e)?e:[]},setFactsFromData:function(e){if(i.isArray(e)){var t=[];for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];if(!i.isPlainObject(a))break;for(var o in a)if(a.hasOwnProperty(o)&&n[o]){t.push({type:o,value:a[o]});break}}this.setFacts(t)}},render:function(){return this.getId()||(this.data={title:t("devise.profile"),items:{links:[]}}),this.renderWidget("bio",{},{icon:"fa-user",help:"en-us/articles/212312885-Profile-Bio-"}),this.renderIntro(),this.renderFacts(),this.postpone(function(){this.initAddFact(),this.initEditing()}),this.domElement},getCustomSettingsDefaults:function(){return{d:null,a:null,f:[]}},setCustomSettings:function(e){this.setDescription(e.d),this.setImageId(e.a),this.setFactsFromData(e.f)},getCustomSettings:function(){return{d:this.getDescription(),a:this.getImageId(),f:this.getFactsData()}},renderIntro:function(){var e=this.domElement.find(".body");e.find(".intro").remove();var t=this.getDescription(),n=this.getImageId(),r={width:128,height:128,crop:"fill",gravity:"face",radius:"max"},a=i(JST["widgets/bio/intro"]({description:this.getDescription(),image:n?i.cloudinary.url(n+".jpg",r):!1,bogus:new Array(20)})).prependTo(e);t||n||a.addClass("edit-only"),this.initIntroEditing()},renderFacts:function(){var e=this,t=this.domElement.find(".facts").empty(),r=this.getFacts();i.each(r,function(r,a){var o=n[a.type];if(o){var s=JST["widgets/bio/facts/"+a.type];i.isFunction(s)||(s=JST["widgets/bio/facts/other"]);var d=a.value;o.formatter&&(d=o.formatter(d));var l=i("<li>").addClass("fact").data("index",r).attr("title",o.title).appendTo(t);l.html(s({value:d,title:o.title,icon:o.icon,isM:"M"==d,isF:"F"==d,displayUrl:d.replace(/https?:\/\//,"")})),i("<i>").addClass("delete edit-only fa fa-trash").appendTo(l).click(function(t){e.removeFactByIndex(r)})}}),this.initSorting()},initSorting:function(){if(this.isEditable()){var e=this,t=this.domElement.find(".facts");t.sortable({cursor:"move",distance:15,disabled:!e.isEditing(),update:function(n,r){var a=e.getFacts(),o=[];t.find(".fact").each(function(){var e=i(this).data("index");"undefined"!=typeof e&&a[e]&&o.push(a[e])}),e.setFacts(o),e.renderFacts(),e.saveSettings()}})}},initEditing:function(){var e=this;i(this).on("startEditing.widget",function(){e.initSorting()}),i(this).on("finishEditing.widget",function(){e.initSorting()})},initAddFact:function(){var e=this;this.initInlineAdding({callback:function(t){e.addFact(t),e.renderFacts(),e.saveSettings()}})},addFact:function(e){if(i.isPlainObject(e)||(e=this.extractFacts(e).shift()),!i.isPlainObject(e))return!1;if("string"!=typeof e.type||"undefined"==typeof e.value)return!1;var t=this.getFacts();t.push(e),this.setFacts(t),this.renderFacts(),this.saveSettings()},removeFactByIndex:function(e){var t=this.getFacts();t.splice(e,1),this.setFacts(t),this.renderFacts(),this.saveSettings()},initIntroEditing:function(){var e=this,t=this.domElement.find(".body");t.find(".description").click(function(t){e.isEditing()&&(t.preventDefault(),t.stopPropagation(),e.editDescription())}),t.find(".avatar").click(function(){e.isEditing()&&e.editAvatar()})},editDescription:function(){function e(e){t.setDescription(e.description),t.renderIntro(),t.saveSettings()}var t=this;this.settingsSidebar("bio",{title:I18n.t("description"),template:"edit_description",formdata:{description:this.getDescription()},save:e})},editAvatar:function(){var t=this,i=new e.ImageUploader({preset:"avatar",uploaded:function(e){t.setImageId(e),t.renderIntro(),t.saveSettings()}});i.show()},extractFacts:function(e){if(e=e?i.trim(""+e):"",!e.length)return[];var t=[];return i.each(n,function(i,n){var r=n.extractor(e);"undefined"!=typeof r&&t.push({type:i,value:r})}),t}});var n=function(){function e(e){switch(e.toLowerCase()){case I18n.t("genders.male").toLocaleLowerCase():case"male":return"M";case I18n.t("genders.female").toLocaleLowerCase():case"female":return"F"}}function t(e){return/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(e)?e:void 0}function n(e){var t=/^(https?:\/\/)?(www\.)?facebook.com\/(.+?)(\?.*)?$/i.exec(e);return t?t[3]:void 0}function r(e){var t=/^(https?:\/\/)?(\w+\.)?linkedin.com\/(.+?)?$/i.exec(e);return t?t[3]:void 0}function a(e){var t=/^from:?\s*(.+)$/i.exec(e);return t?t[1]:void 0}function o(e){var t=/^(https?:\/\/)?(www\.)?twitter.com\/([A-Za-z0-9_]+)$/i.exec(e);if(t)return t[3];var t=/^@([A-Za-z0-9_]+)$/.exec(e);return t?t[1]:void 0}function s(e){return/^https?:\/\/.+/.test(e)?e:/^www\.\S{2,}/.test(e)?"http://"+e:void 0}function d(e){var t=["YYYY-MM-DD","DD-MM-YYYY","MM-DD-YYYY","DD-MMM-YYYY","MMM-DD-YYYY","DD-MM-YY","MM-DD-YY","MM-DD-YY"],i=moment(e,t);return i.isValid()?i.startOf("day").toISOString():void 0}function l(e){return moment(e).format("LL")}function c(e){if(/^#\w+(\s*[,;]?\s+#\w+)*$/.test(e)){var t=e.match(/\w+/g);return t=i.map(t,function(e){return e.replace("_"," ")}),t.join(", ")}}function u(e){return e}return{gender:{icon:"fa-male",title:I18n.t("gender"),extractor:e},email:{icon:"fa-envelope",title:I18n.t("email"),extractor:t},facebook:{icon:"fa-facebook",title:"Facebook",extractor:n},twitter:{icon:"fa-twitter",title:"Twitter",extractor:o},linkedin:{icon:"fa-linkedin",title:"LinkedIn",extractor:r},location:{icon:"fa-globe",title:I18n.t("location"),extractor:a},link:{icon:"fa-bookmark",title:I18n.t("link"),extractor:s},date:{icon:"fa-calendar",title:I18n.t("bio.date"),extractor:d,formatter:l},tags:{icon:"fa-tags",title:I18n.t("tags"),extractor:c},other:{icon:"fa-chevron-right",title:I18n.t("miscellaneous"),extractor:u}}}()}(Yourls,jQuery),function(Yourls,$){"use strict";Yourls.Widget.Calculator=Yourls.Widget.registerType("calculator",{render:function(){function e(){return $.map([1,2,3,4,5,6,7,8,9,0],function(e){return{digit:e}})}return this.data=$.extend({title:I18n.t("new_calculator_widget_title")},this.data),this.renderWidget("calculator",{digits:e()},{icon:"fa-calculator",added:function(){}}),this.initCalculator(),this.domElement},initCalculator:function(){function clear(){display.val(""),clearOnNextAppend=!1}function append(e){display.val(display.val()+e),display.focus()}function addOperator(e){body.find(".operator").each(function(){var t=$(this);t.data("operator")==e&&(clearOnNextAppend=!1,append(" "+t.text()+" "))})}function execute(){var expression=display.val();body.find(".operator").each(function(){var e=$(this),t=e.text(),i=e.data("operator"),n=new RegExp("\\"+t,"g");expression=expression.replace(n,i)}),expression=expression.replace(":","/"),expression=expression.replace("x","*"),expression=expression.replace(",","."),expression=expression.replace("/[^0-9.+-*/]","");var answer=Math.NaN;try{answer=eval(expression)}catch(error){}isFinite(answer)||(answer=0),answer=answer.toString().replace(/(\.[0-9]{6}).+/,"$1"),display.val(answer),display.focus(),clearOnNextAppend=!0}var body=this.domElement.find(".body"),display=body.find(".display input"),clearOnNextAppend=!1;body.find("a").click(function(e){e.preventDefault()}),body.find(".digit").click(function(){clearOnNextAppend&&clear();var e=$(this).data("digit");append(e)}),body.find(".operator").click(function(){addOperator($(this).data("operator"))}),body.find(".execute").click(execute),display.enter(execute),body.find(".clear").click(function(){clear()}),display.keypress(function(e){var t=String.fromCharCode(e.charCode);return/[0-9\.*x:,\/+-]/.test(t)?(clearOnNextAppend&&/[0-9]/.test(t)&&clear(),void(clearOnNextAppend=!1)):!1}),display.keydown(function(e){switch(e.keyCode){case 27:clear();break;default:return}e.preventDefault()})}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Calendar=e.Widget.registerType("calendar",e.ProviderMixin,{VIEWMODE:{month:0,agenda:1},AGENDA_LENGTH:"1",REFRESH_INTERVAL:6e5,COLORS:["black","red","green","blue","orange","pink"],render:function(){return this.data=t.extend({title:I18n.t("widgets.calendar.widget_title")},this.data),this.renderWidget("calendar",{},{icon:"fa-calendar",help:"en-us/articles/200154612",added:t.proxy(this.addNewCalendar,this)}),this.postpone(function(){this.setViewMode(this.getDefaultViewMode()),this.initCalendar(),this.initAutoRefresh(),this.initAddCalendar(),this.bindPagination(),this.bindTabs()}),this.domElement},initAutoRefresh:function(){function e(){r.updateView(),i()}function i(){n=setTimeout(e,r.REFRESH_INTERVAL);
}var n,r=this;i(),t(this).on("delete",function(){n&&clearTimeout(n)})},initAddCalendar:function(){this.domElement.find(".add a.new").click(t.proxy(function(e){e.preventDefault(),this.addNewCalendar()},this))},bindEditHandlers:function(){var e=this;this.domElement.find("a.delete").bind("click",function(i){var n=t(this).parent("li").data("type"),r=t(this).parent("li").data("id");switch(n){case"calendar":var a=e.getCalendar(r);t(this).parent("li").remove(),e.removeCalendars([a]);break;case"provider":t(this).parent("ul").remove();var o=e.getProvider(r);e.removeProvider(r,t.proxy(function(){var t=e.listCalendars(o);for(var i in t)t.hasOwnProperty(i)&&this.removeCalendar(t[i].id);e.updateView(!0)},e))}i.preventDefault()}),this.domElement.find("a.edit").bind("click",function(i){var n=t(this).parent("li").data("id"),r=e.getCalendar(n);r&&e.calendarSettingsDialog(r),i.preventDefault()}),this.domElement.find("input.hide-calendar").bind("change",function(){var i=t(this).parent("li").data("id"),n=t(this).is(":checked"),r=e.getCalendar(i);r.hidden=!n,e.saveSettings(t.proxy(e.updateView,e))})},initCalendar:function(){this.updateView(!1);var e=t.proxy(this.setCalendars,this),i=[];for(var n in this.providers)this.providers.hasOwnProperty(n)&&i.push(this.providers[n].listCalendars().then(function(t,i){i!==!1&&e(t,i)}));var r=t.proxy(this.updateView,this);t.when.apply(t,i).done(function(){r()}).fail(function(e,t){})},getCustomSettings:function(){return{calendars:this.calendarsToJson(),providers:this.providersToJson(),defaultViewMode:this.getDefaultViewMode(),weekStart:this.getWeekStart()}},setCustomSettings:function(e){this.providers="undefined"!=typeof e.providers?this.jsonToProviders(e.providers,"calendar",["ical"]):{},this.calendars="undefined"!=typeof e.calendars?this.jsonToCalendars(e.calendars):{},this.setDefaultViewMode(e.defaultViewMode),this.setWeekStart(e.weekStart)},getCustomSettingsDefaults:function(){return{providers:{},calendars:{},defaultViewMode:this.VIEWMODE.month,weekStart:0}},calendarsToJson:function(){var e=[],i=this.listCalendars();for(var n in i)if(i.hasOwnProperty(n)){var r=t.extend({},i[n]);e.push(r)}return e},jsonToCalendars:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=this.getProvider(e[i].provider);n&&(t[e[i].id]=e[i])}return t},getCustomDropdownItems:function(){return[{caption:I18n.t("widgets.calendar.add_calendar"),icon:"fa-calendar-plus-o",classes:"editable-only",action:t.proxy(this.addNewCalendar,this),pinned:!0}]},addNewCalendar:function(){e.sidebar("widgets/calendar/sidebar/add",{title:I18n.t("widgets.calendar.add_calendar"),icon:"fa-calendar",extraClasses:"browser calendar-browser",rendered:t.proxy(this.bindNewCalendarEvents,this)})},bindNewCalendarEvents:function(){var e=t.proxy(this.setupCalendarProvider,this);t("section.calendar-browser").find("a.add").on("click",function(i){i.preventDefault();var n=t(this).data("type");e(n)})},setupCalendarProvider:function(i){switch(i){case"ical":e.sidebar("widgets/calendar/sidebar/ical",{title:I18n.t("widgets.providers.calendar.ical"),icon:"fa-calendar",buttons:[{caption:I18n.t("widgets.calendar.add"),icon:"fa-plus","default":!0,"class":"default",autoclose:!0,action:t.proxy(this.handleIcalSubmit,this)},{caption:"Back",icon:"fa-arrow-left"}]});break;default:var n=e.Provider.create("calendar",i,{id:this.getNewProviderId(),widget:this,authorization:{}});this.addProvider(n),this.saveSettings(function(){window.top.location.href=n.getAuthUrl()})}},handleIcalSubmit:function(i,n){function r(i,r){r.length>0?(u.addCalendar(i),u.finishEditing(),u.saveSettings(t.proxy(u.updateView,u)),n.sidebar("close"),e.showConfirmation(I18n.t("widgets.calendar.connect_success"))):a(I18n.t("widgets.calendar.no_ical_data"))}function a(e){t(n).find("input").removeAttr("disabled"),o.removeClass("disabled"),o.find("i").removeClass("fa-refresh fa-spin").addClass("fa-plus"),n.sidebar("alert",{type:"error",message:e})}if("undefined"==typeof i.title||0==i.title.length)return I18n.t("widgets.calendar.title_empty");if("undefined"==typeof i.url||0==i.url.length)return I18n.t("widgets.calendar.url_empty");if(e.UrlHelper.isValidButWithoutProtocol(i.url)&&(i.url="http://"+i.url),!e.UrlHelper.isValid(i.url))return I18n.t("widgets.calendar.url_invalid");t(n).find("input").attr("disabled","disabled");var o=t(n).find(".buttons a.default");o.addClass("disabled"),o.find("i").removeClass("fa-plus").addClass("fa-refresh fa-spin");var s=this.listProvidersByType("ical").pop();"undefined"==typeof s&&(s=e.Provider.create("calendar","ical",{id:this.getNewProviderId(),widget:this}),this.addProvider(s));var d={id:i.url,title:i.title,url:i.url,provider:s.id},l=moment().subtract(10,"years"),c=moment().add(10,"years"),u=this;return s.getCalendar(d,l,c).then(function(e,t){r(e,t)},function(){a(I18n.t("widgets.calendar.connect_failed"))},function(e,t){r(e,t)}),!1},bindPagination:function(){var e=this;this.domElement.find(".next").bind("click",function(t){t.preventDefault(),e.next()}),this.domElement.find(".prev").bind("click",function(t){t.preventDefault(),e.previous()})},bindTabs:function(){var t=this;this.domElement.find(".month-view").bind("click",function(i){i.preventDefault(),t.setViewMode(t.VIEWMODE.month),t.setCurrentDate(e.Util.toMoment()),t.updateView()}),this.domElement.find(".agenda-view").bind("click",function(i){i.preventDefault(),t.setViewMode(t.VIEWMODE.agenda),t.setCurrentDate(e.Util.toMoment()),t.updateView()})},bindDayClick:function(){var i=this;this.domElement.find(".cell").bind("click",function(n){n.preventDefault(),i.setViewMode(i.VIEWMODE.agenda);var r=e.Util.toMoment(t(this).data("date")).startOf("day");i.setCurrentDate(r),i.updateView()})},bindEventClick:function(){this.domElement.find("div.event").bind("click",function(e){t(e.target).hasClass("details_link")||(e.preventDefault(),t(this).find("p.summary > a > i").toggleClass("fa-caret-up"),t(this).find("div.extended-info").slideToggle(100))}),this.domElement.find("a.details_link").bind("click",function(i){e.UrlHelper.openUrl(t(this).attr("href"),i)})},bindLoadMoreClick:function(){var i=this;this.domElement.find("a.load-more").bind("click",function(n){n.preventDefault();var r=e.Util.toMoment(i.getCurrentDateEnd()),a=e.Util.toMoment(r).add(i.AGENDA_LENGTH,"months").endOf("day");i.loadEvents(r,a,t.proxy(i.renderAgendaEvents,i),!1)})},updateView:function(e){"boolean"!=typeof e&&(e=!0),this.setLoading(e===!0);var i=this.domElement.find(".calendar-body");i.removeClass("month agenda");var n=this.getCurrentDate();this.domElement.find(".buttons a").removeClass("active"),this.clearStore();var r=this;switch(this.getViewMode()){case this.VIEWMODE.month:i.addClass("month"),this.domElement.find(".back").addClass("disabled"),this.domElement.find(".buttons a.month-view").addClass("active"),this.renderMonth(n.year(),n.month(),e,function(e,t){r.bindDayClick()});break;case this.VIEWMODE.agenda:i.addClass("agenda"),this.domElement.find(".back").removeClass("disabled"),this.domElement.find(".buttons a.agenda-view").addClass("active"),this.renderAgenda(n.year(),n.month(),n.date(),e,function(e,t,i){})}var a=this.domElement.find("div.calendar-list");a.html("");var o=this.listProviders();for(var s in o)if(o.hasOwnProperty(s)){var d={id:o[s].id,parent:!1};"ical"!=o[s].getType()&&(d.title=o[s].getNiceName(),d.icon=o[s].getIcon(),d.parent=!0,d.email=o[s].getIdentifier());var l=this.listCalendars(o[s]);if(l.length>0){var c=t(JST["widgets/calendar/provider"](d));a.append(c);for(var u in l)if(l.hasOwnProperty(u)){var h={id:l[u].id,title:l[u].title,hidden:l[u].hidden,color:l[u].color,deletable:"ical"==o[s].type,hasParent:d.parent},f=t(JST["widgets/calendar/calendar"](h));c.append(f)}}}this.bindEditHandlers()},next:function(){var e=this.getCurrentDate();switch(this.getViewMode()){case this.VIEWMODE.month:e.add(1,"months");break;case this.VIEWMODE.agenda:e.add(1,"days")}this.setCurrentDate(e),this.updateView()},previous:function(){var e=this.getCurrentDate();switch(this.getViewMode()){case this.VIEWMODE.month:e.subtract(1,"month");break;case this.VIEWMODE.agenda:e.subtract(1,"day")}this.setCurrentDate(e),this.updateView()},renderMonth:function(i,n,r,a){"number"!=typeof i&&(i=e.Util.toMoment().year()),("number"!=typeof n||0>n||n>11)&&(n=e.Util.toMoment().month()),"boolean"!=typeof r&&(r=!0);var o=this.domElement.find(".calendar-body");o.html("");var s=e.Util.toMoment({year:i,month:n,day:1}).startOf("day"),d=s.format("MMMM")+" ("+s.format("YYYY")+")";this.domElement.find("span.title").html(d);for(var l=t(JST["widgets/calendar/month/row"]()),c=this.getWeekStart(),u=c;c+7>u;u++){var h=t(JST["widgets/calendar/month/heading"]({heading:I18n.t("date.abbr_day_names")[u%7]}));l.append(h)}o.append(l);var f=e.Util.toMoment({year:i,month:n,day:1}).startOf("day").subtract(s.day(),"days");c>s.day()?f.subtract(7-c,"days"):f.add(c,"days");for(var g=e.Util.toMoment(f),p=0;6>p;p++){for(var m=t(JST["widgets/calendar/month/row"]({row:p})),v=0;7>v;v++){var y=t(JST["widgets/calendar/month/cell"]({title:f.date(),date:f.format("YYYY-MM-DD"),localeDate:f.format("LL"),day:f.format("D"),weekday:f.format("d"),disabled:f.month()!=s.month(),today:f.isSame(e.Util.toMoment(),"day")}));m.append(y),f.add(1,"days")}o.append(m)}r&&this.loadEvents(g,f,t.proxy(this.renderMonthEvents,this)),"undefined"!=typeof a&&a(i,n)},renderAgenda:function(i,n,r,a,o){"number"!=typeof i&&(i=e.Util.toMoment().year()),("number"!=typeof n||0>n||n>11)&&(n=e.Util.toMoment().month()),("number"!=typeof r||1>r||r>31)&&(r=e.Util.toMoment().date()),"boolean"!=typeof a&&(a=!0);var s=this.domElement.find(".calendar-body");s.html("");var d=e.Util.toMoment({year:i,month:n,day:r}).startOf("day");this.domElement.find("span.title").html(d.format("LL"));var l=JST["widgets/calendar/agenda/wrapper"]();s.append(l),a&&this.loadEvents(d,e.Util.toMoment(d).add(this.AGENDA_LENGTH,"months").endOf("day"),t.proxy(this.renderAgendaEvents,this)),t.isFunction(o)&&o(i,n,r)},loadEvents:function(e,i,n,r){function a(){d||n(s.getEvents())}function o(e,t){e&&!d&&s.storeEvents(e,t),a()}"undefined"==typeof r&&(r=!0),this.setCurrentDateEnd(i);var s=this,d=!1;this.loadEventsPromise&&this.loadEventsPromise.reject();var l=this.loadEventsPromise=t.Deferred();l.fail(function(){d=!0}),s.setLoading(!0),l.always(function(){s.setLoading(!1)});var c=[];for(var u in this.calendars)if(this.calendars.hasOwnProperty(u)){var h=this.calendars[u];if(!h.hidden)try{var f=this.getProvider(h.provider),g=f.getCalendar(h,e,i);c.push(g),r&&g.progress(function(e,t){o(t,r)}),g.then(function(e,t){o(t,r)}).fail(function(e,t,i){s.handleError(t,i)})}catch(p){s.handleError(p)}}return t.when.apply(void 0,c).done(l.resolve.bind(l)),l.promise()},handleError:function(){e.Logger.error.apply(e.Logger,arguments)},renderMonthEvents:function(e){this.domElement.find("div.cell ul").html("");for(var t in e)if(e.hasOwnProperty(t)){var i="date_"+e[t].start.format("YYYY-MM-DD"),n=this.domElement.find("div.cell."+i),r=n.find("ul li").length;if(5==r){var a=parseInt(n.find("p.more-events").find("span.count").html())||0,o=++a;n.find("p.more-events").show().html(I18n.t("widgets.calendar.more_events",{count:'<span class="count">'+o+"</span>"}))}else{var s=JST["widgets/calendar/month/event"]({summary:e[t].summary,allDay:e[t].allDay,startTime:e[t].start.format("HH:mm"),endTime:e[t].end.format("HH:mm"),description:e[t].description,color:e[t].calendar.color});n.find("ul").append(s)}}},renderAgendaEvents:function(t){this.domElement.find("div.agenda-wrapper").html("");var i=void 0,n=void 0,r=0;for(var a in t){if(t.hasOwnProperty(a)){"undefined"!=typeof i&&t[a].start.isSame(i.start,"day")||(n=JST["widgets/calendar/agenda/day"]({date:t[a].start.format("YYYY-MM-DD"),title:t[a].start.format("dddd")+" ("+t[a].start.format("LL")+")",today:t[a].start.isSame(e.Util.toMoment(),"day"),empty:!1}),this.domElement.find("div.agenda-wrapper").append(n));var o=JST["widgets/calendar/agenda/event"]({summary:t[a].summary,allDay:t[a].allDay,startTime:t[a].start.format("HH:mm"),endTime:t[a].end.format("HH:mm"),location:t[a].location,description:t[a].description,color:t[a].calendar.color,href:t[a].href,hasDetails:t[a].end||t[a].href||t[a].description||t[a].location}),s="date_"+t[a].start.format("YYYY-MM-DD");this.domElement.find("div."+s+" div.events").append(o),i=t[a]}++r}("undefined"==typeof n||"undefined"!=typeof t[0]&&!t[0].start.isSame(this.getCurrentDate(),"day"))&&(n=JST["widgets/calendar/agenda/day"]({date:this.getCurrentDate().format("YYYY-MM-DD"),title:this.getCurrentDate().format("dddd")+" ("+this.getCurrentDate().format("LL")+")",today:this.getCurrentDate().isSame(e.Util.toMoment(),"day"),empty:!0}),this.domElement.find("div.agenda-wrapper").prepend(n));var d=JST["widgets/calendar/agenda/time_span"]({span:I18n.t("widgets.calendar.show_until",{date:this.getCurrentDateEnd().format("LL")})});this.domElement.find("div.agenda-wrapper").append(d),this.bindLoadMoreClick(),this.bindEventClick()},storeEvents:function(e,t){"undefined"==typeof t&&(t=!0);var i="undefined"!=typeof this.events?this.events:{};if("undefined"!=typeof e&&e.length>0){var n=e[0];if(i.hasOwnProperty(n.calendar.id)){var r=i[n.calendar.id],a={},o={},s=0;for(var d in r)r.hasOwnProperty(d)&&(t&&(o[r[d].id]=r[d]),a[r[d].id]=s,++s);for(var l in e)e.hasOwnProperty(l)&&(a.hasOwnProperty(e[l].id)?(delete o[e[l].id],r[a[e[l].id]]=e[l]):r.push(e[l]));var c=[];for(var u in r)r.hasOwnProperty(u)&&(o.hasOwnProperty(r[u].id)||c.push(r[u]));i[n.calendar.id]=c}else i[n.calendar.id]=e}return this.events=i,this.getEvents()},getEvents:function(){var e=[],t=this.events||{};for(var i in t)t.hasOwnProperty(i)&&(e=e.concat(t[i]));return this.sort(e)},clearStore:function(){this.events={}},sort:function(e){return e.sort(function(e,t){var i=e.start.compare(t.start);return 0==i?e.summary.toLocaleLowerCase().localeCompare(t.summary.toLocaleLowerCase()):i})},getDefaultViewMode:function(){return"number"==typeof this.defaultViewMode?this.defaultViewMode:this.VIEWMODE.month},setDefaultViewMode:function(e){this.defaultViewMode=parseInt(e),isNaN(this.defaultViewMode)&&(this.defaultViewMode=this.VIEWMODE.month)},getViewMode:function(){return"number"==typeof this.viewMode?this.viewMode:this.VIEWMODE.month},setViewMode:function(e){this.viewMode=parseInt(e),isNaN(this.viewMode)&&(this.viewMode=this.VIEWMODE.month)},getWeekStart:function(){return"number"==typeof this.weekStart?this.weekStart:0},setWeekStart:function(e){this.weekStart=parseInt(e),isNaN(this.weekStart)&&(this.weekStart=0)},getCurrentDate:function(){return moment.isMoment(this.currentDate)?this.currentDate:e.Util.toMoment()},setCurrentDate:function(t){moment.isMoment||(t=e.Util.toMoment(t)),this.currentDate=t},getCurrentDateEnd:function(){return moment.isMoment(this.currentDateEnd)?this.currentDateEnd:e.Util.toMoment()},setCurrentDateEnd:function(t){moment.isMoment||(t=e.Util.toMoment(t)),this.currentDateEnd=t},addCalendar:function(e){return this.calendars||(this.calendars={}),this.calendars.hasOwnProperty(e.id)?!1:("undefined"==typeof e.color&&(e.color=this.getFreeColor()),this.calendars[e.id]=e,!0)},setCalendar:function(e){return this.calendars.hasOwnProperty(e.id)?(this.calendars[e.id]=e,e):!1},setCalendars:function(e,i){var n=0;if(i.length>0)for(var r in i)i.hasOwnProperty(r)&&this.addCalendar(i[r])&&n++;var a=this.listCalendars(e);for(var o in a)if(a.hasOwnProperty(o)){var s=a[o].id,d=void 0;for(var l in i)i.hasOwnProperty(l)&&i[l].id==s&&(d=i[l]);"undefined"==typeof d&&(n++,this.removeCalendar(s))}n>0&&this.saveSettings(t.proxy(this.updateView,this))},getCalendar:function(e){return this.calendars[e]?this.calendars[e]:!1},listCalendars:function(e){var t=[];for(var i in this.calendars)if(this.calendars.hasOwnProperty(i)){var n=this.calendars[i];"undefined"!=typeof e?n.provider==e.id&&t.push(n):t.push(n)}return t},removeCalendar:function(e){"undefined"!=typeof this.calendars[e]&&delete this.calendars[e]},removeCalendars:function(e){if(e.length>0){for(var i in e)e.hasOwnProperty(i)&&this.removeCalendar(e[i].id);this.saveSettings(t.proxy(this.updateView,this))}},getFreeColor:function(){var e=[];for(var t in this.COLORS)this.COLORS.hasOwnProperty(t)&&(e[t]={color:this.COLORS[t],count:0});for(var i in this.calendars)if(this.calendars.hasOwnProperty(i)){var n=this.calendars[i],r="undefined"!=typeof n.color?n.color:this.COLORS[0];e[this.COLORS.indexOf(r)].count++}return e.sort(function(e,t){return e.count==t.count?0:e.count<t.count?-1:1}),e[0].color},calendarSettingsDialog:function(e){function i(i){e.title=i.title,e.color=n.COLORS[i.color],n.saveSettings(t.proxy(n.updateView,n))}var n=this;this.settingsSidebar("calendar",{title:I18n.t("widgets.calendar.calendar_settings"),template:"calendar_settings",formdata:{title:e.title,color:this.COLORS.indexOf(e.color)},save:i})},getSettingsConfig:function(){var e=this;return{changed:function(){e.updateView()}}}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Chart=e.Widget.registerType("chart",{SOURCETYPE:{manual:1,csv:2},CHARTTYPE:{area:"area",line:"line",bar:"bar",column:"column",pie:"pie",geo:"geo"},HEIGHT:{small:180,medium:240,large:360,xl:480},getChartType:function(){return this.chartType||this.CHARTTYPE.area},setChartType:function(e){this.chartType=t.trim(e).toLowerCase(),t.inArray(this.chartType,t.values(this.CHARTTYPE))<0&&(this.chartType=this.CHARTTYPE.area)},getChartHeight:function(){return parseInt(this.chartHeight)||this.CHARTTYPE.small},setChartHeight:function(e){this.chartHeight=parseInt(e),t.inArray(this.chartHeight,t.values(this.HEIGHT))<0&&(this.chartHeight=this.HEIGHT.medium)},getShowLegend:function(){return"showLegend"in this?!!this.showLegend:!1},setShowLegend:function(e){this.showLegend="undefined"==typeof e?!1:!!e},isBorderLess:function(){return!!this.borderLess},setBorderLess:function(e){this.borderLess=!!e},getSourceType:function(){return parseInt(this.sourceType)||this.SOURCETYPE.manual},setSourceType:function(e){this.sourceType=parseInt(e),t.inArray(this.sourceType,t.values(this.SOURCETYPE))<0&&(this.sourceType=this.SOURCETYPE.manual)},getSourceUrl:function(){return this.sourceUrl||void 0},setSourceUrl:function(e){this.sourceUrl=t.trim(e)||void 0,this.sourceUrl&&(this.sourceUrl=t.crel("a",{href:this.sourceUrl}).href)},render:function(){this.data=t.extend({title:I18n.t("widgets.chart.widget_title")},this.data),this.renderWidget("chart",{},{icon:"fa-bar-chart",help:"en-us/articles/211469649",added:t.proxy(this.showSettings,this,"data")});var e=this;return this.renderChart(!0,!0).then(function(t){t&&e.postpone(function(){e.renderChart(!1,!1)})}),this.domElement},getCustomDropdownItems:function(){var e=[];return e.push({caption:I18n.t("refresh"),icon:"fa-refresh",action:this.refresh.bind(this)}),e},refresh:function(){this.renderChart(!1,!0)},renderChart:function(i,n){var r=this,a=t.Deferred();this.domElement.attr("data-chart",this.getChartType());var o=this.domElement.find(".body");o.toggleClass("no-padding",this.isBorderLess());var s=o.find("div.legend-container"),d=o.find("div.chart-container"),l=o.find(".loader");return s.toggle(r.getShowLegend()),d.css("height",r.getChartHeight()),l.css({height:r.getChartHeight()+s.outerHeight()}),this.getSourceType()==this.SOURCETYPE.manual&&(i=!1),this.getData(!!i).then(function(i,o){return a.resolve(o),i.getRowCount()>0?e.ChartRenderer.render(d,i,e.ChartRenderer.CHART_TYPES[r.getChartType()],{height:r.getChartHeight(),legendContainer:s,animate:!!n,hAxis:{textPosition:r.isBorderLess()?"in":"out"}}):t.Deferred().reject().promise()}).fail(function(e){s.hide(),d.empty(),t.crel(d[0],"i","no-chart","fa","fa-ban",{title:e||""}),a.reject()}),a.promise()},getSettingsConfig:function(){function e(e){a(e),o(e),d(e)}function i(e){a(e),l.renderChart(!0)}function n(){var e=[];return t.each(l.CHARTTYPE,function(t,i){e.push({name:I18n.t(t,{scope:"widgets.chart.chart_types"}),type:i})}),e}function r(){var e=[];return t.each(l.HEIGHT,function(t,i){e.push({name:I18n.t(t,{scope:"size"}),height:i})}),e}function a(e){var i=e.find("div.source-url"),n=e.find("div.manual-data"),r=e.find("div.legend"),a=l.getSourceType(),o=l.getChartType();i.toggle(a!=l.SOURCETYPE.manual),n.toggle(a==l.SOURCETYPE.manual),r.toggle(t.inArray(o,[l.CHARTTYPE.pie,l.CHARTTYPE.geo])<0)}function o(e){var i=e.find("div.manual-data table"),n=i.children("tbody").empty(),r=l.getManualData();r.eachRow(function(i){var r,i=t.crel(n[0],"tr",t.crel("td",{},i[0].toString()),t.crel("td",{},i[1].toString()),t.crel("td",{},r=t.crel("i","remove","fa","fa-times")));t(r).click(function(){i.parentNode.removeChild(i),s(e)})})}function s(e){var i=l.getManualData();i.clear();var n=e.find("div.manual-data table"),r=n.children("tbody");r.find("tr").each(function(){var e=t(this),n=e.find("td"),r=n[0].innerText,a=n[1].innerText;i.addRow(r,a)}),e.sidebar("markChanged")}function d(e){function i(){var i=t.trim(a.val()),n=parseFloat(s.val());if(!isNaN(n)){var r=l.getManualData();r.addRow(i,n),o(e),a.val("").focus(),s.val(""),e.sidebar("markChanged")}}var n=e.find("div.manual-data table tfoot"),r=n.find("i.add"),a=n.find("input[name=label]"),s=n.find("input[name=value]");r.click(i.bind(this)),s.keydown(function(e){13==e.which&&(e.preventDefault(),e.stopPropagation(),i())})}var l=this;return{templateValues:{chartTypeOptions:n(),heightOptions:r()},rendered:e,changed:i}},getCustomSettingsDefaults:function(){return{c:this.CHARTTYPE.area,h:this.HEIGHT.medium,l:!1,b:!0,t:this.SOURCETYPE.manual,u:void 0,d:null}},getCustomSettings:function(){return{c:this.getChartType(),h:this.getChartHeight(),l:this.getShowLegend()?1:0,b:this.isBorderLess()?1:0,t:this.getSourceType(),u:this.getSourceUrl(),d:this.getManualData().toArray()}},setCustomSettings:function(e){this.setChartType(e.c),this.setChartHeight(e.h),this.setShowLegend(e.l),this.setBorderLess(e.b),this.setSourceType(e.t),this.setSourceUrl(e.u),this.setManualDataFromArray(e.d)},getDataCacheKey:function(){return[this.getSourceType(),this.getSourceUrl()].join("-")},getCachedData:function(){var i=t.Deferred();try{var n=this.getCache(this.getDataCacheKey());if(!n)return i.reject();var r=e.ChartData.fromArray(n);r?i.resolve(r):i.reject()}catch(a){i.reject(a)}finally{return i.promise()}},clearCachedData:function(){this.setCache(this.getDataCacheKey(),null)},retrieveData:function(){var e=this,i=t.Deferred();switch(this.setLoading(!0),this.getSourceType()){case this.SOURCETYPE.manual:var n=this.getManualData();n?i.resolve(n):i.reject();break;case this.SOURCETYPE.csv:this.getCSVData().then(i.resolve.bind(i)).fail(i.reject.bind(i))}return i.always(function(){e.setLoading(!1)}),i.promise()},getData:function(e){function i(){n.retrieveData().then(function(e){n.setCache(n.getDataCacheKey(),e.toArray()),r.resolve(e,!1)}).fail(function(){n.clearCachedData(),r.reject()})}if(this.isPreview())return this.getPreviewData();var n=this,r=t.Deferred();return e?this.getCachedData().then(function(e){r.resolve(e,!0)}).fail(i):i(),r.promise()},getPreviewData:function(){var i=t.Deferred();return i.resolve(new e.ChartData([1,2,3,4,5],[10,25,30,20,35])),i.promise()},getManualData:function(){return this.manualData=this.manualData||function(){return this.manualData=new e.ChartData(2)}.bind(this)(),this.manualData.getLabelsSeries().name=I18n.t("widgets.chart.label"),this.manualData.getDataSeries(0).name=I18n.t("widgets.chart.value"),this.manualData},setManualDataFromArray:function(t){try{this.manualData=e.ChartData.fromArray(t)}catch(i){e.Logger.error(i),delete this.manualData}},getCSVData:function(){var i=t.Deferred(),n=this.getSourceUrl();if(!n)return i.reject();var r=e.UrlHelper.proxyUrl(n);return t.ajax(r,{dataType:"text",error:function(){return!0}}).then(function(t){try{var n=e.ChartData.fromCSV(t,{maxRows:250,maxCols:4});n?i.resolve(n):i.reject()}catch(r){i.reject(r)}}).fail(i.reject.bind(i)),i.promise()}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.CurrencyConverter=e.Widget.registerType("currency_converter",{SUPPORTED_CURRENCIES:{},render:function(){var i=this;return this.renderWidget("currency_converter",{},{help:"en-us/articles/211522929-Currency-converter",added:function(){i.finishEditing()}}),this.postpone(function(){this.fetchAvailableCurrencies().then(function(){i.renderCurrencySelect("from"),i.renderCurrencySelect("to"),i.domElement.find(".from-to-switch").click(t.proxy(i.switchFromToCurrenciesHandler,i)),i.domElement.find("input.from-amount").on("input",t.proxy(i.refresh,i)),i.domElement.find(".disclaimer").click(function(){e.UrlHelper.openUrl(i.getHelpUrl())}),i.isPreview()&&i.refresh()}).fail(function(){i.setError(!0)})}),this.domElement},fetchAvailableCurrencies:function(){var e=this;return t.ajax("/currency/list",{cache:!0,dataType:"json",global:!1}).then(function(t){e.SUPPORTED_CURRENCIES=t.currencies})},refresh:function(){function e(e){var i=isNaN(e)?"":Number(e).toLocaleString(I18n.locale);t.domElement.find("div.to-amount").html(i)}var t=this,i=this.getFromCurrency(),n=this.getToCurrency();return this.isPreview()&&!this.getFromAmount()&&this.domElement.find("input.from-amount").val(1),this.getFromAmount()&&"null"!=i&&"null"!=n?i===n?e(this.getFromAmount()):void this.fetchExchangeRate(i,n).then(function(i){!i.hasOwnProperty("Error")&&i.hasOwnProperty("rate")&&e(parseFloat(i.rate)*parseFloat(t.getFromAmount()))}).fail(function(){t.setError(!0)}):e(NaN)},renderCurrencySelect:function(e){var i=this.domElement.find("div."+e+"-container"),n="from"===e?this.getFromCurrency():this.getToCurrency(),r=t.crel(i,"select",e);return this.getCurrencyOptions().forEach(function(e){var i={value:e.currency};n===e.currency&&(i.selected="selected"),t.crel(r,"option",{},i,e.name)}),r.onchange=t.proxy(this.refresh,this),this},getCurrencyOptions:function(){var e=this,i=["USD","EUR","GBP","JPY"],n={},r=[];return Object.keys(e.SUPPORTED_CURRENCIES).forEach(function(a){var o={currency:a,name:e.SUPPORTED_CURRENCIES[a]};t.inArray(a,i)>=0?n[a]=o:r.push(o)}),r.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),r.unshift({currency:null,name:"\u2500".repeat(10)}),i.reverse().forEach(function(e){n.hasOwnProperty(e)&&r.unshift(n[e])}),r},switchFromToCurrenciesHandler:function(){var e=this.getFromCurrency(),t=this.getToCurrency();this.updateSelectedCurrency("from",t),this.updateSelectedCurrency("to",e),this.refresh()},updateSelectedCurrency:function(e,t){this.domElement.find("select."+e).val(t)},fetchExchangeRate:function(e,i){var n="/currency/get?from_currency="+e+"&to_currency="+i;return t.ajax(n,{cache:!0,dataType:"json",global:!1})},setFromCurrency:function(e){this.from_currency=e},getFromCurrency:function(){var e=this.domElement.find("select.from");return e&&e.length>0?e.val():this.from_currency},setToCurrency:function(e){this.to_currency=e},getToCurrency:function(){var e=this.domElement.find("select.to");return e&&e.length>0?e.val():this.to_currency},getFromAmount:function(){return this.parseLocaleFloat(this.domElement.find("input.from-amount")[0].value)||NaN},parseLocaleFloat:function(e){var i=Number(1.2).toLocaleString(I18n.locale),n=".",r=/1(.)2/.exec(i);r&&(n=r[1]);var a=new RegExp("[^-0-9"+n+"]+","g");return e=t.trim(e).replace(a,""),e=e.replace(new RegExp("\\"+n,"g"),"."),parseFloat(e)},getCustomSettingsDefaults:function(){return{f:"USD",t:"EUR"}},setCustomSettings:function(e){this.setFromCurrency(e.f),this.setToCurrency(e.t)},getCustomSettings:function(){return{f:this.getFromCurrency(),t:this.getToCurrency()}},getSettingsConfig:function(){var e=this;return{templateValues:{currencyOptions:this.getCurrencyOptions().filter(function(e){return null!==e.currency})},changed:function(){this.updateSelectedCurrency("from",this.from_currency),this.updateSelectedCurrency("to",this.to_currency),e.refresh()}}},setError:function(e){e="undefined"==typeof e?!0:1==e,this.domElement.toggleClass("error",e);var i=this.domElement.find("div.error-only"),n=t("<p></p>").append(document.createTextNode(I18n.t("widget_error_explanation")));i.html(n)}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Email=e.Widget.registerType("email",e.ProviderMixin,{FILTER_MODE:{inbox:1,unread:2},ITEM_MODE:{minimal:1,compact:2,detailed:3},REFRESH_INTERVAL:3e5,render:function(){return this.data=t.extend({title:I18n.t("widgets.email.widget_title")},this.data),this.renderWidget("email",{pagination:1},{icon:"fa-envelope",subnav:{autohide:!0,items:t.proxy(this.getSubnavItems,this)},help:"en-us/articles/200162661",added:t.proxy(this.addNewProvider,this)}),this.postpone(function(){this.isEditable()&&this.checkMigration(),this.initAddProvider(),this.initPagination(),this.initSubtitleDropdown(),this.initAutoRefresh(),this.refresh()}),this.domElement},checkMigration:function(){var i=this.getAuthorization(),n=this;if(i&&("undefined"==typeof i.provider_id||!i.provider_id)){var r=e.Provider.create("email","google",{id:this.getNewProviderId(),authorization:i});i.provider_id=r.id,t.ajax({url:"/widget/"+this.getId()+"/auth",type:"PUT",async:!1,data:{access_token:i.access_token,provider_id:r.id},success:function(){n.addProvider(r),n.saveSettings(t.proxy(n.refresh,n))}})}},initSubtitleDropdown:function(){this.domElement.find("div.subtitle").bind("click",function(e){e.preventDefault(),e.stopPropagation(),t(this).closest("header").find("li.dropdown").trigger("click")})},renderProviders:function(){var e=this.listProviders(),t=this.domElement.find("ul.provider-list");t.html("");for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=JST["widgets/email/provider"]({id:n.id,identifier:this.getValueForProvider("title",n,n.getIdentifier()),title:n.getNiceName(),icon:n.getIcon()});t.append(r)}this.bindProviderEvents()},bindProviderEvents:function(){var e=this;this.domElement.find("a.delete").on("click",function(i){i.preventDefault();var n=t(this).closest("li").data("id");e.removeProvider(n,t.proxy(function(){var t=e.getCurrentProvider();t?e.switchProvider(t):(this.clearMessages(),this.setCurrentPage(0),this.setCurrentLabel(void 0),this.refresh())},e))}),this.domElement.find("a.edit-provider").on("click",function(i){i.preventDefault();var n=t(this).closest("li").attr("data-id"),r=e.getProvider(n);if(r){var a=t.proxy(e.providerSettingsDialog,e);a(r)}})},initAddProvider:function(){this.domElement.find("div.add a.new").bind("click",t.proxy(this.addNewProvider,this))},refresh:function(){this.updateSubtitle(),this.renderProviders(),this.renderSubnav(),this.loadMessages()},updateSubtitle:function(){var e=this.getCurrentProvider();e?(this.setSubtitle(this.getValueForProvider("title",e,e.getIdentifier())),this.setSubtitleIcon(e.getIcon())):(this.setSubtitle(""),this.setSubtitleIcon(""))},loadMessages:function(e,i){var n=this,r=this.getCurrentLabel();this.setLoading(!0),e=e||0,i=i||1e3,this.clearMessages(),this.setError(!1),this.renderMessages();var a=this.getCurrentProvider();a?a.listEmail(r).then(function(e,t){var i=n.getCurrentProvider();if(i&&i.id==a.id){var o=n.getCurrentLabel();o&&o.id==r.id&&(n.storeMessages(t),n.renderMessages())}n.setLoading(!1)},function(r,a){if(n.setLoading(!1),n.setError(!0),3>e){i=4*i,e++;var o=t.proxy(n.loadMessages,n,e,i);window.setTimeout(o,i)}else Bugsnag.notify("EmailWidgetLoadingError",a,{provider:{id:r.id,type:r.type}})},function(e,t){t=t?t:[],n.storeMessages(t),n.renderMessages(t)}):(n.setLoading(!1),n.storeMessages([]),n.renderMessages())},renderMessages:function(){var e=this.getMessages(),i=this.getCurrentPage(),n=this.getPageSize();e=e.slice(i*n,(i+1)*n);for(var r=this.domElement.find("ul.message-list"),a=r.find("li.message"),o=e.length,s=0;o>s;++s){var d=e[s];if(moment.isMoment(d.date)){var l=(d.date||"").toString().toMoment();d.dateago=t.timeago(l.toDate()),d.isodate=l.toISOString(),d.date_title=l.format("L")+" "+l.format("LT")}else d.dateago=I18n.t("widgets.email.date_unknown"),d.isodate=0,d.date_title="";d.url=this.getCurrentProvider().getUrlForMessage(d,this.getCurrentLabel());var c=JST["widgets/email/message"](d);t(c).appendTo(r)}a.remove();var u=this.getItemMode();t.each(this.ITEM_MODE,function(e,t){r.toggleClass("item-mode-"+t,t==u)}),this.domElement.find(".no-messages").toggle(!o),this.checkPagination(),this.initClickLink()},setError:function(e){e="undefined"==typeof e?!0:1==e,this.domElement.toggleClass("error",e)},setCurrentLabel:function(e){this.currentLabel=e},getCurrentLabel:function(){if("undefined"!=typeof this.currentLabel)return this.currentLabel;var e=!1,t=this.getCurrentProvider();if(t){var i=t.listEmailLabels();"undefined"!=typeof i&&(e=i[0])}return e},storeMessages:function(e){this.messages=e},clearMessages:function(){this.messages=[]},getMessages:function(){return"undefined"!=typeof this.messages?this.messages:[]},getSubnavItems:function(){var e=this.getCurrentProvider();if(!e)return[];var i=e.listEmailLabels(),n=[],r=this.getCurrentLabel();for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];o.hidden||n.push({caption:o.title,
action:t.proxy(this.labelClicked,this,o),active:"undefined"!=typeof r&&o.id==r.id})}return n},labelClicked:function(e){this.setCurrentLabel(e),this.setCurrentPage(0),this.renderSubnav(),this.loadMessages(e)},addNewProvider:function(){var i=[{name:"google",icon:"fa-google",settings:!1},{name:"windowslive",icon:"fa-windows",settings:!1},{name:"yahoo",icon:"fa-yahoo",settings:!0},{name:"aol",icon:"fa-envelope",settings:!0},{name:"mailru",icon:"fa-envelope",settings:!0},{name:"yandex",icon:"fa-envelope",settings:!0},{name:"zoho",icon:"fa-envelope",settings:!0},{name:"custom_imap",icon:"fa-envelope",settings:!1}];t.each(i,function(){this.caption=I18n.t(this.name,{scope:"widgets.providers.email"}),this.summary=I18n.t("connect_"+this.name,{scope:"widgets.providers.email"})}),e.sidebar("widgets/email/sidebar/add",{title:I18n.t("widgets.email.add_provider"),values:{providers:i},icon:"fa-envelope",extraClasses:"browser email-browser",rendered:t.proxy(this.bindNewProviderEvents,this)})},bindNewProviderEvents:function(){var e=t.proxy(this.setupEmailProvider,this);t("section.email-browser").find("a.add").on("click",function(i){i.preventDefault();var n=t(this).data("type");e(n)})},setupEmailProvider:function(i){var n="fa-envelope";switch(i){case"yahoo":n="fa-yahoo"}switch(i){case"google":case"windowslive":var r=e.Provider.create("email",i,{id:this.getNewProviderId(),widget:this,authorization:{}});this.addProvider(r),this.saveSettings(function(){window.top.location.href=r.getAuthUrl()});break;default:if("custom_imap"==i){var r=e.Provider.create("email",i,{id:this.getNewProviderId(),authorization:{}});this.addProvider(r)}else r=e.Provider.create("email",i,{});var a="custom_imap"==i?"widgets/email/sidebar/custom_imap":"widgets/email/sidebar/imap";e.sidebar(a,{title:I18n.t("widgets.providers.email."+i),icon:n,buttons:[{caption:I18n.t("widgets.email.connect"),icon:"fa-plus","default":!0,"class":"default",autoclose:!0,action:t.proxy(this.handleProviderSubmit,this,i)},{caption:"Back",icon:"fa-arrow-left"}],formdata:{use_ssl:1,port:993},values:{placeholder_email_address:r.getPlaceholderEmailAddress()}})}},handleProviderSubmit:function(i,n,r){if("undefined"==typeof n.username||0==n.username.length)return I18n.t("widgets.email.username_empty");if("undefined"==typeof n.password||0==n.password.length)return I18n.t("widgets.email.password_empty");var a=this.getNewProviderId();n.provider="cio_"+i,n.provider_id=a,t(r).find("input").attr("disabled","disabled");var o=t(r).find(".buttons a.default");o.addClass("disabled"),o.find("i").removeClass("fa-plus").addClass("fa-refresh fa-spin");var s=this;return t.ajax({url:"/widget/"+this.id+"/email",type:"post",data:n,dataType:"json"}).done(function(t){var n=e.Provider.create("email",i,{id:a,widget:s,authorization:t.authorization});s.addProvider(n),s.saveSettings(function(){window.location.reload()})}).fail(function(e){t(r).find("input").removeAttr("disabled"),o.removeClass("disabled"),o.find("i").removeClass("fa-refresh fa-spin").addClass("fa-plus"),r.sidebar("alert",{type:"error",message:e.responseJSON.message||I18n.t("widgets.email.connect_failed")})}),!1},getCustomDropdownItems:function(){var e=[{caption:I18n.t("refresh"),icon:"fa-refresh",action:t.proxy(this.refresh,this)}],i=this.listProviders(),n=this.getCurrentProvider();for(var r in i)if(i.hasOwnProperty(r)){var a=i[r].getIcon()||"fa-envelope";e.push({caption:this.getValueForProvider("title",i[r],i[r].getIdentifier()),icon:n&&n.id==i[r].id?"fa-chevron-right":a,classes:"editable-only",action:t.proxy(this.switchProvider,this),pinned:!0,id:i[r].id})}return e.push({caption:I18n.t("widgets.email.add_provider"),icon:"fa-plus",classes:"editable-only",action:t.proxy(this.addNewProvider,this),pinned:!0}),e},getSubnavOverflowIcon:function(){return"fa-bars"},switchProvider:function(e){e=this.getProvider(e.id),e&&(this.setCurrentProvider(e.id),this.saveSettings(),this.setCurrentPage(0),this.setCurrentLabel(void 0),this.refresh())},getCustomSettingsDefaults:function(){return{c:7,i:this.ITEM_MODE.compact,currentProvider:void 0,providers:{},titles:{}}},setCustomSettings:function(e){this.setPageSize(e.c),this.setItemMode(e.i),this.providers=this.jsonToProviders(e.providers,"email",[]),this.providerConfig=e.providerConfig,this.setCurrentProvider(e.currentProvider)},getCustomSettings:function(){var e=this.getCurrentProvider();return{c:this.getPageSize(),i:this.getItemMode(),providers:this.providersToJson(),currentProvider:"undefined"!=typeof e?e.id:"",providerConfig:this.providerConfig}},getSettingsConfig:function(){function e(){for(var e=[],t=1;20>=t;t++)e.push({label:I18n.t("widgets.email.n_messages",{count:t}),value:t});return e}var t=this;return{templateValues:{countOptions:e()},changed:function(){t.renderMessages()}}},initClickLink:function(){var e=this.domElement.find(".body");e.find("a.link").unbind("click"),e.find("a.link").on("click",t.proxy(this.linkClick,this))},getItemMode:function(){return parseInt(this.itemMode)||this.ITEM_MODE.compact},setItemMode:function(e){this.itemMode=parseInt(e)||this.getItemMode()},getPageSize:function(){return parseInt(this.pageSize)||7},setPageSize:function(e){this.pageSize=Math.max(1,parseInt(e)||this.getPageSize())},getCurrentPage:function(){return parseInt(this.currentPage)||0},setCurrentPage:function(e){this.currentPage=Math.max(0,Math.min(this.getPageCount()-1,parseInt(e)||0))},getPageCount:function(){return Math.ceil(this.getMessageCount()/this.getPageSize())},getMessageCount:function(){var e=this.getMessages();return e?e.length:0},initPagination:function(){var e=this;this.domElement.find(".prev").bind("click",function(t){e.previousMessagesPage(),t.stopPropagation(),t.preventDefault()}),this.domElement.find(".next").bind("click",function(t){e.nextMessagesPage(),t.stopPropagation(),t.preventDefault()})},initAutoRefresh:function(){function e(){r.refresh(),i()}function i(){n=setTimeout(e,r.REFRESH_INTERVAL)}var n,r=this,a=this.getCurrentProvider();a&&i(),t(this).on("delete",function(){n&&clearTimeout(n)})},linkClick:function(i){var n=this,r=t(i.delegateTarget);this.refreshMessagesTimeout&&clearTimeout(this.refreshMessagesTimeout),this.refreshMessagesTimeout=setTimeout(function(){n.loadMessages()},15e3),i.preventDefault(),e.UrlHelper.openUrl(r.attr("href"),i)},checkPagination:function(){var e=this.domElement.find("nav.pager");this.getCurrentPage()>0?e.find("a.prev").removeAttr("disabled"):e.find("a.prev").attr("disabled","disabled"),this.getCurrentPage()+1<this.getPageCount()?e.find("a.next").removeAttr("disabled"):e.find("a.next").attr("disabled","disabled"),e.find(".current").text(this.getCurrentPage()+1),e.find(".total").text(this.getPageCount()),e.toggle(this.getPageCount()>0)},nextMessagesPage:function(){this.setCurrentPage(this.getCurrentPage()+1),this.renderMessages()},previousMessagesPage:function(){this.setCurrentPage(this.getCurrentPage()-1),this.renderMessages()},providerSettingsDialog:function(e){function i(t){this.setValueForProvider("title",t.title,e),this.renderProviders(),this.updateSubtitle(),this.saveSettings()}var n=this;this.settingsSidebar("email",{title:I18n.t("widgets.email.provider.settings"),template:"provider_settings",formdata:{title:n.getValueForProvider("title",e,e.getIdentifier())},save:t.proxy(i,n)})}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Error=e.Widget.registerType("error",{render:function(){return this.data=t.extend({title:I18n.t("widget_error")},this.data),this.data.widget_type="error",this.renderWidget("error",{message:this.data.message||I18n.t("widget_error_explanation")},{icon:"fa-exclamation-triangle",added:function(){},canBeCopied:!1}),this.initReporting(),this.domElement},getCustomDropdownItems:function(){return[{caption:I18n.t("report_error"),icon:"fa-comment",pinned:!0,action:t.proxy(this.reportError,this)}]},initReporting:function(){this.domElement.find("button").click(t.proxy(this.reportError,this))},reportError:function(){e.showFeedbackDialog({subject:"Error in widget #"+this.getId()+": "+this.data.error.toString(),attachment:JSON.stringify(this.data.error)})}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Facebook=e.Widget.registerType("facebook",{render:function(){return this.data=t.extend({title:"Facebook"},this.data),this.renderWidget("facebook",{},{icon:"fa-facebook",added:function(){}}),this.domElement}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.FacebookPage=e.Widget.registerType("facebook_page",{HEIGHT:[{name:"small",size:250},{name:"medium",size:400},{name:"large",size:600}],DEFAULT_HEIGHT:400,getFacebookPageUrl:function(){return this.facebook_page_url},setFacebookPageUrl:function(e){this.facebook_page_url=e},getHeight:function(){return parseInt(this.height)||this.DEFAULT_HEIGHT},setHeight:function(e){e=parseInt(e)||this.DEFAULT_HEIGHT,this.height=e},getSmallHeader:function(){return!!this.small_header},setSmallHeader:function(e){this.small_header=!!e},getShowFriendFaces:function(){return!this.getSmallHeader()},getShowTabs:function(){return!!this.showTabs},setShowTabs:function(e){this.showTabs=!!e},getTabs:function(){return this.getShowTabs()?"timeline,events,messages":"timeline"},render:function(){this.data=t.extend({title:"Facebook"},this.data);var i=this;return this.renderWidget("facebook_page",{setting_u:this.getFacebookPageUrl(),setting_s:this.getHeight(),setting_sh:this.getSmallHeader(),setting_sff:this.getShowFriendFaces(),setting_t:this.getTabs()},{icon:"fa-facebook",added:function(){i.showSettings(),i.adjustWidth()}}),e.LibLoader.load(e.LibLoader.FBSDK).then(function(){FB.init({version:"v2.5",xfbml:!0})}).done(function(){i.adjustWidth()}),t(e.getActivePage()).on("adjusted.columns",t.proxy(this.adjustWidth,this)),this.domElement},adjustWidth:function(){var e=this.domElement.children(".body").innerWidth();e=Math.round(Math.min(500,e)),this.domElement.find(".fb-page").attr("data-width",e),window.FB&&FB.XFBML.parse(this.domElement[0])},renderStyle:function(){var e=this.getHeight(),t=this.domElement.children(".body").css("height",e);t.children(".fb-page").attr("data-height",e),this.adjustWidth()},updateFacebookPluginSettings:function(){var e=this.domElement.find(".fb-page"),t=this.getFacebookPageUrl(),i=this.getSmallHeader()?"true":"false",n=this.getShowFriendFaces()?"true":"false",r=this.getTabs();e.attr({"data-href":t,"data-small-header":i,"data-hide-cover":!1,"data-show-facepile":n,"data-tabs":r})},getCustomSettingsDefaults:function(){return{u:"https://www.facebook.com/STARTMEpage",s:this.DEFAULT_HEIGHT,sh:!0,t:!1}},setCustomSettings:function(e){this.setFacebookPageUrl(e.u),this.setHeight(e.s),this.setSmallHeader(e.sh),this.setShowTabs(e.t)},getCustomSettings:function(){var e={u:this.getFacebookPageUrl(),s:this.getHeight(),sh:this.getSmallHeader()?1:0,t:this.getShowTabs()?1:0};return e},getSettingsConfig:function(){var e=this;return{templateValues:{heightOptions:this.HEIGHT},changed:function(){e.updateFacebookPluginSettings(),e.renderStyle()}}}})}(Yourls,jQuery);var Yourls=function(e,t){"use strict";return e.FeedBrowser=function(i){function n(e,i){t.ajax({url:"/feed/"+e.id+".json",type:"get",dataType:"json",success:function(e){i(e.articles)}})}function r(){var i=[];return i.push({caption:I18n.t("channels.browse"),icon:"fa-rss",url:window.primaryBaseUrl+"/channels"}),i.push({caption:I18n.t("import_bookmarks_feeds"),icon:"fa-upload",action:t.proxy(e.getImport().showSidebar,e.getImport(),e.getActivePageId())}),i}function a(i,n){function r(i){return i=t.trim(i),e.UrlHelper.isValid(i)?a(i):o(i)}function a(t){var i=e.UrlHelper.newLink(t);return{name:i.title,url:i.url}}function o(e){return e=t.map(e.split(/\s/),t.trim).join(" "),{name:I18n.t("news_about",{keywords:e}),url:"https://news.google.com/news?output=rss&q="+encodeURIComponent(e)}}var s=r(i);s&&n.unshift(s)}function o(e){e.query||e.subject||e.area||(e.subject="popular")}function s(e){return t.inArray(e.url,i.excluded)<0}function d(e,t){return e["default"]?{caption:I18n.t("feed_details"),icon:"fa-chevron-right",action:function(){c.showFeedBar(e,{add:t})}}:void 0}function l(i,n){function r(i){var n=0,r=t.makeArray(i.area),a=t.makeArray(i.subject);return t.inArray(e.user.getCountryCode(),r)>=0?n+=20:t.inArray("int",r)>=0&&(n+=10),t.inArray("popular",a)>=0&&(n+=5),n}return r(n)-r(i)}i=t.extend({excluded:[],title:I18n.t("add_feed"),icon:"fa-rss",searchHint:I18n.t("new_feed_description"),extraButtons:r,url:"/feed/find",filters:{subject:{icon:"fa-tag",popular:"popular",tags:function(){return e.tags.getFeedSubjectTags()}},area:{icon:"fa-globe",popular:[e.user.getCountryCode(),"int"],tags:function(){return e.tags.getAreaTags()}}},beforeFilter:o,filterItem:s,beforeSuggestionsRender:a,getItemAction:d,compareItems:l},i);var c=new e.Browser(i);return c.showFeedBar=function(i,r){function a(){var r=t(this);e.UrlHelper.renderFavicon(r.find("header .icon"),i.url);var a=r.find("ul.articles");n(i,function(e){r.find(".loader").hide(),e=e.slice(0,5),t.each(e,function(){var e=this,i=moment(e.date);e.date=t.timeago(i.toDate()),e.isodate=i.toISOString(),e.cloudinary_url=e.image_url?t.cloudinary.url(e.image_url,{fetch_format:"auto",quality:90,width:40,height:40,crop:"fill"}):null,a.append(JST["widgets/rsslist/browser/article"](e))})})}r=t.extend({add:null,feedIsWidget:!1},r);var o=[];t.isFunction(r.add)&&o.push({caption:r.feedIsWidget?I18n.t("add_widget"):I18n.t("add_feed"),icon:"fa-plus","default":!0,action:function(){r.add(i)}}),o.push({caption:I18n.t("back"),icon:"fa-arrow-left"});var s=t.trim(i.name);s||(s=r.feedIsWidget?I18n.t("preview"):I18n.t("feed_preview"));e.sidebar("widgets/rsslist/browser/feedbar",{title:s,icon:"fa-none",extraClasses:"feed-browser light",buttons:o,rendered:a})},c},e}(Yourls,jQuery);(function(e,t){"use strict";e.Widget.Finance=e.Widget.registerType("finance",{unsupportedStockSymbols:["^DJA","^DJC","^DJI","^DJT","^DJU"],suggestedStockSymbols:[],suggestedStockSymbolsData:{},REFRESH_INTERVAL:9e5,getSymbols:function(){return this.symbols||[]},setSymbols:function(e){e=e||[];var i=this.symbols=[],n=this;t.each(e,function(){n.unsupportedStockSymbols.indexOf(this.s)>=0||i.push({n:this.n,s:this.s})})},render:function(){return this.data=t.extend({title:I18n.t("new_finance_widget_title")},this.data),this.renderWidget("finance",{},{icon:"fa-money",help:"en-us/articles/200154592-Stock-Quotes"}),this.postpone(function(){this.publishStockQuotes(),this.publishStockSymbols(),this.initAddSymbol(),this.initAutoSuggest(),this.initSortable(),this.initAutoRefresh()}),this.domElement},getCustomDropdownItems:function(){return[{caption:I18n.t("refresh"),icon:"fa-refresh",classes:"view-only",action:t.proxy(this.refresh,this)}]},initAddSymbol:function(){this.initInlineAdding({callback:t.proxy(function(e){return this.submitSymbol(e)},this)})},initClickLink:function(){var i=t.proxy(this.linkClick,this),n=this.domElement.find("a.link");n.unbind("click").on("click",i),e.contextmenu(n.parents("tr"),t.proxy(this.getLinkContextMenuItems,this))},initAutoSuggest:function(){var e=this;this.domElement.find("input.symbolField").autocomplete({autoFocus:!0,delay:300,minLength:2,source:function(i,n){e.suggestedStockSymbols=[],e.suggestedStockSymbolsData={};var r=t.trim(i.term.toString()),a="/tools/stocksymbol/autocomplete/"+r.hashCode()+"/"+r;t.ajax({url:a,type:"GET",dataType:"json",cache:!0}).then(function(i){t.each(i,function(t,i){if(!(e.unsupportedStockSymbols.indexOf(i.symbol)>=0)){var n=i.symbol+" - "+i.name+(i.exchange?" ("+i.exchange+")":"");e.suggestedStockSymbolsData[n]=i.symbol,e.suggestedStockSymbols.push(n)}}),n(e.suggestedStockSymbols)})}})},initSortable:function(){this.domElement.find("ul.stock-symbols").sortable({connectWith:".widget-finance ul.stock-symbols",placeholder:"ui-sortable-placeholder",forcePlaceholderSize:!0,update:t.proxy(function(e,t){this.updateAndSaveAndRefreshSymbols()},this)})},initAutoRefresh:function(){function e(){r.refresh(),i()}function i(){n=setTimeout(e,r.REFRESH_INTERVAL)}var n,r=this;i(),t(this).on("delete",function(){n&&clearTimeout(n)})},refresh:function(){this.publishStockQuotes()},linkClick:function(i){var n=t(i.delegateTarget);e.UrlHelper.openUrl(n.attr("href"),i)},initDeleteSymbol:function(){this.domElement.find("i.delete").unbind("click"),this.domElement.find("i.delete").on("click",t.proxy(function(e){var i=t(e.delegateTarget).parents("li").data("item_id");this.deleteSymbol(i),e.stopPropagation(),e.preventDefault()},this))},deleteSymbol:function(e){if(e){var t=this.domElement.find('li.symbol[data-item_id="'+e+'"]');t.remove(),this.updateAndSaveAndRefreshSymbols()}},submitSymbol:function(e){if(0==e.length)return!1;var t=this.suggestedStockSymbolsData[e];if("undefined"==typeof t||null==t)return!1;var i={n:e,s:t},n=JST["widgets/finance/symbol"](i);this.domElement.find("ul.stock-symbols").append(n),this.updateAndSaveAndRefreshSymbols(),this.initDeleteSymbol(),this.initClickLink()},getLinkContextMenuItems:function(e){var i=[];return this.isEditable()&&i.push({caption:I18n.t("delete"),action:t.proxy(this.deleteSymbol,this,e.data("id")),icon:"fa-trash"}),i},getCustomSettingsDefaults:function(){return{f:[]}},setCustomSettings:function(e){this.setSymbols(e.f)},getCustomSettings:function(){return{f:this.getSymbols()}},updateSymbols:function(){var e=[];this.domElement.find("li.symbol").each(function(i,n){n=t(n),n.data("index",i),e.push({n:n.data("name"),s:n.data("item_id")})}),this.setSymbols(e)},updateAndSaveAndRefreshSymbols:function(){this.updateSymbols(),this.saveSettings(),this.publishStockQuotes()},publishStockSymbols:function(){var e=this.getSymbols();if(this.domElement.find("ul.stock-symbols li").each(function(e,i){t(i).remove()}),e)for(var i=0;i<e.length;++i){var n=e[i],r=JST["widgets/finance/symbol"](n);this.domElement.find("ul.stock-symbols").append(r)}this.initDeleteSymbol(),this.initClickLink()},publishStockQuotes:function(){for(var e=this,i=this.getSymbols(),n="'",r=[],a=0;a<i.length;++a){var o=i[a].s;-1==this.unsupportedStockSymbols.indexOf(o)&&(r.push({Symbol:o,Name:i[a].n}),"'"!=n&&(n+="','"),n+=o)}n+="'";var s=JST["widgets/finance/quotes"]({quote:r}),d=this.domElement.find("ul.stock-quotes");if(d.empty().append(s),this.initClickLink(),0!=r.length&&"''"!=n){var l="https://query.yahooapis.com/v1/public/yql",c=encodeURIComponent("select Name, Symbol, LastTradePriceOnly, PreviousClose, Change, PercentChange from yahoo.finance.quotes where symbol in ("+n+")"),u=encodeURIComponent("store://datatables.org/alltableswithkeys"),h=l+"?q="+c+"&format=json&env="+u;t.ajax({url:h,dataType:"json",success:function(t){if(t&&t.query&&t.query.results&&t.query.results.quote){var i={};if(t.query.results.quote.length)i=t.query.results;else{var n=[];n[0]=t.query.results.quote,i.quote=n}for(var r=0;r<i.quote.length;++r){i.quote[r].Change<0&&(i.quote[r].down=1),i.quote[r].AbsChange=Math.abs(i.quote[r].Change);var a=JST["widgets/finance/quote"](i.quote[r]),o=e.domElement.find('ul.stock-quotes tr[data-id="'+i.quote[r].Symbol+'"]');o.empty().append(a),e.initClickLink()}}},error:function(e,t,i){return 400==e.status?!0:void 0}})}}})}).call(this,Yourls,jQuery),function(e,t){"use strict";e.Widget.Gadsense=e.Widget.registerType("gadsense",e.ProviderMixin,{DATA_SERIES:{EARNINGS:{type:"default",format:"currency"},PAGE_VIEWS:{type:"default"},COST_PER_CLICK:{short_name:"CPC",type:"average",format:"currency"}},render:function(){var e=this;return this.data=t.extend({title:I18n.t("widgets.gadsense.widget_title")},this.data),this.renderWidget("gadsense",{},{icon:"fa-line-chart",help:"en-us/articles/212080185",added:function(){}}),this.getCurrentProvider()&&null===this.getAccountId()?this.showSettings():this.renderChart(!0,!0).then(function(t){t&&e.postpone(function(){e.renderChart(!1,!1)})}),this.domElement},refresh:function(){this.renderChart(!1,!0)},setupProvider:function(){var t=e.Provider.create("adsense","google",{id:this.getNewProviderId(),widget:this,authorization:{}});this.addProvider(t),this.saveSettings(function(){window.top.location.href=t.getAuthUrl()})},switchProvider:function(){var e=this,t=this.getCurrentProvider();t?this.removeProvider(t.id,function(){e.setAccountId(null),e.setupProvider()}):this.setupProvider()},renderChart:function(i,n){function r(i){var r=t(a.domElement.find("div.chart-container")[0]),o={};Object.keys(a.DATA_SERIES).forEach(function(e,t){o[t]={targetAxisIndex:t}});var s=Object.keys(o).length>2?"none":"in",d={legendContainer:t(a.domElement.find("div.legend-container")[0]),stacked:!1,series:o,vAxis:{textPosition:s},animate:!!n};return e.ChartRenderer.render(r,i,e.ChartRenderer.CHART_TYPES.line,d)}var a=this,o=t.Deferred(),s=this.getCurrentProvider();if(this.setLoading(!0),s||this.isPreview())this.getData(i).then(function(e,t){return o.resolve(t),r(e)}).then(function(){a.setLoading(!1)}).fail(function(t){e.Logger.error(t)});else{var d=t(a.domElement.find("div.chart-container")[0]),l=t(JST["widgets/gadsense/add_account_placeholder"]()).appendTo(d)[0],c=t(t(l).find("a.new")[0]);c.click(t.proxy(this.setupProvider,this)),this.setLoading(!1)}return o.promise()},getData:function(e){function i(){var e=new Date,t=new Date,i=(new Date).getDate();e.setDate(i-31),t.setDate(i-1);var o={accountId:n.getAccountId(),startDate:e.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0],metric:Object.keys(n.DATA_SERIES)};a.fetchReport(o).then(function(e){return n.formatChartData(e)}).then(function(e){n.setCache(n.getDataCacheKey(),e.toArray(),60),r.resolve(e,!1)}).fail(function(){n.clearCachedData(),r.reject()})}var n=this,r=t.Deferred(),a=this.getCurrentProvider();return this.isPreview()?this.generatePreviewData():(e?this.getCachedData().then(function(e){r.resolve(e,!0)}).fail(i):i(),r.promise())},getDataCacheKey:function(){return"adsense-"+this.getAccountId()},getCachedData:function(){var i=t.Deferred();try{var n=this.getCache(this.getDataCacheKey());if(!n)return i.reject();var r=e.ChartData.fromArray(n);r?i.resolve(r):i.reject()}catch(a){i.reject(a)}finally{return i.promise()}},clearCachedData:function(){this.setCache(this.getDataCacheKey(),null)},formatChartData:function(i){var n=this,r=t.Deferred(),a=function(e){var t=e.name.toLowerCase().replace(/_/g," ");return t.charAt(0).toUpperCase()+t.slice(1)},o=[];i.headers.forEach(function(t){var i={};n.DATA_SERIES.hasOwnProperty(t.name)&&(i.short_name=n.DATA_SERIES[t.name].short_name||null,i.type=n.DATA_SERIES[t.name].type||"default",i.format=n.DATA_SERIES[t.name].format||"default",t.hasOwnProperty("currency")&&(i.currency=t.currency)),o.push(new e.ChartSeries(a(t),[],{metadata:i}))});var s=new e.ChartData(o);return i.rows.forEach(function(e){s.addRow(e)}),r.resolve(s)},generatePreviewData:function(){var i=t.Deferred(),n=[];n.push(new e.ChartSeries("date")),n.push(new e.ChartSeries("Pageviews")),n.push(new e.ChartSeries("Earnings"));for(var r=new e.ChartData(n),a=new Date,o=1e4,s=8,d=0;31>d;d++){var l=a.toISOString().split("T")[0].replace(/-/g,""),c=o*(.95+.1*Math.random()-(d%7>=5?.3:0)),u=s*(.9+.1*Math.random()-(d%7>=5?.3:0));a.setDate(a.getDate()-1),r.addRow([l,c,u])}return i.resolve(r)},setAccountId:function(e){this.account_id=e},getAccountId:function(){return this.account_id},getCustomSettingsDefaults:function(){return{currentProvider:void 0,providers:{},title:{},a:null}},setCustomSettings:function(e){this.providers=this.jsonToProviders(e.providers,"adsense",[]),this.providerConfig=e.providerConfig,this.setCurrentProvider(e.currentProvider),this.setAccountId(e.a)},getCustomSettings:function(){var e=this.getCurrentProvider();return{providers:this.providersToJson(),currentProvider:"undefined"!=typeof e?e.id:"",providerConfig:this.providerConfig,a:this.account_id}},getCustomDropdownItems:function(){var i=[],n=this.listProviders(),r=this.getCurrentProvider();return r&&i.push({caption:I18n.t("widgets.ganalytics.change_google_account"),icon:"fa-plus",classes:"editable-only",action:t.proxy(this.switchProvider,this,"google"),pinned:!0}),i.push({caption:I18n.t("refresh"),icon:"fa-refresh",action:t.proxy(this.refresh,this)}),!e.user.isPremium()||r&&0!==n.length||i.push({caption:I18n.t("widgets.ganalytics.select_google_account"),icon:"fa-plus",classes:"editable-only",action:t.proxy(this.setupProvider,this),pinned:!0}),i},loadAccounts:function(){var e=this,i=this.getCurrentProvider();return i?i.listAccounts().then(function(t){return e.accounts=t,t}).fail(function(){e.accounts=[]}):t.Deferred().resolve()},renderDynamicSettingsElements:function(){var e=this,i=function(i){var i=i===!0?!0:!1;t("#accounts").empty().append(t("<label></label>").attr("for","adsense_account_id").text(I18n.t("select_account")));var n=t("<select></select>").attr({id:"adsense_account_id",name:"setting_a"}).change(function(){t("#widget_title").trigger("change")});return t("#accounts").append(n),i?(n.attr({disabled:"disabled"}),t.Deferred().resolve()):(e.accounts.forEach(function(i){var r=t("<option/>").attr("value",i.id).text(i.id);i.id==e.account_id&&r.attr("selected","selected"),n.append(r)}),t.Deferred().resolve())};return i(!0).then(function(){return e.loadAccounts()}).then(function(){return i(!1)}).fail(function(){var i=e.getCurrentProvider();i&&e.removeProvider(i.id,function(){e.setAccountId(null),e.refresh()}),t("#accounts select").remove(),t("#accounts").append(t("<p></p>").addClass("error").text("["+I18n.t("widgets.gadsense.no_accounts_available")+"]"))})},getSettingsConfig:function(){var e=this;return{templateValues:{},changed:function(){e.refresh()},rendered:function(){this.getCurrentProvider()&&this.renderDynamicSettingsElements().then(function(){var i=e.getAccountId();e.accounts.length>0&&(null===i||"undefined"==typeof i)&&t("#widget_title").trigger("change")})}}}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Ganalytics=e.Widget.registerType("ganalytics",e.ProviderMixin,{accounts_by_id:{},web_properties_by_account_id:{},views_by_web_property_id:{},render:function(){return this.data=t.extend({title:I18n.t("widgets.ganalytics.widget_title")},this.data),this.renderWidget("chart",{},{icon:"fa-line-chart",help:"en-us/articles/212066445",added:function(){}}),this.getCurrentProvider()&&null===this.data.settings.v_id?this.showSettings():this.renderChart(!0,!0).then(function(e){e&&self.postpone(function(){self.renderChart(!1,!1)})}),this.domElement},refresh:function(){this.renderChart(!1,!0)},bindNewProviderEvents:function(){var e=t.proxy(this.setupProvider,this);t("section.email-browser").find("a.add").on("click",function(i){i.preventDefault();var n=t(this).data("type");e(n)})},switchProvider:function(){var e=this,t=this.getCurrentProvider();t?this.removeProvider(t.id,function(){e.setViewId(null),e.setupProvider()}):this.setupProvider()},setupProvider:function(){var t=e.Provider.create("analytics","google",{id:this.getNewProviderId(),widget:this,authorization:{}});this.addProvider(t),this.saveSettings(function(){window.top.location.href=t.getAuthUrl()})},renderChart:function(i,n){function r(i){var n=t(a.domElement.find("div.chart-container")[0]),r={legendContainer:t(a.domElement.find("div.legend-container")[0]),hAxis:{textPosition:"in"}};return e.ChartRenderer.render(n,i,e.ChartRenderer.CHART_TYPES.area,r)}var a=this,o=t.Deferred(),s=this.getCurrentProvider();if(this.setLoading(!0),s||this.isPreview())this.getData(i).then(function(e,t){return o.resolve(t),r(e)}).fail(function(t){e.Logger.error("Ganalytics renderChart, failed to load data.",t)}).always(function(){a.setLoading(!1)});else{var d=t(a.domElement.find("div.chart-container")[0]),l=t(JST["widgets/ganalytics/add_account_placeholder"]()).appendTo(d)[0],c=t(t(l).find("a.new")[0]);c.click(t.proxy(this.setupProvider,this)),this.setLoading(!1)}return o.promise()},getData:function(e){function i(){a.getAnalyticsReportingData(n.view_id,n.metrics,n.segment_id,n.number_of_days).then(function(e){return n.formatChartData(e)}).then(function(e){n.setCache(n.getDataCacheKey(),e.toArray(),60),r.resolve(e,!1)}).fail(function(e){n.clearCachedData(),r.reject(e)})}var n=this,r=t.Deferred(),a=this.getCurrentProvider();return n.isPreview()?n.generatePreviewData():(e?this.getCachedData().then(function(e){r.resolve(e,!0)}).fail(i):i(),r.promise())},getDataCacheKey:function(){return["analytics",this.view_id,this.segment_id,this.metric].join("-")},getCachedData:function(){var i=t.Deferred();try{var n=this.getCache(this.getDataCacheKey());if(!n)return i.reject();var r=e.ChartData.fromArray(n);r?i.resolve(r):i.reject()}catch(a){i.reject(a)}finally{return i.promise()}},clearCachedData:function(){this.setCache(this.getDataCacheKey(),null)},formatChartData:function(i){var n=t.Deferred(),r=function(e){var t=e.name.replace("ga:","");return t.charAt(0).toUpperCase()+t.slice(1)},a=[];a.push(new e.ChartSeries("date")),i.columnHeader.metricHeader.metricHeaderEntries.forEach(function(t,i){a.push(new e.ChartSeries(r(t)))});var o=new e.ChartData(a),s=i.data.rows.slice(-31);return s.forEach(function(e){var t=e.metrics[1].values;t.unshift(e.dimensions[0]),o.addRow(t)}),n.resolve(o)},generatePreviewData:function(){var i=t.Deferred(),n=[];n.push(new e.ChartSeries("date")),n.push(new e.ChartSeries("Pageviews"));for(var r=new e.ChartData(n),a=new Date,o=1e6,s=0;31>s;s++){var d=a.toISOString().split("T")[0].replace(/-/g,""),l=o*(.95+.1*Math.random()-(s%7>=5?.3:0));a.setDate(a.getDate()-1),r.addRow([d,l])}return i.resolve(r)},loadAccounts:function(){var e=this,i=this.getCurrentProvider();return i?i.listAccounts().then(function(t){var i={};return t.forEach(function(e){i[e.id]=e}),e.accounts_by_id=i,Object.keys(i)}).then(function(e){return i.listWebProperties(e)}).then(function(t){var i={};return t.forEach(function(e){i.hasOwnProperty(e.accountId)||(i[e.accountId]=[]),i[e.accountId].push(e)}),e.web_properties_by_account_id=i,i}).then(function(e){return i.listViews(e)}).then(function(t){var i={};return t.forEach(function(e){i.hasOwnProperty(e.webPropertyId)||(i[e.webPropertyId]=[]),i[e.webPropertyId].push(e)}),e.views_by_web_property_id=i,t}):t.Deferred().resolve()},loadMetrics:function(){var e={audience:[{id:"ga:pageviews,ga:sessions,ga:users",name:I18n.t("widgets.ganalytics.metrics.overview")},{id:"ga:users",name:I18n.t("widgets.ganalytics.metrics.users")},{id:"ga:newUsers",name:I18n.t("widgets.ganalytics.metrics.new_users")},{id:"ga:1dayUsers",name:I18n.t("widgets.ganalytics.metrics.n_day_active_users",{days:1})},{id:"ga:7dayUsers",name:I18n.t("widgets.ganalytics.metrics.n_day_active_users",{days:7})},{id:"ga:14dayUsers",name:I18n.t("widgets.ganalytics.metrics.n_day_active_users",{days:14})},{id:"ga:30dayUsers",name:I18n.t("widgets.ganalytics.metrics.n_day_active_users",{days:30})},{id:"ga:sessions",name:I18n.t("widgets.ganalytics.metrics.sessions")},{id:"ga:sessionDuration",name:I18n.t("widgets.ganalytics.metrics.session_duration")},{id:"ga:percentNewSessions",name:I18n.t("widgets.ganalytics.metrics.new_sessions")},{id:"ga:pageviews",name:I18n.t("widgets.ganalytics.metrics.pageviews")},{id:"ga:pageviewsPerSession",name:I18n.t("widgets.ganalytics.metrics.pageviews_per_session")},{id:"ga:bounces",name:I18n.t("widgets.ganalytics.metrics.bounces")},{id:"ga:bounceRate",name:I18n.t("widgets.ganalytics.metrics.bounce_rate")}]};return t.Deferred().resolve(e)},loadSegments:function(){var e=this.getCurrentProvider();return e?e.listSegments():t.Deferred().resolve()},getCustomDropdownItems:function(){var i=[],n=this.listProviders(),r=this.getCurrentProvider();return r&&i.push({caption:I18n.t("widgets.ganalytics.change_google_account"),icon:"fa-plus",classes:"editable-only",action:t.proxy(this.switchProvider,this,"google"),pinned:!0}),i.push({caption:I18n.t("refresh"),icon:"fa-refresh",action:t.proxy(this.refresh,this)}),!e.user.isPremium()||0!==n.length&&r||i.push({caption:I18n.t("widgets.ganalytics.select_google_account"),icon:"fa-plus",classes:"editable-only",action:t.proxy(this.setupProvider,this),pinned:!0}),i},setError:function(e,i){e="undefined"==typeof e?!0:1==e,this.domElement.toggleClass("error",e);var n=t(this.domElement.find("div.error-message")[0]),r=t("<p></p>").append(document.createTextNode("An error occurred while loading this widget:"));r.append(t("<br/>")).append(document.createTextNode(i)),n.append(r)},setViewId:function(e){this.view_id=e},setMetrics:function(e){this.metrics=e},setSegmentId:function(e){this.segment_id=e},setNumberOfDays:function(e){this.number_of_days=e},getViewName:function(){var e=this,t=null;return Object.keys(this.views_by_web_property_id).length>0&&Object.keys(this.views_by_web_property_id).forEach(function(i){e.views_by_web_property_id[i].forEach(function(i){i.id==e.view_id&&(t=i.name)})}),t},getCustomSettingsDefaults:function(){return{currentProvider:void 0,providers:{},title:{},v_id:null,v:null,m:null,s:"gaid::-1",d:31}},setCustomSettings:function(e){this.providers=this.jsonToProviders(e.providers,"analytics",[]),this.providerConfig=e.providerConfig,
this.setCurrentProvider(e.currentProvider),this.setViewId(e.v_id),this.setMetrics(e.m),this.setSegmentId(e.s),this.setNumberOfDays(e.d)},getCustomSettings:function(){return{providers:this.providersToJson(),currentProvider:"undefined"!=typeof current?current.id:"",providerConfig:this.providerConfig,v_id:this.view_id,v:this.getViewName(),m:this.metrics,s:this.segment_id,d:this.number_of_days}},renderDynamicSettingsElements:function(){var e=this,i=function(i){var i=i===!0?!0:!1;t("#ga-accounts").empty().append(t("<label></label>").attr("for","ganalytics_view_id").text(I18n.t("widgets.ganalytics.view")));var n=t("<select></select>").attr({id:"ganalytics_view_id",name:"setting_v_id"}).change(function(){t("#widget_title").trigger("change")});return i&&n.attr({disabled:"disabled"}),t("#ga-accounts").append(n),i||Object.keys(e.web_properties_by_account_id).forEach(function(i){e.web_properties_by_account_id[i].forEach(function(r){var a=e.accounts_by_id[i].name+" - "+r.name,o=t("<optgroup></optgroup>").attr("label",a);e.views_by_web_property_id.hasOwnProperty(r.id)&&e.views_by_web_property_id[r.id].forEach(function(i){var n=t("<option/>").attr("value",i.id).text(i.name);i.id==e.view_id&&n.attr("selected","selected"),o.append(n)}),n.append(o)})}),t.Deferred().resolve()},n=function(i,n){var n=n===!0?!0:!1;t("#ga-metrics").empty().append(t("<label></label>").attr("for","ganalytics_metric").text(I18n.t("widgets.ganalytics.metric")));var r=t("<select></select>").attr({id:"ganalytics_metric",name:"setting_m"}).change(function(){t("#widget_title").trigger("change")});if(n&&r.attr({disabled:"disabled"}),t("#ga-metrics").append(r),!n){var a=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};Object.keys(i).forEach(function(n){var o=t("<optgroup></optgroup>").attr("label",a(n));i[n].forEach(function(i){var n=t("<option/>").attr("value",i.id).text(a(i.name));i.id==e.metrics&&n.attr("selected","selected"),o.append(n)}),r.append(o)})}return t.Deferred().resolve()},r=function(e,i){var i=i===!0?!0:!1;t("#ga-segments").empty().append(t("<label></label>").attr("for","ganalytics_segment").text(I18n.t("widgets.ganalytics.segment")));var n=t("<select></select>").attr({id:"ganalytics_segment",name:"setting_s"}).change(function(){t("#widget_title").trigger("change")});return i&&n.attr({disabled:"disabled"}),t("#ga-segments").append(n),i||e.forEach(function(e){var i=t("<option/>").attr("value",e.segmentId).text(e.name);e.segmentId==e.segment&&i.attr("selected","selected"),n.append(i)}),t.Deferred().resolve()},a=i(!0).then(function(){return e.loadAccounts()}).then(function(){return i(!1)}).fail(function(t){e.setError(!0,t)}),o=n(null,!0).then(function(){return e.loadMetrics()}).then(function(e){return n(e,!1)}).fail(function(t){e.setError(!0,t)}),s=r(null,!0).then(function(){return e.loadSegments()}).then(function(e){return r(e,!1)}).fail(function(t){e.setError(!0,t)});return t.when(a,o,s)},getSettingsConfig:function(){var e=this;return{templateValues:{},changed:function(){e.refresh()},rendered:function(){this.getCurrentProvider()&&this.renderDynamicSettingsElements().then(function(){(null===e.view_id||"undefined"==typeof e.view_id)&&t("#widget_title").trigger("change")})}}}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Gcalendar=e.Widget.registerType("gcalendar",{email:"",mode:"",wkst:1,render:function(i){return e.Model.loggedIn()?(this.data=t.extend({title:"Google Calendar"},this.data),this.renderWidget("gcalendar",{},{icon:"fa-calendar",settings:this.settingsDialog,added:function(){}}),this.refresh(),this.domElement):null},getCustomSettingsDefaults:function(){return{e:"",m:"",w:1}},setCustomSettings:function(e){this.email=e.e,this.mode=e.m,this.wkst=parseInt(e.w)||1},getCustomSettings:function(){return{e:this.email,m:this.mode,w:this.wkst}},settingsDialog:function(){function e(e){t.email=e.email,t.mode=e.mode,t.wkst=e.wkst,t.refresh(),t.saveSettings()}var t=this;this.settingsSidebar("gcalendar",{formdata:{email:this.email,mode:this.mode,wkst:this.wkst,hl:this.hl},save:e})},getLanguageCode:function(){switch(I18n.currentLocale()){case"es-AR":return"es_419";case"pt":return"pt_PT";case"zh":return"zh_CN";case"zh-CN":return"zh_CN";default:return I18n.currentLocale()}},refresh:function(){var e="https://www.google.com/calendar/embed?showTitle=0&showNav=0&showPrint=0&height=350",t=this.getSettings();if(t.m&&""!=t.m&&(e+="&mode="+t.m),e+="&wkst="+(t.w&&""!=t.w?t.w:"1"),t.hl&&""!=t.hl&&(e+="&hl="+t.hl),t.e&&""!=t.e)for(var i=t.e.split(/\s*,\s*/),n=0,r=i.length;r>n;n++){var a=i[n];e+=a.match(/@/)?"&src="+encodeURIComponent(a):"&color="+encodeURIComponent(a)}this.domElement.find("iframe").attr("src",e)}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Gtasks=e.Widget.registerType("gtasks",e.ProviderMixin,{tasklists:[],currentTasklist:null,render:function(){if(!e.Model.loggedIn())return null;this.data=t.extend({title:"Google Tasks"},this.data),this.renderWidget("gtasks",{pagination:1},{icon:"fa-tasks",help:"en-us/articles/200162651",subnav:{autohide:!0,viewOnly:!1,items:t.proxy(this.getTaskListItems,this)},added:function(){}});var i=this;return this.isEditable()&&this.checkMigration().then(function(e){e&&e.getType&&(i.addProvider(e),i.saveSettings())}).then(function(){if(i.getCurrentProvider())i.quickRenderTaskLists(),i.refreshTaskLists(),i.initClick(),i.initAddTask();else{i.domElement.addClass("not-authenticated");var e=i.domElement.find("div.body"),n=t(JST["widgets/gtasks/add_account_placeholder"]()).appendTo(e),r=t(n).find("a.new");r.click(t.proxy(i.setupProvider,i)),i.domElement.find("div.add a").hide()}}).fail(function(t){e.Logger.error(t)}),this.domElement},checkMigration:function(){var i=this.getAuthorization();if(i&&("undefined"==typeof i.provider_id||!i.provider_id)){var n=e.Provider.create("tasks","google",{id:this.getNewProviderId(),authorization:i});return i.provider_id=n.id,t.ajax({url:"/widget/"+this.getId()+"/auth",type:"PUT",data:{access_token:i.access_token,provider_id:n.id}}).then(function(){return n})}return t.Deferred().resolve()},getCustomDropdownItems:function(){var e=[];if(!this.isEditable())return e;e.push({caption:I18n.t("refresh"),icon:"fa-refresh",action:t.proxy(this.refreshTasks,this)});var i=this.getCurrentProvider(),n=this.listProviders();return i&&0!==n.length||e.push({caption:I18n.t("select_account"),icon:"fa-google",classes:"editable-only",action:t.proxy(this.setupProvider,this),pinned:!0}),e},setupProvider:function(){var t=e.Provider.create("tasks","google",{id:this.getNewProviderId(),widget:this,authorization:{}});this.addProvider(t),this.saveSettings(function(){window.top.location.href=t.getAuthUrl()})},refreshTaskLists:function(){var t=this;this.getCurrentProvider().fetchTaskLists().then(function(e){t.currentTasklist=e.currentTasklist,t.setQuickRenderTaskLists(e),t.updateData(e),t.loadTasks(e.currentTasklist)}).fail(function(t){e.Logger.error(t)})},refreshTasks:function(){this.loadTasks(this.currentTasklist)},loadTasks:function(e){var t=this;"undefined"!=typeof e&&null!=e&&(this.quickRenderTasks(e),this.getCurrentProvider().fetchTasks(e).then(function(i){t.setQuickRenderTasks(e,i),t.updateData(i)}))},initAddTask:function(){this.initInlineAdding({editOnly:!1,callback:t.proxy(this.insertTask,this)})},insertTask:function(i){var n=this,r=this.domElement.find(".task-list .task:last"),a=r?r.data("item_id"):null;return this.getCurrentProvider().executeInsertTask(i,this.currentTasklist,a).then(function(i){i.tasklist_id=n.currentTasklist,n.publishTask(i,n.domElement.find("ul.task-list")),n.initClick(),t(n).trigger("save"),n.setQuickRenderTasks(n.currentTasklist,null).fail(function(t){e.Logger.error(t)})})},queueDeleteTask:function(e){var t=this,i=this.domElement.find('.task[data-item_id="'+e+'"]'),n=i.data("tasklist_id");this.queueUpdate(function(r){t.getCurrentProvider().executeDeleteTask(e,n).then(function(){i.remove(),t.setQuickRenderTasks(n,null),r&&r()})})},initClick:function(){var e=this,i=this.domElement.find(".task");i.find("i.complete").unbind("click"),i.find("i.complete").on("click",t.proxy(this.clickCompleted,this)),i.find("a.link").off("click.link").on("click.link",t.proxy(this.taskClick,this)),i.find("a.delete").off("click.link").on("click.link",function(i){i.preventDefault(),i.stopPropagation();var n=t(this).parents("li:first"),r=n?n.data("item_id"):null;r&&e.queueDeleteTask(r)})},clickCompleted:function(e){var i=this,n=t(e.target),r=n.parents("li:first"),a=r.data("tasklist_id"),o=r.data("item_id"),s=r.data("completed");return this.getCurrentProvider().executeToggleTaskCompleted(o,a,s).then(function(){s?(n.addClass("fa-square-o").removeClass("fa-check-square"),r.find("a.link").removeClass("completed")):(n.addClass("fa-check-square").removeClass("fa-square-o"),r.find("a.link").addClass("completed")),r.data("completed",s?null:"1"),i.setQuickRenderTasks(a,null)}),!1},taskClick:function(e){e.preventDefault(),this.editTask(t(e.target))},editTask:function(i){var n=t(i).parents("li:first"),r=n.data("title"),a=n.data("notes"),o=n.data("item_id"),s=this;e.sidebar("widgets/gtasks/edit_task",{formdata:{title:r,notes:a},title:I18n.t("edit"),icon:"fa-tasks",autofocus:!0,buttons:[{caption:I18n.t("save"),icon:"fa-save","default":!0,action:function(e){return s.updateTask(n,e)}},{caption:I18n.t("delete"),icon:"fa-trash",action:function(){s.queueDeleteTask(o)}}]})},updateTask:function(e,i){var n=this,r=t.trim(i.title),a=t.trim(i.notes),o=e.data("item_id"),s=e.data("tasklist_id");return 0==r.length?I18n.t("please_specify_title"):void this.getCurrentProvider().executeUpdateTask(o,s,r,a).then(function(){e.data("title",r),e.data("notes",a),e.find(".title").text(r),n.setQuickRenderTasks(s,null)})},quickRenderTaskLists:function(){var e=this.getQuickRenderTaskLists();return e?(this.updateData(e),!this.currentTasklist&&e&&e.tasklists&&e.tasklists.length>0&&(this.currentTasklist=e.tasklists[0].id,this.renderSubnav()),void(this.currentTasklist&&this.quickRenderTasks(this.currentTasklist))):!1},setQuickRenderTaskLists:function(e){this.setCache("tasklists",JSON.stringify(e))},getQuickRenderTaskLists:function(){try{return this.getCache("tasklists")}catch(e){return!1}},quickRenderTasks:function(e){var t=this.getQuickRenderTasks(e);t?this.updateData(t):this.publishTasks([])},setQuickRenderTasks:function(e,t){this.setCache("tasks-"+e,JSON.stringify(t))},getQuickRenderTasks:function(e){try{return this.getCache("tasks-"+e)}catch(t){return!1}},updateData:function(e){"auth"==e.status||"error"==e.status?("error"==e.status?this.domElement.find(".auth").addClass("authenticated"):(this.domElement.find(".auth").removeClass("authenticated"),this.setQuickRenderTaskLists(null)),this.domElement.find(".tasklist-selector").hide(),this.domElement.find(".task-list").hide(),this.domElement.children(".add").hide()):(e.tasklists&&(this.tasklists=e.tasklists,this.renderSubnav()),this.publishTasks(e.tasks||[]),this.domElement.find(".auth").addClass("authenticated"),this.domElement.find(".tasklist-selector").show(),this.domElement.find(".task-list").show(),this.domElement.children(".add").show())},publishTasks:function(e){if("undefined"!=typeof e&&null!=e){for(var t=this.domElement.find("ul.task-list"),i=t.find("li.task"),n=e.length,r=0;n>r;++r)this.publishTask(e[r],t);t.find(".no-tasks").toggle(0==n),i.remove(),this.initClick()}},publishTask:function(e,i){if(e.due||e.completed){var n=(e.due||e.completed).toString().toMoment();e.dateago=t.timeago(n.toDate()),e.isodate=n.toISOString(),e.date_title=n.format("L")+" "+n.format("LT")}else e.dateago="",e.isodate="",e.date_title="";e.title||(e.title="(no title)"),e.short_title||(e.short_title=e.title.length>50?e.title.substr(0,49)+"...":e.title),e.long_title=e.title+(e.date_title?" ("+e.date_title+")":"")+(e.notes?" - "+e.notes:""),e.completed="completed"==e.status?"1":null;var r=JST["widgets/gtasks/task"](e);t(r).appendTo(i)},getTaskListItems:function(){var e=this,i=[];return t.each(this.tasklists,function(){i.push({caption:this.title,active:e.currentTasklist==this.id,action:t.proxy(e.selectTasklist,e,this.id)})}),i},selectTasklist:function(e){var i=!1;return t.each(this.tasklists,function(){return this.id==e?(i=this,!1):void 0}),i?(this.currentTasklist=e,this.loadTasks(e),void this.renderSubnav()):!1},getCustomSettingsDefaults:function(){return{currentProvider:void 0,providers:{}}},setCustomSettings:function(e){this.providers=this.jsonToProviders(e.providers,"tasks",[]),this.providerConfig=e.providerConfig,this.setCurrentProvider(e.currentProvider)},getCustomSettings:function(){var e=this.getCurrentProvider();return{providers:this.providersToJson(),currentProvider:e&&e.id||null,providerConfig:this.providerConfig}}})}(Yourls,jQuery),function(e,t){"use strict";var i={iframe:0,image:1,script:2};e.Widget.Iframe=e.Widget.registerType("iframe",{TYPES:i,getType:function(){return"number"==typeof this.type?this.type:this.TYPES.iframe},setType:function(e){this.type=parseInt(e),t.inArray(this.type,t.values(this.TYPES))<0&&(this.type=this.TYPES.iframe)},getUrl:function(){return"string"==typeof this.url&&this.url.length?this.url:null},setUrl:function(e){this.url=e?t.trim(e.toString()):null},getHeight:function(){return"number"==typeof this.height?this.height:350},setHeight:function(e){this.height=parseInt(e)},isBorderLess:function(){return!!this.borderLess},setBorderLess:function(e){this.borderLess=!!e},getSuppressScrollbars:function(){return!!this.suppressScrollbars},setSuppressScrollbars:function(e){return this.suppressScrollbars=!!e},render:function(){return this.data=t.extend({title:I18n.t("iframe.widget_title")},this.data),this.renderWidget("iframe",{url:this.getUrl(),moved:this.renderEmbed},{icon:"fa-code",help:"en-us/articles/202147702"}),this.postpone(function(){this.renderEmbed()}),t(this).on("startEditing.widget",t.proxy(this.startedEditing,this)),t(this).on("finishEditing.widget",t.proxy(this.finishedEditing,this)),this.domElement},getCustomDropdownItems:function(){return[{caption:I18n.t("refresh"),icon:"fa-refresh",action:t.proxy(this.renderEmbed,this)}]},getCustomSettingsDefaults:function(){return{u:null,h:350,t:this.TYPES.iframe,b:!1,s:!1}},setCustomSettings:function(e){this.setUrl(e.u),this.setHeight(e.h),this.setType(e.t),this.setBorderLess(e.b),this.setSuppressScrollbars(e.s)},getCustomSettings:function(){return{u:this.getUrl(),h:this.getHeight(),t:this.getType(),b:this.isBorderLess()?1:0,s:this.getSuppressScrollbars()?1:0}},getSettingsConfig:function(){var e=this;return{changed:function(){e.renderEmbed()}}},renderEmbed:function(){var i=this.domElement.find(".body").empty();i.toggleClass("borderless",this.isBorderLess());var n=this.getUrl(),r=n&&(e.UrlHelper.isSecure(n)||e.UrlHelper.isData(n));n&&e.isSecure()&&!r&&(n=e.UrlHelper.proxyUrl(n));var a=e.UrlHelper.getSite(n),o={type:this.getType(),url:n,urlInsecure:n&&!r,helpUrl:this.getHelpUrl(),height:this.getHeight(),suppressScrollbars:this.getSuppressScrollbars(),sandboxed:!a||a!=window.primaryDomain};switch(this.getUrl()?this.getType():null){case null:i.append(JST["widgets/iframe/pastebin"](o)),i.removeClass("borderless"),this.initPasteBin();break;case this.TYPES.iframe:i.append(JST["widgets/iframe/iframe"](o));break;case this.TYPES.image:i.append(JST["widgets/iframe/image"](o));break;case this.TYPES.script:var s=JST["widgets/iframe/script_tag"](o);i.append(JST["widgets/iframe/script"](t.extend({scriptTag:encodeURIComponent(s)},o)))}var d=this;i.find("img, iframe").each(function(){var e=t(this);d.setLoading(!0),e.on("load",function(){d.setLoading(!1),i.find(".ssl-warning").addClass("hide")}),d.postpone(function(){e.attr("src",e.data("src"))})}),i.find(".clear").click(t.proxy(function(){this.setUrl(null),this.renderEmbed(),this.saveSettings()},this))},startedEditing:function(){this.domElement.find(".pastebin textarea").focus()},finishedEditing:function(){this.renderEmbed(),this.saveOnFinishEditing&&(delete this.saveOnFinishEditing,this.saveSettings())},initPasteBin:function(){function i(){window.clearTimeout(l),l=window.setTimeout(r,500)}function r(){var i=s.find(".success").hide(),r=s.find(".error").hide(),l=t.trim(d.val());if(!l.length)return!1;for(var c in n){var u=null;try{u=n[c](l)}catch(h){e.Logger.error(h);continue}if(t.isPlainObject(u))return o.setType(u.type),o.setUrl(u.url),"height"in u&&o.setHeight(u.height),"borderless"in u&&o.setBorderLess(u.borderless),o.saveOnFinishEditing=!0,u.tryImage&&a(u.url),i.fadeIn(),setTimeout(t.proxy(o.finishEditing,o),100),!0}r.fadeIn()}function a(e){var i=new Image;i.onload=t.proxy(function(){o.getUrl()==e&&(o.setType(o.TYPES.image),i.height>0&&o.setHeight(i.height),o.isEditing()?this.saveOnFinishEditing=!0:(o.renderEmbed(),o.saveSettings()))},o),i.src=e}var o=this,s=this.domElement.find(".pastebin"),d=s.find("textarea"),l=null;d.bind("change keyup cut paste",i),d.focus()}});var n=function(){function n(e){var t=/^https?:\/\/(www\.)?(youtu\.be\/|youtube\.com\/watch\?v=)([^\s\/]{11})(?:\?.+)?$/.exec(e);if(t){var n=t[3];return{type:i.iframe,url:"//www.youtube.com/embed/"+n+"?theme=light&showinfo=0&controls=0&hl="+I18n.currentLocale(),height:315,borderless:!0}}}function r(e){var t=/^https?:\/\/(www\.)?(vimeo.com)\/(.+\/)?(\d{5,})$/.exec(e);if(t){var n=t[4];return{type:i.iframe,url:"//player.vimeo.com/video/"+n,height:315,borderless:!0}}}function a(t){function n(e){return{type:i.iframe,url:e,tryImage:!0}}return e.UrlHelper.isValid(t)?n(t):e.UrlHelper.isValidButWithoutProtocol(t)?n("http://"+t):void 0}function o(t){return e.UrlHelper.isData(t)?{type:i.iframe,url:t,tryImage:!0}:void 0}function s(e){if(/<iframe/i.test(e)){var n=t("<div>").append(e),r=n.find("iframe:first");if(r.length){var a=t.trim(r.attr("src")),o=r.attr("height");if(a.length)return{type:i.iframe,url:a,height:o}}}}function d(e){if(/<script/i.test(e)){var n=t("<div>").append(e);if(1==n.children().length){var r=n.children("script");if(r.length){var a=t.trim(r.attr("src"));if(a.length)return{type:i.script,url:a}}}}}function l(e){if(/<img/i.test(e)){var n=t("<div>").append(e),r=n.find("img:first");if(r.length){var a=t.trim(r.attr("src")),o=r.attr("height");if(a.length)return{type:i.image,url:a,height:o,borderless:!0}}}}function c(e){var n=t("<div>").append(e);if(0!=n.children().length)return{type:i.iframe,url:"data:text/html;charset=utf-8,"+encodeURIComponent(n.html())}}return[n,r,a,o,s,d,l,c]}()}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Image=e.Widget.registerType("image",{ASPECTRATIO:{square:"1:1",tv:"4:3",iso:"iso",film:"3:2",golden:"golden",hd:"16:9"},getAspectRatio:function(){return this.aspectRatio||this.ASPECTRATIO.golden},setAspectRatio:function(e){this.aspectRatio=t.trim(e),t.inArray(this.aspectRatio,t.values(this.ASPECTRATIO))<0&&(this.aspectRatio=this.ASPECTRATIO.golden)},isPortrait:function(){return!!this.portrait},setPortrait:function(e){this.portrait=!!e},getCropImages:function(){return"cropImages"in this?!!this.cropImages:!0},setCropImages:function(e){this.cropImages=!!e},isSlideshow:function(){return"slideshow"in this?!!this.slideshow:!0},setSlideshow:function(e){this.slideshow=!!e},getImageIds:function(){return this.imageIds||[]},setImageIds:function(e){e instanceof Array||(e=[]),this.imageIds=e},addImageId:function(e){var t=this.getImageIds();t.push(e),this.setImageIds(t)},removeImageId:function(e){var i=this.getImageIds();i=t.grep(i,function(t){return e!=t}),this.setImageIds(i)},getImageCount:function(){return this.imageIds instanceof Array?this.imageIds.length:0},getVisibleImage:function(){return Math.max(0,Math.min(parseInt(this.visibleImage)||0,this.getImageCount()-1))},setVisibleImage:function(e){this.visibleImage=Math.max(0,Math.min(parseInt(e)||0,this.getImageCount()-1)),this.updateView()},render:function(){return this.data=t.extend({title:I18n.t("widgets.image.widget_title")},this.data),this.renderWidget("image",{},{icon:"fa-image",help:"en-us/articles/212080725",added:function(){this.startEditing(),this.addImage()}}),this.imageElement=this.domElement.find("ul.images"),this.renderImages(),this.updateView(),this.postpone(function(){this.initNavigation(),this.initEditing()}),t(this).on("changed.images",function(){this.renderImages(),this.updateView(),this.saveSettings()}.bind(this)),this.domElement},getCustomDropdownItems:function(){var e=[];return this.isEditable()&&e.push({caption:I18n.t("widgets.image.add_image"),icon:"fa-plus",action:t.proxy(this.addImage,this),pinned:!0}),e},renderImages:function(){var e=this,i=this.imageElement.empty(),n=this.getImageIds();if(n.length>0)t.each(n,function(n,r){var a=t.cloudinary.url(r,{format:"jpeg",quality:"auto"}),o=t.crel(i,"li",{"data-image":r});o.style.backgroundImage='url("'+a+'")';var s=t.crel(o,"i","remove","fa","fa-times",{title:I18n.t("remove")});t(s).click(function(){e.removeImageId(r),e.triggerImagesChanged()})});else{var r=t.crel(i,"li","placeholder");t(r).click(this.addImage.bind(this))}},updateView:function(){var e=this.imageElement,t=this.domElement.find(".nav.prev"),i=this.domElement.find(".nav.next"),n=this.getVisibleImage();e.attr("data-aspect",this.getAspectRatio()),e.toggleClass("portrait",this.isPortrait()),e.toggleClass("crop",this.getCropImages()),e.css("left",-100*this.getVisibleImage()+"%"),t.toggle(n>0),i.toggle(n<this.getImageCount()-1),this.initSlideshow()},initSlideshow:function(){this.isSlideshow()?this.startSlideshow():this.stopSlideshow()},startSlideshow:function(){function e(){var e=this.getVisibleImage();e=(e+1)%this.getImageCount(),this.setVisibleImage(e)}this.slideshowInterval||(this.slideshowInterval=window.setInterval(e.bind(this),5e3))},stopSlideshow:function(){window.clearInterval(this.slideshowInterval),delete this.slideshowInterval},initNavigation:function(){function e(e){this.stopSlideshow(),this.setVisibleImage(this.getVisibleImage()+e),this.initSlideshow()}var t=this.domElement.find(".nav.prev"),i=this.domElement.find(".nav.next");t.click(e.bind(this,-1)),i.click(e.bind(this,1))},initEditing:function(){if(this.isEditable()){var e=this.domElement.children(".add");e.click(this.addImage.bind(this)),t(this).on("startEditing.widget",this.enableSorting.bind(this)),t(this).on("finishEditing.widget",this.disableSorting.bind(this))}},enableSorting:function(){function e(){n.imageElement.sortable({items:"li",cursor:"move",distance:15,helper:"clone",update:i})}function i(){var e=[];n.imageElement.children().each(function(){var i=t(this),n=i.data("image");n&&e.push(n)}),n.setImageIds(e),n.triggerImagesChanged()}var n=this;this.imageElement.sortable("instance")?this.imageElement.sortable("enable"):e()},disableSorting:function(){this.imageElement.sortable("instance")&&this.imageElement.sortable("disable")},refreshSorting:function(){this.imageElement.sortable("instance")&&this.imageElement.sortable("refresh")},triggerImagesChanged:function(){t(this).trigger("changed.images")},addImage:function(){function t(e){return i.addImageId(e),i.triggerImagesChanged(),i.setVisibleImage(i.getImageCount()-1),!1}var i=this,n=new e.ImageUploader({title:I18n.t("widgets.image.add_image"),uploadPreset:"image_widget",uploaded:t});n.show()},getSettingsConfig:function(){function e(){var e=[];return t.each(a.ASPECTRATIO,function(t,i){e.push({name:I18n.t(t,{scope:"widgets.image.aspect_ratios"}),value:i})}),e}function i(e){var t=e.find("div.orientation");t.toggle(a.getAspectRatio()!=a.ASPECTRATIO.square)}function n(e){i(e)}function r(e){i(e),a.updateView()}var a=this;return{templateValues:{aspectOptions:e()},rendered:n,changed:r}},getCustomSettingsDefaults:function(){return{a:this.ASPECTRATIO.golden,p:!1,c:!0,s:!0,i:[]}},getCustomSettings:function(){return{a:this.getAspectRatio(),p:this.isPortrait()?1:0,c:this.getCropImages()?1:0,s:this.isSlideshow()?1:0,i:this.getImageIds()}},setCustomSettings:function(e){this.setAspectRatio(e.a),this.setPortrait(e.p),this.setCropImages(e.c),this.setSlideshow(e.s),this.setImageIds(e.i)}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Movies=e.Widget.registerType("movies",{render:function(){return this.data=t.extend({title:I18n.t("new_movies_widget_title")},this.data),this.renderWidget("movies",{},{icon:"fa-film",added:function(){}}),this.domElement}})}(Yourls,jQuery),function(e,t){"use strict";var i=16777181;e.Widget.Notes=e.Widget.registerType("notes",{COLORS:{none:0,yellow:1,blue:2,green:3,pink:4},HEIGHT:{auto:0,small:1,medium:2,large:3},getText:function(){return this.text||""},setText:function(e){this.text=t.trim(e)},setColor:function(e){if(e in this.COLORS)return void(e=this.COLORS[e]);var t;switch(e){case this.COLORS.yellow:t=16777181;break;case this.COLORS.blue:t=14544639;break;case this.COLORS.green:t=14548957;break;case this.COLORS.pink:t=16768477}t&&this.setBackgroundColor(t)},setHtml:function(t){t=e.unescape(t),t=t.replace(/<\/p\s*>/gi,"\n\n"),t=t.replace(/<br\s*\/>/gi,"\n"),t=t.replace(/<li\s*>/gi,"\n* "),t=t.replace(/<\/?(font|p|ul|ol|li)\s*>/gi,""),t=t.replace(/<em>(.+?)<\/em>/gi,"*$1*"),t=t.replace(/<strong>(.+?)<\/strong>/gi,"**$1**"),this.setText(t)},getHeight:function(){return parseInt(this.height)||this.HEIGHT.auto},setHeight:function(e){e=parseInt(e)||this.HEIGHT.auto,this.height=Math.max(this.HEIGHT.auto,Math.min(e,this.HEIGHT.large))},render:function(){return this.data=t.extend({title:I18n.t("new_notes_widget_title")},this.data),this.renderWidget("notes",{text:this.getText()},{icon:"fa-sticky-note",help:"en-us/articles/201208671"}),this.renderText(),this.renderStyle(),t(window).on("resize",t.proxy(this.adjustEditorSize,this)),t(this).on("startEditing.widget",t.proxy(this.startedEditing,this)),t(this).on("finishEditing.widget",t.proxy(this.finishedEditing,this)),this.monitorEditor(),this.initAutoSave(),this.initInteraction(),this.domElement},renderText:function(){var t=e.markdown(this.getText(),{sanitize:!1});this.domElement.find("div.markdown")[0].innerHTML=t},renderStyle:function(){var e=this,i=this.getHeight();t.each(t.values(this.HEIGHT),function(t,n){e.domElement.toggleClass("height-"+n,n==i)})},startedEditing:function(){var e=this.domElement.find("textarea.editor");e.height(0),this.adjustEditorSize(),e.focus()},finishedEditing:function(){this.autoSave(),this.renderText()},monitorEditor:function(){function e(){window.setTimeout(t.proxy(this.adjustEditorSize,this),1)}var i=this.domElement.find("textarea.editor");i.on("keydown",e),i.on("paste",e)},adjustEditorSize:function(){var e=this.domElement.find("textarea.editor"),t=e[0],i=t.scrollHeight;e.height(i);var n=t.scrollHeight-i;e.height(i-n)},initAutoSave:function(){window.setInterval(t.proxy(this.autoSave,this),5e3)},autoSave:function(){var e=this.getEditorText(),t=this.getText();t!=e&&(this.setText(e),this.saveSettings())},initInteraction:function(){this.domElement.find(".markdown").dblclick(t.proxy(this.startEditing,this))},getEditorText:function(){return t.trim(this.domElement.find("textarea.editor").val())},getDefaultBackgroundColor:function(){return i},getCustomSettingsDefaults:function(){return{t:"",s:this.HEIGHT.auto}},setCustomSettings:function(e){e.h?this.setHtml(e.h):this.setText(e.t),this.setColor(e.c||this.getBackgroundColor()),this.setHeight(e.s)},getCustomSettings:function(){return{t:this.getText(),s:this.getHeight()}},getSettingsConfig:function(){var e=this;return{changed:function(){e.renderStyle()}}}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.PublicPage=e.Widget.registerType("public_page",{page:{},render:function(){return this.renderWidget("public_page",t.extend(this.page,{by_user:this.page.owner?I18n.t("by_user",{user:this.page.owner.name}):null}),{icon:"fa-file",anchor:"page-"+this.page.id,added:function(){},canBeCopied:!1}),this.checkScreenshot(),this.updateClasses(),this.domElement},getCustomSettingsDefaults:function(){return{id:null,url:null,description:null,screenshot:null,moderate:null,popular:null,owner:null,organization:null}},setCustomSettings:function(e){this.page=e},updateClasses:function(){var e=this,i={"is-owner":this.isOwner,"is-moderator":this.isModerator,"is-guest":this.isGuest,"is-popular":this.isPopular,"is-pinned":this.isPinned};t.each(i,function(t,i){e.domElement.toggleClass(t,i.call(e))})},getCustomHeaderButtons:function(){var e=[];return e.push({icon:"fa-star",classes:"view-only pinned",caption:I18n.t("unfavorite"),action:t.proxy(this.unsubscribe,this)}),e.push({icon:"fa-thumbs-up",classes:"view-only popular",caption:I18n.t("subject.popular"),action:t.proxy(this.togglePopularState,this)}),e},getCustomDropdownItems:function(){var i=[];this.isModerator()&&i.push({icon:this.isPopular()?"fa-check":"fa-ban",caption:I18n.t("subject.popular"),action:t.proxy(this.togglePopularState,this)},"-"),i.push({icon:"fa-arrow-right",caption:I18n.t("view_page"),url:this.getPageUrl()});var n=this.getPageId(),r=e.pages.get(n);return r&&r.is_editor&&i.push({icon:"fa-pencil",caption:I18n.t("edit_page"),action:t.proxy(e.editPageDialog,e,n,{reloadOnSave:!0})}),r&&r.is_editor||(i.push("-"),this.isPinned()?i.push({icon:"fa-star-o",caption:I18n.t("unfavorite"),action:t.proxy(this.unsubscribe,this)}):i.push({icon:"fa-star",caption:I18n.t("make_favorite"),action:t.proxy(this.subscribe,this)})),i},checkScreenshot:function(){var e=this;if(this.page.screenshot){var t=new Image;t.onload=function(){e.domElement.find(".screenshot").addClass("has-screenshot")},t.src=this.page.screenshot}},getPageId:function(){return this.page.id},getPageUrl:function(){return this.page.url},isOwner:function(){return this.page.owner&&this.page.owner.owns_page},belongsToOrganization:function(){return!!this.page.organization},isModerator:function(){return!!this.page.moderate},isGuest:function(){return!this.isOwner()&&!this.isModerator()},isPopular:function(){return!!this.page.popular},togglePopularState:function(){this.setPopularState(!this.page.popular)},setPopularState:function(i){function n(e){r.page.popular=t.inArray("popular",e.tags)>=0,r.updateClasses()}if(!this.isModerator())return!1;var r=this;e.ajaxSave({url:"/page/"+this.page.id+"/tags/popular",type:i?"put":"delete",contentType:"application/json",dataType:"json",success:n})},isPinned:function(){if("pinned"in this.page)return this.page.pinned;var t=e.pages.get(this.getPageId());return this.page.pinned=t&&t.pinned},subscribe:function(){var t=this;e.Page.API.subscribe(this.getPageId()).done(function(){t.page.pinned=!0,t.updateClasses()})},unsubscribe:function(){var t=this;e.Page.API.unsubscribe(this.getPageId()).done(function(){t.page.pinned=!1,t.updateClasses()})}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.RssList=e.Widget.registerType("rsslist",{IMAGEMODE:{no_image:0,thumbnail:1,large:2,xl:3,xl_only:4},getPageSize:function(){return"number"==typeof this.maxArticles?this.maxArticles:10},setPageSize:function(e){this.maxArticles=parseInt(e)||null},isTabLayout:function(){return 1==this.presentation},setTabLayout:function(e){this.presentation="undefined"==typeof e?1:e?1:0},hasPagination:function(){return 1==this.pagination},setPagination:function(e){this.pagination="undefined"==typeof e?1:e?1:0},getSummaryCount:function(){var e=parseInt(this.focus);return"number"==typeof e?e:1},setSummaryCount:function(e){e=parseInt(e),this.focus="number"==typeof e?e:1},getImageMode:function(){var e=parseInt(this.imageMode);return isNaN(e)?this.IMAGEMODE.large:e},setImageMode:function(e){this.imageMode=parseInt(e),isNaN(this.imageMode)&&(this.imageMode=this.IMAGEMODE.large)},getStartWithXLImage:function(){return!!this.startWithXLImage},setStartWithXLImage:function(e){this.startWithXLImage=!!e},getCurrentFeedId:function(){if(!this.isTabLayout())return null;if("number"==typeof this.currentFeed)return this.currentFeed;var e=this.getFeeds();return e.length?e[0].id:null},getCurrentFeed:function(){return this.getFeedById(this.getCurrentFeedId())},setCurrentFeed:function(e){this.currentFeed=this.isTabLayout()?parseInt(e)||null:null},getArticles:function(){return this.articles||[]},setArticles:function(e){this.articles=t.isArray(e)?e:[]},getArticleCount:function(){return this.getArticles().length},getFeeds:function(){return this.feeds||[]},getFeedById:function(e){var t=this.getFeeds();for(var i in t){var n=t[i];if(n.id==e)return n}},setFeeds:function(e){this.feeds=t.isArray(e)?e:[]},registerFeed:function(e){this.feeds.push(e)},getFeedCount:function(){return this.getFeeds().length},getCurrentPage:function(){return Math.max(1,parseInt(this.currentPage)||0)},setCurrentPage:function(e){this.currentPage=Math.min(Math.max(1,parseInt(e)||0),this.getPageCount())},getPageCount:function(){return Math.ceil(this.getArticleCount()/this.getPageSize())},getDefaultTitle:function(){return I18n.t("new_feed_widget_title")},replaceDefaultTitle:function(e){1==this.feeds.length&&this.getTitle()==this.getDefaultTitle()&&(this.setTitle(e),this.saveSettings())},render:function(){this.data=t.extend({title:this.getDefaultTitle(),items:{feeds:[],articles:[]},url:this.isPersisted()&&"/widget/"+this.getId()+"/feeds"
},this.data),this.setFeeds(this.data.items.feeds),this.setArticles(this.data.items.articles),this.renderWidget("rsslist",{},{icon:"fa-rss",help:"en-us/articles/200552632",subnav:{autohide:!0,showFavicons:e.Model.showFavicons(),faviconPlaceholder:"fa-rss",items:t.proxy(this.getFeedMenuItems,this)},url:this.data.url||this.isPersisted()&&"/widget/"+this.getId()+"/feeds",added:t.proxy(this.browseFeeds,this)});var i=this.getCurrentFeedId()||"all";this.getCurrentFeed();return this.getArticles().length||this.tryCache("feed-"+i,function(e){this.setArticles(e.articles),this.postpone(this.refresh)},function(){window.setTimeout(t.proxy(this.refresh,this),100)}),this.renderArticles(),e.Model.showFavicons()&&this.renderFavicons(),this.showErrors(),t(this).on("finishEditing.widget",t.proxy(this.renderSubnav,this)),t(this).on("delete",t.proxy(function(){this.refreshTimeout&&clearTimeout(this.refreshTimeout)},this)),this.postpone(function(){this.renderFeeds(),this.initAddFeed(),this.initPagination(),this.isEditable()&&this.initSortable(),this.initRefresh()}),this.domElement},getCustomDropdownItems:function(){var e=[];return this.isPersisted()&&(e.push({caption:I18n.t("add_feed"),icon:"fa-plus",classes:"editable-only",action:t.proxy(this.browseFeeds,this),pinned:!0}),e.push({caption:I18n.t("refresh"),icon:"fa-refresh",action:t.proxy(this.refresh,this)})),e},getCustomHeaderButtons:function(){var i=[];return this.options.url&&i.push({icon:"fa-external-link",classes:"view-only",caption:I18n.t("read_more"),action:t.proxy(e.embedPage,e,this.options.url,{once:!0})}),i},initAddFeed:function(){this.domElement.find(".add a.new").click(t.proxy(function(e){e.preventDefault(),this.browseFeeds()},this))},initClickLink:function(){var e=this.domElement.find(".body"),i=t.proxy(this.linkClick,this);e.find("span.edit-link").off("click").on("click",i),e.find("a.link").off("click").on("click",i),e.find("a.image").off("click").on("click",i)},getSettingsConfig:function(){function e(){for(var e=[],t=1;20>=t;t++)e.push({label:I18n.t("n_articles",{count:t}),value:t});return e}function t(e){i(e),n.renderFeeds(),n.updateArticles(),n.checkPagination()}function i(e){var t=e.find("div.summaries-only"),i=e.find("div.regular-image-summaries-only"),r=n.getSummaryCount();t.toggle(r>0);var a=n.getImageMode(),o=a>n.IMAGEMODE.no_image&&a<n.IMAGEMODE.xl;i.toggle(r>1&&o)}var n=this;return{templateValues:{countOptions:e()},rendered:i,changed:t}},getCustomSettingsDefaults:function(){return{n:10,p:!0,m:!0,f:1,i:this.IMAGEMODE.thumbnail,x:!1}},getCustomSettings:function(){return{n:this.getPageSize(),p:this.hasPagination()?1:0,m:this.isTabLayout()?1:0,f:this.getSummaryCount(),i:this.getImageMode(),x:this.getStartWithXLImage()?1:0}},setCustomSettings:function(e){this.setPageSize(e.n),this.setPagination(e.p),this.setTabLayout(e.m),this.setSummaryCount(e.f),this.setImageMode(e.i),this.setStartWithXLImage(e.x)},getRelatedItemIds:function(){return t.map(this.getFeeds(),function(e){return e.id})},browseFeeds:function(){var i=this,n=[];t.each(this.getFeeds(),function(){n.push(this.url)}),new e.FeedBrowser({excluded:n,add:function(e){return i.addFeed(e),!0}}).show()},initPagination:function(){var e=this;this.domElement.find(".prev").bind("click",function(t){t.stopPropagation(),t.preventDefault(),e.previousArticlesPage()}),this.domElement.find("a.next").bind("click",function(t){t.stopPropagation(),t.preventDefault(),e.nextArticlesPage()})},initSortable:function(){var i=this;this.domElement.find("ul.feedlist").sortable({items:".feed",connectWith:".widget-rsslist ul.feedlist",placeholder:"ui-sortable-placeholder",forcePlaceholderSize:!0,update:function(n,r){var a=null;if("undefined"!=typeof r.sender){a=t(r.sender).parents(".widget-rsslist").data("widget_id");var o=e.getActivePage().getWidgetById(a)}if(null!=a&&a!=i.getId()){var s=t(r.item),d={widget:i.getId(),index:s.data("index")};o.putFeed(s.data("item_id"),d,function(){o.reorder()})}i.reorder()},start:function(){i.domElement.addClass("sorting")},stop:function(){i.domElement.removeClass("sorting")}}),this.domElement.droppable({accept:".widget-rsslist ul.feedlist .feed",activeClass:"ui-state-highlight",drop:function(n,r){var a=t(r.draggable).parents(".widget-rsslist").data("widget_id");if(a!=i.getId()){var o=e.getActivePage().getWidgetById(a);if(!i.isEditing()){i.toggleEditing(),r.draggable.clone().appendTo(t(this).find("ul.feedlist"));var s={widget:i.getId(),index:i.getFeedCount()};o.putFeed(r.draggable.data("item_id"),s,function(){o.reorder()})}}i.reorder()}})},initRefresh:function(){this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(t.proxy(function(){this.refresh()},this),36e5)},refresh:function(){this.isPersisted()&&(this.initRefresh(),this.updateArticles())},reorder:function(){var i=[];this.domElement.find("li.feed").each(function(e,n){n=t(n),n.data("index",e),i.push({id:n.data("item_id"),index:n.data("index")})});var n={feeds:i};e.ajaxSave({url:"/widget/"+this.getId()+"/feeds",type:"put",contentType:"application/json",accept:"application/json",dataType:"json",data:JSON.stringify(n),success:t.proxy(function(){this.setCurrentFeed(null),this.setCurrentPage(1),this.loadFeeds(t.proxy(function(){this.renderFeeds(),this.updateArticles()},this))},this)})},linkClick:function(i){var n=t(i.delegateTarget);if(i.preventDefault(),this.isEditing()){var r=n.data("item_id")||n.parents("li:first").data("item_id");return this.editFeed(r),!1}var a=n.attr("href"),o=n.parents("li.article:first");o.tooltip("instance")&&o.tooltip("destroy"),e.gtmEvent("RssClick",{url:a}),e.UrlHelper.openUrl(a,i)},initDeleteFeed:function(){var e=this;this.domElement.find("a.delete").off("click").on("click",function(i){var n=t(this).parents("li"),r=n.data("item_id");n.remove(),e.deleteFeed(r,function(){}),i.stopPropagation(),i.preventDefault()})},addFeed:function(t){var i=this;this.postFeed(t,function(t){i.replaceDefaultTitle(t.name),i.setCurrentFeed(null),i.setCurrentPage(1),i.checkPagination(),i.renderFeeds(),i.initDeleteFeed(),t.loaded===!0?i.updateArticles():i.pollFeed(t.id,function(){i.loadFeeds(function(){i.renderFeeds()}),i.updateArticles()},function(){i.showErrors(t.id)},1e3,6),e.Model.showFavicons()&&i.renderFavicons()})},editFeed:function(i){if(i){var n=this,r=this.domElement.find('li.feed[data-item_id="'+i+'"]'),a=r.find("a"),o=a.attr("href"),s=r.data("name");e.sidebar("widgets/rsslist/edit_feed",{formdata:{title:s,url:o},title:I18n.t("edit_feed"),icon:"fa-rss",alert:I18n.t("fill_in_feed_details"),autofocus:!0,buttons:[{caption:I18n.t("save"),icon:"fa-save","default":!0,action:function(e){var o=t.trim(e.title);return o.length?void(o!=s&&n.putFeed(i,{name:o},function(e){a.text(e.data.name),r.data("name",o);var t=n.getFeedById(i);t.name=o,n.renderFeeds()})):I18n.t("please_specify_title")}},{caption:I18n.t("delete_feed"),icon:"fa-trash",action:function(){r.remove(),n.deleteFeed(i)}}]})}},pollFeed:function(e,i,n,r,a){function o(){if(a>l){setTimeout(s,u);var e=c+u;c=u,u=e}else d()}function s(){a>l?(l+=1,t.ajax({url:"/widget/"+h.getId()+"/feed/"+e+"/poll",type:"get",contentType:"application/json",dataType:"json",success:function(e){e.error?(d(),n()):e.updated?(d(),i()):o()},error:function(){d()}})):d()}function d(){h.setLoading(!1)}var l=0,c=0,u=r,h=this;o(),this.setLoading(!0)},postFeed:function(t,i){var n=this;e.ajaxSave({url:"/widget/"+this.getId()+"/feed",type:"post",contentType:"application/json",data:JSON.stringify(t),dataType:"json",success:function(e){n.registerFeed(e),i(e)},error:function(){return e.error(I18n.t("failed_to_add_feed")),!0}})},putFeed:function(t,i,n){e.ajaxSave({url:"/widget/"+this.getId()+"/feed/"+t,type:"put",contentType:"application/json",data:JSON.stringify(i),dataType:"json",success:n,error:function(e){return 404==e.status?!0:void 0}})},deleteFeed:function(t,i){var n=this;i=i||function(){},e.ajaxSave({url:"/widget/"+this.getId()+"/feed/"+t,type:"delete",contentType:"application/json",dataType:"json",success:function(e){var r=n.getFeeds(),a=[];for(var o in r){var s=r[o];t!=s.id&&a.push(s)}n.setFeeds(a),n.renderFeeds(),n.getCurrentFeedId()==t&&n.selectFeed(n.getFeedCount()?n.getFeeds()[0].id:null),n.updateArticles(),i(e)}})},checkPagination:function(){var e=this.getArticleCount(),t=this.domElement.find("nav.pager");0==e||e<=this.getPageSize()?this.domElement.removeClass("has-pager"):this.hasPagination()?this.domElement.addClass("has-pager"):this.domElement.removeClass("has-pager"),this.getCurrentPage()>1?t.find("a.prev").removeAttr("disabled"):t.find("a.prev").attr("disabled","disabled"),this.getCurrentPage()<this.getPageCount()?t.find("a.next").removeAttr("disabled"):t.find("a.next").attr("disabled","disabled"),t.find(".current").text(this.getCurrentPage()),t.find(".total").text(this.getPageCount())},nextArticlesPage:function(){this.getCurrentPage()<this.getPageCount()&&(this.setCurrentPage(this.getCurrentPage()+1),this.renderArticles())},previousArticlesPage:function(){this.getCurrentPage()>1&&(this.setCurrentPage(this.getCurrentPage()-1),this.renderArticles())},updateArticles:function(){this.loadArticles(t.proxy(this.renderArticles,this),this.getCurrentFeedId())},loadArticles:function(i,n){this.setLoading(!0),n="undefined"!=typeof n?n:null,e.Widget.RssList.API.loadArticles(this.getId(),n).then(function(e){this.setArticles(e),this.setLoading(!1);var r=t.extend({articles:e},this.getFeedById(n));this.setCache("feed-"+(n||"all"),r),i(e)}.bind(this))},loadFeeds:function(e){this.setLoading(!0),t.ajax({url:"/widget/"+this.getId()+"/feed",type:"get",contentType:"application/json",dataType:"json",success:t.proxy(function(t){this.setFeeds(t.items),this.setLoading(!1),e(t.items)},this)})},renderArticles:function(){var i=this,n=this.getArticles(),r=this.getPageSize(),a=(this.getCurrentPage()-1)*r;n=n.slice(a,a+r);var o=this.domElement.find("ul.articlelist").detach();o.empty();var s=!1,d=i.getImageMode(),l=this.getSummaryCount(),c=l>1&&this.getStartWithXLImage()&&d>i.IMAGEMODE.no_image&&d<i.IMAGEMODE.xl;t.each(n,function(n,r){r.monetized_url=e.UrlHelper.monetizeUrl(r.url,r.monetizer);var a=225,d="article";if(l>n){var u=(r.date||"").toString().toMoment();r.dateago=t.timeago(u.toDate()),r.isodate=u.toISOString();var h=i.getImageMode();c&&0==n&&(h=i.IMAGEMODE.xl),r.showImage=h>i.IMAGEMODE.no_image&&!!r.image_url,r.showThumbnail=h==i.IMAGEMODE.thumbnail,r.showLargeImage=h==i.IMAGEMODE.large,r.showXLImage=h>=i.IMAGEMODE.xl,r.showText=h!=i.IMAGEMODE.xl_only,a=r.showXLImage?600:225,d="focus_article",s=!0}else r.showImage=r.showThumbnail=r.showLargeImage=r.showXLImage=!1,r.firstNoFocus=n==i.getSummaryCount(),r.singleFeed=i.isTabLayout(),r.showText=!1;r.image_url&&(r.cloudinary_image_url=t.cloudinary.url(r.image_url,{type:"fetch",crop:"limit",width:a,height:2*a,format:"auto",quality:70,page:1}));var f=JST["widgets/rsslist/"+d](r),g=t(f).appendTo(o);e.hasTouchScreen()||g.children().addBack().filter("li[title]").one("mouseover",function(){t(this).tooltip({items:"a",position:{my:"left+20 bottom-20",at:"right top"},show:{effect:"fade",duration:100,delay:1200},hide:{effect:"toggle",duration:0},track:!0,tooltipClass:"rss-article",content:function(){var e=(r.date||"").toString().toMoment();return r.dateago=t.timeago(e.toDate()),r.isodate=e.toISOString(),JST["widgets/rsslist/article_tooltip"](r)}})}),r.showImage&&e.postpone(function(){var e=new Image;e.onload=e.onerror=function(){e.width>=50&&e.height>=50||(g.find(".focus_image").remove(),g.addClass("no-image"))},e.src=r.cloudinary_image_url})}),this.domElement.find(".body").prepend(o),this.checkPagination(),e.postpone(function(){e.Model.showFavicons()&&this.renderFavicons(),this.initClickLink()},this)},renderFeeds:function(){var i=this.domElement.find("ul.feedlist");i.find("li").each(function(e,i){t(i).remove()});var n=this.getFeeds();for(var r in n){var a=n[r];a.show_error=2==a.status;var o=JST["widgets/rsslist/feed"](a);i.append(o)}this.checkPagination(),e.Model.showFavicons()&&this.renderFavicons(),this.renderSubnav(),this.showErrors(),this.initDeleteFeed(),this.initClickLink()},getFeedMenuItems:function(){var e=this;if(!this.isTabLayout())return[];var i=[];return t.each(this.getFeeds(),function(){i.push({caption:this.name,url:this.url,active:e.getCurrentFeedId()==this.id,action:t.proxy(e.selectFeed,e,this.id)})}),i},selectFeed:function(e){return this.getFeedById(e)?(this.setCurrentFeed(e),this.setCurrentPage(1),this.updateArticles(),void this.renderSubnav()):!1},showErrors:function(e){var i='ul.feedlist li[data-status="2"]';"undefined"!=typeof e&&null!=e&&(i='ul.feedlist li[data-item_id="'+e+'"]'),this.domElement.find(i).each(function(e,i){t(i).find("a.link i.fa-warning").removeClass("hide")})}}),e.Widget.RssList.API=function(){function e(e,t){return i(e,t)}function i(e,i){var a=t.Deferred();return r.push({widgetId:parseInt(e),feedId:i,deferred:a}),1==r.length&&setTimeout(n,10),r.length>=25&&n(),a.promise()}function n(){var e=r;if(r=[],e.length){var i={},n=[];for(var a in e){var o=e[a];o.feedId?n.push(o.widgetId+"_"+o.feedId):n.push(o.widgetId),i[o.widgetId]=o.deferred}return n="/widgets/"+n.join(",")+"/articles",t.ajax({url:n,type:"get",contentType:"application/json",dataType:"json"}).then(function(e){t.each(i,function(t,i){i.resolve(e[t])})}).fail(function(){t.each(i,function(e,t){t.reject()})})}}var r=[];return{loadArticles:e}}()}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Search=e.Widget.registerType("search",{provider:null,defaultProviderId:null,searchProviders:null,render:function(){return this.data=t.extend({title:I18n.t("search")},this.data),this.renderWidget("search",{},{icon:"fa-search",added:function(){}}),this.selectProvider(this.getDefaultProvider(),!0),this.monitorSearchProviders(),this.initSearch(),this.initAutoComplete(),this.initProviderSelector(),this.domElement},getCustomDropdownItems:function(){return[{caption:I18n.t("manage_search_providers"),icon:"fa-search-plus",action:function(){e.searchProviders.showEditProvidersDialog()}}]},getDefaultProvider:function(){var i=this;if(this.searchProviders){var n=null;return t.each(this.searchProviders,function(){(!n||i.data.user_default)&&(n=this)}),n}var r=e.searchProviders.getVisibleProviders();if(this.defaultProviderId){var a=this.defaultProviderId;if(r[a])return r[a]}return e.searchProviders.getDefaultProvider()},setDefaultProvider:function(e){this.defaultProviderId=e||0},getCustomSettingsDefaults:function(){return{defaultProviderId:null,searchProviders:null}},setCustomSettings:function(i){this.defaultProviderId=i.defaultProviderId||0,i.searchProviders&&(this.searchProviders={},t.each(i.searchProviders,function(t,i){self.searchProviders[i.id]=new e.Search.Provider(i)}))},getCustomSettings:function(){var e={defaultProviderId:this.defaultProviderId||0};if(this.searchProviders){var t=[];for(var i in this.searchProviders)if(this.searchProviders.hasOwnProperty(i)){var n=this.searchProviders[i];t.push(n.data)}e.searchProviders=t}return e},initSearch:function(){var e=this;this.domElement.find("form.search").submit(function(t){t.preventDefault(),e.executeSearch()})},initAutoComplete:function(){var e=this,t=this.domElement.find("input.search");t.autocomplete({autoFocus:!1,minLength:3,html:!0,source:function(t,i){e.provider.suggest(t.term,function(e){i(e)})},select:function(t,i){t.stopPropagation(),e.provider.search(i.item.value)}})},initProviderSelector:function(){function i(){var i=[],r=n.searchProviders||e.searchProviders.getVisibleProviders();return t.each(r,function(e,t){i.push({caption:t.getName(),url:t.getUrl(),index:t.getIndex(),action:function(){n.selectProvider(t),n.focus(),n.setDefaultProvider(t.getId()),n.saveSettings()}})}),i.sort(function(e,t){return e.index-t.index}),i}var n=this,r=this.domElement.find("form.search"),a=r.find(".favicon");a.dropdown({position:{my:"left top",at:"left bottom",of:r},showFavicons:!0,items:i})},selectProvider:function(e,t){if(this.provider=!t&&e,!e)return!1;var i=e.getFaviconUrl(),n=this.domElement.find("form.search .favicon");n.attr("title",e.data.name).css({"background-image":"url("+i+")"});var r=I18n.t("search_placeholder",{provider:e.data.name});this.domElement.find("input.search").attr("placeholder",r)},monitorSearchProviders:function(){var i=this;t(e.searchProviders).on("loaded",function(){i.provider||i.selectProvider(i.getDefaultProvider())})},executeSearch:function(){var e=t.trim(this.domElement.find("input.search").val());this.provider.search(e)},focus:function(){this.domElement.find("input.search").focus()}})}(Yourls,jQuery),function(e,t){"use strict";var i="lzpMbU2bcZF5L3R4";e.Widget.Songkick=e.Widget.registerType("songkick",{currentSearch:null,currentPage:1,totalPages:1,hasNextPage:!1,hasPreviousPage:!0,maxResults:10,pagination:1,render:function(){return this.data=t.extend({title:I18n.t("songkick_widget_title")},this.data),this.renderWidget("songkick",{},{icon:"fa-music",subnav:{autohide:!0,showFavicons:!0,items:t.proxy(this.getSearchMenuItems,this)},settings:this.settingsDialog,added:t.proxy(this.addSearchSidebar,this)}),this.currentSearch=this.data.items.searches?this.data.items.searches[0].id:null,this.currentPage=1,this.totalPages=1,this.publishSearches(),this.getResults(t.proxy(function(e){this.publishResults(e)},this),1,this.currentSearch),this.initAddSearch(),this.initPagination(),this.initSortable(),t(this).on("finishEditing.this",t.proxy(this.renderSubnav,this)),this.domElement},initAddSearch:function(){this.domElement.find(".add a.new").click(t.proxy(this.addSearchSidebar,this))},addSearchSidebar:function(){function n(){l=t(this),c=l.find("ul.suggestions"),l.find(".loader").hide(),l.find("input.search").autocomplete({autoFocus:!0,delay:1e3,minLength:2,html:!0,search:function(e,t){c.empty()},source:function(e,t){l.find(".loader").show(),h=[],r(e.term)}})}function r(e){t.each(u,function(n,r){t.ajax({url:"http://api.songkick.com/api/3.0/search/"+r+"s.json?per_page=10&apikey="+i,dataType:"jsonp",jsonp:"jsoncallback",data:{query:t.trim(e)},success:function(t){a(r,e,t)}})})}function a(e,i,n){if(n&&n.resultsPage&&n.resultsPage.results){var r=n.resultsPage.results[e];t.each(r||[],function(i,n){n["type_"+e]=1;var r=JST["widgets/songkick/search_name"](n);"location"==e&&(n=n.metroArea),o({id:n.id,name:t.trim(r),url:n.uri,type:e})})}h.push(e),u.length==h.length&&l.find(".loader").hide()}function o(e){var i=t("<a/>").text(e.name);t("<i/>").addClass("fa").addClass("artist"==e.type?"fa-group":"venue"==e.type?"fa-home":"fa-globe").prependTo(i);return i.click(function(t){t.preventDefault(),l.sidebar("close"),s(e)}),t("<li/>").append(i).appendTo(c)}function s(e){if("undefined"==typeof e||null==e)return!1;e.apikey=i,e.n=e.name;var t=JST["widgets/songkick/search"](e);d.domElement.find("ul.searches").append(t),d.saveData(),d.selectSearch(e.id),d.startEditing(),d.initDeleteSearch(),d.initClickLink()}var d=this;e.sidebar("widgets/songkick/add_search",{title:I18n.t("songkick_add_search"),icon:"fa-music",extraClasses:"songkick-browser",formdata:{search:""},buttons:[{caption:I18n.t("cancel"),icon:"fa-times"}],rendered:n});var l,c,u=["artist","venue","location"],h=[]},initClickLink:function(){var e=this.domElement.find(".body"),i=t.proxy(this.linkClick,this);e.find("i.edit-link").unbind("click").on("click",i),e.find("a.link").unbind("click").on("click",i)},getCustomSettingsDefaults:function(){return{s:[],n:10,p:!1}},setCustomSettings:function(e){this.data.items=this.data.items||{},this.data.items.searches=e.s,this.data.items.results=this.data.items.results||[],this.maxResults=parseInt(e.n),this.pagination=!!e.p},getCustomSettings:function(){return{s:this.data.items.searches,n:parseInt(this.maxResults),p:this.pagination?1:0}},settingsDialog:function(){function e(e){i.maxResults=parseInt(e.count)||10,i.pagination="1"==e.pagination?1:0,i.saveData(),i.getResults(function(e){i.publishResults(e)},1,i.currentSearch)}function t(){for(var e=[],t=1;20>=t;t++)e.push({label:I18n.t("n_music_events",{count:t}),value:t});return e}var i=this;this.settingsSidebar("songkick",{values:{countOptions:t()},formdata:{count:this.maxResults,pagination:this.pagination?1:0},save:e})},initPagination:function(){var e=this;this.domElement.find(".prev").bind("click",function(t){e.previousResultsPage(function(t){e.publishResults(t)}),t.stopPropagation(),t.preventDefault()}),this.domElement.find(".next").bind("click",function(t){e.nextResultsPage(function(t){e.publishResults(t)}),t.stopPropagation(),t.preventDefault()})},initSortable:function(){this.domElement.find("ul.searches").sortable({connectWith:".widget-songkick ul.searches",placeholder:"ui-sortable-placeholder",forcePlaceholderSize:!0,update:t.proxy(this.saveData,this)})},linkClick:function(i){var n=t(i.delegateTarget);if(this.isEditing()){var r=n.data("item_id")||n.parents("li:first").data("item_id");return i.stopPropagation(),i.preventDefault(),this.editSearch(r),!1}return e.shouldOpenLinksInNewWindow()?(window.open(n.attr("href")),!1):void(window.top!==window.self&&(window.top.location.href=n.attr("href")))},initDeleteSearch:function(){var e=this;this.domElement.find("i.delete").unbind("click"),this.domElement.find("i.delete").on("click",function(i){var n=t(this).parents("li");n.remove(),e.saveData(),i.stopPropagation(),i.preventDefault()})},editSearch:function(i){if(i){var n=this,r=this.domElement.find('li.search[data-item_id="'+i+'"]'),a=r.find("a"),o=(a.attr("href"),r.data("name"));e.sidebar("widgets/songkick/edit_search",{formdata:{title:o},title:I18n.t("edit"),icon:"fa-music",autofocus:!0,buttons:[{caption:I18n.t("save"),icon:"fa-save","default":!0,action:function(e){var i=t.trim(e.title);return i.length?void(i!=o&&(a.text(i),r.data("name",i),n.saveData())):I18n.t("please_specify_title")}},{caption:I18n.t("delete"),icon:"fa-trash",action:function(){var e=a.parent();e.remove(),n.saveData()}}]})}},updateSearches:function(){var e=[];this.domElement.find("li.search").each(function(i,n){n=t(n),n.data("index",i),e.push({id:n.data("item_id"),n:n.data("name"),t:n.data("type"),url:n.data("url")})}),this.data.items.searches=e},saveData:function(){this.updateSearches(),this.saveSettings(),this.publishSearches()},checkPagination:function(){var e=this.data.items.results_count,t=this.domElement.find("nav.pager");0==e?t.hide():1==this.pagination?t.show():t.hide(),this.hasPreviousPage=this.currentPage>1,this.hasNextPage=this.currentPage*this.maxResults<e,this.hasPreviousPage?t.find("a.prev").removeAttr("disabled"):t.find("a.prev").attr("disabled","disabled"),this.hasNextPage?t.find("a.next").removeAttr("disabled"):t.find("a.next").attr("disabled","disabled"),t.find(".current").text(this.currentPage),t.find(".total").text(this.totalPages)},nextResultsPage:function(e){this.hasNextPage&&(null!=this.currentSearch?this.getResults(e,this.currentPage+1,this.currentSearch):this.getResults(e,this.currentPage+1))},previousResultsPage:function(e){this.hasPreviousPage&&(null!=this.currentSearch?this.getResults(e,this.currentPage-1,this.currentSearch):this.getResults(e,this.currentPage-1))},getResults:function(e,n,r){var a=this;this.setLoading(!0);var n="undefined"!=typeof n?n:1,r="undefined"!=typeof r?r:null,o=this.getSettings(),s=o.s;return s&&s.length>0?void t.each(s,function(o,s){if(r!=s.id)return!0;var d="songkick_"+s.t+"_"+s.id,l=a.getCache(d);if(l)return a.currentPage=n,a.data.items.results_count=l.length,a.totalPages=Math.ceil(a.data.items.results_count/a.maxResults),a.data.items.results=l,a.setLoading(!1),e(l.slice(n*a.maxResults-a.maxResults,n*a.maxResults)),!0;var c="";switch(s.t){case"artist":c="artists";break;case"venue":c="venues";break;case"location":c="metro_areas"}t.ajax({url:"http://api.songkick.com/api/3.0/"+c+"/"+s.id+"/calendar.json?apikey="+i,type:"get",contentType:"application/json",dataType:"jsonp",jsonp:"jsoncallback",success:function(i){var r=[],o=i.resultsPage.results.event||[];t.each(o||[],function(e,i){i["type_"+s.t]=1;var n=JST["widgets/songkick/result_name"](i);r.push({name:t.trim(n),date:i.start.date,url:i.uri})}),a.setCache(d,r,DAY),a.currentPage=n,a.data.items.results_count=r.length,a.totalPages=Math.ceil(a.data.items.results_count/a.maxResults),a.data.items.results=r,a.setLoading(!1),e(r.slice(n*a.maxResults-a.maxResults,n*a.maxResults))},error:function(){a.setLoading(!1),Bugsnag.notify("SongkickError","Failed to get Songkick results",{parameters:{search:s}},"warning")}})}):(this.setLoading(!1),void e([]))},publishResults:function(i){if("undefined"!=typeof i&&null!=i){var n=this;this.data.items.results=i;var r=n.domElement.find("ul.results");r.find("li").addClass("old");var a=this.data.items.results.length<this.maxResults?this.data.items.results.length:this.maxResults;if(a>0)for(var o=0;a>o;++o){var s=this.data.items.results[o],d=moment(s.date);s.date=d.format("ll");var l=JST["widgets/songkick/result"](s);t(l).appendTo(r).hide()}else{var c="search term",u="";t.each(this.data.items.searches||[],function(e,t){n.currentSearch==t.id&&(c=t.n,u=t.url)});var l=JST["widgets/songkick/result"]({id:0,name:I18n.t("no_music_events",{term:c}),url:u});t(l).appendTo(r).hide()}r.find(".old").remove(),r.find("li").fadeIn(),this.checkPagination(),e.Model.showFavicons()&&this.renderFavicons(),this.initClickLink()}},publishSearches:function(){var e=this.getSettings(),n=e.s||[],r=this.domElement.find("ul.searches");r.find("li").each(function(e,i){t(i).remove()});for(var a=0;a<n.length;++a){var o=n[a];o.apikey=i,o.type=o.t,o[o.type]=1;var s=JST["widgets/songkick/search"](o);r.append(s)}this.checkPagination(),this.renderSubnav(),this.initDeleteSearch(),this.initClickLink()},getSearchMenuItems:function(){var e=[],i=this;return t.each(this.data.items.searches||[],function(){e.push({caption:this.n,url:this.url,active:i.currentSearch==this.id,action:t.proxy(i.selectSearch,i,this.id)})}),e},selectSearch:function(e){var i=!1;return t.each(this.data.items.searches,function(){return this.id==e?void(i=this):void 0}),i?(this.currentSearch=e,this.currentPage=1,this.getResults(t.proxy(this.publishResults,this),1,e),void this.renderSubnav()):!1}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.StockMarket=e.Widget.registerType("stock",{render:function(){return this.data=t.extend({title:I18n.t("new_stock_widget_title")},this.data),this.renderWidget("stock",{},{icon:"fa-line-chart",help:"en-us/articles/200154592",added:function(){}}),this.domElement}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Todo=e.Widget.registerType("todo",{getItems:function(){return this.items||[]},setItems:function(e){this.items=e},render:function(){return this.data=t.extend({title:I18n.t("new_to-dos_widget_title")},this.data),this.renderWidget("todo",{},{icon:"fa-tasks",help:"en-us/articles/212080905",added:function(){}}),this.renderItems(),this.initAddItem(),t(this).on("startEditing.widget",t.proxy(this.initInlineEditMode,this)),t(this).on("finishEditing.widget",t.proxy(this.save,this)),this.postpone(function(){this.initSorting()}),this.domElement},renderItems:function(){var e=this,i=this.domElement.find("ul.task-list");i.find("li.task").remove();var n=this.getItems();t(n).each(function(t,i){e.appendItem(i.t,i.c)}),this.initClick(),this.toggleNoTasksIndicator()},toggleNoTasksIndicator:function(){var e=this.getItems(),t=this.domElement.find("ul.task-list");t.find("li.no-tasks").toggle(0==e.length)},appendItem:function(e,i){var n=this.domElement.find("ul.task-list"),r={title:e,completed:!!i},a=JST["widgets/todo/todo_item"](r);t(a).appendTo(n),this.initClick()},updateFromDOM:function(){var e=[];this.domElement.find("li.task").each(function(i,n){e.push({t:t(n).data("title"),c:t(n).data("completed")})}),this.setItems(e)},initAddItem:function(){this.initInlineAdding({editOnly:!1,callback:t.proxy(this.insertItem,this)})},insertItem:function(e){return this.appendItem(e),this.save(),this.toggleNoTasksIndicator(),!0},initInlineEditMode:function(){var e=this;this.domElement.find("li.task").each(function(i,n){e.enableInlineEdit(t(n))})},initClick:function(){var i=this.domElement.find("li.task");i.find("i.complete").off("click").on("click",t.proxy(this.clickCompleted,this)),i.off("click").on("click",t.proxy(this.listItemClick,this)),i.find("i.delete").off("click.link").on("click.link",t.proxy(this.listItemDeleteClick,this)),e.contextmenu(i,t.proxy(this.getItemContextMenuItems,this))},clickCompleted:function(e){var i=t(e.target),n=i.parents("li:first");return n.data("completed",n.data("completed")?0:"1"),n.toggleClass("completed"),this.save(),!1},listItemClick:function(e){var i=t(e.target).parents("li").addBack().filter("li");return this.enableInlineEdit(i,!0)},enableInlineEdit:function(e,t){var i=this,t=t||!1,n=e.find(".title"),r=e.data("title"),a=e.find("div.inline-edit"),o=a.find("input.inline-edit");t&&(n.addClass("edit-only"),a.removeClass("edit-only"),o.focus().select()),o.off("keyup").on("keyup",function(e){13==e.keyCode?o.blur():27==e.keyCode?l():s(o.val())}),o.off("blur").on("blur",function(){d()});var s=function(t){e.data("title",t),n.attr("title",t),n.text(t)},d=function(){r!=o.val()&&i.save(),c()},l=function(){o.val(r),s(r),c()},c=function(){t&&(a.addClass("edit-only"),n.removeClass("edit-only"))};return!1},listItemDeleteClick:function(e){e.preventDefault(),e.stopPropagation(),this.deleteItem(t(e.target).parents("li:first"))},deleteItem:function(e){e.remove(),this.save(),this.toggleNoTasksIndicator()},getItemContextMenuItems:function(e){var i=[];return i.push({caption:I18n.t("edit"),action:t.proxy(this.enableInlineEdit,this,e,!0),icon:"fa-edit"},{caption:I18n.t("delete"),action:t.proxy(this.deleteItem,this,e),icon:"fa-trash"}),i},initSorting:function(){var i=this;e.canDragWithoutEditing()?this.enableSorting():(t(this).on("startEditing.widget",function(){i.enableSorting()}),t(this).on("finishEditing.widget",function(){0==t(".widget-todo.editing").length&&i.disableSorting()}))},enableSorting:function(i){function n(e,t){e.stopPropagation(),this.save()}if(!i){var r=e.getActivePage().getWidgetsByType(this.getWidgetType());return void t.each(r,function(e,t){t.enableSorting(!0)})}var a=this,o=this.domElement.find("ul.task-list");o.sortable("instance")||o.sortable({items:"li.task",connectWith:e.selectors.todolists,cursor:"move",distance:15,helper:"clone",placeholder:"task ui-sortable-placeholder",forcePlaceholderSize:!0,update:t.proxy(n,this),start:function(){a.domElement.addClass("sorting")},stop:function(){a.domElement.removeClass("sorting")}})},disableSorting:function(){var e=this.domElement.find("ul.task-list");e.sortable("instance")&&e.sortable("destroy")},save:function(){this.updateFromDOM(),this.saveSettings()},getCustomSettingsDefaults:function(){return{t:[]}},setCustomSettings:function(e){this.setItems(e.t)},getCustomSettings:function(){return{t:this.getItems()}}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.TwitterTimeline=e.Widget.registerType("twitter-timeline",{HEIGHT:{small:1,medium:2,large:3,xl:4},getScreenName:function(){return"string"==typeof this.screenName?this.screenName:null},setScreenName:function(e){e=e?t.trim(""+e):null,e&&(e=e.replace(/^@/,"")),this.screenName=e},getHeight:function(){return parseInt(this.height)||this.HEIGHT.medium},setHeight:function(e){e=parseInt(e)||this.HEIGHT.medium,this.height=Math.max(this.HEIGHT.small,Math.min(e,this.HEIGHT.xl))},render:function(){return this.data=t.extend({title:"Twitter Timeline"},this.data),this.renderWidget("twitter-timeline",{},{icon:"fa-twitter-square",settings:!0,added:t.proxy(this.showSettings,this),moved:this.refresh}),this.refresh(),this.domElement},renderStyle:function(){var e=this,i=this.getHeight();t.each(t.values(this.HEIGHT),function(t,n){e.domElement.toggleClass("height-"+n,n==i)})},getCustomSettingsDefaults:function(){return{n:"",h:this.HEIGHT.medium}},getCustomSettings:function(){return{n:this.getScreenName(),h:this.getHeight()}},setCustomSettings:function(e){this.setScreenName(e.n),this.setHeight(e.h)},getSettingsConfig:function(){return{templateValues:{n:this.getScreenName()},rendered:t.proxy(this.refresh,this),changed:t.proxy(this.refresh,this)}},refresh:function(){var e=this.domElement.find(".body");e.empty();var t=this.getScreenName();if(t){var i=JST["widgets/twitter-timeline/code"]({n:t});e.append(i)}this.renderStyle()}})}(Yourls,jQuery),function(e,t){"use strict";e.Widget.Twitter=e.Widget.registerType("twitter",{render:function(){return this.data=t.extend({title:"Twitter"},this.data),this.renderWidget("twitter",{},{icon:"fa-twitter",added:function(){}}),this.domElement}})}(Yourls,jQuery),function(e){"use strict";e.Widget.Urllist=e.Widget.registerType("urllist",{VIEWMODE:{list:0,icons:1,largeIcons:2,details:3},ICONSIZE:{small:0,medium:1,large:2,xl:3},TITLELINES:{one:1,two:2,all:10},MIN_COLUMNS:2,MAX_COLUMNS:6,getViewMode:function(){return"number"==typeof this.viewMode?this.viewMode:this.VIEWMODE.list},setViewMode:function(e){
this.viewMode=parseInt(e),$.inArray(this.viewMode,$.values(this.VIEWMODE))<0&&(this.viewMode=this.VIEWMODE.list),this.viewMode==this.VIEWMODE.largeIcons&&(this.viewMode=this.VIEWMODE.icons,this.setIconSize(this.ICONSIZE.medium))},getIconSize:function(){return"number"==typeof this.iconSize?this.iconSize:this.ICONSIZE.small},setIconSize:function(e){this.iconSize=parseInt(e),$.inArray(this.iconSize,$.values(this.ICONSIZE))<0&&(this.iconSize=this.ICONSIZE.small)},getShowFullDescription:function(){return!!this.showFullDescription},setShowFullDescription:function(e){this.showFullDescription=!!e},getVisibleItemCount:function(){return"number"==typeof this.visibleItemCount?this.visibleItemCount:0},setVisibleItemCount:function(e){this.visibleItemCount=parseInt(e),isNaN(this.visibleItemCount)&&(this.visibleItemCount=0)},getVisibleTitleLines:function(){return parseInt(this.visibleTitleLines)||this.TITLELINES.one},setVisibleTitleLines:function(e){this.visibleTitleLines=parseInt(e),$.inArray(this.visibleTitleLines,$.values(this.TITLELINES))<0&&(this.visibleTitleLines=this.TITLELINES.one)},getMoreLink:function(){var e=this.moreLink;return $.isPlainObject(e)?{caption:e.caption||null,url:e.url||null}:!1},setMoreLink:function(e){e?this.moreLink={caption:e.caption||null,url:e.url}:this.moreLink=!1},render:function(){return this.data=$.extend({title:I18n.t("new_urllist_widget_title"),items:{}},this.data),this.renderWidget("urllist",null,{icon:"fa-bookmark",help:"en-us/articles/200541561",settings:!0,hasDropdownMenu:this.isPersisted(),added:$.proxy(e.showAddBookmarksDialog,e,{widgetId:this.getId()})}),this.renderLinks(this.data.items.links),this.updateView(),this.domElement.addClass("all-hidden"),this.updateVisibleItems(),this.initNewWidgetBehavior(),this.postpone(function(){this.initAddLink(),this.initVisibilityToggle(),this.initMoreLink(),this.isEditable()&&this.initSorting()}),this.domElement},renderLinks:function(t){var i=this.domElement.find(".urllist").empty(),n=this;$.each(t,$.proxy(function(e,t){i.append(n.renderLink(t))},this)),e.postpone(this.initClickLink,this)},renderLink:function(t){var i=t.description||e.UrlHelper.stripProtocol(t.url),n=$.crel("li","urllist-link"),r=$.crel(n,"a","link",{href:t.url,title:t.title+"\n"+i,"data-item_id":t.item_id,"data-monetizer":t.monetizer,"data-icon":t.icon,"data-favicon":t.favicon}),a=$.crel(r,"i","favicon","show");(t.favicon||e.UrlHelper.isAssetUrl(t.icon))&&$.crel(a,"img",{src:t.icon||t.favicon}),e.postpone(function(t,i){var n=$.crel(t,"div","link-buttons view-only");$.crel(n,"i","show-details fa fa-fw fa-info",{title:I18n.t("show_details")}),e.UrlHelper.renderIcon(a,i)}.bind(this,n,t.icon||t.favicon||t.url));$.crel(r,"div","info",$.crel("span","title",{},t.title),$.crel("span","description",{"data-raw":i},i));if(t.item_id){var o=function(){$.crel(n,"i","edit-only edit-link fa fa-pencil",{title:I18n.t("edit")}),$.crel(n,"i","edit-only delete fa fa-trash",{title:I18n.t("delete")}),this.initClickLink()}.bind(this);this.isEditing()?o():$(this).one("startEditing.widget",o)}return n},updateView:function(){var t=this.getViewMode(),i=this.getIconSize(),n=this.getVisibleTitleLines(),r=!1,a=!1;switch(this.domElement.toggleClass("hide-favicons",!e.Model.showFavicons()),this.domElement.removeClass("viewmode-list viewmode-icons viewmode-details"),t){case this.VIEWMODE.list:this.domElement.addClass("viewmode-list");break;case this.VIEWMODE.icons:this.domElement.addClass("viewmode-icons");break;case this.VIEWMODE.details:this.domElement.addClass("viewmode-details"),r=!0,a=!0,e.postpone(this.renderDescriptions.bind(this))}switch(this.domElement.removeClass("icons-small icons-medium icons-large icons-xl"),i){case this.ICONSIZE.small:this.domElement.addClass("icons-small");break;case this.ICONSIZE.medium:this.domElement.addClass("icons-medium");break;case this.ICONSIZE.large:this.domElement.addClass("icons-large");break;case this.ICONSIZE.xl:this.domElement.addClass("icons-xl")}switch(this.domElement.removeClass("title-lines-1 title-lines-2 title-lines-all"),n){case this.TITLELINES.one:this.domElement.addClass("title-lines-1");break;case this.TITLELINES.two:this.domElement.addClass("title-lines-2");break;case this.TITLELINES.all:this.domElement.addClass("title-lines-all")}this.domElement.children(".body").toggleClass("no-padding",r),this.domElement.find(".urllist").toggleClass("large",a).toggleClass("show-full-description",this.getShowFullDescription())},updateVisibleItems:function(){var e=this.domElement.find(".urllist-link");e.removeClass("conditionally-visible"),this.domElement.removeClass("conditional-visibility");var t=this.getVisibleItemCount()||e.length;e.each(function(e,i){e>=t&&$(i).addClass("conditionally-visible")}),t<e.length&&this.domElement.addClass("conditional-visibility")},renderDescriptions:function(){var t=this.domElement.find(".urllist-link .description");$.each(t,function(){var t=$(this);t.html(e.markdown(t.data("raw")))})},getCustomDropdownItems:function(){return[{caption:I18n.t("add_bookmark"),icon:"fa-plus",classes:"editable-only",action:$.proxy(e.showAddBookmarksDialog,e,{widgetId:this.getId()}),pinned:!0},{caption:I18n.t("urllist.sort_bookmarks"),icon:"fa-sort-alpha-asc",classes:"editable-only",action:$.proxy(this.sortDialog,this)}]},canBeCopied:function(){return this.options.canBeCopied&&this.isPersisted()},selectViewMode:function(e){this.setViewMode(e),this.updateView(),this.saveSettings()},getSettingsConfig:function(){function e(e){t(e),this.updateView(),this.updateVisibleItems()}function t(e){var t=i.getViewMode();e.find(".icon-settings").toggle(t!=i.VIEWMODE.list),e.find(".viewmode-icons-settings").toggle(t==i.VIEWMODE.icons),e.find(".viewmode-details-settings").toggle(t==i.VIEWMODE.details)}var i=this;return{templateValues:{visible_item_options:$.map($(new Array(13)),function(e,t){return{value:t}})},rendered:t,changed:e}},setCustomSettings:function(e){this.setIconSize(e.i),this.setViewMode(e.m),this.setVisibleItemCount(e.v),this.setVisibleTitleLines(e.t),this.setShowFullDescription(e.d),this.setMoreLink(e.ml)},getCustomSettingsDefaults:function(){return{m:this.VIEWMODE.list,i:this.ICONSIZE.small,v:0,t:this.TITLELINES.one,d:0,ml:!1}},getCustomSettings:function(){return{m:this.getViewMode(),i:this.getIconSize(),v:this.getVisibleItemCount(),t:this.getVisibleTitleLines(),d:this.getShowFullDescription()?1:0}},sortDialog:function(){function t(e){var t=e.sort_by,r="1"==e.reverse,a=n.domElement.find(".urllist"),o=a.find(".urllist-link");o.sort(function(e,n){var a=0;switch(t){case"title":var o=$(e).find(".title").text(),s=$(n).find(".title").text();a=o.localeCompare(s);break;case"url":var d=$(e).find(".link").attr("href"),l=$(n).find(".link").attr("href");a=i(d).localeCompare(i(l));break;case"age":var c=$(e).find(".link").data("item_id"),u=$(n).find(".link").data("item_id");a=c-u}return r?-a:a}),o.detach().appendTo(a),n.queueReorder()}function i(e){return e=e.replace(/^https?:\/\/(www\.)?|[a-z]{3,}:\/\//i,""),e=e.toLowerCase()}var n=this;e.sidebar("widgets/urllist/sidebar_sort",{title:I18n.t("urllist.sort_bookmarks"),icon:"fa-bookmark",formdata:{sort_by:"title",reverse:0},buttons:[{caption:I18n.t("sort"),icon:"fa-sort-alpha-asc","default":!0,action:t},{caption:I18n.t("cancel"),icon:"fa-times"}]})},initNewWidgetBehavior:function(){if(e.hasTouchScreen()){var t=this;$(this).on("added.widget",function(){t.selectViewMode(t.VIEWMODE.icons)})}},initVisibilityToggle:function(){var e=this;this.domElement.find(".conditional-visibility-toggle").click(function(){e.domElement.toggleClass("all-hidden")})},initMoreLink:function(){var e=this.getMoreLink();if(e){var t=this.domElement.find("> header h2");t.find("a.tag.more").remove(),e&&$.tag("a").addClass("tag more").text(e.caption||I18n.t("more")).attr("href",e.url).appendTo(t)}},editLink:function(t){function i(){f=$(this),r();var e=f.find(".icon-selector");e.click(a)}function n(){r()}function r(){var t=f.find('input[name="icon"]'),i=f.find('input[name="url"]'),n=f.find(".icon-selector i"),r=t.val(),a=i.val();e.UrlHelper.renderIcon(n,r||c||a,"fa-bookmark")}function a(){var t=f.find('input[name="icon"]'),i=t.val().split("#"),n=i[0],a=i[1],o=new e.IconPicker({selectedIcon:n,selectedColor:a,allowDefault:!0,allowColor:!0,allowUpload:!0,selected:function(e,i){t.val(e?e+(i?"#"+i:""):""),r()}});o.show()}t=$(t);var o=$.trim(t.find(".title").text()),s=$.trim(t.attr("href")),d=$.trim(t.find(".description").data("raw")),l=$.trim(t.data("icon")),c=$.trim(t.data("favicon")),u=t.data("item_id"),h=this;e.sidebar("widgets/urllist/edit_link",{formdata:{title:o,url:s,description:d,icon:l},title:I18n.t("edit_link"),icon:"fa-bookmark",autofocus:!0,buttons:[{caption:I18n.t("save"),icon:"fa-save","default":!0,action:function(e){return h.updateLink(t,e)}},{caption:I18n.t("delete_link"),icon:"fa-trash",action:function(){h.queueDeleteLink(u)}}],rendered:i,changed:n});var f},updateLink:function(t,i){t=$(t);var n=$.trim(i.title),r=$.trim(i.url),a=$.trim(i.description),o=$.trim(i.icon);return 0==n.length?I18n.t("please_specify_title"):e.UrlHelper.isValid(r)?(t.attr("href",r),t.find(".title").text(n),t.find(".description").data("raw",a).html(e.markdown(a)),t.attr("title",n+"\n"+(a||e.UrlHelper.stripProtocol(r))),t.data("icon",o),this.renderFavicon(t,o||t.data("favicon")),void this.putLink(t.data("item_id"),{title:n,url:r,description:a,icon:o})):I18n.t("invalid_url")},linkClick:function(t){t.preventDefault();var i=$(t.delegateTarget).parent().children("a.link");if(this.isEditing())this.editLink(i);else{var n=i.attr("href"),r=n,a=i.data("monetizer");n=e.UrlHelper.monetizeUrl(n,a),e.gtmEvent("BookmarkClick",{url:r,monetized:a?1:0}),e.UrlHelper.openUrl(n,t)}},linkDeleteClick:function(e){var t=$(e.delegateTarget);e.preventDefault(),e.stopPropagation();var i=t.parent().find("a.link"),n=i.data("item_id");n&&this.queueDeleteLink(n)},bookmarkClick:function(t){t.preventDefault();var i=$(t.delegateTarget).parents(".urllist-link").children("a.link"),n=i.attr("href"),r=i.find(".title").text();e.showBookmarkUrlDialog(n,r)},showDetails:function(t){t="/site/"+e.UrlHelper.getSite(t),e.UrlHelper.openUrl(t,null,!0)},showDetailsClick:function(e){e.preventDefault();var t=$(e.delegateTarget).parents(".urllist-link").children("a.link"),i=t.attr("href");this.showDetails(i)},getLinkContextMenuItems:function(t){var i=t.find("a.link"),n=[],r=i.attr("href");n.push({caption:I18n.t("open_in_new_window"),action:$.proxy(e.UrlHelper.openUrl,e.UrlHelper,r,null,!0),icon:"fa-external-link"},"-"),this.isEditable()?n.push({caption:I18n.t("edit"),action:$.proxy(this.editLink,this,i),icon:"fa-edit"},{caption:I18n.t("delete"),action:$.proxy(this.queueDeleteLink,this,i.data("item_id")),icon:"fa-trash"}):n.push({caption:I18n.t("bookmark_link"),action:function(){e.showBookmarkUrlDialog(r,i.find(".title").text())},icon:"fa-bookmark"});var a=e.UrlHelper.getSite(r);return a&&a!=window.primaryDomain&&n.push({caption:I18n.t("show_details"),action:this.showDetails.bind(this,r),icon:"fa-info"}),this.isEditable()&&n.push("-",{caption:I18n.t("add_bookmark"),icon:"fa-plus",action:$.proxy(e.showAddBookmarksDialog,e,{widgetId:this.getId()})}),n},initSorting:function(){var t=this;e.canDragWithoutEditing()?this.enableSorting():($(this).on("startEditing.widget",function(){t.enableSorting()}),$(this).on("finishEditing.widget",function(){0==$(".widget-urllist.editing").length&&t.disableSorting()}))},enableSorting:function(t){function i(t,i){t.stopPropagation();var n=e.getActivePage();if(n){var r=$(i.item).find("a.link").data("item_id"),a=$(t.target).parents(".widget").data("widget_id");n.getWidgetById(a);if(this.queueReorder(),!this.hasLink(r)){var o=$(i.item).parents(".widget").data("widget_id"),s=n.getWidgetById(o);s.patchLink(r),s.initClickLink()}}}if(!t){var n=e.getActivePage().getWidgetsByType(this.getWidgetType());return void $.each(n,function(e,t){t.enableSorting(!0)})}var r=this,a=this.domElement.find(".urllist");a.sortable("instance")||a.sortable({items:".urllist-link",connectWith:e.selectors.urllists,cursor:"move",distance:15,helper:"clone",placeholder:"urllist-link ui-sortable-placeholder",forcePlaceholderSize:!0,update:$.proxy(i,this),start:function(){r.domElement.addClass("sorting")},stop:function(){r.domElement.removeClass("sorting")}})},disableSorting:function(){var e=this.domElement.find(".urllist");e.sortable("instance")&&e.sortable("destroy")},initClickLink:function(t){t=t||this.domElement.find(".urllist"),t.find("a.link").off("click.link").on("click.link",$.proxy(this.linkClick,this)),t.find("i.edit-link").off("click.link").on("click.link",$.proxy(this.linkClick,this)),t.find("i.delete").off("click.link").on("click.link",$.proxy(this.linkDeleteClick,this)),t.find("i.bookmark").off("click.link").on("click.link",$.proxy(this.bookmarkClick,this)),t.find("i.show-details").off("click.link").on("click.link",$.proxy(this.showDetailsClick,this)),e.contextmenu(t.children().addBack().filter("li"),$.proxy(this.getLinkContextMenuItems,this))},initAddLink:function(){var t=this,i=this.domElement.find(".add input");i.autocomplete({source:e.UrlHelper.domainAutocomplete,minLength:1,autoFocus:!0,delay:1e3}).data("ui-autocomplete")._renderItem=function(t,i){var n=$("<a/>").text(i.label);if(e.Model.showFavicons()){var r=$("<i/>").addClass("favicon").prependTo(n);e.UrlHelper.renderFavicon(r,i.value)}return $("<li/>").data("item.autocomplete",i).append(n).appendTo(t)},this.initInlineAdding({submitOnClose:!0,callback:function(e){return t.submitLink(e)&&"http://"}})},hasLink:function(e){return this.domElement.find("a.link[data-item_id="+e+"]").length>0},submitLink:function(t,i,n){function r(e,t){s.pollTitle(e,function(e){e.title&&t.find("span").text(e.title)},1e3,6)}if(i=$.trim(i)||null,n=$.trim(n)||null,!e.UrlHelper.isValid(t)){if(!e.UrlHelper.isValidButWithoutProtocol(t))return!1;t="http://"+t}var a=e.UrlHelper.newLink(t),o={url:a.url,title:i,description:n},s=this;return this.postLink(o,function(e){var t=$.extend(e);t.title=t.title||a.title;var i=s.renderLink(t);s.domElement.find(".urllist").append(i),s.postpone(s.initClickLink.bind(s,$(i))),$(s).trigger("save"),e.title||r(e.link_id,i),s.updateVisibleItems()}),!0},queueDeleteLink:function(t){var i=this.domElement.find('.link[data-item_id="'+t+'"]'),n=i.parent();n.remove();var r=this.getId();this.queueUpdate(function(i){e.ajaxSave({url:"/widget/"+r+"/item/"+t,type:"delete",contentType:"application/json",dataType:"json",error:function(e){return 404==e.status?!0:void 0}}).success(i)})},pollTitle:function(t,i,n,r){function a(){if(r>d){setTimeout(o,c);var e=l+c;l=c,c=e}else s()}function o(){r>d?(d+=1,$.ajax({url:"/tools/title/poll",type:"get",data:{link_id:t},dataType:"json",success:function(e){e.updated?(s(),i(e)):a()},error:function(){s()}})):s()}function s(){e.setLoading(!1)}var d=0,l=0,c=n;a(),e.setLoading(!0)},queueReorder:function(){this.updateVisibleItems();var e=this;this.queueUpdate(function(t){e.patchItems(t)})},getData:function(){var e={};e.title=$.trim(this.domElement.find("h2").text()),e.widget_id=this.domElement.data("widget_id");var t=[];return this.domElement.find("a.link").each(function(e,i){t.push({title:$.trim($(i).find(".title").text()),url:$(i).attr("href"),id:$(i).data("item_id")})}),e.items=t,e},patchItems:function(t){var i=this.getData();e.ajaxSave({url:"/widget/"+this.getId()+"/items",type:"patch",contentType:"application/json",data:JSON.stringify(i),dataType:"json"}).success(t)},postLink:function(t,i){e.ajaxSave({url:"/widget/"+this.getId()+"/item",type:"post",contentType:"application/json",data:JSON.stringify({url:t.url,title:t.title||null,description:t.description||null}),dataType:"json"}).success(i)},putLink:function(t,i){e.ajaxSave({url:"/widget/"+this.getId()+"/item/"+t,type:"put",contentType:"application/json",data:JSON.stringify(i),dataType:"json",error:function(e){return 404==e.status?!0:void 0}})},patchLink:function(t,i){e.ajaxSave({url:"/widget/"+this.getId()+"/item/"+t,type:"patch",contentType:"application/json",dataType:"json"}).success(i)}})}(Yourls,jQuery),function(e,t){"use strict";var i=t.sample([{apiKey:"af589fea3657dc03",apiRef:"fc6167750616703f"},{apiKey:"742ed4e5527ee3c3",apiRef:"9c340e00de521261"},{apiKey:"954468fe89b6a954",apiRef:"10fdfd3d434a392c"},{apiKey:"9c79a6e06ea0e509",apiRef:"fb20423e897f48c2"}]);e.Widget.Weather=e.Widget.registerType("weather",{MAX_CACHE:60,LANGUAGES:{af:"AF",sq:"AL",ar:"AR",hy:"HY",az:"AZ",eu:"EU",be:"BY",bg:"BU","en-UK":"LI",my:"MY",ca:"CA",zh:"CN","zh-CN":"CN","zh-TW":"TW",hr:"CR",cs:"CZ",da:"DK",dv:"DV",nl:"NL",en:"EN",eo:"EO",et:"ET",fa:"FA",fi:"FI",fr:"FR","fr-CA":"FC",gl:"GZ",de:"DL",ka:"KA",el:"GR",gu:"GU",ht:"HT",he:"IL",hi:"HI",hu:"HU",is:"IS",io:"IO",id:"ID",ga:"IR",it:"IT",ja:"JP",jv:"JW",km:"KM",ko:"KR",ku:"KU",la:"LA",lv:"LV",lt:"LT",mk:"MK",mt:"MT",mi:"MI",mr:"MR",mn:"MN",no:"NO",oc:"OC",ps:"PS",pl:"PL",pt:"BR",pa:"PA",ro:"RO",ru:"RU",sr:"SR",sk:"SK",sl:"SL",es:"SP",sw:"SI",sv:"SW",tl:"TL",tt:"TT",th:"TH",tr:"TR",tk:"TK",uk:"UA",uz:"UZ",vi:"VU",cy:"CY",wo:"SN",yi:"JI"},metric:0,cities:[],suggestedCitiesLocations:{},render:function(){return this.data=t.extend({title:I18n.t("weather")},this.data),this.renderWidget("weather",{apiref:i.apiRef},{icon:"fa-cloud",help:"en-us/articles/200153682"}),this.publishForecast(),this.publishCities(),this.initAddCity(),this.initAutoSuggest(),this.initSortable(),this.domElement},getCustomSettingsDefaults:function(){return{m:0,c:[]}},getCustomSettings:function(){return{m:this.metric,c:this.cities}},setCustomSettings:function(e){this.metric=parseInt(e.m),this.cities=t.map(t.makeArray(e.c),function(e){return{n:e.n,z:e.z}})},getCustomDropdownItems:function(){return[{caption:I18n.t("refresh"),icon:"fa-refresh",action:t.proxy(this.refresh,this)}]},initAddCity:function(){this.initInlineAdding({callback:t.proxy(this.submitCity,this)})},initClickLink:function(){var e=t.proxy(this.linkClick,this);this.domElement.find("i.edit-link").unbind("click").on("click",e),this.domElement.find("a.link").unbind("click").on("click",e)},getSettingsConfig:function(){var e=this;return{changed:function(){e.publishForecast()}}},initAutoSuggest:function(){function e(e,n){var r=[];i.suggestedCitiesLocations={},t.ajax({url:"//autocomplete.wunderground.com/aq",dataType:"jsonp",jsonp:"cb",data:{query:e.term},cache:!0,error:function(){}}).then(function(e){t.each(e.RESULTS,function(e,t){t.l&&"/q/zmw:"==t.l.slice(0,7)&&(i.suggestedCitiesLocations[t.name]=t.l.slice(7),r.push(t.name))}),n(r)})}var i=this;this.domElement.find("input.cityField").autocomplete({autoFocus:!0,delay:300,minLength:1,source:e})},initSortable:function(){var e=this;this.domElement.find("ul.weather-cities").sortable({connectWith:".widget-weather ul.weather-cities",placeholder:"ui-sortable-placeholder",forcePlaceholderSize:!0,update:function(){e.updateCities(),e.saveSettings(),e.publishForecast()}})},refresh:function(){this.publishForecast(!0)},linkClick:function(i){var n=t(i.delegateTarget);if(this.isEditing()){var r=n.data("item_id")||n.parents("li:first").data("item_id");return i.stopPropagation(),i.preventDefault(),this.editCity(r),!1}return e.shouldOpenLinksInNewWindow()?(window.open(n.attr("href")),!1):void(window.top!==window.self&&(window.top.location.href=n.attr("href")))},initDeleteCity:function(){var e=this;this.domElement.find("i.delete").unbind("click"),this.domElement.find("i.delete").on("click",function(i){var n=t(this).parents("li.city");n.remove(),e.updateCities(),e.saveSettings(),e.publishForecast(),i.stopPropagation(),i.preventDefault()})},submitCity:function(e){if(0==e.length)return!1;var t=this.suggestedCitiesLocations[e];if("undefined"==typeof t||null==t)return!1;var n={n:e,z:t};n.apiref=i.apiRef;var r=JST["widgets/weather/city"](n);this.domElement.find("ul.weather-cities").append(r),this.updateCities(),this.saveSettings(),this.publishForecast(),this.initDeleteCity(),this.initClickLink()},editCity:function(i){if(i){var n=this,r=this.domElement.find('a.link[data-item_id="'+i+'"]'),a=r.parent("li").data("name");e.sidebar("widgets/weather/edit_city",{formdata:{title:a},title:I18n.t("edit"),icon:"fa-cloud",autofocus:!0,buttons:[{caption:I18n.t("save"),icon:"fa-save","default":!0,action:function(e){var i=t.trim(e.title);return i.length?void(i!=a&&(r.text(i),r.parent("li").data("name",i),n.updateCities(),n.saveSettings(),n.publishForecast())):I18n.t("please_specify_title")}},{caption:I18n.t("delete"),icon:"fa-trash",action:function(){var e=r.parent();e.remove(),n.updateCities(),n.saveSettings(),n.publishForecast()}}]})}},getLanguageCode:function(){return this.LANGUAGES[I18n.currentLocale()]||"EN"},updateCities:function(){var e=this.cities=[];this.domElement.find("li.city").each(function(i,n){n=t(n),n.data("index",i),e.push({n:n.data("name"),z:n.data("item_id")})})},publishCities:function(){var e=this.getSettings(),n=e.c;if(this.domElement.find("ul.weather-cities li").each(function(e,i){t(i).remove()}),n)for(var r=0;r<n.length;++r){var a=n[r];a.apiref=i.apiRef;var o=JST["widgets/weather/city"](a);this.domElement.find("ul.weather-cities").append(o)}this.initDeleteCity(),this.initClickLink()},publishForecast:function(e){function n(e,t){e.find(".weather-forecast .weather-days").empty().append(t),a.initClickLink()}function r(e,r){var o="";if(e&&e.forecast&&e.forecast.simpleforecast&&e.forecast.simpleforecast.forecastday&&e.forecast.simpleforecast.forecastday[0]){var s=e.forecast.simpleforecast;for(s.n=r.n,s.z=r.z,s.apiref=i.apiRef;s.forecastday&&s.forecastday.length>3;)s.forecastday.pop();t.each(s.forecastday,function(){var e=moment.unix(this.date.epoch);this.date.weekday=e.format("dddd"),this.date.weekday_short=e.format("dd"),this.icon_url=t.cloudinary.url(this.icon_url,{type:"fetch",fetch_format:"auto"})}),s.conditions=e.current_observation,s.conditions.icon_url=t.cloudinary.url(s.conditions.icon_url,{type:"fetch",fetch_format:"auto"}),o=JST["widgets/weather/forecast"](s)}else o="No weather forecast today for "+r.n,e&&e.response&&e.response.error&&e.response.error.description&&(o=e.response.error.description+" for "+r.n),Bugsnag.notify("WeatherForecastError","No forecast",{location:{zmw:r.z,name:r.n,html:o}},"warning");var d=a.domElement.find('ul.weather-forecasts li[data-item_id="'+r.z+'"]');d.length||(d=t(JST["widgets/weather/forecast_header"]({n:r.n,z:r.z,apiref:i.apiRef})),a.domElement.find("ul.weather-forecasts").append(d)),n(d,o)}var a=this;e||this.domElement.find("ul.weather-forecasts li").remove();var o=this.metric;this.domElement.toggleClass("metric",!!o).toggleClass("imperial",!o),this.cities&&t.each(this.cities,function(n,o){var s=a.domElement.find('ul.weather-forecasts li[data-item_id="'+o.z+'"]');s.length||(s=t(JST["widgets/weather/forecast_header"]({n:o.n,z:o.z,apiref:i.apiRef})),a.domElement.find("ul.weather-forecasts").append(s)),s.removeClass("remove");var d=o.z,l="city_"+d+(e?"_noCache":""),c="city_"+d,u=!0,h=!0;a.tryCache(l).then(function(e){return u=h=!1,e},function(){return t.ajax("/widgets/weather",{dataType:"json",data:{cache_key:c},noBugsnag:!0})}).then(function(e){return h=!1,e},function(){return t.ajax(["//api.wunderground.com/api/",i.apiKey,"/conditions/forecast/q/zmw:",o.z,".json"].join(""),{dataType:"json"})}).then(function(e){return e&&e.forecast?(e.forecast.simpleforecast&&e.forecast.simpleforecast.conditions&&delete e.forecast.simpleforecast.conditions,e.forecast.txt_forecast&&delete e.forecast.txt_forecast,e):t.Deferred().reject().promise()},null).then(function(e){r(e,o),u&&a.setCache(l,e,a.MAX_CACHE),h&&t.ajax("/widgets/weather",{type:"put",contentType:"application/json",accept:"application/json",dataType:"json",data:JSON.stringify({cache_key:c,cache_value:e}),noBugsnag:!0})},function(){Bugsnag.notify("WeatherForecastError","Failed to get forecast",{location:{zmw:o.z,name:o.n}},"warning")})})}})}(Yourls,jQuery),function(e,t){"use strict";function i(){return r||(r=moment.tz.names().concat(moment.tz._extraZones)),r}function n(e){var i=[{zone:"GMT-12:00",name:"International Date Line West"},{zone:"GMT-11:00",name:"Midway Island, Samoa"},{zone:"GMT-10:00",name:"Hawaii"},{zone:"GMT-09:00",name:"Alaska"},{zone:"GMT-08:00",name:"Pacific Time (US and Canada); Tijuana"},{zone:"GMT-07:00",name:"Mountain Time (US and Canada)"},{zone:"GMT-07:00",name:"Chihuahua, La Paz, Mazatlan"},{zone:"GMT-07:00",name:"Arizona"},{zone:"GMT-06:00",name:"Central Time (US and Canada)"},{zone:"GMT-06:00",name:"Saskatchewan"},{zone:"GMT-06:00",name:"Guadalajara, Mexico City, Monterrey"},{zone:"GMT-06:00",name:"Central America"},{zone:"GMT-05:00",name:"Eastern Time (US and Canada)"},{zone:"GMT-05:00",name:"Indiana (East"},{zone:"GMT-05:00",name:"Bogota, Lima, Quito"},{zone:"GMT-04:00",name:"Atlantic Time (Canada"},{zone:"GMT-04:00",name:"Caracas, La Paz"},{zone:"GMT-04:00",name:"Santiago"},{zone:"GMT-03:30",name:"Newfoundland and Labrador"},{zone:"GMT-03:00",name:"Brasilia"},{zone:"GMT-03:00",name:"Buenos Aires, Georgetown"},{zone:"GMT-03:00",name:"Greenland"},{zone:"GMT-02:00",name:"Mid-Atlantic"},{zone:"GMT-01:00",name:"Azores"},{zone:"GMT-01:00",name:"Cape Verde Islands"},{zone:"GMT",name:"Greenwich Mean Time: Dublin, Edinburgh, Lisbon, London"},{zone:"GMT",name:"Casablanca, Monrovia"},{zone:"GMT+01:00",name:"Belgrade, Bratislava, Budapest, Ljubljana, Prague"},{zone:"GMT+01:00",name:"Sarajevo, Skopje, Warsaw, Zagreb"},{zone:"GMT+01:00",name:"Brussels, Copenhagen, Madrid, Paris"},{zone:"GMT+01:00",name:"Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"},{zone:"GMT+01:00",name:"West Central Africa"},{zone:"GMT+02:00",name:"Bucharest"},{zone:"GMT+02:00",name:"Cairo"},{zone:"GMT+02:00",name:"Helsinki, Kiev, Riga, Sofia, Tallinn, Vilnius"},{zone:"GMT+02:00",name:"Athens, Istanbul, Minsk"},{zone:"GMT+02:00",name:"Jerusalem"},{zone:"GMT+02:00",name:"Harare, Pretoria"},{zone:"GMT+03:00",name:"Moscow, St. Petersburg, Volgograd"},{zone:"GMT+03:00",name:"Kuwait, Riyadh"},{zone:"GMT+03:00",name:"Nairobi"},{zone:"GMT+03:00",name:"Baghdad"},{zone:"GMT+03:30",name:"Tehran"},{zone:"GMT+04:00",name:"Abu Dhabi, Muscat"},{zone:"GMT+04:00",name:"Baku, Tbilisi, Yerevan"},{zone:"GMT+04:30",name:"Kabul"},{zone:"GMT+05:00",name:"Ekaterinburg"},{zone:"GMT+05:00",name:"Islamabad, Karachi, Tashkent"},{zone:"GMT+05:30",name:"Chennai, Kolkata, Mumbai, New Delhi"},{zone:"GMT+05:45",name:"Kathmandu"},{zone:"GMT+06:00",name:"Astana, Dhaka"},{zone:"GMT+06:00",name:"Sri Jayawardenepura"},{zone:"GMT+06:00",name:"Almaty, Novosibirsk"},{zone:"GMT+06:30",name:"Yangon Rangoon"},{zone:"GMT+07:00",name:"Bangkok, Hanoi, Jakarta"},{zone:"GMT+07:00",name:"Krasnoyarsk"},{zone:"GMT+08:00",name:"Beijing, Chongqing, Hong Kong SAR, Urumqi"},{zone:"GMT+08:00",name:"Kuala Lumpur, Singapore"},{zone:"GMT+08:00",name:"Taipei"},{zone:"GMT+08:00",name:"Perth"},{zone:"GMT+08:00",name:"Irkutsk, Ulaanbaatar"},{zone:"GMT+09:00",name:"Seoul"},{zone:"GMT+09:00",name:"Osaka, Sapporo, Tokyo"},{zone:"GMT+09:00",name:"Yakutsk"},{zone:"GMT+09:30",name:"Darwin"},{zone:"GMT+09:30",name:"Adelaide"},{zone:"GMT+10:00",name:"Canberra, Melbourne, Sydney"},{zone:"GMT+10:00",name:"Brisbane"},{zone:"GMT+10:00",name:"Hobart"},{zone:"GMT+10:00",name:"Vladivostok"},{zone:"GMT+10:00",name:"Guam, Port Moresby"},{zone:"GMT+11:00",name:"Magadan, Solomon Islands, New Caledonia"},{zone:"GMT+12:00",name:"Fiji Islands, Kamchatka, Marshall Islands"},{zone:"GMT+12:00",name:"Auckland, Wellington"},{zone:"GMT+13:00",name:"Nuku'alofa"}];if(e){var n=t.grep(i,function(t){return t.zone==e});0==n.length&&i.unshift({name:e,zone:e})}return i}e.Widget.WorldClock=e.Widget.registerType("worldclock",{refreshTimeout:null,SIZE:{small:1,normal:2},cities:[],hours:0,suggestedCitiesData:{},customCity:"",size:0,getCities:function(){return this.cities},setCities:function(e){var i=this.cities=[];t.each(e||[],function(){i.push({n:this.n,z:this.z})})},getHours:function(){return this.hours},setHours:function(e){this.hours=e?1:0},getSize:function(){return parseInt(this.size)||this.SIZE.normal},setSize:function(e){this.size=parseInt(e),t.inArray(this.size,t.values(this.SIZE))<0&&(this.size=this.SIZE.normal)},render:function(){return this.data=t.extend({title:I18n.t("new_worldclock_widget_title")},this.data),this.renderWidget("worldclock",{asset_path:asset_path},{icon:"fa-clock-o",help:"en-us/articles/200154582"}),this.publishTimes(),this.publishCities(),this.initAddCity(),this.initAutoSuggest(),this.initSortable(),this.refresh(),t(this).on("delete",t.proxy(function(){this.refreshTimeout&&clearTimeout(this.refreshTimeout)},this)),this.domElement},getCustomDropdownItems:function(){return[{caption:I18n.t("widgets.worldclock.add_city"),icon:"fa-plus",pinned:!0,action:t.proxy(this.addCity,this,"")}]},initAddCity:function(){this.initInlineAdding({callback:t.proxy(this.submitCity,this)})},initClickLink:function(){var e=t.proxy(this.linkClick,this);this.domElement.find("li.city a.link").unbind("click").on("click",e),this.domElement.find("li.city i.edit-link").unbind("click").on("click",e)},getCityContextMenuItems:function(e){var i=e.data("item_id"),n=[];return this.isEditable()&&n.push({caption:I18n.t("widgets.worldclock.edit_city"),action:t.proxy(this.editCity,this,i),icon:"fa-edit"},{caption:I18n.t("widgets.worldclock.delete_city"),action:t.proxy(this.deleteCity,this,i),icon:"fa-trash"}),n},getSettingsConfig:function(){var e=this;return{changed:function(){e.updateSettingsAndDisplay()}}},initAutoSuggest:function(){var e=this;this.domElement.find("input.cityField").autocomplete({autoFocus:!0,delay:300,minLength:1,source:function(n,r){var a=[];if(e.suggestedCitiesData={},e.customCity="",t.each(i(),function(t,i){var r=i.replace(/^(.*)\/(.*)$/,"$2 ($1)").replace(/_/g," ");-1!==r.toLowerCase().indexOf(n.term.toLowerCase())&&(e.suggestedCitiesData[r]=i,a.push(r))}),a.length>0){var o=a.slice(0,20);o.sort()}else e.customCity=n.term,a.push(I18n.t("city_not_found_add_manually",{city:n.term})),o=a;r(o)}})},initSortable:function(){this.domElement.find("ul.worldclock-cities").sortable({connectWith:".widget-worldclock ul.worldclock-cities",placeholder:"ui-sortable-placeholder",forcePlaceholderSize:!0,update:t.proxy(this.updateSettingsAndDisplay,this)})},refresh:function(){this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.publishTimes(),this.refreshTimeout=setTimeout(t.proxy(this.refresh,this),1e3*(60-(new Date).getSeconds()))},linkClick:function(e){if(e.stopPropagation(),e.preventDefault(),this.isEditing()){var i=t(e.delegateTarget),n=i.data("item_id")||i.parents("li:first").data("item_id");this.editCity(n)}},initDeleteCity:function(){var e=this;this.domElement.find("i.delete").unbind("click"),this.domElement.find("i.delete").on("click",function(i){e.deleteCity(t(i.delegateTarget).parents("li:first").data("item_id")),i.stopPropagation(),i.preventDefault()})},deleteCity:function(e){if(e){var t=this.domElement.find('li.city[data-item_id="'+e+'"]');t.remove(),this.updateSettingsAndDisplay()}},submitCity:function(e){if(0==e.length)return!1;var t=this.suggestedCitiesData[e];if("undefined"==typeof t||null==t)return this.addCity(this.customCity),!0;var i={n:e,z:t},n=JST["widgets/worldclock/city"](i);this.domElement.find("ul.worldclock-cities").append(n),this.updateSettingsAndDisplay(),this.initDeleteCity(),this.initClickLink()},addCity:function(i){function r(e){var i=t.trim(e.title);if(!i.length)return I18n.t("please_specify_title");var n=t.trim(e.timezone);if(!n.length)return I18n.t("please_specify_timezone");var e={n:i,z:n},r=JST["widgets/worldclock/city"](e);a.domElement.find("ul.worldclock-cities").append(r),a.updateSettingsAndDisplay(),a.initDeleteCity(),a.initClickLink()}var a=this;e.sidebar("widgets/worldclock/edit_city",{formdata:{title:i},values:{timezones:n()},title:I18n.t("widgets.worldclock.add_city"),icon:"fa-clock-o",autofocus:!0,buttons:[{caption:I18n.t("save"),icon:"fa-save","default":!0,action:r}]})},editCity:function(i){function r(e){var i=t.trim(e.title);if(!i.length)return I18n.t("please_specify_title");var n=t.trim(e.timezone);return n.length?void((i!=s||n!=d)&&(o.text(i),o.data("item_id",i+"_"+n),o.data("timezone",n),o.parent("li").data("name",i),o.parent("li").data("item_id",i+"_"+n),o.parent("li").data("timezone",n),a.updateSettingsAndDisplay())):I18n.t("please_specify_timezone")}if(i){var a=this,o=this.domElement.find('a.link[data-item_id="'+i+'"]'),s=o.parent("li").data("name"),d=o.parent("li").data("timezone");e.sidebar("widgets/worldclock/edit_city",{formdata:{title:s,timezone:d},values:{timezones:n(d)},title:I18n.t("widgets.worldclock.edit_city"),icon:"fa-clock-o",autofocus:!0,buttons:[{caption:I18n.t("save"),icon:"fa-save","default":!0,action:r},{caption:I18n.t("widgets.worldclock.delete_city"),icon:"fa-trash",action:t.proxy(this.deleteCity,this,i)}]})}},getCustomSettingsDefaults:function(){return{c:[],h:1,s:this.SIZE.normal}},setCustomSettings:function(e){
this.setCities(e.c),this.setHours(e.h),this.setSize(e.s)},getCustomSettings:function(){return{c:this.getCities(),h:this.getHours(),s:this.getSize()}},updateCities:function(){var e=[];this.domElement.find("li.city").each(function(i,n){n=t(n),n.data("index",i),e.push({n:n.data("name"),z:n.data("timezone")})}),this.setCities(e)},updateSettingsAndDisplay:function(){this.updateCities(),this.saveSettings(),this.publishCities(),this.publishTimes()},publishCities:function(){var e=this.getCities();if(this.domElement.find("ul.worldclock-cities li").each(function(e,i){t(i).remove()}),e)for(var i=0;i<e.length;++i){var n=e[i],r=JST["widgets/worldclock/city"](n);this.domElement.find("ul.worldclock-cities").append(r)}this.initDeleteCity(),this.initClickLink()},publishTimes:function(){var i=this,n=this.getCities(),r=this.getHours(),a=i.domElement.find("ul.worldclock-times");a.toggleClass("small",this.getSize()==this.SIZE.small),a.toggleClass("large",this.getSize()==this.SIZE.normal),n&&n.length||(n=[{n:"",z:""}]),t(document).ready(function(){a.find("li").each(function(e,i){t(i).remove()}),t.each(n,function(n,a){var o=(new Date).toMoment(),s={n:a.n,z:a.z};if(a.z&&o.tz)try{moment.tz.zone(a.z)?(s.time=o.tz(a.z).format(r?"H:mm":"h:mm a"),s.fulltime=o.tz(a.z).format("LLLL Z")):(s.time=o.utc().utcOffset(a.z).format(r?"H:mm":"h:mm a"),s.fulltime=o.utc().utcOffset(a.z).format("LLLL Z"))}catch(d){s.time=o.format(r?"H:mm":"h:mm a"),s.fulltime=o.format("LLLL Z")}else s.time=o.format(r?"H:mm":"h:mm a"),s.fulltime=o.format("LLLL Z");var l=JST["widgets/worldclock/time"](s),c=i.domElement.find('ul.worldclock-times li[data-item_id="'+a.n+"_"+a.z+'"]');if(c.length||(c=t('<li data-item_id="'+a.n+"_"+a.z+'"></li>'),i.domElement.find("ul.worldclock-times").append(c)),c.empty().append(l),a.z&&o.tz){var u=i.domElement.find("ul.worldclock-times").children().andSelf().filter("li");e.contextmenu(u,t.proxy(i.getCityContextMenuItems,i))}i.initClickLink()})})}});var r}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Adsense.Google=e.Provider.registerType("adsense","google",{getNiceName:function(){return I18n.t("widgets.providers.adsense.google")},getIcon:function(){return"fa-google"},getAuthNamespace:function(){return"google_adsense_oauth2"},listAccounts:function(){function i(n,a){if(r.hasToken()){var o=t.proxy(i,r,n,a);if(!r.checkToken(o))return!1;e.GAPI.useWithAuth("adsense","v1.4",function(e,t){var i=e.accounts.list();i.execute(function(e){e&&!e.error?n(e.items):a(e),t()})},r.config.authorization.access_token)}else a("No credentials in Google Adsense provider - listAccounts()")}var n=t.Deferred(),r=this;return i(function(e){n.resolve(e)},function(e){Bugsnag.notify(e,"Yourls.Provider.Adsense.Google"),n.reject(r,e)}),n.promise()},fetchReport:function(i){function n(r,o){if(a.hasToken()){var s=t.proxy(n,a,r,o);if(!a.checkToken(s))return!1;e.GAPI.useWithAuth("adsense","v1.4",function(e,t){var n=e.accounts.reports.generate(i);n.execute(function(e){e&&!e.error?r(e):o("Fetching Google Adsense accounts failed"),t()})},a.config.authorization.access_token)}else o("No credentials in Google Adsense provider - listAccounts()")}i=t.extend({dimension:"DATE",metric:["EARNINGS","PAGE_VIEWS"]},i);var r=t.Deferred(),a=this;return n(function(e){r.resolve(e)},function(e){Bugsnag.notify(e,"Yourls.Provider.Adsense.Google"),r.reject(a,e)}),r.promise()}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Analytics.Google=e.Provider.registerType("analytics","google",{getNiceName:function(){return I18n.t("widgets.providers.analytics.google")},getIcon:function(){return"fa-google"},getAuthNamespace:function(){return"google_analytics_oauth2"},listAccounts:function(){function i(n,a){if(r.hasToken()){var o=t.proxy(i,r,n,a);if(!r.checkToken(o))return!1;e.GAPI.useWithAuth("analytics","v3",function(e,t){var i=e.management.accounts.list();i.execute(function(e){e&&!e.error?n(e.items):a("Fetching Google Analytics accounts failed"),t()})},r.config.authorization.access_token)}else a("No credentials in Google Analytics provider - listAccounts()")}var n=t.Deferred(),r=this;return i(function(e){n.resolve(e)},function(e){Bugsnag.notify(e,"Yourls.Provider.Analytics.Google"),n.reject(e)}),n.promise()},listWebProperties:function(i){function n(r,o){if(a.hasToken()){var s=t.proxy(n,a,r,o);if(!a.checkToken(s))return!1;e.GAPI.useWithAuth("analytics","v3",function(e,n){var a=window.gapi.client.newBatch();i.forEach(function(t){a.add(e.management.webproperties.list({accountId:t}))}),a.then(function(e,i){if(n(),"function"!=typeof i){var a=[];Object.keys(e.result).forEach(function(i){a=t.merge(a,e.result[i].result.items)}),r(a)}else o(i.result.error.message)})},a.config.authorization.access_token)}else o("No credentials in Google Analytics provider - listWebProperties()")}var r=t.Deferred(),a=this;return n(function(e){r.resolve(e)},function(e){Bugsnag.notify(e,"Yourls.Provider.Analytics.Google"),r.reject(e)}),r.promise()},listViews:function(i){function n(r,o){if(a.hasToken()){var s=t.proxy(n,a,r,o);if(!a.checkToken(s))return!1;e.GAPI.useWithAuth("analytics","v3",function(e,n){var a=window.gapi.client.newBatch();Object.keys(i).forEach(function(t){i[t].forEach(function(i){a.add(e.management.profiles.list({accountId:t,webPropertyId:i.id}))})}),a.then(function(e,i){if(n(),"function"!=typeof i){var a=[];Object.keys(e.result).forEach(function(i){a=t.merge(a,e.result[i].result.items)}),r(a)}else o(i.result.error.message)})},a.config.authorization.access_token)}else o("No credentials in Google Analytics provider - listViews()")}var r=t.Deferred(),a=this;return n(function(e){r.resolve(e)},function(e){Bugsnag.notify(e,"Yourls.Provider.Analytics.Google"),r.reject(e)}),r.promise()},listSegments:function(){function i(n,a){if(r.hasToken()){var o=t.proxy(i,r,n,a);if(!r.checkToken(o))return!1;e.GAPI.useWithAuth("analytics","v3",function(e,t){var i=e.management.segments.list();i.execute(function(e){e&&!e.error?n(e.items):a("Fetching Google Analytics segments failed"),t()})},r.config.authorization.access_token)}else a("No credentials in Google Analytics provider - listSegments()")}var n=t.Deferred(),r=this;return i(function(e){n.resolve(e)},function(e){Bugsnag.notify(e,"Yourls.Provider.Analytics.Google"),n.reject(e)}),n.promise()},getAnalyticsReportingData:function(i,n,r,a){function o(s,l){if(d.hasToken()){var c=t.proxy(o,d,s,l);if(!d.checkToken(c))return!1;e.GAPI.useWithAuth("analyticsreporting","v4",function(e,t){var o=n.split(",").map(function(e){return{expression:e}});window.gapi.client.analyticsreporting.reports.batchGet({reportRequests:[{viewId:String(i),dateRanges:[{startDate:String(2*a)+"daysAgo",endDate:String(a+1)+"daysAgo"},{startDate:String(a)+"daysAgo",endDate:"1daysAgo"}],metrics:o,dimensions:[{name:"ga:date"},{name:"ga:segment"}],segments:[{segmentId:r}]}]}).then(function(e){t();var i=e.result.reports[0];return i.data.rows?s(i):l("No metrics available",i)})},d.config.authorization.access_token)}else l("No credentials in Google Analytics provider - getMetrics()")}var s=t.Deferred(),d=this;return o(function(e){s.resolve(e)},function(e){Bugsnag.notify(e,"Yourls.Provider.Analytics.Google"),s.reject(e)}),s.promise()}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Calendar.Google=e.Provider.registerType("calendar","google",{config:{authorization:{}},setCustomConfig:function(e){this.config=t.extend({},this.config,e)},getCustomConfig:function(){return this.config},getIdentifier:function(){return this.config.authorization.email},getNiceName:function(){return I18n.t("widgets.providers.calendar.google")},getIcon:function(){return"fa-google"},getAuthNamespace:function(){return"google_calendar_oauth2"},getCalendar:function(i,n,r){function a(i,n,r,o,s,l){if(!i||!i.id)return s("Invalid calendar passed to Google provider");var c="calendar-"+i.id,u=e.Cache.get(c,!1),h=n.format("YYYYMMDD")+r.format("YYYYMMDD");if(l(u&&"undefined"!=typeof u&&"undefined"!=typeof u[h]?u[h]:!1),!d.hasToken())return s("No credentials in Google provider - loadCalendar");var f=t.proxy(a,d,i,n,r,o,s,l);return d.checkToken(f)?void e.GAPI.useWithAuth("calendar","v3",function(t,a){t.events.list({calendarId:i.id,timeMin:n.toISOString(),timeMax:r.toISOString(),singleEvents:!0}).execute(function(t){if(t.error)switch(t.error.code){case 400:s(t.error);break;case 401:d.checkToken(f);break;case 403:s(t.error)}else if(t.items){if("undefined"!=typeof t.timeZone)for(var i in t.items)t.items.hasOwnProperty(i)&&("undefined"!=typeof t.items[i].start.dateTime&&(t.items[i].start.dateTime=moment.tz(t.items[i].start.dateTime,t.timeZone).format()),"undefined"!=typeof t.items[i].start.date&&(t.items[i].start.date=moment.tz(t.items[i].start.date,t.timeZone).format()),"undefined"!=typeof t.items[i].end.dateTime&&(t.items[i].end.dateTime=moment.tz(t.items[i].end.dateTime,t.timeZone).format()),"undefined"!=typeof t.items[i].end.date&&(t.items[i].end.date=moment.tz(t.items[i].end.date,t.timeZone).format()));u||(u={}),u[h]=t.items,e.Cache.set(c,u,0),o(t.items)}a()})},d.config.authorization.access_token):!1}function o(t){var n=[];for(var r in t)if(t.hasOwnProperty(r)){var a={id:"",summary:"",description:"",location:"",start:"",end:"",allDay:!1,rrule:"",href:"",calendar:i};a.id="undefined"!=typeof t[r].id?t[r].id:"",a.summary="undefined"!=typeof t[r].summary?t[r].summary:"",a.description="undefined"!=typeof t[r].description?t[r].description:"",a.location="undefined"!=typeof t[r].location?t[r].location:"";var o="undefined"!=typeof t[r].start.dateTime?t[r].start.dateTime:t[r].start.date,s="undefined"!=typeof t[r].end.dateTime?t[r].end.dateTime:t[r].end.date;a.start=e.Util.toMoment(o),a.end=e.Util.toMoment(s),a.allDay="undefined"!=typeof t[r].start.date,a.rrule="undefined"!=typeof t[r].recurrence?t[r].recurrence[0].split(":")[1]:"",a.href="undefined"!=typeof t[r].htmlLink?t[r].htmlLink:"",n.push(a)}return n}var s=t.Deferred(),d=this;return a(i,n,r,function(e){var t=o(e);s.resolve(i,t)},function(e){Bugsnag.notify(e,"Yourls.Provider.Calendar.Google"),s.reject(i,d,e)},function(e){if(e){var t=o(e,i);s.notify(i,t)}else s.notify(i,[])}),s.promise()},listCalendars:function(){function i(n,r){if(a.hasToken()){var o=t.proxy(i,a,n,r);if(!a.checkToken(o))return!1;e.GAPI.useWithAuth("calendar","v3",function(e,t){e.calendarList.list().execute(function(e){if(e.error)switch(e.error.code){case 400:r(e.error);break;case 401:a.checkToken(o);break;case 403:r(e.error)}else e.items&&n(e.items);t()})},a.config.authorization.access_token)}else r("No credentials in Google provider - loadRemoteCalendars()")}function n(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)){var n={id:"",title:"",description:"",hidden:!1,provider:a.id};n.id=e[i].id,n.title=e[i].summary,n.description="undefined"!=typeof e[i].description?e[i].description:"",t.push(n)}return t=t.sort(function(e,t){return e.title.localeCompare(t.title)})}var r=t.Deferred(),a=this;return i(function(e){r.resolve(a,n(e))},function(e){Bugsnag.notify(e,"Yourls.Provider.Google"),r.reject(a,e)}),r.promise()}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Calendar.Ical=e.Provider.registerType("calendar","ical",{config:{},setCustomConfig:function(e){this.config=t.extend({},this.config,e)},getCustomConfig:function(){return this.config},getNiceName:function(){return I18n.t("widgets.providers.calendar.ical")},getIcon:function(){return"fa-calendar"},getCalendar:function(i,n,r){function a(n,r,a){if("undefined"!=typeof i&&"undefined"!=typeof i.url&&i.url.length>0){var o=e.Cache.get("calendar-"+i.url,!1),s=o?e.Util.toMoment(o.updated_at).add("15","minutes"):e.Util.toMoment();if(a(o&&"undefined"!=typeof o.items?o.items:!1),!o||e.Util.toMoment().isAfter(s)){var l=e.UrlHelper.proxyUrl(i.url);if(!l)return r("Invalid calendar URL");t.ajax({url:l,type:"get",success:function(t){var r=d._parse(t),a={updated_at:new Date,items:r};e.Cache.set("calendar-"+i.url,a,0),n(r)},error:function(){r()}})}else n(o.items)}else r("Invalid calender - getCalendar()")}function o(t,i){var n=[];for(var r in t)if(t.hasOwnProperty(r)){var a={id:"",summary:"",description:"",location:"",start:"",end:"",allDay:!1,rrule:"",href:"",calendar:{}};a.id=t[r].uid,a.summary="object"==typeof t[r].summary?t[r].summary.val:t[r].summary,a.description=t[r].description,a.location=t[r].location,a.start=e.Util.toMoment(t[r].start),a.end=e.Util.toMoment(t[r].end),a.allDay="undefined"!=typeof t[r].allDay?t[r].allDay:!1,a.rrule=t[r].rrule,a.calendar=i,n.push(a)}return n}var s=t.Deferred(),d=this;return a(function(e){var t=o(e,i);t=d.expand(t,n,r),t=d.between(t,n,r),s.resolve(i,t)},function(){s.reject(i,d)},function(e){var t=o(e,i);t=d.expand(t,n,r),t=d.between(t,n,r),s.notify(i,t)}),s.promise()},listCalendars:function(){var e=t.Deferred();return e.resolve(this,!1),e.promise()},_parse:function(e){var t=ical.parseICS(e),i=[];for(var n in t)t.hasOwnProperty(n)&&"VEVENT"==t[n].type&&i.push(t[n]);return i}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Calendar.WindowsLive=e.Provider.registerType("calendar","windowslive",{config:{authorization:{},baseUrl:"https://apis.live.net/v5.0/"},setCustomConfig:function(e){this.config=t.extend({},this.config,e)},getCustomConfig:function(){return this.config},getIdentifier:function(){return this.config.authorization.email},getNiceName:function(){return I18n.t("widgets.providers.calendar.windowslive")},getIcon:function(){return"fa-windows"},getAuthNamespace:function(){return"windowslive_calendar_oauth2"},getCalendar:function(i,n,r){function a(t){var n=[];for(var r in t)if(t.hasOwnProperty(r)){var a={id:"",summary:"",description:"",location:"",start:"",end:"",allDay:!1,rrule:"",href:"",calendar:i};a.id="undefined"!=typeof t[r].id?t[r].id:"",a.summary="undefined"!=typeof t[r].name?t[r].name:"",a.description="undefined"!=typeof t[r].description?t[r].description:"",a.location="undefined"!=typeof t[r].location?t[r].location:"";var o=t[r].start_time,d=t[r].end_time;a.start=e.Util.toMoment(o),a.end=e.Util.toMoment(d),a.allDay=t[r].is_all_day_event,a.rrule="",a.href=s.getHref(t[r]),n.push(a)}return n}var o=t.Deferred(),s=this,d="calendar-"+i.id,l=e.Cache.get(d),c=n.format("YYYYMMDD")+r.format("YYYYMMDD");return l&&"undefined"!=typeof l&&"undefined"!=typeof l[c]?o.notify(i,a(l[c])):o.notify(i,[]),this.call(i.id+"/events",function(t){l||(l={}),l[c]=t.data,e.Cache.set(d,l,0),o.resolve(i,a(t.data))},function(e){Bugsnag.notify(e,"Yourls.Provider.Calendar.WindowsLive"),o.reject(i,s,e)},"GET",{start_time:n.toISOString(),end_time:r.toISOString()}),o.promise()},listCalendars:function(){function e(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)){var r={id:"",title:"",description:"",hidden:!1,provider:n.id};r.id=e[i].id,r.title=e[i].name,r.description="undefined"!=typeof e[i].description?e[i].description:"",t.push(r)}return t=t.sort(function(e,t){return e.title.localeCompare(t.title)})}var i=t.Deferred(),n=this;return this.call("me/calendars",function(t){i.resolve(n,e(t.data))},function(e){Bugsnag.notify(e,"Yourls.Provider.Calendar.Google"),i.reject(n,e)}),i.promise()},getHref:function(e){var t="https://calendar.live.com/calendar/calendar.aspx?rru=eventdetails?",i=e.id.split("."),n=i[2],r=i[3];return r=r.substr(0,8)+"-"+r.substr(8,4)+"-"+r.substr(12,4)+"-"+r.substr(16,4)+"-"+r.substr(20,12),n=n.substr(0,8)+"-"+n.substr(8,4)+"-"+n.substr(12,4)+"-"+n.substr(16,4)+"-"+n.substr(20,12),t+="event="+r+"%26calendar="+n}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Email.Aol=e.Provider.registerType("email","aol",{listEmail:function(t){return e.CIO.fetch(this,t)},listEmailLabels:function(){return e.CIO.listEmailLabels()},getNiceName:function(){return I18n.t("widgets.providers.email.aol")},getIcon:function(){return"fa-envelope"},getAuthNamespace:function(){return"cio_aol"},getUrlForMessage:function(e,t){return"https://mail.aol.com/"},getPlaceholderEmailAddress:function(){return"example@aol.com"}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Email.CustomImap=e.Provider.registerType("email","custom_imap",{listEmail:function(t){return e.CIO.fetch(this,t)},listEmailLabels:function(){return e.CIO.listEmailLabels()},getNiceName:function(){return I18n.t("widgets.providers.email.custom_imap")},getIcon:function(){return"fa-envelope"},getAuthNamespace:function(){return"cio_custom_imap"}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Email.Google=e.Provider.registerType("email","google",{listEmail:function(i){function n(a,d,l){if(s.hasToken()){var c=t.proxy(n,s,a,d,l),u="email-"+s.config.authorization.email;"undefined"!=typeof i&&(u+="-"+i.id);var h=e.Cache.get(u,!1);if(h&&l(h),!s.checkToken(c))return!1;e.GAPI.useWithAuth("gmail","v1",function(t,n){var l=window.gapi.client.newHttpBatch();l.add(t.users.messages.list({userId:"me",maxResults:100,labelIds:"undefined"!=typeof i?[i.id]:void 0}),{id:"list"}),l.execute(function(t){var l=t.list.result;if(l.error){switch(l.error.code){case 400:d(l.error);break;case 401:s.checkToken(c);break;case 403:d(l.error)}n()}else l.messages?r(l,i,a,d,n):(e.Cache.set(u,[],0),o.resolve([]))})},s.config.authorization.access_token)}else d("No credentials in Google provider - listEmail")}function r(t,i,n,r,a){for(var o=window.gapi.client.newHttpBatch(),d=0;d<t.messages.length;d++){var l=t.messages[d].id;o.add(window.gapi.client.gmail.users.messages.get({userId:"me",format:"metadata",metadataHeaders:["Date","From","Subject"],id:l}),{id:l})}o.execute(function(o){for(var d=[],l=0;l<t.messages.length;l++){var c=t.messages[l].id,u=o[c];if(u){if(u.error)return void r("gmail.users.messages.get: "+u.error.message);d.push(u.result)}}var h="email-"+s.config.authorization.email;"undefined"!=typeof i&&(h+="-"+i.id),e.Cache.set(h,d,0),a(),n(d)})}function a(i){var n=[];for(var r in i){if(i.hasOwnProperty(r)){var a={id:"",author:"",title:"",date:"",summary:"",unread:!1,starred:!1},o=i[r];a.id=o.id,a.unread=t.inArray("UNREAD",o.labelIds)>=0,a.labels=o.labelIds,a.summary=o.snippet,a.starred=t.inArray("STARRED",o.labelIds)>=0;for(var s=0;s<o.payload.headers.length;s++){var d=o.payload.headers[s];switch(d.name){case"Date":a.date=e.Util.toMoment(d.value);break;case"From":a.author=d.value;break;case"Subject":a.title=d.value}}}n.push(a)}return n}var o=t.Deferred(),s=this;return n(function(e){o.resolve(s,a(e))},function(e){o.reject(s,e)},function(e){o.notify(s,a(e))}),o.promise()},listEmailLabels:function(){return[{id:"INBOX",title:I18n.t("widgets.email.labels.inbox")},{id:"UNREAD",title:I18n.t("widgets.email.labels.unread")},{id:"CATEGORY_PERSONAL",title:I18n.t("widgets.email.labels.primary")},{id:"IMPORTANT",title:I18n.t("widgets.email.labels.important")},{id:"STARRED",title:I18n.t("widgets.email.labels.starred")},{id:"SENT",title:I18n.t("widgets.email.labels.sent")}]},getNiceName:function(){return I18n.t("widgets.providers.email.google")},getIcon:function(){return"fa-google"},getAuthNamespace:function(){return"gmail_api_oauth2"},getUrlForMessage:function(e,t){var i="https://mail.google.com/mail",n="?authuser="+this.getIdentifier(),r=e.id;if("undefined"!=typeof t)if(t.custom)r="#label/"+t.title+"/"+r;else{var a={INBOX:"inbox",UNREAD:"inbox",IMPORTANT:"imp",SENT:"sent",STARRED:"starred",TRASH:"trash"};r="#"+a[t.id]+"/"+r}return i+n+r}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Email.MailRu=e.Provider.registerType("email","mailru",{listEmail:function(t){return e.CIO.fetch(this,t)},listEmailLabels:function(){return e.CIO.listEmailLabels()},getNiceName:function(){return I18n.t("widgets.providers.email.mailru")},getIcon:function(){return"fa-envelope"},getAuthNamespace:function(){return"cio_mailru"},getUrlForMessage:function(e,t){return"https://e.mail.ru/"},getPlaceholderEmailAddress:function(){return"example@mail.ru"}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Email.WindowsLive=e.Provider.registerType("email","windowslive",{listEmail:function(t){return e.CIO.fetch(this,t)},listEmailLabels:function(){return e.CIO.listEmailLabels()},getNiceName:function(){return I18n.t("widgets.providers.email.windowslive")},getIcon:function(){return"fa-windows"},getAuthNamespace:function(){return"cio_windowslive_oauth2"},getUrlForMessage:function(e,t){return""}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Email.Yahoo=e.Provider.registerType("email","yahoo",{listEmail:function(t){return e.CIO.fetch(this,t)},listEmailLabels:function(){return e.CIO.listEmailLabels()},getNiceName:function(){return I18n.t("widgets.providers.email.yahoo")},getIcon:function(){return"fa-yahoo"},getAuthNamespace:function(){return"cio_yahoo"},getUrlForMessage:function(e,t){return"https://mail.yahoo.com"},getPlaceholderEmailAddress:function(){return"example@yahoo.com"}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Email.Zoho=e.Provider.registerType("email","yandex",{listEmail:function(t){return e.CIO.fetch(this,t)},listEmailLabels:function(){return e.CIO.listEmailLabels()},getNiceName:function(){return I18n.t("widgets.providers.email.yandex")},getIcon:function(){return"fa-envelope"},getAuthNamespace:function(){return"cio_yandex"},getUrlForMessage:function(e,t){return"https://mail.yandex.com/"},getPlaceholderEmailAddress:function(){return"example@yandex.com"}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Email.Zoho=e.Provider.registerType("email","zoho",{listEmail:function(t){return e.CIO.fetch(this,t)},listEmailLabels:function(){return e.CIO.listEmailLabels()},getNiceName:function(){return I18n.t("widgets.providers.email.zoho")},getIcon:function(){return"fa-envelope"},getAuthNamespace:function(){return"cio_zoho"},getUrlForMessage:function(e,t){return""},getPlaceholderEmailAddress:function(){return"example@zoho.com"}})}(Yourls,jQuery),function(e,t){"use strict";e.Provider.Tasks.Google=e.Provider.registerType("tasks","google",{getNiceName:function(){return I18n.t("widgets.providers.tasks.google")},getIcon:function(){return"fa-google"},getAuthNamespace:function(){return"google_tasks_oauth2"},fetchTaskLists:function(){var e=t.Deferred();return this.callGAPI("tasklists","list",{}).then(function(t){if(t.items){for(var i=[],n=null,r=0;r<t.items.length;r++){var a=t.items[r];i.push({id:a.id,title:a.title}),0==r&&(n=a.id)}var o={status:"tasklists",tasklists:i,currentTasklist:n};return e.resolve(o)}return e.reject(new Error("no task lists found"))}),e.promise()},fetchTasks:function(e){var i=t.Deferred();return("undefined"==typeof e||null==e)&&i.resolve(),this.callGAPI("tasks","list",{tasklist:e}).then(function(t){if(t.items){for(var n=[],r=0;r<t.items.length;r++){var a=t.items[r];a.tasklist_id=e,n.push(a)}var o={status:"tasks",tasks:n};return i.resolve(o)}}),i.promise()},executeInsertTask:function(e,t,i){var n={tasklist:t,previous:i,title:e};return this.callGAPI("tasks","insert",n)},executeToggleTaskCompleted:function(e,t,i){var n={task:e,tasklist:t,resource:{id:e,status:i?"needsAction":"completed"}};return this.callGAPI("tasks","update",n)},executeUpdateTask:function(e,t,i,n){var r={task:e,tasklist:t,resource:{id:e,title:i,notes:n}};return this.callGAPI("tasks","update",r)},executeDeleteTask:function(e,t){var i={task:e,tasklist:t};return this.callGAPI("tasks","delete",i)},callGAPI:function(i,n,r){var a=this,o=t.Deferred(),s=t.proxy(this.callGAPI,a,i,n,r);return a.checkToken(s)?(e.GAPI.useWithAuth("tasks","v1",function(e,t){e[i][n](r).execute(function(e){return setTimeout(t,1),e&&!e.error?o.resolve(e):(Bugsnag.notify("GtasksWidget","Failed to get tasks",{error:e.error},"warning"),o.reject(e.error))})},this.config.authorization.access_token),o.promise()):o.reject(new Error("Failed to refresh token after retrying"))}})}(Yourls,jQuery),Yourls.boot=function(e,t,i){"use strict";measureEnd("beforeInit"),measure("initialize"),window.dataLayer=window.dataLayer||[];var n=i("#configuration").data(),r="development"==n.environment;window.primaryDomain=n.primaryDomain,window.primaryBaseUrl=n.primaryBaseUrl,window.proxyDomain=n.proxyDomain;try{document.domain.indexOf(window.primaryDomain)>=0&&(document.domain=window.primaryDomain)}catch(a){window.Bugsnag&&Bugsnag.notifyException(a)}window.CurrentUser=n.currentUser,window.countryCode=n.country,t.locale=n.locale,t.fallbacks=!1,t.missingTranslationPrefix="",t.missingBehaviour=r?"message":"guess",window.asset_path=n.assetPath,i.cloudinary.config("cloud_name",n.cloudinaryCloud),i.cloudinary.config("static_image_support",!0),i.cloudinary.config("cdn_subdomain",!1),moment.suppressDeprecationWarnings=!r,i.timeago.settings.allowFuture=!0,window.favicon_provider=n.faviconProvider,window.skimlinks_site_id=n.skimlinksSiteId,window.viglink_api_key=n.viglinkApiKey,Bugsnag.user=n.currentUser,window.referal=n.referal;var o=i("#data").text();try{o=JSON.parse(o)}catch(a){o&&Bugsnag.notifyException(a,"Error parsing page data"),o=null}var s=e.init(o).then(function(){var t=n.flash;t.error?e.error(t.error):t.alert?e.showNotification(t.alert,{type:"alert",autoClose:1e4}):t.notice&&e.showNotification(t.notice,{autoClose:1e4})});return measureEnd("initialize"),s}.bind(this,Yourls,I18n,$);